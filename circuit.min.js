(function (root, factory) {
  if (root === undefined && window !== undefined) root = window;
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define([], function () {
      return (root['Circuit'] = factory());
    });
  } else if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    root['Circuit'] = factory();
  }
}(this, function () {

/**
 *  Copyright 2020 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.8401
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.8401'});


var global=Function("return this")(),window=global.window||global,navigator=global.navigator||window.navigator||{},document=window.document,WebSocket=global.WebSocket,XMLHttpRequest=global.XMLHttpRequest,Promise=global.Promise,Circuit=function(e){"use strict";var t=e.Enums.ConnectionState,n=e.Constants,i=e.Enums,r=e.logger,o=e.Utils;return e.GuestClient=function(a){if(!a||!a.client_id)throw new Error("Cannot create GuestClient object without a client_id");e.BaseEventTarget.call(this,e.logger);var s=this,c=e.Enums.ConnectionState.Disconnected,l=Object.assign({domain:"circuitsandbox.net"},a),d=/<image(?:\s|\s.*?\s)href="(https:\/\/[^"]+)"/,u=[],E=!1,C=null,T=new e.ClientApiHandler(l);T.setRelativeUrl("/guestApi");var p=new e.UserToUserHandler(T),S=e.RtcSessionController;s._clientApiHandler=T,s._userToUserHandler=p,s._rtcSessionController=S;var I=new e.SdkServices(T,p,!0),A=null,R=null,f=null,_=null;function v(e,t,i,r){if(e===n.ReturnCode.NO_RESULT&&i)return!1;if(e){var o=T.getLastError();return r&&r(o),o&&delete o.errObj,t(o),!0}return!1}function g(e,t){return!!e&&(t(new Circuit.Error(n.ReturnCode.SDK_ERROR,e)),!0)}function N(){return new Promise((function(t,i){T.setClientInfo({deviceType:n.DeviceType.SDK,deviceSubtype:o.getDeviceSubtype(),clientVersion:e.version,client_id:l.client_id}),T.connect((function(){r.info("[Guest SDK]: Successfully connected to access server"),t()}),(function(e){r.error("[Guest SDK]: Failed to connect: ",e),i(new Circuit.Error(n.ReturnCode.SDK_ERROR,e))}),s.domain)}))}function m(){return N().then((function(){C=window.setInterval(G,50),new Promise((function(e,t){T.getUserData((function(n,i){v(n,t)||(S.processClientSettings(i.clientSettings),e(i))}))}))})).then((function(){c=e.Enums.ConnectionState.Ready,w({type:"connectionStateChanged",state:e.Enums.ConnectionState.Ready})}))}function h(){T.disconnect(),C&&(window.clearInterval(C),s.dispatch({type:"connectionStateChanged",state:t.Disconnected}))}function O(){return new Promise((function(e){if(!A)return h(),void e();A=null,R=null;var t=function(){h(),e()},n=window.setTimeout((function(){n=null,t()}),2e3);T.logout((function(){n&&(window.clearTimeout(n),t())}))}))}function D(e,t){return new Promise((function(n,i){T.validateSessionInvite(e,null,(function(e,r){v(e,i)||n(r),t&&h()}))}))}function P(){return new Promise((function(e,t){R?I.CallControlSvc.endCall(R.callId,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))}function y(e){return new Promise((function(t,i){if(R)if(R.hasLocalScreenShare())I.CallControlSvc.removeMediaStream(R.callId,(function(e){g(e,i)||t()}));else{if(!e)return void i(new Circuit.Error(n.ReturnCode.SDK_ERROR,"Missing MediaStream"));I.CallControlSvc.addMediaStream(R.callId,e,(function(e){g(e,i)||t()}))}else i(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call"))}))}function b(e){return new Promise((function(t,i){if(void 0!==e)if(R){var r=R.sessionCtrl.getLocalStream(e);r?t(r):i("No stream found with id "+e)}else i(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call"));else i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"id is required"))}))}function U(e){if(e&&e.xmlElement){var t=d.exec(e.xmlElement);if(t&&t[1]){var n=t[1],i=n.indexOf("/fileapi");-1!==i&&(n=o.getOrigin()+n.slice(i))!==t[1]&&(e.xmlElement=e.xmlElement.replace(t[1],n))}}}var L=["activeMediaType","callId","convId","convType","cstaCallId","direction","establishedTime","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoStream","localVideoUrl","localStreams","mediaType","participants","peerUser","remoteAudioDisabled","remoteAudioStream","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","remoteVideoStreams","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];function M(e){if(!e)return Promise.resolve();var t={};return L.forEach((function(n){try{t[n]=e[n]}catch(e){}})),t.state=e.state.name,t.isEstablished=e.state.established,function(e,t){if("function"==typeof e)try{var n=e(t);if(n&&"object"==typeof n)return"function"==typeof n.then?n:Promise.resolve(n)}catch(e){r.error("[Guest SDK]: Error applying injector. ",e)}return Promise.resolve(t)}(Circuit.Injectors.callInjector,t)}function w(e){C&&(r.debug("[Guest SDK]: Enqueue "+e.type),u.push(e))}function G(){if(!E&&u.length){E=!0;try{var e=u.shift();if(r.debug("[Guest SDK]: Dequeue "+e.type+". Events left in the queue: "+u.length),!s.hasEventListener(e.type))return void r.debug("[Guest SDK]: There is no listener for this event");var t=[];t.push(e.call?M(e.call):void 0),Promise.all(t).then((function(t){t[0]&&(e.call=t[0]),r.debug("[Guest SDK]: Dispatch ",e.type),s.dispatch(e)}))}catch(e){r.error("[Guest SDK]: Error processing event queue. ",e)}finally{E=!1}}}return Object.defineProperty(s,"domain",{get:function(){return l.domain},set:function(e){l.domain=e},enumerable:!0,configurable:!1}),Object.defineProperty(s,"connectionState",{get:function(){return c},enumerable:!0,configurable:!0}),Object.defineProperty(s,"getAudioVideoStats",{get:function(){if(!R)return function(){return Promise.reject(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call"))};var e=R.sessionCtrl.getCurrentPeerConnection();return e&&e.getStats?e.origGetStats?e.origGetStats.bind(e):e.getStats.bind(e):function(){return Promise.reject(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No PeerConnection present"))}},enumerable:!1,configurable:!1}),s.validateToken=function(e){return R?D(e,!1):N().then((function(){return D(e,!0)}))},s.monitorSession=function(e,t,o){return _?Promise.reject(i.MonitorSessionError.MONITOR_IN_PROGRESS):new Promise((function(a,s){_=s,function e(t,o,a){return new Promise((function(s,c){R?c(i.MonitorSessionError.CLIENT_BUSY):(o=Math.max(o,5)||5,a=Math.min(a,600),isNaN(a)&&(a=60),N().then((function(){return D(t,!0)})).then((function(l){if(_)switch(r.debug("[Guest SDK]: Validate token result: ",l.validateResult),l.validateResult){case n.SessionInviteInfoResult.VALID_NOSESSION:a<o?c(i.MonitorSessionError.TIMEOUT):(r.debug("[Guest SDK]: Start "+o+" seconds timer before testing again. Remaining time "+a+" seconds."),f=window.setTimeout((function(){f=null,e(t,o,a-=o).then(s).catch(c)}),1e3*o));break;case n.SessionInviteInfoResult.VALID_SESSION:s();break;case n.SessionInviteInfoResult.INVALID:c(i.MonitorSessionError.INVALID_TOKEN);break;case n.SessionInviteInfoResult.VALID_NO_GUEST_ACCESS:c(i.MonitorSessionError.NO_GUEST_ACCESS);break;default:c(i.MonitorSessionError.SERVICE_EXCEPTION)}})).catch((function(e){r.error("[Guest SDK]: Failed to monitor session: ",e.code||e),c(i.MonitorSessionError.SERVICE_EXCEPTION)})))}))}(e,t,o).then(a).catch(s).finally((function(){_=null}))}))},s.cancelMonitor=function(){_&&(f&&(clearTimeout(f),f=null),_(i.MonitorSessionError.MONITOR_CANCELED),_=null)},s.joinConference=function(e,t){return e&&e.token&&e.firstName&&e.lastName?m().then((function(){return D(e.token)})).then((function(t){switch(t.validateResult){case n.SessionInviteInfoResult.VALID_SESSION:return function(e){return new Promise((function(t,i){T.registerSessionGuest(e,(function(r,o){r?i(r):T.getConversationSummary(o.convId,e.token,(function(r,a){r?i(r):(A={userId:o.userId,firstName:e.firstName,lastName:e.lastName,displayName:e.firstName+" "+e.lastName,clientId:o.clientId,userType:n.UserType.SESSION_GUEST,apiVersion:o.apiVersion,hasPermission:function(){return!1}},o.guestContext&&(A.guestContext=o.guestContext,A.keysToOmitFromLogging=["guestContext"],o.keysToOmitFromLogging=["guestContext"]),I.SdkHelperSvc.setLocalUser(A),a.participants=[{userId:A.userId}],I.SdkHelperSvc.addConversationToCache(a),t(a))}))}))}))}(e);case n.SessionInviteInfoResult.INVALID:return Promise.reject(i.GuestJoinError.INVALID_TOKEN);case n.SessionInviteInfoResult.VALID_NO_GUEST_ACCESS:return Promise.reject(i.GuestJoinError.NO_GUEST_ACCESS);case n.SessionInviteInfoResult.VALID_NOSESSION:return Promise.reject(i.GuestJoinError.NO_SESSION);default:return Promise.reject(i.GuestJoinError.SERVICE_EXCEPTION)}})).then((function(e){return r.info("[Guest SDK]: Successfully registered guest. Join the active session."),function(e,t){return new Promise((function(n,i){I.CallControlSvc.startConference(e,t,(function(e,t,o){e?i(e):(r.debug("[Guest SDK]: Started conference with callId = "+o.callId+", warning = "+(t||"None")),n(R=o))}))}))}(e.convId,t)})).catch((function(e){return r.error("[Guest SDK]: Failed to register guest: ",e),O(),i.GuestJoinError[e]?Promise.reject(e):Promise.reject(i.GuestJoinError.SERVICE_EXCEPTION)})):Promise.reject("guestData is missing required data")},s.logout=function(){return P().catch((function(){})).then(O)},s.getActiveCall=function(){return R},s.leaveConference=P,s.setMediaDevices=function(e){return new Promise((function(t,i){e?e.playback||e.recording||e.video||e.ringing?(e.playback&&(e.playback=Array.isArray(e.playback)?e.playback:[e.playback],S.playbackDevices=e.playback.map((function(e){return{id:e}}))),e.recording&&(e.recording=Array.isArray(e.recording)?e.recording:[e.recording],S.recordingDevices=e.recording.map((function(e){return{id:e}}))),e.video&&(e.video=Array.isArray(e.video)?e.video:[e.video],S.videoDevices=e.video.map((function(e){return{id:e}}))),e.ringing&&(e.ringing=Array.isArray(e.ringing)?e.ringing:[e.ringing],S.ringingDevices=e.ringing.map((function(e){return{id:e}}))),R?I.CallControlSvc.renegotiateMedia(R.callId,(function(e){e&&r.warn("[Guest SDK]: Unable to renegotiate media.",e),t()})):t()):i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes")):i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"))}))},s.muteParticipant=function(e){return new Promise((function(t,i){R?I.CallControlSvc.muteParticipant(R.callId,{userId:e},(function(e){g(e,i)||t()})):i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.toggleVideo=function(){return new Promise((function(e,t){R?I.CallControlSvc.toggleVideo(R.callId,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.toggleRemoteAudio=function(){return new Promise((function(e,t){R?(R.remoteAudioDisabled?I.CallControlSvc.enableRemoteAudio(R.callId):I.CallControlSvc.disableRemoteAudio(R.callId),e(R.callId)):t(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call"))}))},s.toggleRemoteVideo=function(){return new Promise((function(e,t){R?I.CallControlSvc.toggleRemoteVideo(R.callId,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.toggleScreenShare=function(){return new Promise((function(e,t){R?R.hasLocalScreenShare()?I.CallControlSvc.removeScreenShare(R.callId,(function(n){g(n,t)||e()})):I.CallControlSvc.addScreenShare(R.callId,null,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call"))}))},s.setScreenshareStream=y,s.toggleMediaStream=y,s.getLocalAudioVideoStream=b.bind(s,S.LOCAL_STREAMS.AUDIO_VIDEO),s.getLocalScreenshareStream=b.bind(s,S.LOCAL_STREAMS.DESKTOP),s.setAudioVideoStream=function(e,t){return new Promise((function(i,r){e?R?Circuit.WebRTCAdapter.origGetUserMedia?r(new Circuit.Error(n.ReturnCode.SDK_ERROR,"Already setting another audio/video stream")):(t=t||{audio:!!e.getAudioTracks().length,video:!!e.getVideoTracks().length},Circuit.WebRTCAdapter.origGetUserMedia=Circuit.WebRTCAdapter.getUserMedia,Circuit.WebRTCAdapter.getUserMedia=function(t,n){n&&n(e)},R.sessionCtrl.dontReuseAudioStream=!0,I.CallControlSvc.setMediaType(R.callId,t,(function(e){R.sessionCtrl.dontReuseAudioStream=!1,Circuit.WebRTCAdapter.getUserMedia=Circuit.WebRTCAdapter.origGetUserMedia,delete Circuit.WebRTCAdapter.origGetUserMedia,g(e,r)||i()}))):r(new Circuit.Error(n.ReturnCode.SDK_ERROR,"No active call")):r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"))}))},s.mute=function(){return new Promise((function(e,t){R?I.CallControlSvc.mute(R.callId,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.unmute=function(){return new Promise((function(e,t){R?I.CallControlSvc.unmute(R.callId,(function(n){g(n,t)||e()})):t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.getLastRtpStats=function(){return R&&R.sessionCtrl?R.savedRTPStats||[]:null},s.getRemoteStreams=function(){return R&&R.sessionCtrl?R.sessionCtrl.getRemoteStreams()||[]:null},s.addWhiteboardElement=function(e){return new Promise((function(t,i){if(R)if(e){var r={rtcSessionId:R.callId,xmlElement:e};T.addWhiteboardElement(r,(function(e){v(e,i)||t()}))}else i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.removeWhiteboardElement=function(e){return new Promise((function(t,i){if(R)if(e){var r={rtcSessionId:R.callId,xmlId:e};T.removeWhiteboardElement(r,(function(e){v(e,i)||t()}))}else i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else i(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.updateWhiteboardElement=function(e,t){return new Promise((function(i,r){if(R)if(e)if(t){var o={rtcSessionId:R.callId,xmlId:e,xmlElement:t};T.updateWhiteboardElement(o,(function(e){v(e,r)||i()}))}else r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.clearWhiteboard=function(e,t){return new Promise((function(i,r){if(R){var o={rtcSessionId:R.callId,userId:e||void 0,preserveBackground:t||void 0};T.clearWhiteboard(o,(function(e){v(e,r)||i()}))}else r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.getWhiteboard=function(){return new Promise((function(e,t){if(R){var i={rtcSessionId:R.callId};T.getWhiteboard(i,(function(n,i){v(n,t)||(i.elements&&i.elements.forEach(U),i.callId=i.rtcSessionId,delete i.rtcSessionId,e(i))}))}else t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.setWhiteboardBackground=function(t){return new Promise((function(i,o){if(R)if(t)if("object"==typeof t)new e.FileUpload(l).uploadWhiteboardFile(t,R.callId).then((function(e){var t={rtcSessionId:R.callId,url:e.url};T.setWhiteboardBackground(t,(function(e){v(e,o)||i()}))})).catch((function(e){r.error("[Guest SDK]: File upload error. ",e),o(new Circuit.Error(n.ReturnCode.SDK_ERROR,e))}));else if("string"==typeof t){var a={rtcSessionId:R.callId,url:t};T.setWhiteboardBackground(a,(function(e){v(e,o)||i()}))}else o(new Circuit.Error(n.ReturnCode.SDK_ERROR,"file must be a File object or a string"));else o(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"));else o(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.clearWhiteboardBackground=function(){return new Promise((function(e,t){if(R){var i={rtcSessionId:R.callId};T.clearWhiteboardBackground(i,(function(n){v(n,t)||e()}))}else t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.toggleWhiteboardOverlay=function(){return new Promise((function(e,t){if(R){var i={rtcSessionId:R.callId};T.toggleWhiteboardOverlay(i,(function(n){v(n,t)||e()}))}else t(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},s.undoWhiteboard=function(e,t){return new Promise((function(i,r){if(R){var o={rtcSessionId:R.callId,steps:e,userId:t||void 0};T.undoWhiteboard(o,(function(e){v(e,r)||i()}))}else r(new Circuit.Error(n.ReturnCode.MISSING_REQUIRED_PARAMETER,"No active call"))}))},T.addEventListener("connectionStateChange",(function(e){if(c===t.Reconnecting)return r.debug("[Guest SDK]: Connection is lost. Disconnect."),void s.logout();c=e.newState,w({type:"connectionStateChanged",state:e.newState})})),T.on("User.SESSION_CLOSED",(function(e){w({type:"sessionClosed",reason:e.reason})})),T.on("RTCSession.WHITEBOARD_ENABLED",(function(e){R&&R.callId===e.sessionId&&(R.whiteboardEnabled=!0,w({type:"whiteboardEnabled",enabled:!0,whiteboard:e.whiteboard,data:{enabled:!0,whiteboard:e.whiteboard}}),w({type:"callStatus",call:R,reason:"whiteboardEnabled"}))})),T.on("RTCSession.WHITEBOARD_DISABLED",(function(e){R&&R.callId===e.sessionId&&(R.whiteboardEnabled=!1,w({type:"whiteboardEnabled",enabled:!1,data:{enabled:!1}}),w({type:"callStatus",call:R,reason:"whiteboardEnabled"}))})),T.on("RTCSession.WHITEBOARD_CLEARED",(function(e){R&&R.callId===e.sessionId&&w({type:"whiteboardCleared",userId:e.userId,possibleUndoOperations:e.possibleUndoOperations})})),T.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",(function(e){R&&R.callId===e.sessionId&&(U(e.element),w({type:"whiteboardElement",action:"added",element:e.element,possibleUndoOperations:e.possibleUndoOperations}))})),T.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",(function(e){R&&R.callId===e.sessionId&&w({type:"whiteboardElement",action:"removed",elementId:e.elementId,possibleUndoOperations:e.possibleUndoOperations})})),T.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",(function(e){R&&R.callId===e.sessionId&&(U(e.element),w({type:"whiteboardElement",action:"updated",element:e.element,possibleUndoOperations:e.possibleUndoOperations}))})),T.on("RTCSession.WHITEBOARD_BACKGROUND_SET",(function(e){U(e.element),w({type:"whiteboardBackground",action:"set",element:e.element,possibleUndoOperations:e.possibleUndoOperations})})),T.on("RTCSession.WHITEBOARD_BACKGROUND_CLEARED",(function(){w({type:"whiteboardBackground",action:"cleared"})})),T.on("RTCSession.WHITEBOARD_OVERLAY_TOGGLED",(function(){w({type:"whiteboardOverlayToggled"})})),T.on("RTCSession.WHITEBOARD_SYNC",(function(e){w({type:"whiteboardSync",whiteboard:e.whiteboard,possibleUndoOperations:e.possibleUndoOperations})})),T.on("RTCSession.WHITEBOARD_CONVERSION_FAILED",(function(e){w({type:"whiteboardConversionFailed",callId:e.sessionId,errorText:e.errorText,lastElements:e.lastElements})})),I.PubSubSvc.subscribe("/call/state",(function(e){R===e&&w({type:"callStatus",call:e,reason:"callStateChanged"})})),I.PubSubSvc.subscribe("/call/remoteStreamUpdated",(function(e){R===e&&w({type:"callStatus",call:e,reason:"remoteStreamUpdated"})})),I.PubSubSvc.subscribe("/call/localStreamEnded",(function(e){R===e&&w({type:"callStatus",call:e,reason:"localStreamEnded"})})),I.PubSubSvc.subscribe("/call/muted",(function(e){R===e&&w({type:"callStatus",call:e,reason:"callMuted"})})),I.PubSubSvc.subscribe("/call/localUser/muted",(function(e){R&&R.callId===e&&w({type:"callStatus",call:R,reason:"localUserMuted"})})),I.PubSubSvc.subscribe("/call/localUser/unmuted",(function(e){R&&R.callId===e&&w({type:"callStatus",call:R,reason:"localUserUnmuted"})})),I.PubSubSvc.subscribe("/call/localUser/mutedSelf",(function(e,t){R&&R.callId===e&&w(t?{type:"callStatus",call:R,reason:"localUserSelfMuted"}:{type:"callStatus",call:R,reason:"localUserSelfUnmuted"})})),I.PubSubSvc.subscribe("/call/locked",(function(e){R===e&&w({type:"callStatus",call:e,reason:"callLocked"})})),I.PubSubSvc.subscribe("/call/participant/updated",(function(e,t){R&&R.callId===e&&w({type:"callStatus",call:R,participant:t,reason:"participantUpdated"})})),I.PubSubSvc.subscribe("/call/participants/updated",(function(e,t){R&&R.callId===e&&w({type:"callStatus",call:R,participants:t,reason:"participantsUpdated"})})),I.PubSubSvc.subscribe("/call/participant/added",(function(e,t){R&&R.callId===e&&w({type:"callStatus",call:R,participant:t,reason:"participantAdded"})})),I.PubSubSvc.subscribe("/call/participants/added",(function(e,t){R&&R.callId===e&&w({type:"callStatus",call:R,participants:t,reason:"participantsAdded"})})),I.PubSubSvc.subscribe("/call/participant/joined",(function(e,t){R===e&&w({type:"callStatus",call:e,participant:t,reason:"participantJoined"})})),I.PubSubSvc.subscribe("/call/participant/removed",(function(e){R&&R.callId===e&&w({type:"callStatus",call:R,reason:"participantRemoved"})})),I.PubSubSvc.subscribe("/call/recording/info",(function(e){R===e&&w({type:"callStatus",call:e,reason:"callRecording"})})),I.PubSubSvc.subscribe("/call/droppedRemotely",(function(e){R===e&&w({type:"callStatus",call:e,reason:"droppedRemotely"})})),I.PubSubSvc.subscribe("/call/sdpConnected",(function(e){R===e&&w({type:"callStatus",call:e,reason:"sdpConnected"})})),I.PubSubSvc.subscribe("/call/participants/activeSpeakers",(function(e,t){R&&R.callId===e&&w({type:"callStatus",call:R,reason:"activeSpeakerChanged",activeSpeakers:t})})),I.PubSubSvc.subscribe("/call/network/quality",(function(e,t){R&&R.callId===e&&w({type:"callNetworkQualityChanged",callId:e,data:t})})),I.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",(function(e){R&&R.callId===e&&w({type:"callRtpThresholdReached",call:R})})),I.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",(function(e){R&&R.callId===e&&w({type:"callRtpThresholdCleared",call:R})})),I.PubSubSvc.subscribe("/call/ended",(function(e,t){R===e&&(w({type:"callEnded",call:e,replaced:t}),R=null,window.setTimeout((function(){r.info("[Guest SDK]: Active call has ended. Logout and disconnect guest user."),O()}),500))})),s},e.GuestClient.prototype.name="GuestClient",Object.defineProperty(e,"supportedGuestEvents",{get:function(){return["connectionStateChanged","whiteboardEnabled","whiteboardElement","whiteboardCleared","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded","whiteboardBackground","whiteboardOverlayToggled","whiteboardSync"]},enumerable:!0,configurable:!0}),e}((Circuit=function(e){"use strict";var t=e.Enums.ConnectionState,n=e.Enums.ConversationType,i=e.Constants,r=e.logger,o=e.PrivateData,a=e.Enums.Targets,s=e.Enums.VideoResolutionLevel,c=e.Utils,l="CALL_RECORDING,CALLS,MENTION_EVENT,READ_CONVERSATIONS,READ_USER,READ_USER_PROFILE,WRITE_CONVERSATIONS,WRITE_USER_PROFILE";function d(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(e){}}!function(e,t){if(e.location.hash||e.location.search){var n=Object.assign({},c.parseQS(e.location.hash),c.parseQS(e.location.search));if(n.state)try{Object.assign(n,JSON.parse(n.state))}catch(e){r.error("Could not decode state parameter")}if(n.display&&"popup"===n.display&&n.redirect_uri===e.location.origin+e.location.pathname&&e.document.addEventListener("DOMContentLoaded",(function(){e.document.body.innerHTML="Redirecting, please wait..."})),n.callback){var i=n.callback;if(i in t)try{delete n.callback,t[i](n)}catch(e){}}n.display&&"popup"===n.display&&d()}}(window,window.opener||window.parent);var u=c.getBrowserInfo();return e.ExtensionConnHandlerSingleton.getInstance(),Circuit.WebRTCAdapter.unifiedPlanEnabled=!(!u.safari&&!u.firefox),e.Client=function(d){e.BaseEventTarget.call(this,e.logger);var u=this,E=e.Enums.ConnectionState.Disconnected,C=c.shallowCopy(d)||{};C.domain=C.domain||"circuitsandbox.net",C.emoticonMode=C.emoticonMode||"standard",G(d);var T,p,S,I,A,R,f,_="node"===window.navigator.platform,v="iOS"===window.navigator.platform||"Android"===window.navigator.platform,g=/<image(?:\s|\s.*?\s)href="(https:\/\/[^"]+)"/,N=[],m=!1,h=null,O=new e.ClientApiHandler(C),D=new e.UserToUserHandler(O),P=e.RtcSessionController;u._clientApiHandler=O,u._userToUserHandler=D,u._rtcSessionController=P;var y=new e.SdkServices(O,D,!1);function b(e,t,n,r){if(e===i.ReturnCode.NO_RESULT&&n)return!1;if(e){var o=O.getLastError();return r&&r(o),o&&delete o.errObj,t(o),!0}return!1}function U(e,t){return!!e&&(t(new Circuit.Error(i.ReturnCode.SDK_ERROR,e)),!0)}function L(){return"https://"+u.domain+"/"}function M(e,t,n){var i,r={};return r.width=t,r.height=n,r.left=window.screenX+(window.outerWidth-t)/2,r.top=window.screenY+(window.outerHeight-n)/2,r.scrollbars="yes",i=Object.keys(r).map((function(e){return e+"="+r[e]})).join(", "),window.open(e,r.name,i)}function w(e){return C.scope.split(",").indexOf(e)>=0||C.scope.split(",").indexOf("ALL")>=0}function G(e){e=e||{},C.client_id=e.client_id,C.client_secret=e.client_secret,C.redirect_uri=e.redirect_uri||window.location.origin+window.location.pathname,C.scope=(e.scope?e.scope.replace(/\s+/g,""):"")||l,w(i.OAuthScope.READ_USER_PROFILE)||(C.scope=i.OAuthScope.READ_USER_PROFILE+","+e.scope),w(i.OAuthScope.ALL)&&(C.scope=l)}function k(e){return new Promise((function(t,n){var r,o=_?new XMLHttpRequest(C):new XMLHttpRequest;if(o.open(e.type||e.dataType||"GET",e.url,!0),o.withCredentials=e.xhrFields&&e.xhrFields.withCredentials,!T||e.headers&&e.headers.Authorization||o.setRequestHeader("Authorization","Bearer "+T),e.headers)for(var a in e.headers)e.headers.hasOwnProperty(a)&&o.setRequestHeader(a,e.headers[a]);o.onload=function(){if(200===o.status)e.success&&e.success(o.responseText),t(o.responseText);else{var i=new Circuit.Error(o.status,o.responseText||o.statusText);e.error&&e.error(i),n(i)}},o.onerror=function(){var t=new Circuit.Error(i.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");e.error&&e.error(t),n(t)},e.data&&(r=c.toQS(e.data),o.setRequestHeader("Content-type","application/x-www-form-urlencoded")),o.send(r)}))}function H(e){return new Promise((function(t,n){k({type:"POST",url:"https://"+u.domain+"/sdklogin",data:{token:e.token||void 0,accessToken:e.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then((function(){e.accessToken&&(T=e.accessToken),t()})).catch(n)}))}function V(){return k({url:"https://"+u.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0}).then((function(){}))}function B(){return new Promise((function(e,t){if(C.client_id)if(window.localStorage){var n=window.localStorage.getItem("oauth");try{n=JSON.parse(n)}catch(e){return window.localStorage.removeItem("oauth"),void t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}n&&"object"==typeof n||(n={}),n[C.client_id]={access_token:T,domain:u.domain,expires_at:p},window.localStorage.setItem("oauth",JSON.stringify(n)),r.debug("[SDK]: Stored access_token for client_id: "+C.client_id),e()}else e();else t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"client_id missing in client object"))}))}function F(){return new Promise((function(e,t){var n=window.localStorage.getItem("oauth");if(n){try{n=JSON.parse(n)}catch(e){return void t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"==typeof n){var o=n[C.client_id];o&&o.access_token?(T=o.access_token,p=o.expires_at,r.debug("[SDK]: Retrieved access_token for client_id: "+C.client_id),e(T)):t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))}else t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"invalid data in localStorage"))}else t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"))}))}function x(e){var t="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[t]=function(){try{e.apply(this,arguments)&&delete window[t]}catch(e){r.error(e)}},t}function W(){return new Promise((function(e,t){var n=null;if(!C.client_id)return u.oauthwin&&(u.oauthwin.close(),u.oauthwin=null),void t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"client_id missing in client object"));T=void 0;var o=x((function(o){if(n&&window.clearInterval(n),!o||o.error){T=void 0;var a=o?o.error:"The authentication was not completed";t(new Circuit.Error(i.ReturnCode.SDK_ERROR,a))}else T=o.access_token,p=o.expires_in&&Date.now()+1e3*o.expires_in,B().catch((function(e){r.error("[SDK]: Failed to store the OAuth access token.",e)})).then((function(){e({username:o.username,accessToken:o.access_token})}))})),a={client_id:C.client_id,redirect_uri:C.redirect_uri,response_type:"token",scope:C.scope||""};a.state=JSON.stringify({callback:o,display:"popup",redirect_uri:a.redirect_uri});var s="https://"+C.domain+"/oauth/authorize?"+c.toQS(a),l=u.oauthwin||M(s,450,520);l?(u.oauthwin=null,window.setTimeout((function(){l.location.href=s}),500),n=window.setInterval((function(){l&&!l.closed||(n&&window.clearInterval(n),t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))}),500)):t(new Circuit.Error(i.ErrorCode.SDK_ERROR,"OAuth popup blocked"))}))}function K(){return new Promise((function(e,t){var n=null,r=x((function(r){if(n&&window.clearInterval(n),!r||r.error){var o=r?r.error:"The authentication was not completed";t(new Circuit.Error(i.ReturnCode.SDK_ERROR,o))}else e({username:r.username})})),o=JSON.stringify({callback:r,display:"popup",redirect_uri:C.redirect_uri}),a={return_to:C.redirect_uri+"#state="+o},s="https://"+C.domain+"/oauth/login?"+c.toQS(a),l=u.oauthwin||M(s,450,520);u.oauthwin=null,window.setTimeout((function(){l.location.href=s}),500),n=window.setInterval((function(){l&&!l.closed||(n&&window.clearInterval(n),t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))}),500)}))}function Y(e){return e=e||T,k({type:"GET",url:"https://"+u.domain+"/oauth/token/"+e,crossDomain:!0}).then((function(e){try{return JSON.parse(e)}catch(e){return Promise.reject(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid token returned"))}}))}function q(){if(C.client_secret&&C.autoRenewToken&&p){S&&window.clearTimeout(S);var e=p-Date.now()-6e4;(e=Math.min(2147483647,e))>0&&(S=window.setTimeout(j,e))}}function j(){return new Promise((function(e,t){var n={type:"POST",url:"https://"+u.domain+"/oauth/token",data:{scope:C.scope,grant_type:"implicit"}};C.client_secret&&(n.headers={Authorization:"Basic "+window.btoa(C.client_id+":"+C.client_secret)},n.data.grant_type="client_credentials"),k(n).then((function(n){var r=JSON.parse(n);if(r&&r.access_token&&"Bearer"===r.token_type)T=r.access_token,O.setToken(T),p=r.expires_in&&Date.now()+1e3*r.expires_in,q(),Ve({type:"accessTokenRenewed"}),e(T);else{T=null,p=null;var o=new Circuit.Error(i.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Ve({type:"renewAccessTokenFailed",error:o}),t(o)}})).catch(t)}))}function Q(){return new Promise((function(e,t){var n=[i.GetStuffType.USER,i.GetStuffType.SUPPORT_CONVERSATION_ID,i.GetStuffType.TELEPHONY_CONVERSATION_ID,i.GetStuffType.ACCOUNTS,i.GetStuffType.PRESENCE_STATE,i.GetStuffType.TENANT];O.getStuff(n,(function(n,i){b(n,t,!0)||(A=i.telephonyConvId,R=i.supportConvId,Le(i.user).then((function(t){t.secId=i.tenant.secId,u.loggedOnUser=t,y.SdkHelperSvc.setLocalUser(t),e()})).catch(t))}))}))}function z(){return w(i.OAuthScope.CALLS)?y.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function X(){return w(i.OAuthScope.CALLS)&&C.enableTelephony&&y.AtcRegistrationSvc.initAtcForSdk(),Promise.resolve()}function J(){return new Promise((function(e,t){O.getUserData((function(n,i){b(n,t)||(P.processClientSettings(i.clientSettings),e(i))}))})).then(Q).then(z).then(X).then((function(){Ve({type:"connectionStateChanged",state:e.Enums.ConnectionState.Ready})}))}function $(){return new Promise((function(t,n){h&&(window.clearInterval(h),h=null,O.disconnect()),O.setToken(T),O.setClientInfo({deviceType:i.DeviceType.SDK,deviceSubtype:c.getDeviceSubtype(),clientVersion:e.version}),O.connect((function(){r.info("[SDK]: Successfully connected to access server."),h=window.setInterval(Be,50),t()}),(function(e){r.error("[SDK]: Failed to connect: ",e),O.disconnect(),n(new Circuit.Error(i.ReturnCode.SDK_ERROR,e))}),u.domain)})).then(J).then((function(){return u.loggedOnUser}))}function Z(){return new Promise((function(e,t){k({type:"POST",url:"https://"+u.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(C.client_id+":"+C.client_secret)},data:{grant_type:"client_credentials",scope:C.scope}}).then((function(n){var r=JSON.parse(n);r&&r.access_token&&"Bearer"===r.token_type?(T=r.access_token,p=r.expires_in&&Date.now()+1e3*r.expires_in,q(),e({accessToken:T})):(T=null,p=null,t(new Circuit.Error(i.ReturnCode.SDK_ERROR,r&&r.error_description||"Internal error with Client Credentials Grant authentication")))})).catch(t)}))}function ee(e){return new Promise((function(t,n){e&&e.filterConnector?(e.retrieveAction=e.retrieveAction||Circuit.Enums.RetrieveAction.CONVERSATIONS,e.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATIONS&&e.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid retrieveAction")),O.getConversationsByFilter(e,(function(i,r){if(!b(i,n,!0))if(e.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATIONS){var o=r&&r.conversations||[];Promise.all(o.map(ke)).then(t).catch(n)}else e.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&t(r.conversationIds||[])}))):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"options.filterConnector"))}))}function te(e){return new Promise((function(t,n){O.getConversationById(e,(function(e,i){b(e,n)||ke(i).then(t).catch(n)}))}))}function ne(e){return new Promise((function(t,n){O["string"==typeof e?"getUserByEmail":"getUserByEmail2"](e,(function(e,r){b(e,n,null,(function(e){e&&e.code===i.ReturnCode.NO_RESULT&&(e.info="User does not exist")}))||Le(r).then(t).catch(n)}))}))}function ie(e,t){return new Promise((function(n,r){e?e.length?(t?O.getPartialUsersByIds:O.getUsersByIds)(e,(function(e,t){b(e,r)||Promise.all(t.map(Le)).then(n).catch(r)})):n([]):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"))}))}function re(){return new Promise((function(e,t){O.getDevices((function(n,i){b(n,t,!0)||e(i||[])}))}))}function oe(){return new Promise((function(e,t){if(f)e(f);else{var n=[i.GetStuffType.SUPPORT_INFO];O.getStuff(n,(function(n,i){b(n,t)||(f=i.supportInfo,e(f))}))}}))}function ae(e){return"string"==typeof e&&(e={userId:e,createIfNotExists:!1}),new Promise((function(t,n){e.userId?O.getConversationByUser(e.userId,(function(r,o){r?r===i.ReturnCode.NO_RESULT?e.createIfNotExists?le(e.userId).then((function(e){t(e&&e.conversation)})):t():b(r,n):ke(o).then(t).catch(n)})):n(new Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))}))}function se(e,t){return"string"!=typeof e?Promise.reject(new Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):e.match(c.EMAIL_ADDRESS_PATTERN)?ne(e).then((function(e){return{userId:e.userId,createIfNotExists:t}})).then(ae):ae({userId:e,createIfNotExists:t})}function ce(e){return function(e){if(!e||!e.content)return Promise.resolve();for(var t=/<@([0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12})>/g,n=t.exec(e.content),i=[];null!==n;)i.push(n[1]),n=t.exec(e.content);return i.length?ie(i,!0).then((function(t){t.forEach((function(t){e.content=e.content.replace("<@"+t.userId+">",'<span class="mention" abbr="'+t.userId+'">'+t.displayName+"</span>")}))})):Promise.resolve()}(e).then((function(){e.mentionedUsers=c.createMentionedUsersArray(e.content)}))}function le(e){return new Promise((function(t,n){if(u.loggedOnUser.userId!==e){var r={type:i.ConversationType.DIRECT,participants:[{userId:e},{userId:u.loggedOnUser.userId}]};O.createConversation(r,(function(e,i,r){b(e,n)||ke(i).then((function(e){t({conversation:e,alreadyExists:r})}))}))}else n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"userId is of logged on user"))}))}function de(e,t){return new Promise((function(n,r){e?O.updateGuestAccess(e,t,(function(e){b(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))}function ue(e){var t={};return e&&e.forEach((function(e){switch(e.key){case i.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED:t.hideProfileExternal=e.booleanValue;break;case i.UserSettingKey.OPT_OUT_PRESENCE:t.presenceOptOut=e.booleanValue;break;case i.UserSettingKey.SHARE_LOCATION:t.shareLocation=e.booleanValue;break;case i.UserSettingKey.VOICEMAIL_ENABLED:t.voicemailEnabled=e.booleanValue;break;case i.UserSettingKey.VOICEMAIL_NO_RECORDING:t.voicemailNoRecording=e.booleanValue;break;case i.UserSettingKey.VOICEMAIL_TIMEOUT:t.voicemailTimeout=e.numberValue;break;case i.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED:t.voicemailCustomGreetingEnabled=e.booleanValue;break;case i.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI:t.voicemailCustomGreetingUri=e.stringValue?L()+"fileapi?fileid="+e.stringValue:null;break;case i.UserSettingKey.SECOND_TELEPHONY_CALL_ROUTING:t.busySetting=e.stringValue}})),t}function Ee(e){return new Promise((function(t,n){e.userId=u.loggedOnUser.userId,O.setPresence(e,(function(e){b(e,n)||t()}))}))}function Ce(e,t){return new Promise((function(n,i){O.getPresence(e,t,(function(e,t){b(e,i)||n(t)}))}))}function Te(){return new Promise((function(e,t){O.renewToken((function(n){b(n,t)?Ve({type:"renewSessionTokenFailed",error:n}):(r.debug("[SDK]: Session token renewed"),Ve({type:"sessionTokenRenewed"}),e())}))}))}function pe(e){return re().then((function(t){return t.some((function(t){return e?t.clientId===e:t.clientId!==u.loggedOnUser.clientId&&(t.clientInfo.deviceType===i.DeviceType.WEB||t.clientInfo.deviceType===i.DeviceType.APPLICATION&&"DESKTOP_APP"===t.clientInfo.deviceSubtype)}))}))}function Se(e){return re().then((function(t){return t.some((function(t){return t.clientId===e}))}))}function Ie(e,t){return new Promise((function(n,r){D.sendContactCardRequest(e,(function(e){e?r(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):n({type:t})}))}))}function Ae(e){return new Promise((function(t,n){var r="https://"+(u.domain.startsWith("sdk.")?u.domain.substr(4):u.domain)+e,o=window.open(r,"_blank");o?(o.focus(),t(o)):n(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}))}function Re(e){var t=y.CallControlSvc.findCall(e);return t||((t=y.CallControlSvc.getActiveCall(e))||null)}function fe(e){return e.pin=e.tenantPIN+e.sessionPIN,e.link&&(e.link="https://"+u.domain+e.link),delete e.tenantPIN,delete e.sessionPIN,delete e.conversationId,e}function _e(e){return new Promise((function(t,n){e?y.CallControlSvc.endCall(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))}function ve(e,t){return new Promise((function(n,i){var r={VGA:"",HD:s.VIDEO_720,FHD:s.VIDEO_1080},o={audio:!1,video:Circuit.WebRTCAdapter.getVideoOptions({sourceId:e,videoResolution:r[t]})};Circuit.WebRTCAdapter.getUserMedia(o,(function(e){Circuit.WebRTCAdapter.stopMediaStream(e),n(t)}),i)}))}function ge(e,t){return function(n){var i=n&&n.name;return"ConstraintNotSatisfiedError"===i||"OverconstrainedError"===i?ve(e,t):Promise.reject(n)}}function Ne(e,t){return new Promise((function(n,r){if(e){var o=Re(e);if(o)if(o.hasLocalScreenShare())y.CallControlSvc.removeMediaStream(e,(function(e){U(e,r)||n()}));else{if(!t)return void r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Missing MediaStream"));y.CallControlSvc.addMediaStream(e,t,(function(e){U(e,r)||n()}))}else r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))}function me(e){return new Promise((function(t,n){if(void 0!==e){var r=y.CallControlSvc.getActiveCall();if(r){var o=r.sessionCtrl.getLocalStream(e);o?t(o):n("No stream found with id "+e)}else n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"id is required"))}))}function he(e){if(e&&e.xmlElement){var t=g.exec(e.xmlElement);if(t&&t[1]){var n=t[1],i=n.indexOf("/fileapi");-1!==i&&(n=c.getOrigin()+n.slice(i))!==t[1]&&(e.xmlElement=e.xmlElement.replace(t[1],n))}}}var Oe="content/images/icon-general-default-avatar",De=["-blue","-green","-orange","-yellow"];function Pe(e){var t=0;if(e)for(var n=0;n<e.length;n++)t+=e.charCodeAt(n);return De[t%De.length]}function ye(e,t){if("function"==typeof e)try{var n=e(t);if(n&&"object"==typeof n)return"function"==typeof n.then?n:Promise.resolve(n)}catch(e){r.error("[SDK]: Error applying injector. ",e)}return Promise.resolve(t)}var be=["activeMediaType","callId","convId","convType","cstaCallId","direction","establishedTime","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoStream","localVideoUrl","localStreams","mediaType","participants","peerUser","remoteAudioDisabled","remoteAudioStream","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","remoteVideoStreams","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];function Ue(e){if(!e)return Promise.resolve();var t={};return be.forEach((function(n){try{t[n]=e[n]}catch(e){}})),t.state=e.state.name,t.isEstablished=e.state.established,ye(Circuit.Injectors.callInjector,t)}function Le(e){if(!e)return Promise.resolve();var t=L();if(e.smallImageUri&&e.largeImageUri)e.avatar=t+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=t+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var n=Pe(e.userId);e.avatar=t+Oe+n+".png",e.avatarLarge=t+Oe+n+"-XL.png",e.hasAvatar=!1}return delete e.smallImageUri,delete e.largeImageUri,delete e.tenantId,delete e.roles,delete e.accountTemplateType,delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.assignedPhoneNumbers,e.accounts&&e.accounts.length&&(e.tenantId=e.accounts[0].tenantId),e.hasPermission=function(e){if(!this.accounts||!e)return!1;var t=this.accounts[0],n=t&&t.permissions;return!!n&&n.some((function(t){return t.systemPermission===e}))},ye(Circuit.Injectors.userInjector,e)}function Me(e){if(!e)return Promise.resolve();switch(e.type){case i.ConversationItemType.TEXT:e.text.state===i.TextItemState.DELETED?e.text.content="":(e.attachments=e.attachments||[],e.externalAttachments=e.externalAttachments||[],"standard"===C.emoticonMode&&(e.text.content=c.standardizeEmoticon(e.text.content)),o.retrievePrivateDataFromContent(e),!e.conceptboards||e.text.conceptboards&&e.text.conceptboards.length||(e.text.conceptboards=e.conceptboards),delete e.conceptboards,C.removeMentionHtml&&(e.text.content=c.removeMentionHtml(e.text.content)));break;case i.ConversationItemType.SYSTEM:e.system.affectedParticipants&&(e.system.affectedParticipants=e.system.affectedParticipants.map((function(e){return e.userId})))}return e.attachments&&e.attachments.length&&(e.attachments=e.attachments.filter((function(t){if(t.url=L()+"fileapi/"+encodeURIComponent(t.fileName)+"?fileid="+t.fileId+"&itemid="+t.itemId,t.fileName.startsWith("tHuMbNaIl___")){var n=t.fileName.substring("tHuMbNaIl___".length),i=e.attachments.find((function(e){return e.fileName===n}));if(i)return i.thumbnailUrl=t.url,i.isImage=!0,!1}return!0}))),ye(Circuit.Injectors.itemInjector,e)}function we(e){return new Promise((function(t){e&&e.topLevelItem?(r.debug("[SDK]: Publicize the topLevelItem. convId = ",e.convId),Me(e.topLevelItem).then((function(){r.debug("[SDK]: Publicized topLevelItem. convId = ",e.convId),t(e)})).catch((function(n){r.error("[SDK]: Failed to publicize topLevelItem. ",n),t(e)}))):t(e)}))}function Ge(e){return new Promise((function(t){if(e&&e.parentItem){r.debug("[SDK]: Publicize the thread. itemId = ",e.parentItem.intemId),e.comments=e.comments||[];var n=e.comments.slice(0);n.unshift(e.parentItem),Promise.all(n.map(Me)).then((function(){t(e)})).catch((function(n){r.error("[SDK]: Failed to publicize thread. ",n),t(e)}))}else t(e)}))}function ke(e){if(!e)return Promise.resolve();if(r.debug("[SDK]: Publicize conversation. convId = ",e.convId),e.participants=e.participants.map((function(e){return e.userId})),e.moderators=e.moderators&&e.moderators.map((function(e){return e.userId})),e.isTelephonyConversation=e.convId===A,e.isSupportConversation=e.convId===R,e.type!==i.ConversationType.DIRECT){var t=L();if(e.conversationAvatar&&e.conversationAvatar.smallPictureId&&e.conversationAvatar.largePictureId)e.avatar=t+"avatar?convId="+e.convId+"&type=small&fileid="+e.conversationAvatar.smallPictureId,e.avatarLarge=t+"avatar?convId="+e.convId+"&type=large&fileid="+e.conversationAvatar.largePictureId,e.hasConversationAvatar=!0;else{var o=e.isDraft?"":Pe(e.convId);e.avatar=t+"content/images/icon-general-default-group-avatar"+o+".png",e.avatarLarge=t+"content/images/icon-general-default-group-avatar"+o+"-XL.png",e.hasConversationAvatar=!1}e.type===i.ConversationType.OPEN&&(e.type=n.COMMUNITY)}return ye(Circuit.Injectors.conversationInjector,e).then(we)}function He(e){if(!e)return Promise.resolve();var t=L();if(e.smallImageUri&&e.largeImageUri)e.avatar=t+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=t+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var n=Pe(e.userId);e.avatar=t+Oe+n+".png",e.avatarLarge=t+Oe+n+"-XL.png",e.hasAvatar=!1}return delete e.smallImageUri,delete e.largeImageUri,ye(Circuit.Injectors.participantInjector,e)}function Ve(e){r.debug("[SDK]: Enqueue "+e.type),N.push(e)}function Be(){if(!m&&N.length){m=!0;try{var e=N.shift();if(r.debug("[SDK]: Dequeue "+e.type+". Events left in the queue: "+N.length),!u.hasEventListener(e.type))return void r.debug("[SDK]: There is no listener for this event");var t=[];t.push(e.user?Le(e.user):void 0),t.push(e.item?Me(e.item):void 0),t.push(e.conversation?ke(e.conversation):void 0),t.push(e.call?Ue(e.call):void 0),Promise.all(t).then((function(t){t[0]&&(e.user=t[0]),t[1]&&(e.item=t[1]),t[2]&&(e.conversation=t[2]),t[3]&&(e.call=t[3]),r.debug("[SDK]: Dispatch ",e.type),u.dispatch(e)}))}catch(e){r.error("[SDK]: Error processing event queue. ",e)}finally{m=!1}}}return Object.defineProperty(u,"domain",{get:function(){return C.domain},set:function(e){C.domain=e},enumerable:!0,configurable:!1}),Object.defineProperty(u,"accessToken",{get:function(){return T},set:function(e){T=e},enumerable:!0,configurable:!0}),Object.defineProperty(u,"expiresAt",{get:function(){return p},enumerable:!0,configurable:!0}),Object.defineProperty(u,"connectionState",{get:function(){return E},enumerable:!0,configurable:!0}),Object.defineProperty(u,"getAudioVideoStats",{get:function(){var e=y.CallControlSvc.getActiveCall();if(!e)return function(){return Promise.reject(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))};var t=e.sessionCtrl.getCurrentPeerConnection();return t&&t.getStats?t.origGetStats?t.origGetStats.bind(t):t.getStats.bind(t):function(){return Promise.reject(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No PeerConnection present"))}},enumerable:!1,configurable:!1}),u.setOauthConfig=G,u.logon=function(e){var t,n,o,a;if(e){if("object"!=typeof e)return t="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.",r.error(t),Promise.reject(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(C.client_id&&C.client_secret)return t="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.",r.error(t),Promise.reject(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(C.client_id&&e.token)return t="Circuit.Client is created with client_id, so no API token should be passed to the logon API.",r.error(t),Promise.reject(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(!C.client_id&&!e.token)return t="Circuit.Client was not created with client_id, so API token should be passed to the logon API.",r.error(t),Promise.reject(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t))}else if(!C.client_id)return t="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.",r.error(t),Promise.reject(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));return C.client_id&&C.client_secret?Z().then(H).then($):C.client_id&&e&&e.username&&e.password?(o=e.username,a=e.password,new Promise((function(e,t){k({type:"POST",url:"https://"+u.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(C.client_id)},data:{username:o,password:a,grant_type:"password",scope:C.scope}}).then((function(n){var r=JSON.parse(n);r&&r.access_token&&"Bearer"===r.token_type?(T=r.access_token,p=r.expires_in&&Date.now()+1e3*r.expires_in,q(),e({accessToken:T})):(T=null,p=null,t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))})).catch(t)}))).then(H).then($):C.client_id&&e&&e.accessToken?_||v||e.skipTokenValidation?H(e).then($):(e.prompt&&(n="https://"+C.domain+"/dist/oauthLoading.html",u.oauthwin=M(n,450,520)),T=e.accessToken,Y().then((function(){return e.prompt?V().then((function(){u.oauthwin.close(),u.oauthwin=null})).catch(K).then($):$()})).catch((function(e){return u.oauthwin&&u.oauthwin.close(),u.oauthwin=null,Promise.reject(e)}))):C.client_id?u.logonChecked?$():e&&e.logonChecked?F().then(Y).then(V).then($):(n="https://"+C.domain+"/dist/oauthLoading.html",u.oauthwin=M(n,450,520),F().then(Y).then(V).then((function(){u.oauthwin.close(),u.oauthwin=null})).catch(W).then($)):e&&e.token?H(e).then($):Promise.reject(new Circuit.Error(i.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},u.logonCheck=function(){return F().then(Y).then(V).then((function(){u.logonChecked=!0,I&&window.clearTimeout(I),I=window.setTimeout((function(){I=null,u.logonChecked=!1}),5e3)}))},u.changePassword=function(){return new Promise((function(e,t){var n=null,r=x((function(r){if(n&&window.clearInterval(n),!r||r.error){var o=r?r.error:"The password change failed";t(new Circuit.Error(i.ReturnCode.SDK_ERROR,o))}else e()})),o={client_id:C.client_id,redirect_uri:C.redirect_uri,response_type:"token",scope:C.scope||""};o.state=JSON.stringify({callback:r,display:"popup",redirect_uri:o.redirect_uri});var a="https://"+C.domain+"/oauth/changePassword?"+c.toQS(o),s=u.oauthwin||M(a,450,520);u.oauthwin=null,window.setTimeout((function(){s.location.href=a}),500),n=window.setInterval((function(){s&&!s.closed||(n&&window.clearInterval(n),t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))}),500)}))},u.logout=function(e){return e?new Promise((function(e){var n=function(){T=null,p=null,O.disconnect(),window.clearInterval(h),u.dispatch({type:"connectionStateChanged",state:t.Disconnected}),e()},i=window.setTimeout((function(){i=null,n()}),2e3);O.logout((function(){i&&(window.clearTimeout(i),n())}))})):(T=null,p=null,O.disconnect(),Promise.resolve())},u.revokeToken=function(e){return new Promise((function(t,n){e=e||T,T=null,p=null,B();var r=window.setTimeout((function(){r=null,t()}),2e3);O.revokeAccessToken(e,(function(e){r&&(window.clearTimeout(r),e!==i.ReturnCode.DISCONNECTED&&b(e,n)||t())}))}))},u.setCookie=function(e){C.cookie=e},u.getCookie=function(){return C.cookie},u.isAuthenticated=V,u.validateToken=Y,u.getLoggedOnUser=function(){return new Promise((function(e,t){u.loggedOnUser?e(u.loggedOnUser):O.getLoggedOnUser((function(n,i){b(n,t)||Le(i.user).then((function(t){u.loggedOnUser=t,y.SdkHelperSvc.setLocalUser(t),e(t)}))}))}))},u.getTelephonyConversationId=function(){return new Promise((function(e,t){O.getTelephonyConversationId((function(n,i){b(n,t)||e(i)}))}))},u.getSupportConversationId=function(){return new Promise((function(e,t){O.getSupportConversationId((function(n,i){b(n,t)||e(i)}))}))},u.getSupportConversation=function(){return new Promise((function(e,t){oe().then((function(n){n.supportType===i.SupportType.CONVERSATION?O.getSupportConversation((function(n,i){b(n,t)||ke(i).then(e).catch(t)})):t(new Error(i.ReturnCode.SDK_ERROR,"supportType is not CONVERSATION"))})).catch(t)}))},u.getSupportInfo=oe,u.getTenantUsers=function(e){return new Promise((function(t,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||i.GetAccountsSorting.BY_FIRST_NAME,O.getAccounts(e,(function(e,i){b(e,n)||Promise.all(i.accounts.map((function(e){return Le(e.user)}))).then(t).catch(n)}))}))},u.getAccounts=function(e){return new Promise((function(t,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||i.GetAccountsSorting.BY_FIRST_NAME,O.getAccounts(e,(function(e,i){b(e,n)||Promise.all(i.accounts.map((function(e){return Le(e.user)}))).then((function(e){var n=i.accounts.map((function(t,n){return{account:t.account,user:e[n]}}));t({accounts:n,searchPointer:i.searchPointer,hasMore:i.hasMoreResults})})).catch(n)}))}))},u.subscribePresence=function(e){return new Promise((function(t,n){O.subscribePresence(e,(function(e){b(e,n)||t()}))}))},u.unsubscribePresence=function(e){return new Promise((function(t,n){O.unsubscribePresence(e,(function(e){b(e,n)||t()}))}))},u.subscribeTenantPresence=function(){return new Promise((function(e,t){C.client_secret?O.subscribeTenantPresence(u.loggedOnUser.tenantId,(function(n){b(n,t)||e()})):t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"API only allowed for bots"))}))},u.unsubscribeTenantPresence=function(){return new Promise((function(e,t){C.client_secret?O.unsubscribeTenantPresence(u.loggedOnUser.tenantId,(function(n){b(n,t)||e()})):t(new Circuit.Error(i.ReturnCode.SDK_ERROR,"API only allowed for bots"))}))},u.subscribeTypingIndicator=function(e){return new Promise((function(t,n){e?O.subscribe(e,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"convId is required"))}))},u.unsubscribeTypingIndicator=function(e){return new Promise((function(t,n){e?O.unsubscribe(e,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"convId is required"))}))},u.typing=function(e,t,n){return new Promise((function(r,o){e&&void 0!==t?O.typing(e,t,n,(function(e){b(e,o)||r()})):o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"missing parameter"))}))},u.renewSessionToken=Te,u.renewToken=j,u.getUserById=function(e){return new Promise((function(t,n){e?O.getUser(e,(function(e,i){b(e,n)||Le(i).then(t).catch(n)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))}))},u.getUsersById=ie,u.getUserByEmail=ne,u.getUsersByEmail=function(e){return new Promise((function(t,n){if(e){if(Array.isArray(e)){if(!e.length)return void t([]);e={emailAddresses:e}}O.getUsersByEmails(e,(function(e,i){b(e,n)||Promise.all(i.map(Le)).then(t).catch(n)}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"))}))},u.updateUser=function(e){return new Promise((function(t,n){O.updateUser(e,(function(e){b(e,n)||t()}))}))},u.getPresence=Ce,u.setPresence=Ee,u.setStatusMessage=function(e){return new Promise((function(t,n){e=e||"",O.setUserSettings({key:i.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:i.UserSettingDataType.STRING,stringValue:e},(function(i){b(i,n)||Ce([u.loggedOnUser.userId]).then((function(t){return Ee({state:t.length&&t[0].state,statusMessage:e})})).then(t).catch(n)}))}))},u.getStatusMessage=function(){return new Promise((function(e,t){O.getUserSettings([i.UserSettingArea.ALL],(function(n,r){if(!b(n,t)){var o=r&&r.find((function(e){return e.key===i.UserSettingKey.STATUS_MESSAGE_TEXT}));e(o?o.stringValue:"")}}))}))},u.setCallForwarding=function(e){return new Promise((function(t,n){e&&"object"==typeof e&&"boolean"==typeof e.status?y.CstaSvc.setForwardingImmediate(!!e.status,e.number,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"settings object with a status and phone number is required"))}))},u.setUserSettings=function(e){return new Promise((function(t,n){if(e){var r=[];void 0!==e.presenceOptOut&&r.push({key:i.UserSettingKey.OPT_OUT_PRESENCE,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.presenceOptOut}),void 0!==e.shareLocation&&r.push({key:i.UserSettingKey.SHARE_LOCATION,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.shareLocation}),void 0!==e.voicemailEnabled&&r.push({key:i.UserSettingKey.VOICEMAIL_ENABLED,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.voicemailEnabled}),void 0!==e.voicemailNoRecording&&r.push({key:i.UserSettingKey.VOICEMAIL_NO_RECORDING,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.voicemailNoRecording}),void 0!==e.voicemailTimeout&&r.push({key:i.UserSettingKey.VOICEMAIL_TIMEOUT,dataType:i.UserSettingDataType.NUMBER,numberValue:e.voicemailTimeout}),void 0!==e.voicemailCustomGreetingEnabled&&r.push({key:i.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.voicemailCustomGreetingEnabled}),void 0!==e.hideProfileExternal&&r.push({key:i.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED,dataType:i.UserSettingDataType.BOOLEAN,booleanValue:!!e.hideProfileExternal}),void 0!==e.busySetting&&r.push({key:i.UserSettingKey.SECOND_TELEPHONY_CALL_ROUTING,dataType:i.UserSettingDataType.STRING,stringValue:e.busySetting}),O.setUserSettings(r,(function(e){b(e,n)||t()}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"))}))},u.getUserSettings=function(){return new Promise((function(e,t){O.getUserSettings([i.UserSettingArea.ALL],(function(n,i){b(n,t)||e(ue(i))}))}))},u.uploadCustomVoicemailGreeting=function(t){return new Promise((function(n,o){t?new e.FileUpload(C).uploadFiles([t],u.domain).then((function(e){if(e&&e.length){var t=[{key:i.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI,dataType:i.UserSettingDataType.STRING,stringValue:e[0].fileId}];O.setUserSettings(t,(function(e){b(e,o)||n()}))}else o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"error uploading file"))})).catch((function(e){r.error("[SDK]: Fileupload error.",e),o(new Circuit.Error(i.ReturnCode.SDK_ERROR,e))})):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"))}))},u.getDevices=re,u.getConversations=function(e){return new Promise((function(t,n){(e=e||{}).numberOfConversations=e.numberOfConversations||25;var r=e.direction!==i.SearchDirection.AFTER;O.getConversations(u.loggedOnUser.userId,e.timestamp,r,e.numberOfConversations,i.ConversationFilter.ALL,(function(e,i){b(e,n)||Promise.all(i.map(ke)).then(t).catch(n)}))}))},u.getConversationTopics=function(e,t){return new Promise((function(n,i){var r=(t=t||{}).maxNumberOfTopics||void 0,o=t.timestamp||void 0;O.getConversationTopics(e,o,r,(function(e,t,r){if(!b(e,i)){var o=[];(t=t||[]).forEach((function(e){Object.keys(e).forEach((function(t){o.push(e[t])}))})),Promise.all(o.map(Me)).then((function(){n({conversationTopics:t,hasOlderTopics:r})})).catch(i)}}))}))},u.getMarkedConversations=function(){return new Promise((function(e,t){O.getMarkedConversationsList((function(n,i){b(n,t,!0)||e(i||[])}))}))},u.getFavoriteConversationIds=function(){return new Promise((function(e,t){O.getFavoriteConversationIds((function(n,i){b(n,t,!0)||e(i||[])}))}))},u.favoriteConversation=function(e){return new Promise((function(t,n){e?O.markConversation({convId:e,markType:i.ConversationMarkFilter.FAVORITE},(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.unfavoriteConversation=function(e){return new Promise((function(t,n){e?O.unmarkConversation({convId:e,markType:i.ConversationMarkFilter.FAVORITE},(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.archiveConversation=function(e){return new Promise((function(t,n){e?O.markConversation({convId:e,markType:i.ConversationMarkFilter.MUTE},(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.unarchiveConversation=function(e){return new Promise((function(t,n){e?O.unmarkConversation({convId:e,markType:i.ConversationMarkFilter.MUTE},(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.addLabels=function(e){return new Promise((function(t,n){Array.isArray(e)?(e=e.map((function(e){return{value:e}})),O.addLabels(e,(function(e,i){b(e,n,!0)||t(i&&i.labels||[])}))):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Parameter must be an array of label names."))}))},u.assignLabels=function(e,t){return new Promise((function(n,r){Array.isArray(t)?O.assignLabels(e,t,(function(e,t){b(e,r)||n(t||[])})):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))}))},u.editLabel=function(e){return new Promise((function(t,n){O.editLabel(e,(function(e,i){b(e,n,!0)||t(i)}))}))},u.getAllLabels=function(){return new Promise((function(e,t){O.getAllLabels((function(n,i){b(n,t,!0)||e(i||[])}))}))},u.removeLabels=function(e){return new Promise((function(t,n){Array.isArray(e)?O.removeLabels(e,(function(e,i){b(e,n,!0)||t(i||[])})):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))}))},u.unassignLabels=function(e,t){return new Promise((function(n,r){Array.isArray(t)?O.unassignLabels(e,t,(function(e,t){b(e,r)||n(t||[])})):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))}))},u.getConversationsByFilter=ee,u.getConversationsByLabel=function(e,t){return e?((t=t||{}).filterConnector={conditions:[{filterTarget:i.FilterTarget.LABEL_ID,expectedValue:[e]}]},t.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,ee(t)):Promise.reject(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"labelId"))},u.getConversationsByType=function(e,t){return e?((t=t||{}).retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,t.number=t.number||25,t.filterConnector={conditions:[{filterTarget:i.FilterTarget.CONVERSATION_TYPE,expectedValue:[e]}],connectors:[{boolConnector:i.FilterBoolConnector.OR,conditions:[{filterTarget:i.FilterTarget.LABEL_ID,filterTargetComparator:i.FilterTargetComparator.NOT,expectedValue:[i.SystemLabel.ARCHIVED]}]}],boolConnector:i.FilterBoolConnector.AND},ee(t)):new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"conversationType is required.")},u.getArchivedConversations=function(e){return(e=e||{}).filterConnector={conditions:[{filterTarget:i.FilterTarget.LABEL_ID,expectedValue:[i.SystemLabel.ARCHIVED]}]},e.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,ee(e)},u.getConversationById=te,u.getConversationsByIds=function(e){return new Promise((function(t,n){O.getConversationsByIds(e,(function(e,i){b(e,n)||Promise.all(i.map(ke)).then(t).catch(n)}))}))},u.getConversationParticipants=function(e,t){return new Promise((function(n,i){t=t||{},O.getConversationParticipants(e,t,(function(e,t){b(e,i)||Promise.all(t.participants.map(He)).then((function(e){t.participants=e,n(t)})).catch(i)}))}))},u.getItemById=function(e){return new Promise((function(t,n){O.getItemById(e,(function(e,i){b(e,n)||Me(i).then(t).catch(n)}))}))},u.getItemsById=function(e){return new Promise((function(t,n){O.getItemsByIds(e,(function(e,i){b(e,n)||Promise.all(i.map(Me)).then(t).catch(n)}))}))},u.getConversationItems=function(e,t){return new Promise((function(n,r){(t=t||{}).modificationDate=t.modificationDate||void 0,t.creationDate=t.creationDate||t.creationTime||void 0,t.direction=t.direction||i.SearchDirection.BEFORE,t.numberOfItems=t.numberOfItems||25,O.getConversationItems(e,t.modificationDate,t.creationDate,t.direction,t.numberOfItems,(function(e,t){b(e,r)||Promise.all(t.map(Me)).then(n).catch(r)}))}))},u.getConversationFeed=function(e,t){return new Promise((function(n,i){t=t||{},O.getConversationFeed(e,t.timestamp,t.minTotalItems,t.maxTotalUnread,t.commentsPerThread,t.maxUnreadPerThread,(function(e,t,r){b(e,i)||Promise.all(t.map(Ge)).then((function(e){n({threads:e,hasOlderThreads:r})})).catch(i)}))}))},u.getItemsByThread=function(e,t,n){return new Promise((function(r,o){var a=(n=n||{}).modificationDate||n.creationDate,s=n.modificationDate?i.TimestampFilter.MODIFICATION:i.TimestampFilter.CREATION;O.getThreadComments(e,t,a,s,n.direction,n.number||n.numberOfItems,(function(e,t,n){b(e,o)||Promise.all(t.map(Me)).then((function(e){r({items:e,hasMore:n})})).catch(o)}))}))},u.addTextItem=function(t,n){return new Promise((function(o,a){function s(e){ce(e).then((function(){O.addTextItem(e,(function(e,t){b(e,a)||Me(t).then(o).catch(a)}))})).catch(a)}if(t)if(n)if("string"==typeof n)s({convId:t,content:n,contentType:"RICH"});else if("object"==typeof n){var c={convId:t,parentId:n.parentId,contentType:n.contentType||i.TextItemContentType.RICH,subject:n.subject,content:n.content,form:n.form,externalAttachmentMetaData:n.externalAttachments};if(n.attachments&&n.attachments.length>0)new e.FileUpload(C).uploadFiles(n.attachments,u.domain).then((function(e){c.attachmentMetaData=[],e.forEach((function(e){c.attachmentMetaData.push(e)})),s(c)})).catch((function(e){r.error("[SDK]: Fileupload error.",e),a(new Circuit.Error(i.ReturnCode.SDK_ERROR,e))}));else s(c)}else a(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid content"));else a(new Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));else a(new Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.deleteTextItem=function(e){return new Promise((function(t,n){e&&"string"==typeof e?O.deleteTextItem({itemId:e},(function(e,i){b(e,n)||t(i)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"itemId is required"))}))},u.updateTextItem=function(t){return new Promise((function(n,o){function a(){ce(t).then((function(){O.updateTextItem(t,(function(e,t){b(e,o)||Me(t).then(n).catch(o)}))})).catch(o)}t?t.itemId?"object"==typeof t?t.attachments&&t.attachments.length>0?new e.FileUpload(C).uploadFiles(t.attachments,u.domain).then((function(e){t.attachmentMetaData=[],e.forEach((function(e){t.attachmentMetaData.push(e)})),a()})).catch((function(e){r.error("[SDK]: Fileupload error.",e),o(new Circuit.Error(i.ReturnCode.SDK_ERROR,e))})):a():o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid content")):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required")):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))}))},u.getJournalEntries=function(e){return new Promise((function(t,n){if(e=e||{},A){var r={convId:A,timestamp:e.timestamp||void 0,direction:e.direction||i.SearchDirection.BEFORE,numberOfEntries:e.numberOfEntries||25,journalFilter:e.journalFilter||i.JournalFilter.ALL};O.getJournalEntries(r,(function(e,i){b(e,n)||(i=i||[],Promise.all(i.map(Me)).then(t).catch(n))}))}else n(new Error(i.ReturnCode.SDK_ERROR,"no telephony conversation found"))}))},u.getDirectConversationWithUser=se,u.addParticipant=function(e,t,n){return new Promise((function(i,r){var o={convId:e,userId:t};O.addParticipant(o,(function(o,a){b(o,r)||(ke(a.conversation).then(i).catch(r),n&&y.SdkHelperSvc.getConversationPromise(e).then((function(e){if(e.call)if(a.conversation.convId===e.convId){var n=t.map((function(e){return{userId:e}}));y.PubSubSvc.publish("/conversation/participants/add",[e.call,n])}else y.PubSubSvc.publish("/conversation/upgrade",[e,a.conversation])})))}))}))},u.removeParticipant=function(e,t){return new Promise((function(n,i){O.removeParticipant(e,t,(function(e){b(e,i)||n()}))}))},u.getFlaggedItems=function(){return new Promise((function(e,t){O.getFlaggedItems((function(n,i){b(n,t,!0)||e(i||[])}))}))},u.flagItem=function(e,t){return new Promise((function(n,i){O.setFlagItem({convId:e,itemId:t},(function(e){b(e,i)||n()}))}))},u.unflagItem=function(e,t){return new Promise((function(n,i){O.clearFlagItem(e,t,(function(e){b(e,i)||n()}))}))},u.likeItem=function(e){return new Promise((function(t,n){O.likeTextItem(e,u.loggedOnUser.userId,(function(e){b(e,n)||t()}))}))},u.unlikeItem=function(e){return new Promise((function(t,n){O.unlikeTextItem(e,u.loggedOnUser.userId,(function(e){b(e,n)||t()}))}))},u.markItemsAsRead=function(e,t){return new Promise((function(n,i){t=t||Date.now(),O.setReadPointer(e,t,(function(e){b(e,i)||n()}))}))},u.moderateConversation=function(e){return new Promise((function(t,n){e?O.moderateConversation(e,(function(e,i){b(e,n)||(i&&"LOCK_OK"===i.moderateResult?t():n(i))})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.unmoderateConversation=function(e){return new Promise((function(t,n){e?O.unmoderateConversation(e,(function(e,i){b(e,n)||(i&&"UNLOCK_OK"===i.moderateResult?t():n(i))})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.grantModeratorRights=function(e,t){return new Promise((function(n,r){e&&t?O.grantModeratorRights(e,t,(function(e,t){b(e,r)||(t&&"GRANT_OK"===t.grantModeratorResult?n():r(t))})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))}))},u.dropModeratorRights=function(e,t){return new Promise((function(n,r){e&&t?O.dropModeratorRights(e,t,(function(e,t){b(e,r)||(t&&"DROP_OK"===t.dropModeratorResult?n():r(t))})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))}))},u.enableGuestAccess=function(e){return de(e,!1)},u.disableGuestAccess=function(e){return de(e,!0)},u.createDirectConversation=function(e){return e&&"string"==typeof e?e.match(c.EMAIL_ADDRESS_PATTERN)?ne(e).then((function(e){return e.userId})).then(le):le(e):Promise.reject(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))},u.createGroupConversation=function(e,t){return new Promise((function(n,r){if(e)if(-1===e.indexOf(u.loggedOnUser.userId)&&e.unshift(u.loggedOnUser.userId),e.length<2)r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));else if(e.indexOf("")>-1||e.indexOf(null)>-1)r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Participant cannot be empty"));else{e=e.map((function(e){return{userId:e}}));var o={type:i.ConversationType.GROUP,participants:e,topic:t};O.createConversation(o,(function(e,t){b(e,r)||ke(t).then(n).catch(r)}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"))}))},u.createConferenceBridge=function(e){return new Promise((function(t,n){if(e){var r={type:i.ConversationType.GROUP,participants:[{userId:u.loggedOnUser.userId}],topic:e};O.createConversation(r,(function(e,i){b(e,n)||ke(i).then(t).catch(n)}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"))}))},u.createCommunity=function(e,t,n){return new Promise((function(r,o){e&&e.length||(e=[u.loggedOnUser.userId]),e=e.map((function(e){return{userId:e}}));var a={type:i.ConversationType.OPEN,participants:e,topic:t,description:n};O.createConversation(a,(function(e,t){b(e,o)||ke(t).then(r).catch(o)}))}))},u.joinCommunity=function(e){return new Promise((function(t,n){e?O.joinOpenConversation(e,(function(e,i){b(e,n)||t(i)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.updateConversation=function(e,t){return new Promise((function(n,i){var r={conversationId:e,topic:t.topic||void 0,description:t.description||void 0};O.updateConversation(r,(function(e,t){b(e,i)||ke(t).then(n).catch(i)}))}))},u.findCall=function(e){return Promise.resolve(Ue(Re(e)))},u.getCalls=function(){return Promise.all(y.CallControlSvc.getCalls().map(Ue))},u.getActiveCall=function(){return Promise.resolve(Ue(y.CallControlSvc.getActiveCall()))},u.getActiveRemoteCalls=function(){return Promise.all(y.CallControlSvc.getActiveRemoteCall().map(Ue))},u.getStartedCalls=function(){var e=y.CallControlSvc.getCalls().filter((function(e){return e.state.name===Circuit.Enums.CallState.Started.name})).map(Ue);return Promise.all(e)},u.getConferenceInvitationText=function(e,t){return new Promise((function(n,i){O.getConferenceInvitationText(e,t,(function(e,t){b(e,i)||n(t)}))}))},u.startConference=function(e,t,n){return te(e).then((function(r){return new Promise((function(o,a){r?n&&n!==u.loggedOnUser.clientId?Se(n).then((function(r){if(r){var s={content:{type:"START_CONFERENCE_REQUEST",mediaType:t.video?"video":"audio",convId:e,sdk:!0},destUserId:u.loggedOnUser.userId,destClientId:n};D.sendContactCardRequest(s,(function(e,t){if(e)a(new Circuit.Error(i.ErrorCode.SDK_ERROR,e));else{var n=t.response&&t.response.data;n?o(n):a(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Invalid response for START_CONFERENCE_REQUEST"))}}))}else a(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No client found for clientId "+n))})):(y.SdkHelperSvc.addConversationToCache(r),y.CallControlSvc.startConference(r.convId,t,(function(e,t,n){U(e,a)||Ue(n).then(o).catch(a)}))):a(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))}))}))},u.getConversationDetails=function(e){return new Promise((function(t,n){O.getJoinDetails(e,!1,(function(e,i){b(e,n)||t(fe(i))}))}))},u.changeConversationPin=function(e){return new Promise((function(t,n){O.getJoinDetails(e,!0,(function(e,i){b(e,n)||t(fe(i))}))}))},u.joinConference=function(e,t,n){return new Promise((function(r,o){e?n&&n!==u.loggedOnUser.clientId?Se(n).then((function(a){if(a){var s={content:{type:"JOIN_CONFERENCE_REQUEST",callId:e,mediaType:t},destUserId:u.loggedOnUser.userId,destClientId:n};D.sendContactCardRequest(s,(function(e,t){e?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,t.response.code)):r():o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))}))}else o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No client found for clientId "+n))})):y.CallControlSvc.joinGroupCall(e,t,(function(e){U(e,o)||r()})):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.pullRemoteCall=function(e,t){return new Promise((function(n,r){e?y.CallControlSvc.pullRemoteCall(e,t,(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.leaveConference=_e,u.endConference=function(e){return new Promise((function(t,n){e?y.CallControlSvc.endConference(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.setMediaDevices=function(e){return new Promise((function(t,n){if(e)if(e.playback||e.recording||e.video||e.ringing){e.playback&&(e.playback=Array.isArray(e.playback)?e.playback:[e.playback],P.playbackDevices=e.playback.map((function(e){return{id:e}}))),e.recording&&(e.recording=Array.isArray(e.recording)?e.recording:[e.recording],P.recordingDevices=e.recording.map((function(e){return{id:e}}))),e.video&&(e.video=Array.isArray(e.video)?e.video:[e.video],P.videoDevices=e.video.map((function(e){return{id:e}}))),e.ringing&&(e.ringing=Array.isArray(e.ringing)?e.ringing:[e.ringing],P.ringingDevices=e.ringing.map((function(e){return{id:e}})));var o=y.CallControlSvc.getActiveCall();o?y.CallControlSvc.renegotiateMedia(o.callId,(function(e){e&&r.warn("[SDK]: Unable to renegotiate media.",e),t()})):t()}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes"));else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"))}))},u.makeCall=function(e,t,n){return se(e,n).then((function(e){return new Promise((function(n,r){e?((t&&t.videoResolution&&t.videoResolution===Circuit.Enums.VideoResolutionLevel.VIDEO_720||t.videoResolution===Circuit.Enums.VideoResolutionLevel.VIDEO_1080)&&(t.hdVideo=!0),y.SdkHelperSvc.addConversationToCache(e),y.CallControlSvc.makeCall(e.convId,t,(function(e,t,i){U(e,r)||Ue(i).then(n).catch(r)}))):r(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Conversation does not exist"))}))}))},u.endRemoteCall=function(e){return new Promise((function(t,n){e?y.CallControlSvc.endRemoteCall(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.dropParticipant=function(e,t){return new Promise((function(n,r){e?y.CallControlSvc.dropParticipant(e,{userId:t},(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.muteParticipant=function(e,t){return new Promise((function(n,r){e?y.CallControlSvc.muteParticipant(e,{userId:t},(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.muteRtcSession=function(e){return new Promise((function(t,n){e?y.CallControlSvc.muteRtcSession(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.getCallDevices=function(){return y.CallControlSvc.getCallDevices().map((function(e){return e.name}))},u.getPushDevices=function(){return y.CallControlSvc.getPushDevices().map((function(e){return e.name}))},u.getAnswerDevices=function(e){return y.CallControlSvc.getAnswerDevices(e).map((function(e){return e.name}))},u.getAtcCalls=y.CallControlSvc.getAtcCalls,u.dialNumber=function(e,t){return new Promise((function(n,r){c.PHONE_PATTERN.test(e||null)?y.CallControlSvc.dialNumber(e,t,{audio:!0,video:!1},(function(e,t,i){U(e||t,r)||Ue(i).then(n).catch(r)})):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid number"))}))},u.getTelephonyData=y.SdkHelperSvc.getTelephonyData,u.sendDigits=function(e,t){return new Promise((function(n,r){/^[\d#*,]+$/.exec(t)?y.CallControlSvc.sendDigits(e,t,(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))}))},u.navigateToConversation=function(e,t,n){return new Promise((function(r,o){if(e){var a={content:{type:"CONVERSATION_NAVIGATE_REQUEST",convId:e,sdk:!0},destUserId:u.loggedOnUser.userId},s="CONVERSATION_NAVIGATE_VIA_OTHER_CLIENT";t?Se(t).then((function(e){e?(a.destClientId=t,Ie(a,s).then(r).catch(o)):o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No client found for clientId "+t))})):pe().then((function(t){t?Ie(a,s).then(r).catch(o):n?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):Ae("/#/conversation/"+e).then((function(e){r({type:"CONVERSATION_NAVIGATE_VIA_URL",win:e})})).catch(o)}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))}))},u.sendClickToCallRequest=function(e,t,n,r){return new Promise((function(o,a){if(e){t=t||"audio";var s=e.match(c.PHONE_DIAL_PATTERN),l=s&&s[0];l&&(e=null);var d={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:l?"telephony":t,contact:{email:e||void 0,phoneNumber:l||void 0},promptBeforeDial:!n,sdk:!0},destUserId:u.loggedOnUser.userId};n?Se(n).then((function(e){e?(d.destClientId=n,Ie(d,"CALL_VIA_OTHER_CLIENT").then(o).catch(a)):a(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No client found for clientId "+n))})):pe().then((function(n){if(n)Ie(d,"CALL_VIA_OTHER_CLIENT").then(o).catch(a);else if(r)a(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."));else{Ae(l?"/#/phone?number="+l:"/#/call?user="+e+"&media="+t).then((function(e){o({type:"CALL_VIA_URL",win:e})})).catch(a)}}))}else a(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"emailAddress is required"))}))},u.sendClickToAnswerRequest=function(e,t,n){return new Promise((function(r,o){var a={content:{type:"CLICK_TO_ANSWER_REQUEST",mediaType:t=t||"audio",callId:e,promptBeforeAnswer:!n,sdk:!0},destUserId:u.loggedOnUser.userId};n?Se(n).then((function(e){e?(a.destClientId=n,Ie(a,"ANSWER_VIA_OTHER_CLIENT").then(r).catch(o)):o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No client found for clientId "+n))})):pe().then((function(e){e?Ie(a,"ANSWER_VIA_OTHER_CLIENT").then(r).catch(o):o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."))}))}))},u.muteDevice=function(e,t,n){return new Promise((function(r,o){e?(void 0===(n=n||{}).mic&&(n.mic=!0),void 0===n.speaker&&(n.speaker=!0),pe(t).then((function(a){if(a){var s={content:{type:"MUTE_DEVICE_REQUEST",callId:e,option:n},destUserId:u.loggedOnUser.userId,destClientId:t,sdk:!0};D.sendContactCardRequest(s,(function(e,t){e?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,t.response.code)):r():o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))}))}else o(new Circuit.Error(i.ErrorCode.SDK_ERROR,"Device not found"))}))):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.addParticipantToCall=function(e,t){return new Promise((function(n,r){if(e)if(t)if(t.userId||t.email||t.number){var o={userId:t.userId||void 0,dialOutPhoneNumber:t.number||void 0,displayName:t.displayName||void 0};!t.userId&&t.email&&t.email.match(c.EMAIL_ADDRESS_PATTERN)?ne(t.email).then((function(t){o.userId=t.userId,y.CallControlSvc.addParticipantToCall(e,o,(function(e){e?r(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):n()}))})).catch(r):y.CallControlSvc.addParticipantToCall(e,o,(function(e){e?r(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):n()}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.addParticipantToRtcSession=function(e,t){return new Promise((function(n,r){if(e)if(t)if(t.userId||t.email||t.number){var o={userId:t.userId||void 0,dialOutPhoneNumber:t.number||void 0,displayName:t.displayName||void 0};!t.userId&&t.email&&t.email.match(c.EMAIL_ADDRESS_PATTERN)?ne(t.email).then((function(t){o.userId=t.userId,y.CallControlSvc.addParticipantToRtcSession(e,o,(function(e){e?r(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):n()}))})).catch(r):y.CallControlSvc.addParticipantToRtcSession(e,o,(function(e){e?r(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):n()}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.answerCall=function(e,t,n){return new Promise((function(r,o){e?y.CallControlSvc.answerCallOnDevice(e,t,n&&a[n],(function(e){U(e,o)||r()})):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.endCall=_e,u.toggleVideo=function(e){return new Promise((function(t,n){e?y.CallControlSvc.toggleVideo(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.changeHDVideo=function(e,t,n){return new Promise((function(r,o){e?(t=!!t,y.CallControlSvc.changeHDVideo(e,t,(function(e){U(e,o)||r()}),n)):o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.changeVideoResolution=function(e,t){return new Promise((function(n,r){e?t?y.CallControlSvc.changeVideoResolution(e,t,(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"resolution is required")):r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.getMaxVideoResolution=function(e){return e?ve(e,Circuit.Enums.VideoResolution.FHD).catch(ge(e,Circuit.Enums.VideoResolution.HD)).catch(ge(e,Circuit.Enums.VideoResolution.VGA)).catch((function(){return Promise.reject("No video supported for deviceId: "+e)})):Promise.reject(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"deviceId is required"))},u.toggleRemoteAudio=function(e){return new Promise((function(t,n){if(e){var r=Re(e);r?(r.remoteAudioDisabled?y.CallControlSvc.enableRemoteAudio(e):y.CallControlSvc.disableRemoteAudio(e),t(e)):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.toggleRemoteVideo=function(e){return new Promise((function(t,n){e?y.CallControlSvc.toggleRemoteVideo(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.toggleScreenShare=function(e){return new Promise((function(t,n){if(e){var r=Re(e);r?r.hasLocalScreenShare()?y.CallControlSvc.removeScreenShare(e,(function(e){U(e,n)||t()})):y.CallControlSvc.addScreenShare(e,null,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.setScreenshareStream=Ne,u.toggleMediaStream=Ne,u.getLocalAudioVideoStream=me.bind(u,P.LOCAL_STREAMS.AUDIO_VIDEO),u.getLocalScreenshareStream=me.bind(u,P.LOCAL_STREAMS.DESKTOP),u.setAudioVideoStream=function(e,t,n){return new Promise((function(r,o){if(e)if(t){var a=Re(e);a?Circuit.WebRTCAdapter.origGetUserMedia?o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Already setting another audio/video stream")):(n=n||{audio:!!t.getAudioTracks().length,video:!!t.getVideoTracks().length},Circuit.WebRTCAdapter.origGetUserMedia=Circuit.WebRTCAdapter.getUserMedia,Circuit.WebRTCAdapter.getUserMedia=function(e,n){n&&n(t)},a.sessionCtrl.dontReuseAudioStream=!0,y.CallControlSvc.setMediaType(e,n,(function(e){a.sessionCtrl.dontReuseAudioStream=!1,Circuit.WebRTCAdapter.getUserMedia=Circuit.WebRTCAdapter.origGetUserMedia,delete Circuit.WebRTCAdapter.origGetUserMedia,U(e,o)||r()}))):o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No call found"))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.startRecording=function(e,t,n){return new Promise((function(r,o){if(e){var a=y.CallControlSvc.getActiveCall();a?e===a.callId?y.CallControlSvc.startRecording((function(e){U(e,o)||r()}),t,n):o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Call ID is not for active call")):o(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No active call found"))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.stopRecording=function(e,t){return new Promise((function(n,r){if(e){var o=y.CallControlSvc.getActiveCall();o?e===o.callId?y.CallControlSvc.stopRecording((function(e){U(e,r)||n()}),t):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Call ID is not for active call")):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No active call found"))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.switchRecordingLayout=function(e,t){return new Promise((function(n,r){if(e){var o=y.CallControlSvc.getActiveCall();o?e===o.callId?y.CallControlSvc.switchRecordingLayout(t,(function(e){U(e,r)||n()})):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"Call ID is not for active call")):r(new Circuit.Error(i.ReturnCode.SDK_ERROR,"No active call found"))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.deleteRecording=function(e){return new Promise((function(t,n){O.deleteRecording(e,(function(e){b(e,n)||t()}))}))},u.mute=function(e){return new Promise((function(t,n){e?y.CallControlSvc.mute(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.unmute=function(e){return new Promise((function(t,n){e?y.CallControlSvc.unmute(e,(function(e){U(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.getLastRtpStats=function(e){if(!e)throw new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=Re(e);return t&&t.sessionCtrl?t.savedRTPStats||[]:null},u.getRemoteStreams=function(e){if(!e)throw new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=Re(e);return t&&t.sessionCtrl?t.sessionCtrl.getRemoteStreams()||[]:null},u.enableWhiteboard=function(e,t){return new Promise((function(n,r){if(e)if(t){var o={rtcSessionId:e,viewbox:t};O.enableWhiteboard(o,(function(e){b(e,r)||n()}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.disableWhiteboard=function(e){return new Promise((function(t,n){if(e){var r={rtcSessionId:e};O.disableWhiteboard(r,(function(e){b(e,n)||t()}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.addWhiteboardElement=function(e,t){return new Promise((function(n,r){if(e)if(t){var o={rtcSessionId:e,xmlElement:t};O.addWhiteboardElement(o,(function(e){b(e,r)||n()}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.removeWhiteboardElement=function(e,t){return new Promise((function(n,r){if(e)if(t){var o={rtcSessionId:e,xmlId:t};O.removeWhiteboardElement(o,(function(e){b(e,r)||n()}))}else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else r(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.updateWhiteboardElement=function(e,t,n){return new Promise((function(r,o){if(e)if(t)if(n){var a={rtcSessionId:e,xmlId:t,xmlElement:n};O.updateWhiteboardElement(a,(function(e){b(e,o)||r()}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.clearWhiteboard=function(e,t,n){return new Promise((function(r,o){if(e){var a={rtcSessionId:e,userId:t||void 0,preserveBackground:n||void 0};O.clearWhiteboard(a,(function(e){b(e,o)||r()}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.getWhiteboard=function(e){return new Promise((function(t,n){if(e){var r={rtcSessionId:e};O.getWhiteboard(r,(function(e,i){b(e,n)||(i.elements&&i.elements.forEach(he),i.callId=i.rtcSessionId,delete i.rtcSessionId,t(i))}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.setWhiteboardBackground=function(t,n){return new Promise((function(o,a){if(t)if(n)if("object"==typeof n)new e.FileUpload(C).uploadWhiteboardFile(n,t).then((function(e){var n={rtcSessionId:t,url:e.url};O.setWhiteboardBackground(n,(function(e){b(e,a)||o()}))})).catch((function(e){r.error("[SDK]: File upload error. ",e),a(new Circuit.Error(i.ReturnCode.SDK_ERROR,e))}));else if("string"==typeof n){var s={rtcSessionId:t,url:n};O.setWhiteboardBackground(s,(function(e){b(e,a)||o()}))}else a(new Circuit.Error(i.ReturnCode.SDK_ERROR,"file must be a File object or a string"));else a(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"));else a(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.clearWhiteboardBackground=function(e){return new Promise((function(t,n){if(e){var r={rtcSessionId:e};O.clearWhiteboardBackground(r,(function(e){b(e,n)||t()}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.toggleWhiteboardOverlay=function(e){return new Promise((function(t,n){if(e){var r={rtcSessionId:e};O.toggleWhiteboardOverlay(r,(function(e){b(e,n)||t()}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.undoWhiteboard=function(e,t,n){return new Promise((function(r,o){if(e){var a={rtcSessionId:e,steps:t,userId:n||void 0};O.undoWhiteboard(a,(function(e){b(e,o)||r()}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))}))},u.startUserSearch=function(e){return"string"==typeof e&&(e={query:e}),new Promise((function(t,n){O.startUserSearch(e,(function(e,i){e?n(e):t(i)}))}))},u.startBasicSearch=function(e){var t;return t="string"==typeof e?{scope:i.SearchScope.ALL,searchTerm:e}:e,new Promise((function(e,n){O.startBasicSearch(t,null,(function(t,i){t?n(t):e(i)}))}))},u.startAdvancedUserSearch=function(e){return new Promise((function(t,n){if(e)if("object"==typeof e&&e.query){var r={searchContext:e.searchContext||Circuit.Enums.SearchContext.USER,query:e.query,searchExactAssignedPhoneNumber:e.searchExactAssignedPhoneNumber||!1,resultSetLimit:0};O.startAdvancedUserSearch(r,(function(e,i){b(e,n)||t(i)}))}else n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"query needs to be an object containing the property to be queried"));else n(new Circuit.Error(i.ReturnCode.SDK_ERROR,"missing parameter"))}))},u.cancelSearch=function(e){return new Promise((function(t,n){O.cancelSearch(e,(function(e){b(e,n)||t()}))}))},u.submitForm=function(e,t){return new Promise((function(n,i){O.submitFormData(e,t,(function(e){b(e,i)||n()}))}))},u.createIncomingWebhook=function(e){return new Promise((function(t,n){e&&"object"==typeof e?e.conversationId?O.createIncomingWebhook(e,(function(e,i){b(e,n)||t(i)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a conversation Id")):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"newWebhookData must be an object"))}))},u.deleteIncomingWebhook=function(e){return new Promise((function(t,n){e&&"string"==typeof e?O.deleteIncomingWebhook(e,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be deleted"))}))},u.getIncomingWebhook=function(e){return new Promise((function(t,n){e&&"string"==typeof e?O.getIncomingWebhook(e,(function(e,i){b(e,n)||t(i)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be retrieved"))}))},u.getIncomingWebhooks=function(e){return new Promise((function(t,n){if(e&&"object"==typeof e){if(e.tenantId)e.filter=i.CPasSIncomingWebhookFilter.TENANT;else if(e.userId)e.filter=i.CPasSIncomingWebhookFilter.USER;else{if(!e.conversationId)return void n("Missing id for filtering");e.filter=i.CPasSIncomingWebhookFilter.CONVERSATION}O.getIncomingWebhooks(e,(function(e,i){b(e,n)||t(i)}))}else n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"searchCondition must be an object"))}))},u.suspendIncomingWebhook=function(e){return new Promise((function(t,n){e&&"string"==typeof e?O.suspendIncomingWebhook(e,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be suspended"))}))},u.unsuspendIncomingWebhook=function(e){return new Promise((function(t,n){e&&"string"==typeof e?O.unsuspendIncomingWebhook(e,(function(e){b(e,n)||t()})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be unsuspended"))}))},u.updateIncomingWebhook=function(e){return new Promise((function(t,n){e&&"object"==typeof e?e.webhookId?O.updateIncomingWebhook(e,(function(e,i){b(e,n)||t(i)})):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a webhook Id")):n(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"updateWebhookData must be an object"))}))},u.sendAppMessageToUser=function(e,t,n){return new Promise((function(r,o){if(e&&"string"==typeof e)if(t&&"string"==typeof t)if(n&&"object"==typeof n){var a={content:{type:e,message:n},destUserId:t};D.sendSdkRequest(a,(function(e){e?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):r()}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))}))},u.sendAppMessageToClient=function(e,t,n){return new Promise((function(r,o){if(e&&"string"==typeof e)if(t&&"string"==typeof t)if(n&&"object"==typeof n){var a={content:{type:e,message:n},destUserId:u.loggedOnUser.userId,destClientId:t};D.sendSdkRequest(a,(function(e){e?o(new Circuit.Error(i.ErrorCode.SDK_ERROR,e)):r()}))}else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));else o(new Circuit.Error(i.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))}))},u.addAppMessageListener=function(e,t){D.on("SDK."+e,t)},u.removeAppMessageListener=D.off,y.PubSubSvc.subscribe("/localUser/update",(function(){Ve({type:"loggedOnUserUpdated",user:u.loggedOnUser})})),O.on("Conversation.ADD_ITEM",(function(e){Ve({type:"itemAdded",item:e.item})})),O.on("Conversation.UPDATE_ITEM",(function(e){Ve({type:"itemUpdated",item:e.item})})),O.on("Conversation.FLAG_ITEM",(function(e){Ve({type:"itemFlagged",convId:e.convId,itemId:e.conversationItemId})})),O.on("Conversation.CLEAR_FLAGGED_ITEM",(function(e){Ve({type:"itemUnflagged",convId:e.convId,itemId:e.conversationItemId})})),O.on("Conversation.CREATE",(function(e){Ve({type:"conversationCreated",conversation:e.conversation})})),O.on("Conversation.UPDATE",(function(e){Ve({type:"conversationUpdated",conversation:e.conversation})})),y.PubSubSvc.subscribe("/conversation/new",(function(e){Ve({type:"conversationUpdated",conversation:e})})),O.on("Conversation.CONVERSATION_MARKED",(function(e){switch(e.filter){case i.ConversationMarkFilter.MUTE:Ve({type:"conversationArchived",convId:e.convId});break;case i.ConversationMarkFilter.FAVORITE:Ve({type:"conversationFavorited",convId:e.convId})}})),O.on("Conversation.CONVERSATION_UNMARKED",(function(e){switch(e.filter){case i.ConversationMarkFilter.MUTE:Ve({type:"conversationUnarchived",convId:e.convId});break;case i.ConversationMarkFilter.FAVORITE:Ve({type:"conversationUnfavorited",convId:e.convId})}})),O.on("ConversationUserData.LABELS_ADDED",(function(e){Ve({type:"labelsAdded",labels:e.labelsAdded})})),O.on("ConversationUserData.LABEL_EDITED",(function(e){Ve({type:"labelEdited",label:e.labelEdited})})),O.on("ConversationUserData.LABELS_REMOVED",(function(e){Ve({type:"labelsRemoved",labelIds:e.labelsRemoved})})),O.on("Conversation.USER_DATA_CHANGED",(function(e){Ve({type:"conversationUserDataChanged",data:e})})),O.on("Conversation.READ_ITEMS",(function(e){Ve({type:"conversationReadItems",data:e})})),O.on("User.USER_PRESENCE_CHANGE",(function(e){Ve({type:"userPresenceChanged",presenceState:e.newState})})),O.on("User.TENANT_PRESENCE_CHANGE",(function(e){e.newState.forEach((function(e){Ve({type:"userPresenceChanged",presenceState:e})}))})),O.on("Conversation.TYPING",(function(e){Ve({type:"typing",data:e})})),O.on("User.USER_UPDATED",(function(e){Ve({type:"userUpdated",user:e.user})})),O.addEventListener("connectionStateChange",(function(e){E===t.Reconnecting&&e.newState===t.Connected&&J().catch((function(e){r.error("Error initializing websocket on reconenct",e)})),E=e.newState,Ve({type:"connectionStateChanged",state:e.newState})})),O.addEventListener("reconnectFailed",(function(){Ve({type:"reconnectFailed"}),C.client_secret&&Z().then(H).then($).catch((function(e){r.error("Error re-authenticating on auto-reconnect for client credentials grant",e)}))})),O.on("User.SESSION_EXPIRES",(function(){u.loggedOnUser&&Te()})),O.on("User.SESSION_EXPIRING",(function(){Ve({type:"sessionExpiring"})})),O.on("User.SESSION_CLOSED",(function(e){Ve({type:"sessionClosed",reason:e.reason})})),O.on("User.PASSWORD_CHANGED",(function(){Ve({type:"passwordChanged"})})),O.on("User.USER_SETTING_UPDATED",(function(e){var t=ue(e.settings);Object.keys(t).length>0&&Ve({type:"userSettingsChanged",userSettings:t})})),O.on("Search.BASIC_SEARCH_RESULT",(function(e){Ve({type:"basicSearchResults",data:e})})),O.on("Search.SEARCH_STATUS",(function(e){Ve({type:"searchStatus",data:e})})),O.on("System.MAINTENANCE",(function(e){Ve({type:"systemMaintenance",data:e})})),O.on("User.USER_DELETED",(function(e){Ve({type:"userDeleted",data:e})})),O.on("Conversation.DELETE",(function(e){Ve({type:"conversationDeleted",convId:e.convId})})),O.on("RTCSession.WHITEBOARD_ENABLED",(function(e){var t=Re(e.sessionId);t&&(t.whiteboardEnabled=!0,Ve({type:"whiteboardEnabled",enabled:!0,whiteboard:e.whiteboard,data:{enabled:!0,whiteboard:e.whiteboard}}),Ve({type:"callStatus",call:t,reason:"whiteboardEnabled"}))})),O.on("RTCSession.WHITEBOARD_DISABLED",(function(e){var t=Re(e.sessionId);t&&(t.whiteboardEnabled=!1,Ve({type:"whiteboardEnabled",enabled:!1,data:{enabled:!1}}),Ve({type:"callStatus",call:t,reason:"whiteboardEnabled"}))})),O.on("RTCSession.WHITEBOARD_CLEARED",(function(e){Ve({type:"whiteboardCleared",userId:e.userId,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",(function(e){he(e.element),Ve({type:"whiteboardElement",action:"added",element:e.element,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",(function(e){Ve({type:"whiteboardElement",action:"removed",elementId:e.elementId,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",(function(e){he(e.element),Ve({type:"whiteboardElement",action:"updated",element:e.element,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_BACKGROUND_SET",(function(e){he(e.element),Ve({type:"whiteboardBackground",action:"set",element:e.element,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_BACKGROUND_CLEARED",(function(){Ve({type:"whiteboardBackground",action:"cleared"})})),O.on("RTCSession.WHITEBOARD_OVERLAY_TOGGLED",(function(){Ve({type:"whiteboardOverlayToggled"})})),O.on("RTCSession.WHITEBOARD_SYNC",(function(e){Ve({type:"whiteboardSync",whiteboard:e.whiteboard,possibleUndoOperations:e.possibleUndoOperations})})),O.on("RTCSession.WHITEBOARD_CONVERSION_FAILED",(function(e){Ve({type:"whiteboardConversionFailed",callId:e.sessionId,errorText:e.errorText,lastElements:e.lastElements})})),O.on("ActivityStream.ACTIVITY_CREATED",(function(e){e.navigableItem&&e.navigableItem.mention&&Ve({type:"mention",mention:e.navigableItem.mention})})),O.on("CPAAS.SUBMIT_FORM_DATA",(function(e){Ve({type:"formSubmission",itemId:e.itemId,form:e.form,submitterId:e.submitterId})})),y.PubSubSvc.subscribe("/call/incoming",(function(e){Ve({type:"callIncoming",call:e})})),_&&y.PubSubSvc.subscribe("/call/warmupFailed",(function(e,t){Ve({type:"callIncoming",call:t})})),y.PubSubSvc.subscribe("/call/state",(function(e){Ve({type:"callStatus",call:e,reason:"callStateChanged"})})),y.PubSubSvc.subscribe("/call/remoteStreamUpdated",(function(e){Ve({type:"callStatus",call:e,reason:"remoteStreamUpdated"})})),y.PubSubSvc.subscribe("/call/localStreamEnded",(function(e){Ve({type:"callStatus",call:e,reason:"localStreamEnded"})})),y.PubSubSvc.subscribe("/call/muted",(function(e){Ve({type:"callStatus",call:e,reason:"callMuted"})})),y.PubSubSvc.subscribe("/call/localUser/muted",(function(e){Ve({type:"callStatus",call:Re(e),reason:"localUserMuted"})})),y.PubSubSvc.subscribe("/call/localUser/unmuted",(function(e){Ve({type:"callStatus",call:Re(e),reason:"localUserUnmuted"})})),y.PubSubSvc.subscribe("/call/localUser/mutedSelf",(function(e,t){var n=Re(e);Ve(t?{type:"callStatus",call:n,reason:"localUserSelfMuted"}:{type:"callStatus",call:n,reason:"localUserSelfUnmuted"})})),y.PubSubSvc.subscribe("/call/locked",(function(e){Ve({type:"callStatus",call:e,reason:"callLocked"})})),y.PubSubSvc.subscribe("/call/moved",(function(e,t){Ve({type:"callStatus",call:Re(t),reason:"callMoved"})})),y.PubSubSvc.subscribe("/call/participant/updated",(function(e,t){Ve({type:"callStatus",call:Re(e),participant:t,reason:"participantUpdated"})})),y.PubSubSvc.subscribe("/call/participants/updated",(function(e,t){Ve({type:"callStatus",call:Re(e),participants:t,reason:"participantsUpdated"})})),y.PubSubSvc.subscribe("/call/participant/added",(function(e,t){Ve({type:"callStatus",call:Re(e),participant:t,reason:"participantAdded"})})),y.PubSubSvc.subscribe("/call/participants/added",(function(e,t){Ve({type:"callStatus",call:Re(e),participants:t,reason:"participantsAdded"})})),y.PubSubSvc.subscribe("/call/participant/joined",(function(e,t){Ve({type:"callStatus",call:e,participant:t,reason:"participantJoined"})})),y.PubSubSvc.subscribe("/call/participant/removed",(function(e){Ve({type:"callStatus",call:Re(e),reason:"participantRemoved"})})),y.PubSubSvc.subscribe("/call/recording/info",(function(e){Ve({type:"callStatus",call:e,reason:"callRecording"})})),y.PubSubSvc.subscribe("/call/droppedRemotely",(function(e){Ve({type:"callStatus",call:e,reason:"droppedRemotely"})})),y.PubSubSvc.subscribe("/call/sdpConnected",(function(e){Ve({type:"callStatus",call:e,reason:"sdpConnected"})})),y.PubSubSvc.subscribe("/call/participants/activeSpeakers",(function(e,t){Ve({type:"callStatus",call:Re(e),reason:"activeSpeakerChanged",activeSpeakers:t})})),y.PubSubSvc.subscribe("/call/network/quality",(function(e,t){Ve({type:"callNetworkQualityChanged",callId:e,data:t})})),y.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",(function(e){Ve({type:"callRtpThresholdReached",call:Re(e)})})),y.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",(function(e){Ve({type:"callRtpThresholdCleared",call:Re(e)})})),y.PubSubSvc.subscribe("/call/ended",(function(e,t){Re(e.callId)||Ve({type:"callEnded",call:e,replaced:t})})),u},e.Client.prototype.name="Client",e.isCompatible=function(){var e=parseInt(u.version,10);return u.chrome&&e>=44||u.firefox&&e>=42||u.edge},e.supportedFeatures=function(){return e.isCompatible()?{text:!0,rtc:u.chrome||u.firefox}:{text:!1,rtc:!1}},Object.defineProperty(e,"supportedEvents",{get:function(){return["accessTokenRenewed","renewAccessTokenFailed","loggedOnUserUpdated","itemAdded","itemUpdated","itemFlagged","itemUnflagged","conversationCreated","conversationUpdated","conversationArchived","conversationFavorited","conversationUnarchived","conversationUnfavorited","conversationUserDataChanged","conversationReadItems","userPresenceChanged","userUpdated","connectionStateChanged","sessionTokenRenewed","reconnectFailed","userSettingsChanged","basicSearchResults","searchStatus","systemMaintenance","whiteboardEnabled","whiteboardElement","whiteboardCleared","mention","formSubmission","callIncoming","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded","whiteboardBackground","whiteboardOverlayToggled","whiteboardSync","labelsAdded","labelEdited","labelsRemoved","typing"]},enumerable:!0,configurable:!0}),e}((Circuit=function(e){"use strict";return e.Injectors={},e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.logger,i=e.PhoneNumberFormatter,r=e.Utils;function o(e,i){if(!e||!e.localUser)return n.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!i||i.isExtended)return i;var r=Object.create(i);r.isExtended=!0,r.moderators=r.moderators||[];var o=i.participants.map((function(e){return"string"==typeof e?{userId:e}:e})).filter((function(t){return t.userId===e.localUser.userId&&(r.hasJoined=!0),t.userId!==e.localUser.userId}));return r.peerUsers=o,i.type===t.ConversationType.DIRECT&&(r.peerUser=o[0]),r.userIsModerator=function(e){return!!e&&r.moderators.some((function(t){return t.userId===e.userId}))},r}function a(e){if(!e||e.isExtended)return e;var t=Object.create(e);return t.isExtended=!0,t}function s(e){var n=e&&e.accounts&&e.accounts[0],o=n&&n.telephonyConfiguration;if(o){o.phoneNumber=i.format(o.phoneNumber)||"",o.callerId=i.format(o.callerId)||"",o.reroutingPhoneNumber=i.format(o.reroutingPhoneNumber)||"",e.reroutingPhoneNumber=o.reroutingPhoneNumber,e.ondSipAuthenticationHash=o.ondSipAuthenticationHash,e.onsSipAuthenticationHash=o.onsSipAuthenticationHash,e.associatedTelephonyUserID=o.associatedTelephonyUserID,e.associatedTelephonyUserType=o.associatedTelephonyUserType;var a=(o.previousAlternativeDevice||[]).map(r.cleanPhoneNumber).reduce((function(e,t){return t.startsWith("+")&&"+"!==t&&(e[t]=!0),e}),{});if(e.previousAlternativeNumbers=Object.keys(a),e.reroutingPhoneNumber){var s=r.cleanPhoneNumber(e.reroutingPhoneNumber);e.previousAlternativeNumbers.includes(s)||e.previousAlternativeNumbers.unshift(s)}e.associatedTelephonyUserID?(e.isOsBizCTIEnabled=e.associatedTelephonyUserType===t.GtcTrunkType.OSBIZ_TRUNK_TYPE&&o.isOsBizCTIEnabled,e.isATC=e.isOsBizCTIEnabled||e.associatedTelephonyUserType===t.GtcTrunkType.ATC_TRUNK_TYPE,e.isSTC=e.associatedTelephonyUserType===t.GtcTrunkType.SUB_TRUNK_TYPE,(e.isATC||e.isSTC)&&(e.associatedGTCUserId=e.associatedTelephonyUserID)):(e.isOsBizCTIEnabled=!1,e.isATC=!1,e.isSTC=!1)}else delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.ondSipAuthenticationHash,delete e.onsSipAuthenticationHash,delete e.associatedTelephonyUserID,delete e.associatedTelephonyUserType,delete e.isATC,delete e.isSTC}var c=function(e,t){return window.setTimeout(e,t)};c.cancel=function(e){e&&window.clearTimeout(e)};var l=function(e,t,n){if(void 0===n)return window.setInterval(e,t);if(n<=0)return null;var i=0,r=null;return r=window.setInterval((function(){e(),++i>=n&&window.clearInterval(r)}),t)};l.cancel=function(e){e&&window.clearInterval(e)};var d=null;e.ClientApiHandlerSingleton.getInstance=function(){return d};var u=null;return e.UserToUserHandlerSingleton.getInstance=function(){return u},e.SdkServices=function(t,i,E){d=t,u=i,this.rootScope={localUser:null,clientVersion:"",browser:r.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(e){e&&e()},$digest:function(){},i18n:{localize:function(e){return e},map:{res_Unknown:"Unknown"}},localize:function(e){return e}},E&&(this.rootScope.isSessionGuest=!0),e.Conversation={extend:o.bind(null,this.rootScope)},e.UserProfile={extend:a.bind(null),syncTelephonyConfig:s.bind(null)},this.PubSubSvc=new e.PubSubSvcImpl(n),this.ExtensionSvc=new e.ExtensionSvcImpl(this.rootScope,c,window,Promise,n,this.PubSubSvc,null),this.SdkHelperSvc=new e.SdkHelperSvcImpl(this.rootScope,Promise,n,this.PubSubSvc),this.AtcRegistrationSvc=new e.AtcRegistrationSvcImpl(this.rootScope,c,n,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.DeviceDiagnosticSvc=new e.DeviceDiagnosticSvcImpl(this.rootScope,c,n,this.PubSubSvc,null),this.CircuitCallControlSvc=new e.CircuitCallControlSvcImpl(this.rootScope,c,l,window,Promise,n,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc,this.DeviceDiagnosticSvc),this.CstaSvc=new e.CstaSvcImpl(this.rootScope,c,Promise,n,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new e.CallControlSvcImpl(this.rootScope,Promise,c,n,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),e.Conversation=null,e.UserProfile=null,d=null,u=null},e}((Circuit=function(e){"use strict";var t=e.Enums.CallState,n=e.Enums.CstaCallState,i=e.Constants,r=e.Enums,o=e.Enums.ParticipantAction,a=e.Enums.ScreenDisplayAction,s=e.Enums.ScreenLayoutAction,c=e.Enums.Targets,l=e.Enums.TransferCallFailedCauses,d=e.Utils,u=e.UserToUserHandlerSingleton;return e.CallControlSvcImpl=function(E,C,T,p,S,I,A,R,f,_,v,g){p.debug("New Service: CallControlSvc");var N,m=[],h=this,O=u.getInstance();function D(e,t,n){return n=n||function(){},e&&t&&t.userId?f?k(e)?!!t.isMeetingPointInvitee||(p.warn("[CallControlSvc]: Cannot invoke CMR action - Participant is not CMR invitee"),n("Not CMR invitee"),!1):(p.warn("[CallControlSvc]: Cannot invoke CMR action - There is no local call"),n("Call invalid"),!1):(p.error("[CallControlSvc]: Cannot invoke CMR action - MeetingPointSvc is not initialized"),n("MeetingPointSvc not initialized"),!1):(n("Invalid arguments"),!1)}function P(e){m.some((function(t,n){return!!e.sameAs(t)&&(m.splice(n,1),!0)}))}function y(e){return m.find((function(t){return t.callId===e}))||null}function b(){for(var e=null,i=0;i<m.length;i++){if(m[i].state===t.ActiveRemote)return m[i];m[i].checkCstaState(n.Conference)&&(e=m[i])}return e}function U(e){p.debug("[CallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),S.publish("/call/state",[e])}function L(e){e.terminate()}function M(e){e&&(p.debug("[CallControlSvc]: Publish /conversation/update event. convId = ",e.convId),S.publish("/conversation/update",[e]))}function w(o){if(o)if(o.isAtcRemote){var a=A.getConversationFromCache(o.convId);if(a&&a.isTelephony){if(!o.checkCstaState([n.Idle,n.Terminated])&&(function(e){for(var t=0;t<m.length;t++)if(e.sameAs(m[t]))return p.debug("[CallControlSvc]: Updating call with callId = "+e.callId),void(m[t]=e);m.push(e)}(o),!a.call||a.call.isHandoverInProgress&&!a.call.sameAs(o)||a.call.isAtcRemote&&(a.call.isHolding()||a.call.isHoldInProgress()))){if(a.call&&a.call.isHandoverInProgress){var s=a.call;s.clearAtcHandoverInProgress(),o.establishedTime=s.establishedTime,s.isAtcRemote?P(s):I.removeCallFromList(s),s.terminateReason=r.CallClientTerminatedReason.USER_ENDED,L(s),p.debug("[CallControlSvc]: Publish /call/ended event."),S.publish("/call/ended",[s,!1])}a.call=o}!function(i,r){switch(i.getCstaState()){case n.Initiated:case n.Offered:case n.ExtendedRinging:i.setState(t.Started);break;case n.Delivered:i.setState(t.Delivered);break;case n.Busy:i.setState(t.Busy);break;case n.Ringing:i.checkState(t.Ringing)||(i.setState(t.Ringing),_&&_.show({type:e.Enums.NotificationType.INCOMING_VOICE_CALL,user:i.peerUser,extras:{conversation:r,call:i}}));break;case n.Idle:case n.TransferFailed:case n.Failed:i.setState(t.Idle);break;case n.Terminated:i.setState(t.Terminated);break;default:i.setState(t.ActiveRemote)}}(o,a),o.state!==t.Idle&&o.state!==t.Terminated&&o.state!==t.Started?(M(a),U(o),R.isPrimaryClient()&&o.state!==t.Ringing&&g.setPresenceWithLocation(i.PresenceState.BUSY)):o.state!==t.Idle&&o.state!==t.Terminated||(L(o),P(o),p.debug("[CallControlSvc]: Publish /call/ended event"),S.publish("/call/ended",[o,!1]),o.isHandoverInProgress||a.call&&a.call.sameAs(o)&&(a.call=b(),a.call||I.getActiveCall()||g.setPresenceWithLocation(i.PresenceState.AVAILABLE)),M(a))}else p.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation")}else U(o);else p.warn("[CallControlSvc]: Invalid call object in /atccall/info event")}function G(e){var t=function(){for(var e=0;e<m.length;e++)if(m[e].isHandoverInProgress)return m[e];return null}();if(t){t.atcCallInfo.transferCb&&(t.atcCallInfo.transferCb(null,null,e),delete t.atcCallInfo.transferCb);var n=A.getConversationFromCache(e.convId);e.establishedTime=t.establishedTime,L(t),P(t),n&&n.call&&(n.call=e,M(n))}}function k(e){var t=I.getActiveCall();return!!t&&e===t.callId}function H(e){p.debug("[CallControlSvc]: Publish /call/nativeDial event"),S.publish("/call/nativeDial",[e])}function V(){if(!E.localUser.isOsBizCTIEnabled)return null;var e=I.findOsBizFirstCall();if(!e)return null;var t=I.findOsBizSecondCall();if(!t)return null;var n=e.checkCstaState(r.CstaCallState.Holding);return{activeCall:n?t:e,heldCall:n?e:t}}function B(e,t,n){var i;"object"==typeof t&&(i=t);var o={content:{type:r.StcMessage.TRANSFER,phoneNumber:E.localUser.callerId,transferRequest:{sessionId:e.callId,target:{dn:i?i.peerUser.phoneNumber:t,sessionId:i?i.callId:void 0}}},destUserId:E.localUser.associatedTelephonyUserID};O.sendStcRequest(o,(function(e,t){if(e||t&&t.error){var r=l.Unreachable.name;t&&l[t.error]&&(r=t.error),n&&n(l[r].ui)}else i&&i.isPresent()&&!i.state.established&&h.endCall(i.callId),n&&n()}))}function F(e,t,n){if(p.buttonPressed("Toggle video for participant with userId: ",t.userId),t.isMeetingPointInvitee){t.toggleVideoInProgress=!0;var i=A.getConversationFromCache(e.convId);t.setActions(i,E.localUser),h.toggleVideoParticipant(e.callId,t,(function(e){t.toggleVideoInProgress=!1,t.setActions(i,E.localUser),e&&(p.error("[CallControlSvc]: Cannot toggle video participant. ",e),n(e))}))}else p.info("[CallControlSvc]: Cannot toggle video participant for ",t.userId)}function x(e){return e.muted&&(e.userId===E.localUser.userId||e.actions.includes(o.Unmute))}function W(e){return e&&(e.hasRemoteScreenShare()||e.hasLocalScreenShare())}function K(e,t,n){I.mergeCalls(e,t).then((function(){n()})).catch((function(e){p.warn("[CallControlSvc]: Merge call failed"),n(e)}))}return S.subscribe("/atccall/info",(function(e){p.debug("[CallControlSvc]: Received /atccall/info event"),w(e)})),S.subscribe("/atccall/replace",(function(e){p.debug("[CallControlSvc]: Received /atccall/replace event"),G(e)})),S.subscribe("/call/ended",(function(e){if(p.debug("[CallControlSvc]: Received /call/ended event"),e.sendDtmfTimer&&(T.cancel(e.sendDtmfTimer),e.sendDtmfTimer=null),delete e.dtmfDigits,e.isAtcRemote)e.clearAtcHandoverInProgress(),P(e);else{var n=A.getConversationFromCache(e.convId);n&&n.isTelephony&&!n.call&&(n.call=b()||m.find((function(e){return e.state===t.Ringing}))||null,n.call&&M(n)),e.isRemote||I.getActiveCall()||(R.isPrimaryClient()&&b()||g.setPresenceWithLocation(i.PresenceState.AVAILABLE),g.cancelAutoSnooze())}})),S.subscribe("/atccall/hangingcall",(function(e){var t;p.debug("[CallControlSvc]: Received /atccall/hangingcall event"),t=e,A.getTelephonyConversation((function(e,n){!e&&n&&n.call&&n.call.atcCallInfo.getCstaCallId()===t&&(n.call=null,M(n))}))})),S.subscribe("/call/state",(function(e){p.debug("[CallControlSvc]: Received /call/state event"),e&&e.state.established&&(e.isRemote||g.setPresenceWithLocation(i.PresenceState.BUSY),e.dtmfDigits&&function(e){var t=e.dtmfDigits;if(t){delete e.dtmfDigits;var n=t.match(/^,*/)[0].length,i=2e3*n+1e3;n&&(t=t.substr(n)),e.sendDtmfTimer=T((function(){e.sendDtmfTimer=null,e.isPresent()&&(p.debug("[CallControlSvc]: Send delayed DTMF digits "+t+" for call "+e.callId),h.sendDigits(e.callId,t))}),i)}}(e))})),S.subscribe("/screenshare/started",(function(){p.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),g.startAutoSnooze()})),S.subscribe("/screenshare/ended",(function(){p.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),g.cancelAutoSnooze()})),d.isMobile()&&O.on("MOBILE_BREAKOUT.DIAL",(function(e){p.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),E.$apply((function(){!function(e){if(e&&e.phoneNumber){p.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var t={phoneNumber:e.phoneNumber,autoDial:e.autoDial,userName:e.userName},n=[];e.conversationId&&n.push(A.getConversationPromise(e.conversationId)),e.userId&&n.push(v.getUserPromise(e.userId)),n.length?C.all(n).then((function(e){e&&e.forEach((function(e){e.userId?t.user=e:t.conversation=e})),H(t)})):H(t)}}(e)}))})),this.initActiveSessionsForSdk=I.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=I.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=I.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=I.setClientDiagnosticsDisabled,this.getCalls=I.getCalls,this.getPhoneCalls=I.getPhoneCalls,this.getActiveCall=I.getActiveCall,this.isConnectionInProgress=I.isConnectionInProgress,this.getIncomingCall=I.getIncomingCall,this.getActiveRemoteCall=I.getActiveRemoteCall,this.joinGroupCall=I.joinGroupCall,this.makeCall=I.makeCall,this.makeAtcCall=function(e,t,n){var i=d.cleanPhoneNumber("object"==typeof t?t.dialedDn:t);"object"==typeof t?t.dialedDn=i:t={dialedDn:i},t.dtmfDigits&&(t.dtmfDigits=d.cleanPhoneNumberDigitsWithPin(t.dtmfDigits));var r,o=function(e){return m.find((function(t){return t.isAtPosition(e)}))||null}(e)||E.localUser.isOsBizCTIEnabled&&((r=h.getActiveCall())&&r.isTelephonyCall?r:null);R.startCall(o,e,t,n)},this.makeEchoTestCall=I.makeEchoTestCall,this.makeEchoTestCallWithOptions=I.makeEchoTestCallWithOptions,this.dialNumber=I.dialNumber,this.dialPhoneNumber=I.dialPhoneNumber,this.dialUsingDefaultDevice=function(e,t){t=t||function(){};var n=e&&e.dialedDn;n&&d.PHONE_DIAL_PATTERN.test(n)?(p.debug("[CallControlSvc]: Calling "+n+" with name: "+e.toName),A.getTelephonyConversation((function(i,r){if(i||!r)return p.debug("[CallControlSvc]: Error on getTelephonyConversation. ",i),void t(i||"No telephony conversation");if(r.call&&r.call.consultation){var o=r.call.getPosition()||N;if(o&&o!==c.WebRTC||E.localUser.isOsBizCTIEnabled)return p.info("[CallControlSvc]: Start consultation from "+o.name+" to ",n),h.makeAtcCall(o,e,t),void(r.call.consultation=!1)}else if(N&&(N!==c.WebRTC||r.call&&E.localUser.isOsBizCTIEnabled))return p.info("[CallControlSvc]: Make call from "+N.name+" to ",n),void h.makeAtcCall(N,e,t);e.mediaType=e.mediaType||{audio:!0,video:!1,desktop:!1},h.dialPhoneNumber(e,t)}))):t("Missing or wrong number")},this.setDefaultCallDevice=function(e){e&&e.name&&Object.keys(c).some((function(t){return e.name===c[t].name&&(N=c[t],p.debug("[CallControlSvc]: Set defaultCallDevice to ",N.name),!0)}))},this.startConference=I.startConference,this.startConferenceWithOptions=I.startConferenceWithOptions,this.cannotHandleSecondCall=function(){var e=h.getIncomingCall();if(!e)return!1;var n=h.getActiveCall();return!!n&&(n.isTelephonyCall&&!e.isTelephonyCall||!n.isTelephonyCall&&n.checkState([t.Active,t.Waiting]))},this.answerCall=function(e,t,n){if(I.getEstablishedLocalPhoneCalls().length>1)return p.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(n&&n("Can not answer the call"));var r=I.findCall(e);if(r)E.localUser.isOsBizCTIEnabled&&r.isTelephonyCall&&r.atcCallInfo&&r.isOsBizSecondCall?R.answerCstaCall(r.atcCallInfo.getCstaCallId(),n):I.answerCall(e,t,n);else{r=y(e);var o=I.getActiveCall(),a=I.getIncomingCall(),s=I.getCallToPickup();r?o&&!o.isTelephonyCall?I.endActiveCall((function(){R.pullRemoteCall(e,n)})):a&&!a.isTelephonyCall?I.endCallWithCauseCode(a.callId,i.InviteRejectCause.BUSY,(function(){R.pullRemoteCall(e,n)})):R.pullRemoteCall(e,n):s&&s.callId===e?I.pickupTeamCall(e,t,n):(p.warn("[CallControlSvc]: answerCall - There is no alerting call"),n&&n("No alerting call"))}},this.answerCallOnDevice=function(e,t,n,i){if(i=i||function(){},n&&n!==c.WebRTC){var r=I.findCall(e);r?r.isTelephonyCall?E.localUser.isOsBizCTIEnabled&&n!==c.VM&&n!==c.Cell?R.answerCstaCall(r.atcCallInfo.getCstaCallId(),i):R.deflect(e,n,null,i):(p.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call"),i("Not telephony call")):(r=y(e))?r.pickupNotification?R.pickupCall(e,n,i):r.getPosition()!==n?R.deflect(e,n,null,i):R.answer(e,i):(p.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),i("No alerting call"))}else h.answerCall(e,t,i)},this.endCall=function(e,t){h.endCallWithCauseCode(e,null,t)},this.endCallWithCauseCode=function(e,n,i){var o=I.findCall(e);if(o)if(o.isOsBizFirstCall){var a=I.findOsBizSecondCall();a&&a.direction===r.CallDirection.INCOMING&&a.checkState(t.Ringing)?R.endCstaCall(o.atcCallInfo.getCstaCallId()):R.reconnect(o,I.findOsBizSecondCall(),i)}else o.isOsBizSecondCall?R.reconnect(o,I.findOsBizFirstCall(),i):o.isRemote?I.endRemoteCall(e,i):n?I.endCallWithCauseCode(e,n,i):(E.localUser.isOsBizCTIEnabled&&o.isTelephonyCall&&o.checkState(t.Ringing)&&R.endCallOnRemoteDevices(o.atcCallInfo.getCstaCallId()),I.endCall(e,i));else(o=y(e))&&m.length>1&&h.reconnectCall(e,i)||(o?R.endRemoteCall(e,i):(p.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",e),i&&i("Call not found")))},this.retrieveAndEndCall=function(e,t){t=t||function(){};var n=I.findCall(e)||y(e);if(!n)return p.warn("[CallControlSvc]: retrieveAndEndCall invoked without a valid call"),void t("Call not found");if(n.isTelephonyCall&&n.isHolding()){var i=function(n){if(n)return p.warn("[CallControlSvc]: Failed to retrieve call"),void t(n);h.endCall(e,t)};!E.localUser.isOsBizCTIEnabled||n.isAtcRemote&&!n.isAtPosition(c.Cell)?n.isAtcRemote?R.retrieve(n,i):I.retrieveCall(e,i):R.retrieveWithReconnectCall(n,i)}else h.endCall(e,t)},this.endConference=I.endConference,this.startScreenShare=I.startScreenShare,this.addScreenShare=I.addScreenShare,this.selectMediaToShare=I.selectMediaToShare,this.removeScreenShare=I.removeScreenShare,this.requestScreenControl=I.requestScreenControl,this.offerScreenControl=I.offerScreenControl,this.rejectScreenControlRequest=I.rejectScreenControlRequest,this.stopScreenControl=I.stopScreenControl,this.addAudio=I.addAudio,this.removeAudio=I.removeAudio,this.enableRemoteAudio=I.enableRemoteAudio,this.disableRemoteAudio=I.disableRemoteAudio,this.addVideo=I.addVideo,this.removeVideo=I.removeVideo,this.addVideoStream=I.addVideoStream,this.toggleRemoteVideo=I.toggleRemoteVideo,this.disableRemoteVideoOnly=I.disableRemoteVideoOnly,this.enableRemoteVideo=I.enableRemoteVideo,this.toggleVideo=I.toggleVideo,this.toggleCamera=I.toggleCamera,this.changeHDVideo=I.changeHDVideo,this.changeVideoResolution=I.changeVideoResolution,this.renegotiateMedia=I.renegotiateMedia,this.setMediaType=I.setMediaType,this.addMediaStream=I.addMediaStream,this.removeMediaStream=I.removeMediaStream,this.pullRemoteCall=function(e,t,n){var i=I.findCall(e);if(i)I.pullRemoteCall(e,t,n);else if(i=y(e)){var r=I.getActiveCall();if(r)return r.isTelephonyCall?void I.holdCall(r.callId,(function(){R.pullRemoteCall(e,n)})):void I.endActiveCall((function(){R.pullRemoteCall(e,n)}));R.pullRemoteCall(e,n)}else p.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),n&&n("No active remote call")},this.pushLocalCall=R.pushLocalCall,this.getAtcCalls=function(){return m},this.swapCall=function(e,t){t=t||function(){};var i=V();if(i)R.alternate(i.heldCall,i.activeCall,t);else{var r=I.findCall(e);if(r&&r.isTelephonyCall&&!r.isRemote)I.swapCall(e,t);else{if(m.length>1){var o=m.find((function(t){return t.isHolding()&&t.callId===e}));if(o){var a=o.getPosition(),s=m.find((function(t){return t.checkCstaState([n.Active,n.Conference])&&t.isAtPosition(a)&&t.callId!==e}));if(s)return void R.alternate(o,s,t)}}p.warn("[CallControlSvc]: swapCall possible only with 2 calls"),t("No calls to swap")}}},this.mergeCall=function(e,t){t=t||function(){};var i,r,o=I.getPhoneCalls(!0);if(m.length<=1&&o.length<=1)return p.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),void t("No calls to merge");if(o.length>1&&(i=I.findActivePhoneCall(!0),r=I.findHeldPhoneCall(!0),i&&r))return E.localUser.isSTC?void(r.isDirectUpgradedToConf?I.retrieveCall(r.callId,(function(e){e?(p.error("[CallControlSvc]: Error retrieving the hosted call"),t("Error in retrieving the hosted call")):K(i.callId,r.callId,t)})):K(r.callId,i.callId,t)):void(r.isAtcConferenceCall()&&!E.localUser.isOsBizCTIEnabled?h.swapCall(r.callId,(function(e){e?(p.warn("[CallControlSvc]: Swap call failed. Cannot proceed with merge call."),t(e)):R.conference(i,r,t)})):R.conference(r,i,t));if(i=m.find((function(t){return t.checkCstaState([n.Active,n.Conference])&&t.callId===e}))){var a=i.getPosition();if(r=m.find((function(t){return t.isHolding()&&t.isAtPosition(a)&&t.callId!==e})))return void R.conference(r,i,t)}p.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),t("No calls to merge")},this.transferCall=function(e,t,n){n=n||function(){};var i=V();if(i)R.consultationTransfer(i.activeCall,i.heldCall,n);else{var r,o=I.findCall(e),a=I.getPhoneCalls(!0);if(t=d.cleanPhoneNumber(t),o&&1===a.length)o.isTelephonyCall&&o.atcCallInfo?R.transfer(o,t,n):o.isSTC?B(o,t,n):(p.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call"));else{if(o&&2===a.length)return r=I.findHeldPhoneCall(!0),void(o.isTelephonyCall&&o.atcCallInfo?R.consultationTransfer(o,r,n):o.isSTC?B(o.state.established?o:r,o.state.established?r:o,n):(p.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call")));if(m.length>0){if(1===m.length&&!m[0].isHolding())return o=m[0],void R.transfer(o,t,n);if(o=m.find((function(t){return!t.isHolding()&&t.callId===e}))){var s=o.getPosition();if(r=m.find((function(t){return t.isHolding()&&t.isAtPosition(s)&&t.callId!==e})))return void R.consultationTransfer(o,r,n)}}p.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),n("Not enough calls for the transfer")}}},this.holdCall=function(e,t){t=t||function(){};var n=I.findCall(e);n?n.isHolding()?(p.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):E.localUser.isOsBizCTIEnabled&&n.isTelephonyCall?R.holdWithConsultationCall(n,t):I.holdCall(e,t):(n=y(e))?n.isHolding()?(p.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):E.localUser.isOsBizCTIEnabled&&n.getPosition()===c.Cell?R.holdWithConsultationCall(n,t):R.hold(n,t):(p.warn("[CallControlSvc]: holdCall invoked without a valid call"),t("Call not found"))},this.retrieveCall=function(e,t){t=t||function(){};var n=I.findCall(e);n?n.isHolding()?E.localUser.isOsBizCTIEnabled&&n.isTelephonyCall?R.retrieveWithReconnectCall(n,t):I.retrieveCall(e,t):(p.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):(n=y(e))?n.isHolding()?E.localUser.isOsBizCTIEnabled&&n.getPosition()===c.Cell?R.retrieveWithReconnectCall(n,t):R.retrieve(n,t):(p.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):(p.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),t("Call not found"))},this.reconnectCall=function(e,t){if(m.length>1){var n=m.find((function(t){return!t.isHolding()&&t.callId===e}));if(n){var i=n.getPosition(),r=m.find((function(t){return t.isHolding()&&t.isAtPosition(i)&&t.callId!==e}));if(r)return R.reconnect(n,r,t),!0}}return p.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),t("No calls to reconnect"),!1},this.ignoreCall=function(e,t){var n=y(e);if(n&&n.pickupNotification)R.ignoreCall(n,t);else{var i=I.getCallToPickup();!i||i.pickupSession!==e&&i.callId!==e?t&&t("No pickup call"):I.ignorePickupCall()}},this.hideRemoteCall=I.hideRemoteCall,this.dropParticipant=I.dropParticipant,this.addParticipantToCall=I.addParticipantToCall,this.addParticipantToRtcSession=I.addParticipantToRtcSession,this.mute=I.mute,this.unmuteLocally=I.unmuteLocally,this.unmute=I.unmute,this.toggleMute=I.toggleMute,this.muteParticipant=function(e,t,n){if(n=n||function(){},e&&t){if(!k(e))return p.warn("[CallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!f)return p.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_MuteParticipantFailed");f.muteMeetingPoint(t.userId,(function(i){i?(p.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),n("res_MuteParticipantFailed")):I.muteParticipant(e,t,n)}))}else I.muteParticipant(e,t,n)}else n("Missing callId or participant")},this.hasUnmutedParticipants=I.hasUnmutedParticipants,this.hasScreenControlFeature=I.hasScreenControlFeature,this.muteRtcSession=I.muteRtcSession,this.unmuteParticipant=function(e,t,n){if(n=n||function(){},e&&t){if(!k(e))return p.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!f)return p.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_UnmuteParticipantFailed");f.unmuteMeetingPoint(t.userId,(function(e){e?(p.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),n("res_UnmuteParticipantFailed")):n()}))}else I.unmuteParticipant(e,t,n)}else n("Missing callId or participant")},this.toggleMuteParticipant=function(e,t,n){e&&t?t.muted?h.unmuteParticipant(e,t,n):h.muteParticipant(e,t,n):n("Missing callId or participant")},this.toggleVideoParticipant=function(e,t,n){if(n=n||function(){},e&&t&&t.userId){if(!k(e))return p.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!f)return p.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_StartVideoParticipantFailed");f.toggleVideoMeetingPoint(t.userId,(function(e){e?(p.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),n("res_ToggleVideoFailed")):n()}))}else p.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",t.userId),n("res_StartVideoParticipantFailed")}else n("Missing callId or participant")},this.toggleScreenSharing=function(e,t,n){D(e,t,n)&&(n=n||function(){},f.toggleScreenShareMeetingPoint(t.userId,(function(e){e?(p.error("[CallControlSvc]: Failed to toggle screen share for Meeting Room invitee. ",e),n("Cannot toggle Screen Sharing")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=a.ToggleScreenShare.name),p.debug("[CallControlSvc]: Screensharing is selected to show it on CMR"),n())})))},this.toggleConferencePoll=function(e,t,n){D(e,t,n)&&(n=n||function(){},f.toggleConferencePollMeetingPoint(t.userId,(function(e){e?(p.error("[CallControlSvc]: Failed to toggle conference poll for Meeting Room invitee. ",e),n("Cannot toggle conference poll")):(p.debug("[CallControlSvc]: Conference poll is selected to show it on CMR"),n())})))},this.toggleWhiteboard=function(e,t,n){D(e,t,n)&&(n=n||function(){},f.toggleWhiteboardMeetingPoint(t.userId,(function(e){e?(p.error("[CallControlSvc]: Failed to toggle whiteboard for Meeting Room invitee. ",e),n("Cannot toggle Whiteboard")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=a.ToggleWhiteboard.name),p.debug("[CallControlSvc]: Whiteboard is selected to show it on CMR"),n())})))},this.toggleVideoFeature=function(e,t,n){D(e,t,n)&&(n=n||function(){},f.toggleVideoFeatureMeetingPoint(t.userId,(function(e){e?(p.error("[CallControlSvc]: Failed to toggle video for Meeting Room invitee. ",e),n("Cannot toggle Video")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=a.ToggleVideo.name),p.debug("[CallControlSvc]: Video is selected to show it on CMR"),n())})))},this.toggleLayout=function(e,t,n,i){D(e,n,i)&&(t?(i=i||function(){},f.toggleLayoutMeetingPoint(n.userId,t,(function(t,r){if(t)p.error("[CallControlSvc]: Failed to toggle layout for Meeting Room invitee. ",t),i("Cannot toggle Layout");else{if(r&&r.primaryScreen&&(p.debug("[CallControlSvc]: Selected CMR layout is ",r.primaryScreen.currentLayout),n.cmrData&&(n.cmrData.primaryScreen=r.primaryScreen)),n.cmrData){var o=I.findCall(e);n.cmrData.selectedFeature=r.selectedMediaFeature||o&&o.screenEnabledFeature}i(null,r)}}))):i("Missing layout action"))},this.swapDisplays=function(e,t,n){D(e,t,n)&&(n=n||function(){},f.swapDisplays(t.userId,(function(e){e?(p.error("[CallControlSvc]: Failed to swap displays for Meeting Room invitee. ",e),n("Cannot swap displays")):n()})))},this.invokeParticipantAction=function(e,t){switch(e.action){case o.StartVideo:!(n=e.participant).toggleVideoInProgress&&n.isMeetingPointInvitee&&n.mediaType&&!n.mediaType.video&&F(e.call,e.participant,t);break;case o.StopVideo:(function(e){return!(e.toggleVideoInProgress||!e.isMeetingPointInvitee)&&(e.mediaType&&e.mediaType.video)})(e.participant)&&F(e.call,e.participant,t);break;case o.Mute:h.checkAndMuteParticipant(e.call.callId,e.participant);break;case o.Unmute:h.checkAndUnmuteParticipant(e.call.callId,e.participant);break;case o.RemoveFromStage:h.checkAndRemoveParticipantFromStage(e.participant)}var n},this.canUnmuteParticipant=x,this.checkAndMuteParticipant=function(e,t){!function(e){return!e.muted&&(e.userId===E.localUser.userId||e.actions.includes(o.Mute))}(t)?p.info("[CallControlSvc]: Cannot mute remote participant"):(p.buttonPressed("Mute other participant with userId: ",t.userId),h.muteParticipant(e,t))},this.checkAndUnmuteParticipant=function(e,t){x(t)?(p.buttonPressed("Unmute other participant with userId: ",t.userId),h.unmuteParticipant(e,t)):p.info("[CallControlSvc]: Cannot unmute remote participant")},this.checkAndRemoveParticipantFromStage=function(e){e.actions.includes(o.RemoveFromStage)&&h.removeFromStage(e.userId)},this.fillScreenActions=function(e,t){if(t.isMeetingPointInvitee&&(t.screenDisplayActions=[],t.screenLayoutActions=[],t.cmrData)){var n=t.cmrData.isPollFeatureEnabled&&!!e.isPollStarted,i=e.whiteboardEnabled+W(e)+n,r=h.isAllowedToAddVideoFeature(t,i);i+=r,Object.values(a).forEach((function(o){if(i>=2)switch(o.name){case a.ToggleWhiteboard.name:e.whiteboardEnabled&&t.screenDisplayActions.push(o);break;case a.ToggleScreenShare.name:W(e)&&t.screenDisplayActions.push(o);break;case a.ToggleConferencePoll.name:n&&t.screenDisplayActions.push(o);break;case a.ToggleVideo.name:r&&t.screenDisplayActions.push(o)}o.name===a.SwapDisplays.name&&2===t.cmrData.displayCount&&t.screenDisplayActions.push(o)})),t.cmrData.isLayoutsEnabled&&t.cmrData.primaryScreen&&Object.values(s).forEach((function(e){(e.name===t.cmrData.primaryScreen.currentLayout||t.cmrData.primaryScreen.allowedLayouts.includes(e.name))&&t.screenLayoutActions.push(e)}))}},this.isScreenActionSelected=function(e,t){switch(t.type){case"screenEnabledFeature":return t.name===e.cmrData.selectedFeature;case"cmrLayout":return!(!e||!e.cmrData.primaryScreen||e.cmrData.primaryScreen.currentLayout!==t.name);default:return!1}},this.selectRemoteDisplayLayout=function(e,t){if(t=t||function(){},e.call&&e.action&&e.participant&&e.participant.isMeetingPointInvitee&&e.participant.screenLayoutActions&&e.participant.screenLayoutActions.includes(e.action))return h.isScreenActionSelected(e.participant,e.action)?(p.debug("[CallControlSvc]: Ignore action. CMR layout is already ",e.action.name),void t()):void h.toggleLayout(e.call.callId,e.action.name,e.participant,t);t("Not allowed")},this.selectRemoteDisplayFeature=function(e,t){if(t=t||function(){},e.call&&e.action&&e.participant&&e.participant.isMeetingPointInvitee&&e.participant.screenDisplayActions&&e.participant.screenDisplayActions.includes(e.action)){if(h.isScreenActionSelected(e.participant,e.action)&&e.action.name!==a.SwapDisplays.name)return p.debug("[CallControlSvc]: Ignore action. CMR display is already ",e.action.name),void t();e.participant.cmrData=e.participant.cmrData||{},e.participant.cmrData.pendingMediaFeatures=null;var n=e.call.callId;switch(e.action){case a.ToggleWhiteboard:h.toggleWhiteboard(n,e.participant,t);break;case a.ToggleScreenShare:h.toggleScreenSharing(n,e.participant,t);break;case a.ToggleConferencePoll:h.toggleConferencePoll(n,e.participant,t);break;case a.ToggleVideo:h.toggleVideoFeature(n,e.participant,t);break;case a.SwapDisplays:h.swapDisplays(n,e.participant,t)}}else t("Not allowed")},this.isAllowedToAddVideoFeature=function(e,t){return!!(e&&e.isMeetingPointInvitee&&e.cmrData)&&!(1!==e.cmrData.displayCount||!t||(e.cmrData.isLayoutsEnabled?!e.cmrData.primaryScreen:e.cmrData.primaryScreen))},this.stopRingingTone=I.stopRingingTone,this.endActiveCall=I.endActiveCall,this.startRecording=I.startRecording,this.stopRecording=I.stopRecording,this.startTranscription=I.startTranscription,this.stopTranscription=I.stopTranscription,this.switchRecordingLayout=I.switchRecordingLayout,this.startRecordingParticipant=I.startRecordingParticipant,this.submitCallQualityRating=I.submitCallQualityRating,this.raiseQuestion=I.raiseQuestion,this.inviteToStage=I.inviteToStage,this.inviteToStageAnswer=I.inviteToStageAnswer,this.inviteToStageCancel=I.inviteToStageCancel,this.removeFromStage=I.removeFromStage,this.getQuestions=I.getQuestions,this.updateQuestionState=I.updateQuestionState,this.openCurtain=I.openCurtain,this.closeCurtain=I.closeCurtain,this.getNodeState=I.getNodeState,this.canSendWebRTCDigits=I.canSendWebRTCDigits,this.sendDigits=function(e,t,n){if(n=n||function(){},!t)return p.warn("[CallControlSvc]: sendDigits invoked without any digit"),void n("No digits");var i=I.findCall(e);i?i.sessionCtrl.canSendDTMFDigits()?I.sendDigits(e,t,n):i.atcCallInfo?R.generateDigits(i,t,(function(e){e?n("res_SendDtmfFailed"):n()})):n("res_SendDtmfFailed"):(i=y(e))?R.generateDigits(i,t,n):(p.warn("[CallControlSvc]: SendDigits invoked without a valid call"),n("Call not found"))},this.disableIncomingVideo=I.disableIncomingVideo,this.enableIncomingVideo=I.enableIncomingVideo,this.toggleParticipantPointer=I.toggleParticipantPointer,this.sendDataMessage=I.sendDataMessage,this.findCall=I.findCall,this.findConversationByCallId=function(e){var t=A.getConversationByRtcSession(e);if(t)return t;for(var n=0;n<m.length;n++)if(m[n].callId===e)return A.getConversationFromCache(m[n].convId);return null},this.sendParticipantPointer=I.sendParticipantPointer,this.getCallDevices=R.getCallDevices,this.getPushDevices=R.getPushDevices,this.getAnswerDevices=function(e){if(e&&"object"==typeof e)return R.getAnswerDevices(e);var t=I.findCall(e)||y(e);return R.getAnswerDevices(t)},this.updateActiveCallMediaDevices=I.updateActiveCallMediaDevices,this.addSimulatedParticipants=I.addSimulatedParticipants,this.canStartScreenShare=I.canStartScreenShare,this.canStartRecording=I.canStartRecording,this.canTakeScreenshot=I.canTakeScreenshot,this.addConferenceAsGuest=I.addConferenceAsGuest,this.removeConferenceAsGuest=I.removeConferenceAsGuest,this.testCandidatesCollection=I.testCandidatesCollection,this.findOsBizSecondCall=I.findOsBizSecondCall,this.getConferenceParticipants=I.getConferenceParticipants,this.changeInputDevices=I.changeInputDevices,this.setIncomingVideoStreams=I.setIncomingVideoStreams,this.getNetworkQualityInfo=I.getNetworkQualityInfo,this.isPinVideoSupported=I.isPinVideoSupported,this},e}((Circuit=function(e){"use strict";var t=e.Enums.AgentState,n=e.AtcCallInfo,i=e.Enums.AtcMessage,r=e.Enums.AtcRegistrationState,o=e.AtcRemoteCall,a=e.BusyHandlingOptions,s=e.Enums.CallDirection,c=e.Enums.CallForwardingTypes,l=e.Enums.CallState,d=e.ClientApiHandlerSingleton,u=e.Constants,E=e.Enums.CstaCallState,C=e.CstaParser,T=e.Enums.JournalEntryTypes,p=e.LocalCall,S=e.Enums.MissedReasonTypes,I=e.PhoneNumberFormatter,A=e.Enums.RedirectionTypes,R=e.RoutingOptions,f=e.Enums.Targets,_=e.Enums.TeamPickupFailedCauses,v=e.Enums.TeamPickupMessage,g=e.Enums.TransferCallFailedCauses,N=e.UserToUserHandlerSingleton,m=e.Utils;return e.CstaSvcImpl=function(h,O,D,P,y,b,U,L,M){P.debug("New Service: CstaSvc");var w=["connected","hold","queued"],G=["connected","hold"],k=/Forward/,H=this,V={forwardList:[]},B=N.getInstance(),F=d.getInstance(),x=new C,W=null,K=null,Y=null,q=null,j={},Q=null,z=[],X={},J={},$=!1,Z=!0,ee=!0,te={},ne={},ie=[],re=[],oe=!1,ae=null,se=null,ce=null,le=null,de=!1,ue=!1,Ee=null,Ce=null,Te=null,pe=null,Se=!1,Ie=0,Ae=0,Re=null,fe=null,_e="Number not available",ve=null;function ge(e){return!!h.localUser&&h.localUser.selectedRoutingOption===e.name}function Ne(e){h.localUser&&(h.localUser.selectedRoutingOption=e.name)}function me(e,t,n,i,r){if(n&&e.peerUser&&e.peerUser.fqnLookedUp===n)r&&r();else{if(e.setPeerUser(t,i),e.peerUser.userId||!n||!m.PHONE_PATTERN.test(n))return P.debug("[CstaSvc]: User already resolved or number is not fully qualified to do a reverse phone lookup"),void(r&&r());var o=O((function(){o=null,e.isPresent()&&(r&&r(),r=null)}),2e3,!1);L.startReverseLookUp(n,(function(a){var s;(O.cancel(o),e.isPresent())&&(a&&(i=a.displayName,s=a.userId),e.setPeerUser(t,i,s,n),r&&r())}))}}function he(e,t,n,i,r,o){if(!e.redirectingUser||!e.redirectingUser.redirectionType){if(e.setRedirectingUser(t,n,i,null,r),!n||!m.PHONE_PATTERN.test(n))return P.debug("[CstaSvc]: number is not fully qualified to do a reverse phone lookup"),void(o&&o());var a=O((function(){a=null,e.isPresent()&&(o&&o(),o=null)}),2e3,!1);L.startReverseLookUp(n,(function(i){O.cancel(a),e.isPresent()&&(i&&e.setRedirectingUser(t,n,i.displayName,i.userId,r),o&&o())}))}}function Oe(){if(re.length){var e=re.splice(0,1);L.startPhoneCallSearch(e[0].phoneNumber,(function(){var t=L.getUserSearchList().slice(0),n=e[0].call;delete e[0].call;var i=null;(i=1===t.length?n.addParticipant({userId:t[0].userId||e[0].userId,phoneNumber:e[0].phoneNumber,displayName:t[0].displayName,participantId:e[0].participantId}):n.addParticipant(e[0]))&&W&&(P.debug("[CstaSvc]: Publish /atccall/participant/added"),y.publish("/atccall/participant/added",[n.callId,i])),O(Oe,0)}))}else oe=!1}function De(){h.localUser.isATC&&W&&(Object.assign(V,U.getAtcRegistrationData()),K=function(){var e=b.getActiveCall();if(!e||!e.isTelephonyCall)return null;var t=Pe(e);if(t)return t;var i=Object.create(e);return i.atcCallInfo=e.atcCallInfo||new n,z.push(i),i}(),Y=function(){var e=b.findHeldPhoneCall();if(!e)return null;var t=Pe(e);if(t)return t;var i=Object.create(e);return i.atcCallInfo=e.atcCallInfo||new n,z.push(i),i}(),q=ye(),Q=be(),z.length>0&&(z=z.filter((function(e){return!e.checkState(l.Terminated)||(K===e&&(K=null),Y===e&&(Y=null),q===e&&(q=null),Q===e&&(Q=null),!1)}))),K||q||Y||Q||m.emptyArray(z))}function Pe(e){for(var t=0;t<z.length;t++)if(z[t].callId===e.callId){var n=z[t].atcCallInfo;return e.peerUser.phoneNumber!==z[t].peerUser.phoneNumber&&n.clearServicesPermitted(),z[t]=e,e.atcCallInfo&&e.atcCallInfo.cstaConn||(z[t].atcCallInfo=n),z[t]}return null}function ye(){var e=b.getIncomingCall();if(!e||!e.isTelephonyCall)return null;var t=Pe(e);if(t)return t;var i=Object.create(e);return i.atcCallInfo=e.atcCallInfo||new n,z.push(i),i}function be(){var e=b.getActiveRemoteCall()[0];if(!e||!e.isTelephonyCall)return null;var t=Pe(e);return t||(e.atcCallInfo=e.atcCallInfo||new n,z.push(e),e)}function Ue(e,t){if(j[e]){P.debug("[CstaSvc]: Remove remote call with Call Id = "+e);var n=j[e];!t&&Le(n),n.setCstaState(E.Idle),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n]),delete j[e]}}function Le(e){if(!(h.localUser.noCallLog&&!h.localUser.isOS4K||e.pickupNotification))if(e){var t=e.atcCallInfo;if(!t.pickUp&&!t.getIgnoreCall()&&(e.isAtcRemote||e.isOsBizSecondCall||e.pulled)){if(!W)return void P.error("[CstaSvc]: No telephony conversation");if(!e.peerUser.phoneNumber&&e.peerUser.displayName===W.peerUser.displayName)return void P.warn("[CstaSvc]: This call has no peer display information.");var n=t.originalPartnerDisplay&&t.originalPartnerDisplay.fqn&&(t.originalPartnerDisplay.fqn!==t.peerFQN||!e.peerUser.displayName)&&!(e.pickedUp&&e.direction===s.INCOMING),i={phoneNumber:n?t.originalPartnerDisplay.dn:e.peerUser.phoneNumber,displayName:n?t.originalPartnerDisplay.name:e.peerUser.displayName,userId:!n&&e.peerUser.userId||W.peerUser.userId,resolvedUser:!!e.peerUser.userId&&!n,fqn:n?t.originalPartnerDisplay.fqn:t.peerFQN},r={convId:W.convId,starter:e.direction===s.INCOMING?i.userId:h.localUser.userId,source:e.direction===s.INCOMING?i.fqn:h.localUser.phoneNumber,destination:e.direction===s.OUTGOING?i.fqn:h.localUser.phoneNumber,startTime:e.creationTime,duration:e.establishedTime?Date.now()-e.establishedTime:0,type:0===e.establishedTime?T.MISSED:T.REGULAR,participants:[{userId:h.localUser.userId,type:"USER",phoneNumber:h.localUser.phoneNumber,displayName:h.localUser.displayName},{userId:i.userId,type:"TELEPHONY",phoneNumber:i.phoneNumber,displayName:i.displayName,resolvedUser:i.resolvedUser}]};r.type===T.MISSED&&function(e,t){switch(t){case S.DEST_OUT_OF_ORDER:e.missedReason=u.RTCItemMissed.UNREACHABLE;break;case S.REORDER_TONE:e.missedReason=u.RTCItemMissed.INVALID_NUMBER;break;case S.BUSY:e.missedReason=u.RTCItemMissed.USER_BUSY;break;case S.CANCELLED:e.missedReason=u.RTCItemMissed.CANCELED;break;case S.DECLINED:e.missedReason=u.RTCItemMissed.DECLINED;break;case S.TRANSFERRED:e.type=T.REGULAR;break;default:e.missedReason=u.RTCItemMissed.TEMPORARILY_UNAVAILABLE}}(r,t.getMissedReason()),function(e){if(ee)F.addJournalEntry(e);else{var t=1e3+1e3*Math.random();O((function(){(function(e){var t=e&&e.participants&&e.participants[1];if(t)return ie.some((function(e,n){return m.cleanPhoneNumber(e.phoneNumber)===m.cleanPhoneNumber(t.phoneNumber)&&e.displayName===t.displayName&&(P.debug("[CstaSvc]: Call log entry already sent by another client"),ie.splice(n,1),!0)}));return!1})(e)||F.addJournalEntry(e)}),t,!1)}}(r)}}else P.error("[CstaSvc]: No remoteCall")}function Me(){for(var e in j)j.hasOwnProperty(e)&&Ue(e,!0)}function we(e){return Object.values(j).find((function(t){return t.callId===e}))||null}function Ge(){return Object.values(j).find((function(e){return e.isHolding()}))||null}function ke(e){if(h.localUser.isOsBizCTIEnabled){var t=Object.values(j).find((function(e){return e.atcCallInfo&&e.atcCallInfo.isQueuedIncomingCall()}))||null;t&&(P.debug("[CstaSvc]: There is a call waiting. Allow it to ring"),t.atcCallInfo.setQueuedIncomingCall(!1),e===f.WebRTC?mt(t):(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[t])))}}function He(e){if(!W)return null;var t=Object.create(W);return t.rtcSessionId=e,new o(t)}function Ve(e){return h.localUser.isOsBizCTIEnabled&&e.networkCallingDevice?e.networkCallingDevice:e.callingDevice}function Be(e){if(!e)return!1;var t=function(e){var t=e;if(h.localUser.isOsBizCTIEnabled){var n=Fe(e);n&&n[1]&&(t=n[1])}return t}(e);return!!(t.includes(V.onsFQN)||V.osmoDeviceList&&V.osmoDeviceList.includes(t))&&(!t.includes("uid=")&&!function(e){return e.includes("keyId=")}(t))}function Fe(e){return h.localUser.isOsBizCTIEnabled?V.osmoDeviceList&&/\/(\+?\**\d+)/.exec(e)||/<(\+?\**\d+)/.exec(e)||[e,e]:/ond=(\+?\d+)/.exec(e)}function xe(e,t,n){if(P.debug("[CstaSvc]: Get call position for "+e),!Be(e))return P.error("[CstaSvc]: Invalid device ID ("+e+"). Cannot determine position."),f.Other;var i=f.Other,r=Fe(e);if(r&&r[1]){var o=r[1];o===V.osmoFQN?i=t&&t!==V.epid?f.Other:function(e){return h.localUser.isOsBizCTIEnabled&&h.localUser.reroutingPhoneNumber&&ge(R.AlternativeNumber)&&e===s.INCOMING}(n)?f.Cell:f.WebRTC:o===V.cell?i=f.Cell:o===V.parkingDn?i=f.Queue:V.osmoDeviceList&&V.osmoDeviceList.includes(o)&&(i=f.Desk)}else i=f.Desk;return P.debug("[CstaSvc]: Call position is:",i.name),i}function We(e){var t={fqn:"",dn:_e,name:""};if(e){var n=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,i=n.exec(e);i?(h.localUser.isOsBizCTIEnabled&&i[1]&&(i[1]=i[1].replace(/\/.*/,"")),t.fqn=i[1]||"",t.name=i[2]||"",t.dn=i[4]||i[1]||_e):(i=(n=/N([^;]*)/).exec(e))?(t.fqn=i[1]||"",t.dn=i[1]||_e):(t.fqn=e,t.dn=e)}return P.debug("[CstaSvc]: Retrieved partner display: ",t),t}function Ke(e){De();for(var t=b.getPhoneCalls(),i=[],r=0;r<t.length;r++)if(t[r].atcCallInfo&&t[r].atcCallInfo.getCstaCallId()){if(t[r].atcCallInfo.getCstaCallId()===e)return K=t[r]}else{var o=t[r].getRedirectingUser();t[r].atcCallInfo=new n,o&&(t[r].atcCallInfo.redirectingUser=o),i.push(t[r])}return q&&q.atcCallInfo.getCstaCallId()===e?q:(q&&!q.atcCallInfo.getCstaCallId()&&i.push(q),i[0])}function Ye(e){return"forwardImmediate"===e||h.localUser.isOsBizCTIEnabled&&("forwardImmInt"===e||"forwardImmExt"===e)}function qe(){var e=!0;Me(),De(),H.snapshotDevice((function(t,n){if($=!0,t)t.indexOf("deviceOutOfService")>-1&&(Z=!0,rt());else if(n.hasOwnProperty("deskPhoneRegistered")?(Z=!n.deskPhoneRegistered,e=!1):Z=h.localUser.isOsBizCTIEnabled&&!V.osmoDeviceList,rt(),e&&h.localUser.isOSV&&!Z&&H.getLogicalDeviceInformation(),n.activeCalls)try{n.activeCalls.forEach((function(e){e.localCallState.length<2||(2!==e.localCallState.length||-1!==w.indexOf(e.localCallState[0])&&-1!==G.indexOf(e.localCallState[1]))&&H.snapshotCall(e.connectionId,(function(e,t){if(!e&&t){var n=function(e){var t=e.endpoints,n=e.callingDevice,i=e.calledDevice,r=Be(n)?s.OUTGOING:s.INCOMING;if(!t||t.length<2)return null;var o=null,a=t[0].callIdentifier.cID,c=t.length>2?E.Conference:E.Active;return t.forEach((function(n){if(c&&Be(n.deviceOnCall)){if(-1===w.indexOf(n.localConnectionState))return void(c=null);var i=xe(n.deviceOnCall,e.epid);i===f.WebRTC&&(K||Q)?K?o=K:(o=Q,i=f.Other):o=He(a),o.direction||(o.direction=r),o.setPosition(i),o.atcCallInfo.setCstaConnection(n.callIdentifier),Object.assign(e.servicesPermitted,n.servicesPermitted),"queued"===n.localConnectionState?c=E.Parked:"hold"===n.localConnectionState&&(c=t.length>2?E.ConferenceHolding:c===E.Held?E.HoldOnHold:E.Holding)}})),o&&2===t.length&&t.forEach((function(e){if(!Be(e.deviceOnCall)){if(-1===G.indexOf(e.localConnectionState))return void(c=null);var t=o.direction===s.OUTGOING?We(i):We(n);o.atcCallInfo.setPartnerDisplay(t),me(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),"hold"===e.localConnectionState&&(c=c===E.Holding?E.HoldOnHold:E.Held)}})),c?(o.atcCallInfo.setServicesPermitted(e.servicesPermitted),o.setCstaState(c),o.isAtPosition(f.WebRTC)?(P.debug("[CstaSvc]: This is a webRTC call. The reconnection is being handled by CircuitCallControlSvc"),null):(j[a]=o,P.debug("[CstaSvc]: Created new Remote Call object: ",o),o)):null}(t);n&&(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n]))}}))}))}catch(e){P.error(e)}}))}function je(){return h.localUser.isOsBizCTIEnabled&&h.localUser.pbxDNDSupported}function Qe(){return h.localUser.pbxCallRoutingOptionsSupported}function ze(e){return new D((function(t){H.getAgentState(e,(function(e,n){e&&P.error("[CstaSvc]: Failed to get Agent State. ",e),t(n||null)}))}))}function Xe(){qe(),H.getForwarding(Ut),h.localUser.isOsBizCTIEnabled?ee&&(wt(ue),je()&&H.getDoNotDisturb(Pt),function(){if(Qe()&&V&&V.osmoDeviceList&&!(V.osmoDeviceList.length<=1)){var e=[ze(V.osmoDeviceList[0]),ze(V.osmoDeviceList[1])];D.all(e).then((function(e){var n=h.localUser.selectedRoutingOption,i=e[0];i&&(i.agentState!==t.Ready?Ne(R.CircuitClient):ge(R.CircuitClient)&&Ne(R.DefaultRouting)),(i=e[1])&&(i.agentState!==t.Ready?Ne(R.DeskPhone):ge(R.DeskPhone)&&Ne(R.DefaultRouting)),h.localUser.selectedRoutingOption!==n&&(P.debug("[CstaSvc]: Publish /csta/agentStateUpdated"),y.publish("/csta/agentStateUpdated"))}))}}()):(H.getDoNotDisturb(Pt),H.getAgentState(null,Lt))}function Je(e,t,n,i){var r=h.localUser.isOsBizCTIEnabled?"":V.onsFQN+";ond=";switch(e){case f.WebRTC:i&&V.osmoDeviceList&&V.osmoDeviceList.length>1?r="N<"+V.onsFQN+"/"+V.osmoDeviceList[1]+">":r+=n?V.osmoFQN:V.osmoFQN+";epid="+V.epid;break;case f.Cell:if(h.localUser.isOsBizCTIEnabled&&h.localUser.reroutingPhoneNumber)r=ge(R.AlternativeNumber)?V.osmoDeviceList&&V.osmoDeviceList.length>1?"N<"+V.onsFQN+"/"+V.osmoDeviceList[1]+">":V.onsFQN:h.localUser.reroutingPhoneNumber;else{if(!V.cell)return P.error("[CstaSvc]: Cell phone is not configured"),null;r+=V.cell}break;case f.Desk:r+=V.onsFQN,i&&V.osmoDeviceList&&(r="N<"+r+"/"+V.osmoDeviceList[0]+">");break;case f.VM:r=V.vm;break;case f.Other:t?r+=t:r=V.vm;break;default:return P.error("[CstaSvc]: Invalid target: "+e),null}return r}function $e(e,t,n){return!(!h.localUser.isOsBizCTIEnabled||"connected"!==e||xe(t)!==f.Desk||xe(n)!==f.WebRTC)&&(P.debug("[CstaSvc]: DSS call move from desk to client"),!0)}function Ze(e){return Object.assign(V,U.getAtcRegistrationData()),!(!{subscriber:h.localUser.cstaNumber}.subscriber||!V)||(e&&e("There is no registered user."),!1)}function et(e,t,n){var o=x.genCstaRequest(e);if(!o)return P.error("[CstaSvc]: Failed to build CSTA request: "+e.request),void(t&&t("Failed to send the request"));if(ce===r.Registered){var a={content:{type:i.CSTA,phoneNumber:h.localUser.cstaNumber,CSTA:o},destUserId:h.localUser.associatedTelephonyUserID};n&&(a.keysToOmitFromLogging=n.map((function(e){return"content.CSTA."+e}))),B.sendAtcRequest(a,(function(n,i){h.$apply((function(){if(n)P.warn("[CstaSvc]: ",n),t&&t(n);else{var r=x.parseResponse(e.request,i.CSTA);r||""===r?r.error?("Operation Error"===r.errorCategory&&"invalidConnectionID"===r.errorValue&&"busy"!==e.reason&&"AcceptCall"!==e.request&&"DeflectCall"!==e.request&&qe(),t&&t(r.errorCategory+" - "+r.errorValue)):t&&t(null,r):t&&t("Failed to parse response from server")}}))}))}else t&&t("Client is not registered with ATC")}function tt(e,t){var n,i,r,o;t.transferredCall&&!t.seamlessHandover&&(J[e]={newCallId:t.transferredCall.cID,failedCallId:(n=t.transferredCall.cID,r=(parseInt(n.substring(0,2),16)+2).toString(16).toUpperCase(),o=n.substring(2),i=r.length<2?"0"+r+o:r+o,P.debug("[CstaSvc]: FailedCallId to be tracked: "+i),i),timeout:O((function(){delete J[e]}),4e3)})}function nt(e,t){return!(!e||!Ze())&&((t===f.Other||!e.isAtPosition(t))&&(!!function(){var e=ht();V&&V.vm&&e.push(f.VM);h.localUser.isOsBizCTIEnabled&&h.localUser.reroutingPhoneNumber&&!e.includes(f.Cell)&&e.push(f.Cell);return e.push(f.Other),e}().includes(t)||(P.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+t),!1)))}function it(){h.localUser.isOsBizCTIEnabled||(P.debug("[CstaSvc]: Synchronize the selected routing option"),H.updateRoutingOption(h.localUser.selectedRoutingOption))}function rt(){var e=!Z,t=!!(V&&V.cell||h.localUser.reroutingPhoneNumber);P.debug("[CstaSvc]: Publish /csta/deviceChange event. desk="+e+", cell="+t),y.publish("/csta/deviceChange")}function ot(){return h.localUser.isOsBizCTIEnabled?V.onsFQN:h.localUser.isOSV?m.normalizeDn(h.localUser.cstaNumber):h.localUser.cstaNumber}function at(e){var t=b.findOsBizFirstCall(),n=b.findOsBizSecondCall();if(t&&n){if(t.atcCallInfo.getCstaCallId()===e)return P.debug("[CstaSvc]: First local call with callId: ",e),P.debug("[CstaSvc]: Second local call with callId: ",n.atcCallInfo.getCstaCallId()),b.moveOsBizCalls(t,n),!0;if(n.atcCallInfo.getCstaCallId()===e)return P.debug("[CstaSvc]: Second local call with callId: ",e),P.debug("[CstaSvc]: First local call with callId: ",t.atcCallInfo.getCstaCallId()),b.moveOsBizCalls(n,t),!0}else if(!t&&!n){var i=be();if(i&&i.atcCallInfo&&i.atcCallInfo.getCstaCallId()===e){P.debug("[CstaSvc]: Remote call with callId: ",e);var r=Ge();if(r){P.debug("[CstaSvc]: Second remote call with callId: ",r.atcCallInfo.getCstaCallId());var o=i.atcCallInfo;return i.atcCallInfo=r.atcCallInfo,i.setPeerUser(i.atcCallInfo.peerDn,i.atcCallInfo.peerName),r.atcCallInfo=o,delete j[i.atcCallInfo.getCstaCallId()],j[o.getCstaCallId()]=r,Ue(r.atcCallInfo.getCstaCallId()),!0}}}return!1}function st(e,t){return Object.values(j).some((function(n){return n.atcCallInfo.pickUp&&(h.localUser.isOSV?n.atcCallInfo.peerFQN===e:n.atcCallInfo.peerName===t)}))}function ct(e){P.debug("[CstaSvc]: New pickup call for: ",e.calledDisplay.displayName);var t=He(e.callId);t.atcCallInfo.pickUp=!0,t.setPosition(f.Other),t.atcCallInfo.setPartnerDisplay(e.callingDisplay),j[e.callId]=t,e.event?(t.atcCallInfo.setServicesPermitted(e.event.servicesPermitted),t.atcCallInfo.setCstaConnection(e.event.connection)):e.callingUserId&&(t.pickupSession=e.callId,t.peerGtcUserId=e.callingUserId,t.setRedirectingUser(e.calledDisplay.dn,e.calledDisplay.fqn,e.calledDisplay.name,e.calledUserId,A.CallPickupNotification)),t.setCstaState(E.Ringing),t.direction=s.INCOMING,t.atcCallInfo.setOriginalPartnerDisplay(e.calledDisplay),me(t,t.atcCallInfo.peerDn,t.atcCallInfo.peerFQN,t.atcCallInfo.peerName,(function(){e.callingUserId?Mt(t):he(t,e.calledDisplay.dn,e.calledDisplay.fqn,e.calledDisplay.name,A.CallPickupNotification,(function(){Mt(t)}))}))}function lt(e){return e&&e.atcCallInfo&&e.atcCallInfo.masterParallelHgCall}function dt(e,t){e&&("hold"===t.localConnectionInfo?e.setCstaState(E.Holding):(e.setCstaState(E.Active),e.clearRetrieveInProgress()))}function ut(e,t){var n=Ke(e);n&&(n.pulled=xe(t)===f.WebRTC,n.atcCallInfo.setIgnoreCall(!1),P.debug("[CstaSvc]: Set localCall.pulled to ",n.pulled))}function Et(e){var t=e.droppedConnection.cID,n=Ke(t)||j[t];if(te={},n){if(n.pickupNotification&&n.isHandoverInProgress)return;if(e.pickupNotificationTerminated&&(!e.droppedConnection.dID||Be(e.droppedConnection.dID)))return void P.debug("[CstaSvc]: The pickup notification terminated event is for this user. Ignore it");if("null"!==e.localConnectionInfo){if(h.localUser.isOsBizCTIEnabled&&"multipleAlerting"===e.cause)return void P.info("[CstaSvc]: Discarding ConnectionClearEvent due to parallel ringing. Do not overwrite services permitted.");if(P.info("[CstaSvc]: Update services permitted."),n.atcCallInfo.setServicesPermitted(e.servicesPermitted),n.participants.length>1&&(n.participants.some((function(t){return t.participantId===e.droppedConnection.dID&&(n.removeParticipant(t.userId),!0)})),function(e){return e.isRemote&&1===e.participants.length||!e.isRemote&&2===e.participants.length}(n))){var i=n.participants[n.isRemote?0:1];n.removeParticipant(i.userId),me(n,i.phoneNumber,i.phoneNumber,i.displayName),n.checkCstaState(E.Conference)?n.setCstaState(E.Active):n.checkCstaState(E.ConferenceHolding)&&n.setCstaState(E.Holding)}return n.atcCallInfo.getMissedReason()||n.establishedTime||(n.direction===s.INCOMING?n.atcCallInfo.setMissedReason(Be(e.releasingDevice)?S.DECLINED:S.CANCELLED):n.atcCallInfo.setMissedReason(Be(e.releasingDevice)?S.CANCELLED:S.DECLINED)),P.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[n])}if(P.info("[CstaSvc]: Local connection info is null."),P.info("[CstaSvc]: Update services permitted."),n.atcCallInfo.setServicesPermitted(e.servicesPermitted),n.atcCallInfo.getMissedReason()||n.establishedTime||n.atcCallInfo.setMissedReason(n.direction===s.INCOMING&&"normalClearing"===e.cause?S.DECLINED:S.CANCELLED),n.clearAtcHandoverInProgress(),n.atcCallInfo.clearOutgoingCallCampedOn(),h.localUser.isOsBizCTIEnabled){if(n.atcCallInfo.getCstaReconnectId().cID)et({request:"ClearConnection",connectionToBeCleared:n.atcCallInfo.getCstaReconnectId()}),n.atcCallInfo.setCstaReconnectId({});if(Q&&Q.checkState(l.ActiveRemote)&&(Q.pullBlocked=!1),at(t))return}}!function(e,t){var n=X[e.cID]||X["02000000000000000000000000000000"];if(n){var i=He(n);i.atcCallInfo.setCstaConnection(e),"normalClearing"!==t&&(i.setCstaState(E.TransferFailed),i.atcCallInfo.setTransferCallFailedCause(t)),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]),delete X[e.cID],delete X["02000000000000000000000000000000"]}}(e.droppedConnection,e.cause),Ue(t)}function Ct(e){var t,n,i,r,o,a=null;if(Be(e.callingDevice)&&!$e(e.localConnectionInfo,e.callingDevice,e.alertingDevice))r=E.Delivered,n=e.alertingDevice,i=e.calledDevice,t={cID:e.connection.cID,dID:e.callingDevice},o=s.OUTGOING;else{if(!Be(e.alertingDevice))return void P.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");r=E.Ringing,n=Ve(e),t=e.connection,o=s.INCOMING}var c=xe(t.dID,e.epid,o),d=We(n);if("enteringDistribution"===e.cause)return P.debug("[CstaSvc]: This event is for the master of the parallel hunt group"),(a=j[t.cID])||(a=He(t.cID),j[t.cID]=a,P.debug("[CstaSvc]: Created new Remote Call object for callID= ",t.cID)),a.setCstaState(r),a.setPosition(c),a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setIgnoreCall(!1),void(a.atcCallInfo.masterParallelHgCall=!0);if(!function(e,t,n,i){return!(!h.localUser.isOsBizCTIEnabled||"keyOperation"!==e&&"singleStepTransfer"!==e||t!==f.Desk||i!==s.INCOMING||j[n]||ge(R.DeskPhone))&&(P.debug("[CstaSvc]: This event is received for parallel ringing on device."),!0)}(e.cause,c,t.cID,o)){if(c===f.WebRTC){if(a=Ke(t.cID)){if(a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setCstaState(r),a.atcCallInfo.setQueuedIncomingCall(!1),Gt(a,l.Delivered),c=a.isRemote?f.Other:c,a.setPosition(c),d){P.debug("[CstaSvc]: Update partner display to ",d),a.atcCallInfo.setPartnerDisplay(d),me(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName);var u=we(t.cID);u&&(u.forwarded&&he(a,u.redirectingUser.phoneNumber,u.redirectingUser.fqNumber,u.redirectingUser.displayName,u.redirectingUser.redirectionType),u.atcCallInfo.setIgnoreCall(!0),Ue(t.cID))}return te={},P.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[a])}if(ae&&ae.atcCallInfo&&ae.atcCallInfo.getCstaCallId()===e.connection.cId)return void P.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");P.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var C=t.cID;if((a=j[C])||(a=He(C),j[C]=a,P.debug("[CstaSvc]: Created new Remote Call object for callID= ",C)),lt(a))P.debug("[CstaSvc]: Ignore Delivered event for master parallel hunt group");else if(a.setCstaState(r),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setPosition(c),a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setQueuedIncomingCall(!1),a.clearAtcHandoverInProgress(),a.direction=o,a.receivedAlerting=!0,h.localUser.isOsBizCTIEnabled&&"recallNoAnswer"===e.cause&&c===f.Desk&&o===s.INCOMING&&a.atcCallInfo.setRecalledCall(!0),d){if(a.atcCallInfo.setPartnerDisplay(d),i){var T=We(i);T.fqn!==d.fqn?a.atcCallInfo.setOriginalPartnerDisplay(T):a.atcCallInfo.setOriginalPartnerDisplay(d)}me(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName,(function(){$&&(a.direction===s.INCOMING&&(P.debug("[CstaSvc]: Publish /call/remote/incoming event"),y.publish("/call/remote/incoming",[a])),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[a]))}))}else a.direction===s.INCOMING&&(P.debug("[CstaSvc]: Publish /call/remote/incoming event"),y.publish("/call/remote/incoming",[a])),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[a])}}function Tt(e){var t,n,i=Ke(e.connection.cID);if(!(i&&function(e,t){if(e.direction===s.OUTGOING&&k.test(t.cause)){var n=We(t.divertingDevice);he(e,n.dn,n.fqn,n.name,A.CallForward);var i=We(t.newDestination);return e.setPeerUser(i.dn,i.name),e.atcCallInfo.setOriginalPartnerDisplay(n),!0}return!!(h.localUser.isOsBizCTIEnabled&&e.direction===s.INCOMING&&e.isOsBizSecondCall&&Be(t.divertingDevice)&&at(t.connection.cID))&&(P.debug("[CstaSvc]: Second call was diverted and released"),!0)}(i,e)||function(e){return!("distributed"!==e.cause||!Be(e.divertingDevice)||xe(e.newDestination)!==f.Desk)&&(P.debug("[CstaSvc]: Ignore Diverted event with cause = distributed and newDestination = desk"),!0)}(e))){if(i=j[e.connection.cID]){if(lt(i))return void P.debug("[CstaSvc]: Ignore Diverted event for master parallel hunt group")}else i=He(e.connection.cID);if("null"===e.localConnectionInfo&&Be(e.divertingDevice)){if(Be(e.newDestination)){if(xe(e.newDestination)===f.WebRTC&&(te={cID:e.connection.cID,dID:e.newDestination}),i){if(i.pickupNotification)return;if(function(e,t){if("redirected"===e.cause&&e.lastRedirectionDevice&&!Be(e.lastRedirectionDevice)){var n=We(e.lastRedirectionDevice);he(t,n.dn,n.fqn,n.name,A.CallForward),j[e.connection.cID]=t}}(e,i),h.localUser.isOsBizCTIEnabled&&"park"===e.cause&&xe(e.newDestination)!==xe(e.divertingDevice))return i.setRedirectionType(A.Dss),void(j[e.connection.cID]=i);if(i.forwarded)return;if(i.checkCstaState(E.Ringing)&&xe(e.newDestination)===i.getPosition())return P.debug("[CstaSvc]: new destination has the same position as the current alerting position. Ignore event"),void(te={});i.atcCallInfo.setIgnoreCall(!0),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i])}}else{if(((a=e.newDestination)&&We(a).dn===V.vm||xe(e.connection.dID)===f.WebRTC||h.localUser.isOsBizCTIEnabled)&&i.atcCallInfo.setIgnoreCall(!0),i.setCstaState(E.Idle),i.direction=s.INCOMING,i.atcCallInfo.setMissedReason(S.CANCELLED),k.test(e.cause)){j[e.connection.cID]=i;var r=We(e.callingDevice);P.debug("[CstaSvc]: Update partner display to ",r),i.atcCallInfo.setPartnerDisplay(r),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName)}P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i])}i&&!i.isHandoverInProgress&&Ue(e.connection.cID)}else if(!Be(e.divertingDevice)&&i){var o=We(e.divertingDevice);if(o&&i.atcCallInfo.setOriginalPartnerDisplay(o),i.direction===s.OUTGOING&&k.test(e.cause))return he(i,(t=We(e.divertingDevice)).dn,t.fqn,t.name,A.CallForward),n=We(e.newDestination),void i.setPeerUser(n.dn,n.name);i.atcCallInfo.setMissedReason(S.CANCELLED),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i])}var a}}function pt(e,t){ne&&ne.newCallId===t&&(e.direction=ne.direction,e.setRedirectingUser(ne.redirectingUser.phoneNumber,ne.redirectingUser.fqNumber,ne.redirectingUser.displayName,ne.redirectingUser.userId,ne.redirectingUser.redirectionType),e.atcCallInfo.transferCb=ne.transferCb,delete ne.transferCb,ne={})}function St(e){var t;te={};var n=function(e){var t={};return Be(e.callingDevice)&&!$e(e.localConnectionInfo,e.callingDevice,e.answeringDevice)?(t.localConnection={cID:e.establishedConnection.cID,dID:e.callingDevice},t.partnerDeviceId=e.answeringDevice,t.direction=s.OUTGOING,t.originalPartnerDisplay=We(e.calledDevice)):Be(e.answeringDevice)?(t.localConnection=e.establishedConnection,t.partnerDeviceId=Ve(e),t.direction=s.INCOMING,t.originalPartnerDisplay=We(e.callingDevice)):P.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?"),t}(e),i=n.localConnection,r=n.partnerDeviceId,o=n.direction,a=n.originalPartnerDisplay;P.debug("[CstaSvc]: LocalConnection: ",i),P.debug("[CstaSvc]: Partner Device ID: ",r);var c=We(r),d=xe(i.dID,e.epid,o);if(d===f.WebRTC){if(P.info("[CstaSvc]: The Established Event is for a local WebRTC call"),t=Ke(i.cID))return void function(e,t,n,i){P.info("[CstaSvc]: The Established Event is for a local WebRTC call");var r=f.WebRTC;e.atcCallInfo.setCstaConnection(t),P.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",t),e.isRemote&&(P.warn("[CstaSvc]: There is no local call associated with the Established Event"),r=f.Other),e.atcCallInfo.setServicesPermitted(i.servicesPermitted),dt(e,i),Gt(e,l.Active),e.atcCallInfo.setPartnerDisplay(n),e.setPosition(r),e.clearAtcHandoverInProgress(),e.atcCallInfo.clearOutgoingCallCampedOn(),e.receivedAlerting=!0,e.atcCallInfo.setQueuedIncomingCall(!1),me(e,e.atcCallInfo.peerDn,e.atcCallInfo.peerFQN,e.atcCallInfo.peerName),pt(e,t.cID);var o=we(t.cID);o&&(o.forwarded||o.pickupNotification)?(he(e,o.redirectingUser.phoneNumber,o.redirectingUser.fqNumber,o.redirectingUser.displayName,o.redirectingUser.redirectionType===A.CallForward?A.CallForward:A.CallPickedUp),o.atcCallInfo.setIgnoreCall(!0),Ue(t.cID)):"callPickup"===i.cause&&(e.pickupNotification?e.setRedirectionType(A.CallPickedUp):i.lastRedirectionDevice&&he(e,We(i.lastRedirectionDevice).dn,We(i.lastRedirectionDevice).fqn,We(i.lastRedirectionDevice).name,A.CallPickedUp)),e.isRemote||e.isOsBizSecondCall||e.updateCallState(),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[e]),ke(r)}(t,i,c,e);if("recall"===e.cause||"callPickup"===e.cause)return t=b.findActivePhoneCall(),P.info("[CstaSvc]: Original call callId:",t.atcCallInfo.getCstaCallId()),t.atcCallInfo.setCstaConnection(i),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),"hold"===e.localConnectionInfo?t.setCstaState(E.Holding):t.setCstaState(E.Active),t.updateCallState(),P.debug("[CstaSvc]: Publish /atccall/info event"),void y.publish("/atccall/info",[t]);if(h.localUser.isOsBizCTIEnabled&&h.localUser.reroutingPhoneNumber&&ge(R.AlternativeNumber)?d=f.Cell:(P.debug("[CstaSvc]: There is no local or remote call, change the position to Other"),d=f.Other),Be(e.answeringDevice)&&!e.epid)return void P.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(ae&&ae.atcCallInfo&&ae.atcCallInfo.getCstaCallId()===i.cId)return void P.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var u=!1;(t=j[i.cID])||(u=!0,pt(t=He(i.cID),i.cID)),lt(t)?P.debug("[CstaSvc]: Ignore Established event for master parallel hunt group"):(t.setPosition(d),t.atcCallInfo.setPartnerDisplay(c),t.atcCallInfo.setOriginalPartnerDisplay(a),me(t,t.atcCallInfo.peerDn,t.atcCallInfo.peerFQN,t.atcCallInfo.peerName),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.atcCallInfo.setCstaConnection(i),t.atcCallInfo.setRecalledCall(!1),t.direction=o,function(e){e&&e.atcCallInfo&&e.atcCallInfo.transferCb&&(e.atcCallInfo.transferCb&&e.atcCallInfo.transferCb(null,null,e),delete e.atcCallInfo.transferCb)}(t),t.clearAtcHandoverInProgress(),t.atcCallInfo.clearOutgoingCallCampedOn(),t.receivedAlerting=!0,t.atcCallInfo.setQueuedIncomingCall(!1),t.atcCallInfo.setIgnoreCall(!1),h.localUser.isOsBizCTIEnabled&&d===f.Cell&&t.atcCallInfo.setOsbizCallOnAlternativeNumber(),dt(t,e),"callPickup"===e.cause&&(t.pickupNotification?(t.setRedirectionType(A.CallPickedUp),t.atcCallInfo.pickUp=!1):t.getRedirectionType()===A.Dss?t.setRedirectionType(null):e.lastRedirectionDevice&&he(t,We(e.lastRedirectionDevice).dn,We(e.lastRedirectionDevice).fqn,We(e.lastRedirectionDevice).name,A.CallPickedUp)),u&&(P.debug("[CstaSvc]: Created new Remote Call object: ",t),j[i.cID]=t),h.localUser.isOsBizCTIEnabled&&Q&&(Q.pullBlocked=!0),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[t]),ke(d))}function It(e){return h.localUser.isOsBizCTIEnabled?{cID:e.getCstaCallId(),dID:V.onsFQN}:e.getCstaConnection()}function At(e){var t,n,i,r,o;if(Be(e.queue)){t=e.queuedConnection,n=e.callingDevice,P.debug("[CstaSvc]: LocalConnection: ",t),P.debug("[CstaSvc]: Partner Device ID: ",n),i=xe(t.dID,e.epid);var a=We(n);if(r=t.cID,!(o=j[r])){if("noAvailableAgents"===e.cause)return void P.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");if(h.localUser.isOsBizCTIEnabled&&!h.localUser.pbxCampOnSupported&&("multipleQueuing"===e.cause||"keyOperation"===e.cause||"campOn"===e.cause))return void P.debug("[CstaSvc]: CampOn is not supported. Ignore this event.");o=He(r),j[r]=o,P.debug("[CstaSvc]: Created new Remote Call object for callID= ",r)}if(o.setPosition(i),o.atcCallInfo.setPartnerDisplay(a),me(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),o.setCstaState(E.Parked),o.atcCallInfo.setCstaConnection(t),h.localUser.isOsBizCTIEnabled&&h.localUser.pbxCampOnSupported&&("campOn"===e.cause||"keyOperation"===e.cause))if(K&&i===f.WebRTC){if(P.debug("[CstaSvc]: Cause=campOn. A local call is established and user receives new incoming call"),i===f.WebRTC)return void mt(o,e.servicesPermitted)}else Object.values(j).find((function(e){return e.isEstablished}))&&i===f.Desk?(P.debug("[CstaSvc]: Cause=campOn. A remote call is established and user receives new incoming call"),W.call=o,P.debug("[CstaSvc]: Publish /conversation/update event. convId = ",W.convId),y.publish("/conversation/update",[W]),P.debug("[CstaSvc]: Publish /call/remote/incoming event"),y.publish("/call/remote/incoming",[o]),o.direction=s.INCOMING,o.setCstaState(E.Ringing)):q&&(P.debug("[CstaSvc]: Cause=campOn. A call is ringing and user receives new incoming call. Do not display yet."),o.setCstaState(E.Ringing),o.direction=s.INCOMING,o.atcCallInfo.setQueuedIncomingCall(!0))}else{if(!h.localUser.isOsBizCTIEnabled||!Be(e.callingDevice)||"campOn"!==e.cause)return void P.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.");if(i=xe(e.callingDevice),r=e.queuedConnection.cID,!(o=i===f.WebRTC?Ke(r):j[r]))return void P.debug("[CstaSvc]: Call not found for callID= ",r);o.atcCallInfo.setOutgoingCallCampedOn(),o.isRemote&&o.checkCstaState(E.Busy)&&o.setCstaState(E.Delivered)}o.atcCallInfo.setServicesPermitted(e.servicesPermitted),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[o])}function Rt(e){var t,n=e.failedConnection.cID,i=xe(e.failedConnection.dID)===f.WebRTC?Ke(n):j[n];if(i)if("fail"===e.localConnectionInfo&&Be(e.failingDevice)){if(lt(i))return void P.debug("[CstaSvc]: Ignore Failed event for master parallel hunt group");switch(Be(e.callingDevice)&&(t=We(e.calledDevice)).dn!==_e&&i&&!i.pickedUp&&t.fqn!==m.cleanPhoneNumber(i.atcCallInfo.peerFQN)&&(me(i,t.dn,t.fqn,t.name),i.atcCallInfo.setPartnerDisplay(t)),e.cause){case"blocked":X[n]&&P.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),h.localUser.isOSV||(i.isHandoverInProgress&&(P.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),i.clearAtcHandoverInProgress(),P.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed")),h.localUser.isOsBizCTIEnabled&&i.isRemote&&i.atcCallInfo&&i.atcCallInfo.setServicesPermitted(e.servicesPermitted));break;case"doNotDisturb":P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]);break;case"reorderTone":i.atcCallInfo.setMissedReason(S.REORDER_TONE),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]);break;case"busy":i.atcCallInfo.setMissedReason(S.BUSY),i.checkCstaState(E.Offered)&&i.setCstaState(E.Failed),i.atcCallInfo.clearOutgoingCallCampedOn(),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]);break;case"destNotObtainable":O((function(){i.isPresent()&&function(e,t){var n=e.isOsBizSecondCall?b.findOsBizFirstCall():Ge();if(e&&n&&Ze(t)){return void et({request:"ReconnectCall",heldCall:It(n.atcCallInfo),activeCall:It(e.atcCallInfo)},t)}t&&t()}(i)}),2e3)}}else"connected"===e.localConnectionInfo&&Be(e.callingDevice)&&(i.atcCallInfo.setServicesPermitted(e.servicesPermitted),(t=We(e.failingDevice||e.calledDevice))&&(i.atcCallInfo.setPartnerDisplay(t),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName)),i.isRemote&&"busy"===e.cause&&i.setCstaState(E.Busy),i.atcCallInfo.setMissedReason(function(e){var t=S.DEFAULT;switch(e){case"busy":t=S.BUSY;break;case"reorderTone":t=S.REORDER_TONE;break;case"blocked":t=S.DECLINED;break;case"destOutOfOrder":t=S.DEST_OUT_OF_ORDER}return t}(e.cause)),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]));else P.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.")}function ft(e){if(Re)return P.warn("[CstaSvc]: Queue new forwarding request until loop detected timer expires"),void(fe=e);Date.now()-Ie<2e3?Ae++:Ae=0,Ie=Date.now(),P.debug("[CstaSvc]: Forward loop counter: "+Ae+" timestamp: "+Ie),Ae>3?(P.error("[CstaSvc]: Loop detected while trying to update forwarding data."),fe=e,Re=O((function(){P.debug("[CstaSvc]: Loop detection timeout has expired. Process queued request."),Ae=0,Re=null,fe&&fe(),fe=null}),6e4,!1)):e&&e()}function _t(e){h.localUser&&(h.localUser.isOsBizCTIEnabled?function(e){if(!e||!e.agentDevice||!Ze()||e.agentGroup!==V.onsFQN)return;var t=xe(e.agentDevice),n=h.localUser.selectedRoutingOption;switch(e.name){case"AgentReadyEvent":(t===f.WebRTC&&ge(R.DeskPhone)||t===f.Desk&&ge(R.CircuitClient))&&Ne(R.DefaultRouting);break;case"AgentNotReadyEvent":t===f.WebRTC?Ne(R.DeskPhone):t===f.Desk&&Ne(R.CircuitClient)}h.localUser.selectedRoutingOption!==n&&(P.debug("[CstaSvc]: Publish /csta/agentStateUpdated"),y.publish("/csta/agentStateUpdated"))}(e):function(e){switch(e.name){case"AgentReadyEvent":h.localUser.agentStateReady=!0;break;case"AgentNotReadyEvent":case"AgentBusyEvent":case"AgentWorkingAfterCallEvent":h.localUser.agentStateReady=!1;break;case"AgentLoggedOffEvent":h.localUser.isAgent=!1,h.localUser.agentStateReady=!1;break;case"AgentLoggedOnEvent":h.localUser.isAgent=!0,h.localUser.agentStateReady=!1;break;default:return}h.localUser.isOSV&&(ve=e.huntGroupList);P.debug("[CstaSvc]: Publish /agent/state/ready event"),y.publish("/agent/state/ready",[h.localUser.agentStateReady])}(e))}function vt(e,t,n,i){if(Ze(i))if(e.atcCallInfo&&(e.checkCstaState([E.Active])||e.atcCallInfo.isHandoverAllowed()||e.atcCallInfo.isDeflectAllowed()))if(nt(e,t)){var r=Je(t,n,h.localUser.isOsBizCTIEnabled,h.localUser.isOsBizCTIEnabled);if(r){var o={autoAnswer:t===f.Desk||t===f.WebRTC};e.checkCstaState([E.Ringing,E.Parked])?(o.request="DeflectCall",o.callToBeDiverted=It(e.atcCallInfo),o.newDestination=r,h.localUser.isOSV||(P.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",e.atcCallInfo.getCstaCallId())),e.setAtcHandoverInProgress(),et(o,(function(n){n?(i&&i("res_MoveCallFailed"),e.clearAtcHandoverInProgress(),h.localUser.isOSV||(P.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed",[!0]))):(h.localUser.isOSV&&(P.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",e.atcCallInfo.getCstaCallId())),t===f.WebRTC&&e.atcCallInfo.setIgnoreCall(!0),e.atcCallInfo.transferCb=i,ut(e.atcCallInfo.getCstaCallId(),r))}))):(o.request="SingleStepTransferCall",o.activeCall=It(e.atcCallInfo),o.transferredTo=r,o.seamlessHandover=e.atcCallInfo.isSeamlessHandoverAllowed(),h.localUser.isOSV||(P.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",e.atcCallInfo.getCstaCallId())),e.setAtcHandoverInProgress(),et(o,(function(t,n){t||!n?(i&&i("res_MoveCallFailed"),e.clearAtcHandoverInProgress(),h.localUser.isOSV||(P.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed",[!0]))):(tt(o.activeCall.cID,n),ne={primaryCallId:o.activeCall.cID,newCallId:n.transferredCall.cID,direction:e.direction,redirectingUser:e.redirectingUser,transferCb:i},h.localUser.isOSV&&(P.debug("[CstaSvc]: Publish /csta/handover event"),y.publish("/csta/handover",e.atcCallInfo.getCstaCallId())),e.atcCallInfo.transferCb=i)})))}else i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("res_MoveCallFailed")}function gt(e,t){var n=He(e.dialedDn);me(n,e.dialedDn,e.dialedDn,e.toName),n.setCstaState(E.Delivered),n.direction=s.OUTGOING,n.setPosition(t);var i={dn:e.dialedDn,fqn:e.dialedDn,name:e.toName||""};if(n.atcCallInfo.setPartnerDisplay(i),n.atcCallInfo.setIgnoreCall(!0),j[e.dialedDn]=n,t===f.WebRTC&&h.localUser.isOsBizCTIEnabled){var r={reuseSessionCtrl:K&&K.sessionCtrl},o=new p(W,r);o.atcCallInfo=n.atcCallInfo,me(o,n.peerUser.phoneNumber,null,n.peerUser.displayName),o.isOsBizSecondCall=!0,o.setState(l.Initiated),o.direction=s.OUTGOING,Ue(e.dialedDn,!0),W.call=o,P.debug("[CstaSvc]: Publish /conversation/update event. convId = ",W.convId),y.publish("/conversation/update",[W]),b.addCallToList(o),P.debug("[CstaSvc]: Publish /call/state event. callId = "+o.callId+", state = "+o.state.name),y.publish("/call/state",[o])}else P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n]),P.debug("[CstaSvc]: Created new Remote Call object: ",n)}function Nt(e,t,n){var i=we(t.dialedDn);if(i)i.atcCallInfo.setCstaConnection(e),i.setCallIdForTelephony(e.cID),i.setCstaState(E.Delivered),i.atcCallInfo.setIgnoreCall(!1),t.dtmfDigits&&(i.dtmfDigits=t.dtmfDigits),delete j[t.dialedDn];else{me(i=He(e.cID),t.dialedDn,t.dialedDn,t.toName),i.setCstaState(E.Delivered),i.direction=s.OUTGOING,i.atcCallInfo.setCstaConnection(e),i.setPosition(n);var r={dn:t.dialedDn,fqn:t.dialedDn,name:t.toName||""};i.atcCallInfo.setPartnerDisplay(r)}i.atcCallInfo.setOriginalPartnerDisplay(i.atcCallInfo.getPartnerDisplay()),j[e.cID]=i,P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]),P.debug("[CstaSvc]: Created new Remote Call object: ",i)}function mt(e,t){if(e&&K){P.debug("[CstaSvc]: Creating local waiting call"),e.direction=s.INCOMING,e.setPosition(f.WebRTC),t&&e.atcCallInfo.setServicesPermitted(t),e.atcCallInfo.setIgnoreCall(!0);var n={reuseSessionCtrl:K&&K.sessionCtrl},i=new p(W,n);i.atcCallInfo=e.atcCallInfo,me(i,e.peerUser.phoneNumber,null,e.peerUser.displayName),i.isOsBizSecondCall=!0,K.isOsBizFirstCall=!0,i.direction=s.INCOMING,W.call=i,P.debug("[CstaSvc]: Publish /conversation/update event. convId = ",W.convId),y.publish("/conversation/update",[W]),i.setState(l.Ringing),i.setCstaState(E.Ringing),b.addCallToList(i),P.debug("[CstaSvc]: Publish /call/incoming event"),y.publish("/call/incoming",[W.call])}}function ht(){var t=[];return e.WebRTCAdapter.enabled&&t.push(f.WebRTC),Z||t.push(f.Desk),(V&&V.cell||h.localUser.isOsBizCTIEnabled&&h.localUser.reroutingPhoneNumber&&ge(R.AlternativeNumber))&&t.push(f.Cell),t}function Ot(e){var t=null;if(h.localUser.selectedBusyHandlingOption!==a.DefaultRouting.name){var n=e.atcCallInfo&&e.atcCallInfo.getCstaConnection()||te;if(n&&n.cID&&ee){switch(h.localUser.selectedBusyHandlingOption){case a.SendToAlternativeNumber.name:t={request:"DeflectCall",callToBeDiverted:n,newDestination:Je(f.Cell)};break;case a.BusySignal.name:t={request:"ClearConnection",connectionToBeCleared:n,reason:"busy"};break;case a.SendToVM.name:t={request:"DeflectCall",callToBeDiverted:n,newDestination:Je(f.VM)};break;default:return}et(t,(function(i){if(!i&&"ClearConnection"===t.request)if(e.atcCallInfo)e.atcCallInfo.setMissedReason(S.BUSY),e.checkCstaState(E.Offered)&&e.setCstaState(E.Failed);else if(U.isClearConnectionBusySupported()){var r=j[n.cID]||He(n.cID);r.peerUser=e.peerUser,r.direction=s.INCOMING,r.creationTime=e.creationTime,r.atcCallInfo.setMissedReason(S.BUSY),j[n.cID]=r,Ue(n.cID)}})),te={}}}else e.checkCstaState(E.Offered)&&(et(t={request:"AcceptCall",callToBeAccepted:e.atcCallInfo.getCstaConnection()}),te={})}function Dt(e){h.localUser.userPresenceState.state!==u.PresenceState.DND&&e?(P.debug("[CstaSvc]: DND is enabled on the switch. Set snooze on Circuit."),M.snooze(-1)):h.localUser.userPresenceState.state!==u.PresenceState.DND||e||(P.debug("[CstaSvc]: DND is disabled on the switch. Resume snooze on Circuit."),M.resume())}function Pt(e,t){!e&&t&&(h.localUser.isOsBizCTIEnabled?Dt(t.doNotDisturbOn):h.localUser.doNotDisturbOn=t.doNotDisturbOn)}function yt(e){switch(e){case c.Immediate.name:case c.VM.name:return"forwardImmediate";case c.NoAnswer.name:return"forwardNoAns";default:return""}}function bt(e){switch(e){case"forwardImmediate":return c.Immediate.name;case"forwardImmInt":case"forwardImmExt":return h.localUser.isOsBizCTIEnabled?c.Immediate.name:"";case"forwardNoAns":return c.NoAnswer.name;case"preferredDevice":return h.localUser.isOsBizCTIEnabled?"preferredDevice":"";default:return""}}function Ut(e,t){var n;(Object.values(c).forEach((function(e){h.localUser.cfData[e.name]={cfwType:e.name,cfwEnabled:!1,cfwAvailable:!1,cfwNumber:"",label:e.label,description:e.description,message:e.message}})),!e&&t)&&(h.localUser.cfData.Immediate.cfwAvailable=!h.localUser.isOSV,(n=t.forwardList)&&n.forEach((function(e){switch(bt(e.forwardingType)){case c.Immediate.name:h.localUser.cfData.Immediate.cfwAvailable=!0,h.localUser.cfData.Immediate.cfwEnabled=e.forwardStatus&&e.forwardDN!==V.vm,h.localUser.cfData.Immediate.cfwNumber=e.forwardDN!==V.vm&&I.format(e.forwardDN),h.localUser.cfData.VM.cfwAvailable=!0,h.localUser.cfData.VM.cfwEnabled=e.forwardStatus&&e.forwardDN===V.vm,h.localUser.cfData.VM.cfwNumber=V.vm;break;case c.NoAnswer.name:if(h.localUser.isOsBizCTIEnabled&&Qe())if(e.forwardStatus){var t=e.forwardDN&&Fe(e.forwardDN);t&&t[1]!==h.localUser.reroutingPhoneNumber&&(h.localUser.reroutingPhoneNumber=t[1]),V&&V.osmoDeviceList&&V.osmoDeviceList.length>1&&H.getForwardingPreferredDevice(V.osmoDeviceList[1],Ut)}else h.localUser.reroutingPhoneNumber="",V&&V.osmoDeviceList&&ge(R.AlternativeNumber)&&Ne(R.DefaultRouting);else h.circuitLabs.CALL_FORWARD_NO_REPLY&&h.localUser.isOSV&&(h.localUser.cfData.NoAnswer.cfwType=c.NoAnswer.name,h.localUser.cfData.NoAnswer.cfwAvailable=!0,h.localUser.cfData.NoAnswer.cfwEnabled=e.forwardStatus,h.localUser.cfData.NoAnswer.cfwNumber=I.format(e.forwardDN));break;case"preferredDevice":!e.forwardStatus&&ge(R.AlternativeNumber)?Ne(R.DefaultRouting):e.forwardStatus&&h.localUser.reroutingPhoneNumber&&Ne(R.AlternativeNumber)}})),V.forwardList=t.forwardList||[],t.hasOwnProperty("voicemailActive")&&(h.localUser.voicemailPBXEnabled=!0,h.localUser.voicemailActive=t.voicemailActive,h.localUser.voicemailRingDuration=t.voicemailRingDuration,Ee=t.voicemailRingDuration),t.mainRingDuration&&(h.localUser.ringDurationEnabled=!0,h.localUser.mainRingDuration=t.mainRingDuration,h.localUser.clientRingDuration=t.clientRingDuration,h.localUser.cellRingDuration=t.cellRingDuration,Ce=t.mainRingDuration,Te=t.clientRingDuration,pe=t.cellRingDuration,h.localUser.alternativeNumber=t.alternativeNumber||m.cleanPhoneNumber(h.localUser.reroutingPhoneNumber),h.localUser.routeToCell=t.routeToCell,h.localUser.ringDurationConfigurable=t.hasOwnProperty("overrideProfile")?t.overrideProfile:!h.localUser.isOSV),t.hasOwnProperty("staticOndActive")?(de=!0,t.staticOndActive?(le=t.staticOndDN,ge(R.AlternativeNumber)&&!h.localUser.reroutingPhoneNumber?Ne(R.DefaultRouting):t.staticOndDN===m.cleanPhoneNumber(h.localUser.reroutingPhoneNumber)?Ne(R.AlternativeNumber):(Ne(R.Other),h.localUser.otherRoutingNumber=I.format(t.staticOndDN))):(le="",(ge(R.AlternativeNumber)||ge(R.Other))&&Ne(R.DefaultRouting)),P.debug("[CstaSvc]: Publish /csta/staticOndUpdated event"),y.publish("/csta/staticOndUpdated")):de=!1,P.debug("[CstaSvc]: Publish /localUser/update event"),y.publish("/localUser/update",[h.localUser]),P.debug("[CstaSvc]: Publish /csta/getForwardingResponse"),y.publish("/csta/getForwardingResponse"))}function Lt(e,n){!e&&n&&(h.localUser.isAgent=n.loggedOnState,h.localUser.isAgent&&(h.localUser.agentStateReady=n.agentState===t.Ready,h.localUser.isOSV&&(ve=n.huntGroupList),P.debug("[CstaSvc]: Publish /agent/state/ready event"),y.publish("/agent/state/ready",[h.localUser.agentStateReady])))}function Mt(e){m.isMobile()||b.getActiveCall()||(e=e||Object.values(j).find((function(e){return e.pickupNotification})))&&e.isPresent()&&!e.pickupNotificationShown&&(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[e]),P.debug("[CstaSvc]: Publish /call/pickupNotification event"),y.publish("/call/pickupNotification",[e]),e.pickupNotificationShown=!0)}function wt(e,t){Ze(t)&&et({request:"SetBusy",device:ot(),busyState:e},t)}function Gt(e,t){e.isOsBizSecondCall&&(e.setState(t),P.debug("[CstaSvc]: Publish /conversation/update event. convId = ",W.convId),y.publish("/conversation/update",[W]))}function kt(e,t){if(h.localUser.isOsBizCTIEnabled&&e)switch(e){case R.AlternativeNumber.name:return void H.setRoutingOptionReroutingNumber(null,t);case R.DeskPhone.name:return void H.setAgentStateOSBiz(!0,R.CircuitClient.name,t);case R.CircuitClient.name:return void H.setAgentStateOSBiz(!0,R.DeskPhone.name,t)}t&&t()}return B.on("ATC.CSTA",(function(e){e.type===i.CSTA&&e.CSTA&&h.$apply((function(){!function(e){var t=x.parseEvent(e.CSTA);if(!t)return;switch(function(e,t){"DigitsGeneratedEvent"===e.name&&(t.CSTA=t.CSTA.replace(/"dGL":"[^"]*"/,'"dGL":"***"')),P.debug("[CstaSvc]: Received CSTA event: ",t)}(t,e),P.debug("[CstaSvc]: Parsed CSTA Event: ",t),delete t.keysToOmitFromLogging,t.category){case"CallControl":case"CallAssociatedFeature":H.handleCallEvent(t);break;case"LogicalDeviceFeature":H.handleLogicalDeviceEvent(t);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":H.handleDeviceEvent(t);break;default:P.debug("[CstaSvc]: Unsupported CSTA Event category: "+t.category)}}(e)}))})),B.on("ATC.PRIMARYCLIENT",(function(e){var t;P.info("[CstaSvc]: Received PRIMARYCLIENT event:",e),e.type===i.PRIMARYCLIENT&&e.primaryClientId&&(t=e.primaryClientId,h.localUser.clientId!==t?(P.debug("[CstaSvc]: This is not the Primary ATC client"),ee=!1):(P.debug("[CstaSvc]: This is the primary ATC client"),ee=!0))})),B.on("ATC.ADVANCING",(function(e){if(e.type===i.ADVANCING){P.debug("[CstaSvc]: Received UserToUser ATC.ADVANCING");var t=b.getIncomingCall(e.rtcSessionId);t&&(ne={newCallId:t.atcCallInfo.getCstaCallId(),direction:t.direction,redirectingUser:t.redirectingUser})}})),F.on("Team.NOTIFY",(function(e){e.callingUser?W&&h.localUser.phoneNumber?h.localUser.cfData.Immediate.cfwEnabled||h.localUser.doNotDisturbOn?P.debug("[CstaSvc]: Ignore team notification as the user has call forwarding immediate or DND enabled"):st(e.callingUser.fullyQualifiedNumber,e.callingUser.displayName)?P.debug("[CstaSvc]: There is already a pickup notification for this call. Ignore it."):(P.debug("[CstaSvc]: Handle the team notification for phone call"),h.$apply((function(){L.getUserById(e.calledUserId,(function(t,n){!t&&n?n.userId!==h.localUser.userId?ct({callingDisplay:{dn:e.callingUser.phoneNumber,fqn:e.callingUser.fullyQualifiedNumber,name:e.callingUser.displayName},calledDisplay:{dn:n.phoneNumber,fqn:n.fullyQualifiedNumber,name:n.displayName},callId:e.rtcSessionId,callingUserId:e.callingUserId}):P.debug("[CstaSvc]: Ignore team notification when called user is the local user"):P.error("[CstaSvc]: Error getting called user")}))}))):P.error("[CstaSvc]: No telephony conversation or phoneNumber. Cannot handle team notification"):P.debug("[CstaSvc]: Ignore team notification for Circuit call")})),F.on("Team.NOTIFY_CANCEL",(function(e){var t=j[e.rtcSessionId];t&&!t.isHandoverInProgress&&h.$apply((function(){Ue(e.rtcSessionId)}))})),y.subscribe("/conversations/showTelephonyConversation",(function(e,t){P.debug("[CstaSvc]: Received /conversations/showTelephonyConversation event. show = ",e),e&&(W=t)})),y.subscribe("/conversation/update",(function(e){W&&W.convId===e.convId&&(W=e)})),y.subscribe("/atcRegistration/state",(function(e){P.debug("[CstaSvc]: Received /atcRegistration/state event."),ce=e,h.localUser.isATC&&(!$&&e===r.Registered&&Se?Xe():$=!1,e!==r.Registered&&Me())})),y.subscribe("/activeSessions/received",(function(){P.debug("[CstaSvc]: Received /activeSessions/received event"),Se=!0,$||ce===r.Registered&&Xe()})),y.subscribe("/registration/state",(function(e){P.debug("[CstaSvc]: Received /registration/state event"),e!==RegistrationState.Registered&&(Se=!1)})),y.subscribe("/call/incoming",(function(e){e&&W&&e.convId===W.convId&&(P.debug("[CstaSvc]: Received /call/incoming event."),Object.keys(j).some((function(e){var t=j[e];return!(!t.checkCstaState(E.Ringing)||!t.isAtPosition(f.WebRTC))&&((q=ye())&&(P.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),q.atcCallInfo=t.atcCallInfo,t.atcCallInfo=new n,t.atcCallInfo.setIgnoreCall(!0),Ue(e)),!0)})))})),y.subscribe("/atccall/firstcall",(function(e){P.debug("[CstaSvc]: Received /atccall/firstcall event"),function(e){var t=e.atcCallInfo&&e.atcCallInfo.getCstaConnection()||te;ee&&et({request:"DeflectCall",callToBeDiverted:t,newDestination:Je(f.Desk)})}(e)})),y.subscribe("/atccall/secondcall",(function(e){P.debug("[CstaSvc]: Received /atccall/secondcall event."),Ot(e)})),y.subscribe("/atccall/replace",(function(e,t){P.debug("[CstaSvc]: Received /atccall/replace event");var i=j[t];if(i){e.establishedTime=i.establishedTime;var r=i.atcCallInfo;e.atcCallInfo||(e.atcCallInfo=new n),e.atcCallInfo.setOriginalPartnerDisplay(r.originalPartnerDisplay),Ue(t,!0)}})),y.subscribe("/callHistory/item/added",(function(e){e&&e.rtc&&e.rtc.rtcParticipants&&2===e.rtc.rtcParticipants.length&&(ie.unshift("TELEPHONY"===e.rtc.rtcParticipants[0].type?e.rtc.rtcParticipants[0]:e.rtc.rtcParticipants[1]),ie.length>2&&ie.pop())})),y.subscribe("/call/ended",(function(e){e&&e.isTelephonyCall&&!e.isRemote&&(ae=e,O.cancel(se),se=O((function(){ae=null,se=null}),2e3),(e.isOsBizSecondCall||e.pulled)&&Le(e)),e.pickupNotification||e.isRemote||Mt(),De()})),y.subscribe("/routing/alternativeNumber/changed",(function(){P.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),h.localUser.isOsBizCTIEnabled&&(H.setRoutingOptionReroutingNumber(h.localUser.reroutingPhoneNumber),P.debug("[TelephonySettingsSvc]: Publish /csta/deviceChange event"),y.publish("/csta/deviceChange")),it()})),y.subscribe("/localUser/update",(function(){h.localUser.isATC&&(P.debug("[CstaSvc]: Received /localUser/update event"),h.localUser.isOsBizCTIEnabled&&(ue&&h.localUser.userPresenceState.state!==u.PresenceState.BUSY||!ue&&h.localUser.userPresenceState.state===u.PresenceState.BUSY&&b.getCalls().some((function(e){return!e.isTelephonyCall})))&&(ue=!ue,ee&&(P.debug("[CstaSvc]: Update busy state. New State: ",ue),wt(ue))),it())})),y.subscribe("/user/snooze/start",(function(){je()&&ee&&(P.info("[CstaSvc]: Received /user/snooze/start event"),H.setDoNotDisturb(!0))})),y.subscribe("/user/autoSnooze/start",(function(){je()&&ee&&(P.info("[CstaSvc]: Received /user/autoSnooze/start event"),H.setDoNotDisturb(!0))})),y.subscribe("/user/snooze/end",(function(){je()&&ee&&(P.info("[CstaSvc]: Received /user/snooze/end event"),H.setDoNotDisturb(!1))})),y.subscribe("/user/snooze/resume",(function(){je()&&ee&&(P.info("[CstaSvc]: Received /user/snooze/resume event."),H.setDoNotDisturb(!1))})),y.subscribe("/language/update",(function(){_e=h.i18n.map.res_NumberNotAvailable})),y.subscribe("/feature/state/changed",(function(e,t){e===u.LabFeatureName.CALL_FORWARD_NO_REPLY&&(P.debug("[CstaSvc]: Call Forward No Reply has changed status"),t?H.getForwarding(Ut):(h.localUser.cfData.NoAnswer.cfwAvailable=!1,P.debug("[CstaSvc]: Publish /csta/forwardingEvent"),y.publish("/csta/forwardingEvent")))})),this.alternate=function(e,t,n){Ze(n)&&(e&&t?(e.setRetrieveInProgress(),t.setHoldInProgress(),et({request:"AlternateCall",activeCall:It(t.atcCallInfo),heldCall:It(e.atcCallInfo)},(function(i){i?(e.clearRetrieveInProgress(),t.clearHoldInProgress(),n&&n("res_RetrieveCallFailed")):(h.localUser.isOsBizCTIEnabled&&(W.call=e,P.debug("[CstaSvc]: Publish /conversation/update event. convId = ",W.convId),y.publish("/conversation/update",[W])),n&&n(null))}))):n&&n("Invalid calls to alternate"))},this.conference=function(e,t,n){Ze(n)&&(e&&t?et({request:"ConferenceCall",activeCall:It(t.atcCallInfo),heldCall:It(e.atcCallInfo)},(function(e,t){e||!t?n&&n("res_MergeCallFailed"):n&&n(null)})):n&&n("Invalid calls to conference"))},this.answer=function(e,t){if(Ze(t)){var n=we(e);if(!n){if(!q||!q.atcAdvancing)return void(t&&t("There is no call to be answered"));var i=It((n=q).atcCallInfo);i.dID=V.onsFQN,n.atcCallInfo.setCstaConnection(i)}var r=n.atcAdvancing?f.Desk:n.getPosition(),o=Object.values(j).find((function(t){return t.callId!==e&&t.isAtPosition(r)}));if(!o||h.localUser.isOsBizCTIEnabled)et({request:"AnswerCall",callToBeAnswered:It(n.atcCallInfo)},t);else H.alternate(n,o,t)}},this.answerCstaCall=function(e,t){Ze(t)&&et({request:"AnswerCall",callToBeAnswered:{cID:e,dID:V.onsFQN}},t)},this.pickupCall=function(e,t,n){n=n||function(){};var i=we(e);if(i&&i.pickupNotification){if(i.pickupSession)!function(e,t){var n={content:{type:v.TEAM_PICKUP,teamPickupData:{pickupSessionId:e.pickupSession,divertTo:m.cleanPhoneNumber(h.localUser.isOsBizCTIEnabled?V.onsFQN:h.localUser.callerId)}},destUserId:e.peerGtcUserId};B.sendTeamPickupRequest(n,(function(e,n){e||n&&n.error?n&&_[n.error]?t&&t(_[n.error].ui):t&&t("res_PickUpCallFailed"):t&&t()}))}(i,(function(t){if(t)return n(t),void Ue(e,!0);n()}));else{if(!Ze(n))return;et({request:"GroupPickupCall",newDestination:Je(t=t||f.WebRTC)},(function(t){if(t)return n("res_PickUpCallFailed"),void Ue(e,!0);n()}))}P.debug("[CstaSvc]: Publish /atccall/pickUpInProgress"),y.publish("/atccall/pickUpInProgress",[i]),i.setAtcHandoverInProgress()}else n("There is no call to be picked up")},this.clearTransferredCall=function(e){J[e]&&(O.cancel(J[e].timeout),delete J[e])},this.consultationTransfer=function(e,t,n){Ze(n)&&et({request:"TransferCall",heldCall:It(t.atcCallInfo),activeCall:It(e.atcCallInfo)},(function(e,t){e||!t?n&&n(g.Unreachable.ui):n&&n(null)}))},this.deflect=function(e,t,n,i){if(Ze(i)){var r=Ke(e)||b.getIncomingCall()||we(e);if(r)if(nt(r,t))if(r.atcAdvancing&&t===f.Desk)H.answer(e,i);else{var o=Je(t,n);if(o){var a={request:"DeflectCall",callToBeDiverted:It(r.atcCallInfo),newDestination:o,autoAnswer:t===f.Desk||t===f.WebRTC};h.localUser.isOsBizCTIEnabled&&t===f.Cell&&ge(R.CircuitClient)&&(a.callToBeDiverted.dID=V.osmoFQN),et(a,(function(e){e?i&&i("res_MoveCallFailed"):t===f.VM||h.localUser.isOsBizCTIEnabled&&t===f.Cell||r.setAtcHandoverInProgress()}))}else i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("There is no call to be deflected")}},this.generateDigits=function(e,t,n){Ze(n)&&et({request:"GenerateDigits",connectionToSendDigits:It(e.atcCallInfo),charactersToSend:t},(function(i){n&&n(i),h.localUser.isOsBizCTIEnabled&&!i&&(P.info("[CstaSvc]: Number of DTMF digits played: ",t&&t.length),y.publish("/call/singleDigitSent",[e,t]))}),["GD.cTS"])},this.getDoNotDisturb=function(e){Ze(e)&&et({request:"GetDoNotDisturb",device:ot()},e)},this.getForwarding=function(e){Ze(e)&&et({request:"GetForwarding",device:ot()},e)},this.getMessageWaiting=function(e){Ze(e)&&et({request:"GetMessageWaitingIndicator",device:ot()},e)},this.getTransferredCall=function(e){return J[e]},this.pullRemoteCall=function(e,t){var n=we(e);n?n.pickupNotification?H.pickupCall(e,null,t):vt(n,f[f.WebRTC.name],null,t):(P.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),t("No active remote call"))},this.pushLocalCall=function(e,t,n){var i;De(),K&&K.callId===e?i=K:Y&&Y.callId===e&&(i=Y),i?vt(i,f[t],null,n):(P.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),n("No active local call"))},this.endRemoteCall=function(e,t){var n=we(e);n?this.hangupRemote(n,t):(P.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),t&&t("No active remote call"))},this.endCallOnRemoteDevices=function(e){Ze()&&V.osmoDeviceList&&e&&et({request:"ClearConnection",connectionToBeCleared:{cID:e,dID:V.onsFQN}})},this.endCstaCall=function(e){Ze()&&e&&et({request:"ClearConnection",connectionToBeCleared:{cID:e,dID:V.onsFQN}})},this.hangupRemote=function(e,t){if(e.isRemote&&Ze(t)){if(!It(e.atcCallInfo).cID)return P.warn("[CstaSvc]: hangupRemote invoked without a valid call"),void(t&&t("No active remote call"));et({request:"ClearConnection",connectionToBeCleared:It(e.atcCallInfo)},(function(n){n?t&&t(n):(e.getCstaState().established||e.atcCallInfo.getMissedReason()||(e.direction===s.INCOMING?e.atcCallInfo.setMissedReason(S.DECLINED):e.atcCallInfo.setMissedReason(S.CANCELLED),Ue(e.atcCallInfo.getCstaCallId())),t&&t())}))}},this.hold=function(e,t){if(Ze(t)){var n={request:"HoldCall",callToBeHeld:It(e.atcCallInfo)};h.localUser.isOsBizCTIEnabled&&e.isRemote&&V.supportedFeatures&&V.supportedFeatures.includes("zhOs")&&(n.holdOptions="exclusiveHold"),e.setHoldInProgress(),et(n,(function(n){n?(e.clearHoldInProgress(),t&&t("res_HoldCallFailed")):t&&t(null)}))}},this.holdWithConsultationCall=function(e,t){if(Ze(t)){var n={request:"ConsultationCall",existingCall:It(e.atcCallInfo)};e.setHoldInProgress(),et(n,(function(n,i){n?(e.clearHoldInProgress(),t&&t("res_HoldCallFailed")):(i&&i.iC&&i.iC.cID&&e.atcCallInfo.setCstaReconnectId({cID:i.iC.cID,dID:V.onsFQN}),t&&t(null))}))}},this.reconnect=function(e,t,n){Ze(n)&&et({request:"ReconnectCall",heldCall:It(t.atcCallInfo),activeCall:It(e.atcCallInfo)},n)},this.retrieve=function(e,t){if(Ze(t)){var n={request:"RetrieveCall",callToBeRetrieved:It(e.atcCallInfo)};e.setRetrieveInProgress(),et(n,(function(n){n?(e.clearRetrieveInProgress(),t&&t("res_RetrieveCallFailed")):t&&t(null)}))}},this.retrieveWithReconnectCall=function(e,t){if(Ze(t)){var n={request:"ReconnectCall",heldCall:It(e.atcCallInfo),activeCall:e.atcCallInfo.getCstaReconnectId()};e.setRetrieveInProgress(),et(n,(function(n){n?(e.clearRetrieveInProgress(),e.atcCallInfo.setCstaReconnectId({}),t&&t("res_RetrieveCallFailed")):t&&t(null)}))}},this.setDoNotDisturb=function(e,t){Ze(t)&&(P.debug("[CstaSvc]: Set DND to ",e),et({request:"SetDoNotDisturb",device:ot(),doNotDisturbOn:e},t))},this.setForwarding=function(e,t){if(Ze(t)){var n={request:"SetForwarding",device:e.device||ot(),activateForward:e.activateForward,forwardDN:e.forwardDN||"",forwardingType:e.forwardingType,ringCount:e.ringCount};ft((function(){et(n,t)}))}},this.snapshotCall=function(e,t){Ze(t)&&et({request:"SnapshotCall",snapshotObject:e},t)},this.snapshotDevice=function(e){Ze(e)&&et({request:"SnapshotDevice",snapshotObject:V.onsFQN,osmo:V.osmo},e)},this.getLogicalDeviceInformation=function(e){Ze(e=e||function(){})&&et({request:"GetLogicalDeviceInformation",device:ot()},(function(t,n){t||!n||n.hasPhysicalDeviceInformation||Z||(Z=!0,rt()),e(t,n)}))},this.transfer=function(e,t,n){if(Ze(n)){var i={};e.checkCstaState([E.Ringing,E.Parked])?(i.request="DeflectCall",i.callToBeDiverted=It(e.atcCallInfo),i.newDestination=t,et(i,n)):(i.request="SingleStepTransferCall",i.activeCall=It(e.atcCallInfo),i.transferredTo=t,et(i,(function(e,t){if(e||!t){if(e&&-1!==e.indexOf("internalResourceBusy"))return tt(i.activeCall.cID,{transferredCall:{cID:"00000000000000000000000000000000"}}),void(n&&n(null));n&&n(g.Unreachable.ui)}else tt(i.activeCall.cID,t),n&&n(null)})))}},this.consultationCall=function(e,t,n){if(Ze(n)&&t){var i={request:"ConsultationCall",consultedDevice:t.dialedDn,existingCall:It(e.atcCallInfo)};gt(t,e.getPosition());var r=j[t.dialedDn];et(i,(function(i,o){if(i||!o){if(n&&n("res_MakeCallFailed"),r){if(i.endsWith("invalidCalledDeviceID"))r.atcCallInfo.setMissedReason(S.REORDER_TONE);else{if(i.endsWith("requestIncompatibleWithCallingDevice")||i.endsWith("invalidDeviceID"))return void Ue(t.dialedDn,!0);r.atcCallInfo.setMissedReason(S.DEST_OUT_OF_ORDER)}r.atcCallInfo.setIgnoreCall(!1),Ue(t.dialedDn)}}else!e.isRemote&&h.localUser.isOsBizCTIEnabled?e.isOsBizFirstCall=!0:Nt(o.iC,t,e.getPosition()),n&&n()}))}},this.makeCall=function(e,t,n){if(Ze(n)&&t){var i={request:"MakeCall",calledDirectoryNumber:t.dialedDn,callingDevice:Je(e),autoOriginate:e===f.Desk||e===f.WebRTC?"doNotPrompt":"prompt"};gt(t,e);var r=j[t.dialedDn];et(i,(function(i,o){if(i||!o){if(n&&n("res_MakeCallFailed"),i.endsWith("invalidCalledDeviceID"))r.atcCallInfo.setMissedReason(S.REORDER_TONE);else{if(i.endsWith("requestIncompatibleWithCallingDevice")||i.endsWith("invalidDeviceID"))return void Ue(t.dialedDn,!0);r.atcCallInfo.setMissedReason(S.DEST_OUT_OF_ORDER)}r.atcCallInfo.setIgnoreCall(!1),Ue(t.dialedDn)}else Nt(o.caD,t,e),n&&n()}))}},this.ignoreCall=function(e,t){Ue(e.callId),t&&t()},this.callBackCallRelated=function(e,t){Ze(t)&&et({request:"CallBackCallRelated",callBackConnection:e.atcCallInfo.getCstaConnection()},t)},this.callBackNonCallRelated=function(e,t){Ze(t)&&et({request:"CallBackNonCallRelated",orD:V.onsFQN,tD:e},t)},this.cancelCallBack=function(e,t){Ze(t)&&et({request:"CancelCallBack",orD:V.onsFQN,td:e||void 0},t)},this.setMicrophoneMute=function(e,t){Ze(t)&&et({request:"SetMicrophoneMute",device:ot(),mute:e},t)},this.getMicrophoneMute=function(e){Ze(e)&&et({request:"GetMicrophoneMute",device:ot()},e)},this.callLogSnapShot=function(e){Ze(e)&&et({request:"CallLogSnapShot",device:ot()},e)},this.snapshot=function(){qe()},this.getAgentState=function(e,t){if(Ze(t)){var n={request:"GetAgentState",device:e||ot()};h.localUser.isOsBizCTIEnabled&&(n.group=ot()),et(n,t)}},this.setAgentState=function(e,n){Ze(n)&&((e=!!e)!==h.localUser.agentStateReady&&et({request:"SetAgentState",device:ot(),state:e?t.Ready:t.NotReady},n))},this.setAgentStateOSBiz=function(e,n,i){Ze(i)&&(e=!!e,et({request:"SetAgentState",device:n===R.CircuitClient.name?V.osmoFQN:n===R.DeskPhone.name&&V.osmoDeviceList&&V.osmoDeviceList.length>0?V.osmoDeviceList[0]:ot(),state:e?t.Ready:t.NotReady,group:ot()},i))},this.handleCallEvent=function(e){var t,n,i;if(e)if(De(),$)try{switch(e.name){case"CallInformationEvent":!function(e){var t=e.connection.cID,n=null;if(e.pickupNotificationEarly){if(Be(e.connection.dID))return void P.debug("[CstaSvc]: The pickup notification is for a call to this user. Ignore it");if(Be(e.callingDevice))return void P.debug("[CstaSvc]: The calling party of this pickup notification call is this user. Ignore it");n=j[t];var i=We(e.connection.dID),r=We(e.callingDevice);if(n)P.debug("[CstaSvc]: Existing pickup call for: ",i.dn),n.atcCallInfo.setCstaConnection(e.connection);else{if(st(r.fqn,r.name))return void P.debug("[CstaSvc]: There is already a pickup notification for this call. Ignore it");ct({callingDisplay:r,calledDisplay:i,callId:t,evt:e})}}else{if(n=xe(e.connection.dID,e.epid)===f.WebRTC?Ke(t):j[t]){if(n.atcCallInfo.setCstaConnection(e.connection),e.callingDevice&&!Be(e.callingDevice)){var o=We(e.callingDevice);n.atcCallInfo.setPartnerDisplay(o),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}e.servicesPermitted&&(n.atcCallInfo.setServicesPermitted(e.servicesPermitted),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&(n.checkCstaState(E.ConferenceHolding)?n.setCstaState(E.Holding):n.checkCstaState(E.Conference)&&n.setCstaState(E.Active))),n.checkCstaState([E.Offered,E.ExtendedRinging,E.Idle])?P.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n]))}else P.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.")}}(e);break;case"ConferencedEvent":!function(e){e.secondaryOldCall&&(h.localUser.isOsBizCTIEnabled&&at(e.secondaryOldCall.cID)?P.debug("[CstaSvc]: Cleared secondary atc call with Call Id = ",e.secondaryOldCall.cID):Ue(e.secondaryOldCall.cID));var t=null,n=xe(e.primaryOldCall.dID,e.epid),i=h.localUser.isOSV||h.localUser.isOsBizCTIEnabled||n!==f.WebRTC||!e.secondaryOldCall?e.primaryOldCall.cID:e.secondaryOldCall.cID;(t=n===f.WebRTC?Ke(i):j[i])?(e.conferenceConnections.forEach((function(e){if(e.endpoint&&Be(e.endpoint)||e.connection&&Be(e.connection.dID)){if(t.atcCallInfo.setCstaConnection(e.connection),t.isAtcRemote){var n=t.atcCallInfo,r=t.peerUser,o=t.participants,a=t.direction;t.setCstaState(E.Idle),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[t]),delete j[i],(t=He(e.connection.cID)).atcCallInfo=n,t.peerUser=r,t.participants=o,t.direction=a,j[e.connection.cID]=t}P.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection)}else{var s=e.endpoint&&We(e.endpoint)||We(e.connection.dID);re.push({call:t,userId:e.connection.dID,participantId:e.connection.dID,phoneNumber:s.dn,displayName:s.name}),oe||(oe=!0,Oe())}})),"hold"===e.localConnectionInfo?t.setCstaState(E.ConferenceHolding):(t.setCstaState(E.Conference),!t.isRemote&&h.localUser.isOsBizCTIEnabled&&t.setState(l.Active)),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[t])):P.debug("[CstaSvc]: Could not find a call with Call Id = "+i)}(e);break;case"ConnectionClearedEvent":Et(e);break;case"DeliveredEvent":Ct(e);break;case"DigitsGeneratedEvent":n=(t=e).connection.cID,(i=Ke(n))||(i=j[n]),i&&Be(t.connection.dID)&&(P.info("[CstaSvc]: Number of DTMF digits played: ",t.digitGeneratedList&&t.digitGeneratedList.length),y.publish("/call/singleDigitSent",[i,t.digitGeneratedList]));break;case"DivertedEvent":Tt(e);break;case"EstablishedEvent":St(e);break;case"FailedEvent":Rt(e);break;case"HeldEvent":!function(e){var t=e.heldConnection.cID,n=Ke(t);if(n||(n=j[t])){if(P.debug("[CstaSvc]: Current csta call state: ",n.getCstaState()),Be(e.holdingDevice)){switch(n.atcCallInfo.setCstaConnection(e.heldConnection),n.getCstaState()){case E.Held:n.setCstaState(E.HoldOnHold);break;case E.Conference:n.setCstaState(E.ConferenceHolding),h.localUser.isOsBizCTIEnabled&&!n.isRemote&&n.setState(l.Holding);break;default:n.setCstaState(E.Holding),n.isRemote||n.setState(l.Holding)}n.clearHoldInProgress()}else"hold"===e.localConnectionInfo?n.checkCstaState(E.ConferenceHolding)||n.setCstaState(E.HoldOnHold):n.checkCstaState(E.Conference)||n.setCstaState(E.Held);P.debug("[CstaSvc]: New csta call state: ",n.getCstaState()),n.atcCallInfo.setServicesPermitted(e.servicesPermitted),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n])}else P.warn("[CstaSvc]: Could not find call corresponding to Held Event.")}(e);break;case"OfferedEvent":!function(e){var t,n;if(Be(e.offeredDevice)){if(t=e.offeredConnection,n=e.callingDevice,P.debug("[CstaSvc]: LocalConnection: ",t),P.debug("[CstaSvc]: Partner Device ID: ",n),h.localUser.cfData.Immediate.cfwEnabled)return P.debug("[CstaSvc]: Immediate call forwarding is enabled. Accept call"),void et({request:"AcceptCall",callToBeAccepted:t});var i=We(n),r=j[t.cID];if(!r||!r.pickupNotification){if((r=He(t.cID)).setPosition(f.Desk),r.atcCallInfo.setPartnerDisplay(i),me(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),r.setCstaState(E.Offered),r.direction=s.INCOMING,r.atcCallInfo.setCstaConnection(t),k.test(e.cause)){var o=We(e.lastRedirectionDevice);he(r,o.dn,o.fqn,o.name,A.CallForward)}P.debug("[CstaSvc]: Created new Remote Call object: ",r),j[t.cID]=r,te={cID:t.cID,dID:Je(f.WebRTC,null,!0)},ge(R.DeskPhone)||(b.isSecondCall()||W.call&&W.call.isAtcRemote&&!W.call.atcCallInfo.pickUp?Ot(r):(et({request:"AcceptCall",callToBeAccepted:It(r.atcCallInfo)}),te={}))}}else P.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.")}(e);break;case"QueuedEvent":At(e);break;case"RetrievedEvent":!function(e){var t=e.retrievedConnection.cID,n=Ke(t);if(n||(n=j[t])){if(Be(e.retrievingDevice))n.atcCallInfo.setCstaConnection(e.retrievedConnection),n.checkCstaState(E.HoldOnHold)?(n.setCstaState(E.Held),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.zsiHo&&n.setCstaState(E.Active)):n.checkCstaState(E.ConferenceHolding)?(n.setCstaState(E.Conference),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&n.setCstaState(E.Active)):n.setCstaState(E.Active),n.isRemote||n.setState(l.Active),n.clearRetrieveInProgress(),n.atcCallInfo.setCstaReconnectId({});else if(n.checkCstaState([E.ConferenceHolding,E.Conference]))"hold"===e.localConnectionInfo?n.setCstaState(E.ConferenceHolding):n.setCstaState(E.Conference);else if("hold"===e.localConnectionInfo?n.setCstaState(E.Holding):n.setCstaState(E.Active),n.isRemote){var i=We(e.retrievingDevice);n.atcCallInfo.setPartnerDisplay(i),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}n.atcCallInfo.setServicesPermitted(e.servicesPermitted),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n])}else P.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.")}(e);break;case"ServiceCompletionFailureEvent":!function(e){var t=e.primaryCall.connectionID.cID,n=xe(e.primaryCall.connectionID.dID,V.epid)===f.WebRTC?Ke(t):j[t];if(!n)return P.debug("[CstaSvc]: Could not find a call with Call Id = "+t),P.debug("[CstaSvc]: Publish /atccall/hangingcall event"),void y.publish("/atccall/hangingcall",t);if(P.debug("[CstaSvc]: Publish /atccall/moveFailed event"),y.publish("/atccall/moveFailed"),n.checkState([l.Terminated,l.Idle])){var i=n.atcCallInfo,r=n.peerUser,o=n.establishedTime,a=n.direction;delete j[t],(n=He(t)).atcCallInfo=i,n.peerUser=r,n.establishedTime=o,n.direction=a,j[t]=n}n.clearAtcHandoverInProgress(),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[n])}(e);break;case"ServiceInitiatedEvent":!function(e){var t,n=xe(e.initiatingDevice,e.epid);if(n===f.WebRTC&&(t=Ke(e.initiatedConnection.cID)))if(t.atcCallInfo.setCstaConnection(e.initiatedConnection),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),!t.isRemote&&t.checkState([l.Initiated,l.Ringing,l.Delivered]))P.info("[CstaSvc]: Set the CSTA connection ID for the call: ",e.initiatedConnection),t.setCstaState(E.Initiated),Gt(t,l.Delivered),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[t]);else{if(t.isRemote)return void P.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",e.initiatedConnection);P.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else(t=j[e.initiatedConnection.cID])||(t=He(e.initiatedConnection.cID)).setCstaState(E.Initiated),t.setPosition(n),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.direction=s.OUTGOING,t.atcCallInfo.setCstaConnection(e.initiatedConnection),j[e.initiatedConnection.cID]=t,P.debug("[CstaSvc]: Created new Remote Call object: ",t)}(e);break;case"TransferredEvent":!function(e){if("null"!==e.localConnectionInfo){var t=null,n=e.primaryOldCall.cID,i=Ke(n)||j[n];if(i){if(i.isAtcRemote&&e.secondaryOldCall&&e.secondaryOldCall.cID&&e.transferringDevice&&e.transferredToDevice&&$e(e.localConnectionInfo,e.transferringDevice,e.transferredToDevice)){var r=Ke(e.secondaryOldCall.cID);r&&(i.setCstaState(E.Idle),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]),delete j[n],(i=r).atcCallInfo.setCstaCallId(n))}if(e.transferredConnections.forEach((function(r){if(r.endpoint&&Be(r.endpoint)||r.connection&&Be(r.connection.dID))i.atcCallInfo.setCstaConnection(r.connection),P.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",r.connection),i.isAtcRemote&&(i.setCallIdForTelephony(r.connection.cID),delete j[n],j[i.callId]=i,P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]));else{if(i.isAtcRemote){var o=i.atcCallInfo;i.setCstaState(E.Idle);var a=i.peerUser,s=i.direction,c=i.establishedTime;P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]),delete j[n],(i=He(r.connection.cID)).atcCallInfo=o,i.atcCallInfo.setCstaConnection(r.connection),i.setCstaState("alerting"===e.localConnectionInfo?E.Ringing:E.Active),P.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",r.connection),me(i,a.phoneNumber,a.phoneNumber,a.displayName),i.direction=s,i.establishedTime=c;var l=We(e.transferringDevice);i.atcCallInfo.setOriginalPartnerDisplay(l),j[i.callId]=i}t=r.endpoint&&We(r.endpoint)||r.connection.dID&&We(r.connection.dID)}})),!i.isRemote&&!i.isEstablished())return P.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),void(t&&(i.atcCallInfo.setPartnerDisplay(t),i.transferredOnRinging=!0,me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName,(function(){$&&(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]))}))));switch(e.localConnectionInfo){case"hold":i.setCstaState(E.Holding);break;case"connected":i.setCstaState(E.Active);break;case"alerting":i.setCstaState(E.Ringing);break;default:P.debug("[CstaSvc]: Unexpected localConnectionInfo: ",e.localConnectionInfo)}i.atcCallInfo.setServicesPermitted(e.servicesPermitted),t&&(i.atcCallInfo.setPartnerDisplay(t),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName,(function(){$&&(P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i]))}))),P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[i])}else P.debug("[CstaSvc]: Could not find a call with Call Id = "+n)}else{if(e.secondaryOldCall){Ue(e.primaryOldCall.cID);var o=j[e.secondaryOldCall.cID];o&&o.atcCallInfo.setMissedReason(S.TRANSFERRED),O((function(){Ue(e.secondaryOldCall.cID)}),1e3)}else{if(Be(e.transferringDevice)&&Be(e.transferredToDevice)){var a=j[e.primaryOldCall.cID];a&&a.atcCallInfo.setIgnoreCall(!0),ut(e.primaryOldCall.cID,e.transferredToDevice)}Ue(e.primaryOldCall.cID)}if("singleStepTransfer"===e.cause){var s=H.getTransferredCall(e.primaryOldCall.cID);s&&(H.clearTransferredCall(e.primaryOldCall.cID),X[s.failedCallId]=e.primaryOldCall.cID)}else if("transfer"===e.cause){var c=He(e.secondaryOldCall.cID);P.debug("[CstaSvc]: Publish /atccall/info event"),y.publish("/atccall/info",[c])}}}(e);break;default:P.debug("[CstaSvc]: Ignore CSTA Call Event ("+e.name+")")}}catch(e){P.error(e)}else P.debug("[CstaSvc]: Ignore any call event until snapshot is performed")},this.handleDeviceEvent=function(e){if(e)try{switch(e.name){case"BackInServiceEvent":Z=!1,rt();break;case"OutOfServiceEvent":Z=!0,rt();break;default:P.debug("[CstaSvc]: Ignore CSTA Device Event ("+e.name+")")}}catch(e){P.error(e)}},this.handleLogicalDeviceEvent=function(e){var t;if(e)try{switch(e.name){case"ForwardingEvent":!function(e){if(e){switch(V.forwardList.some((function(t){return!!(t.forwardingType===e.forwardingType||Ye(t.forwardingType)&&Ye(e.forwardingType))&&(t.forwardStatus=e.forwardStatus,t.forwardDN=e.forwardTo,!0)}))||V.forwardList.push({forwardDN:e.forwardTo,forwardStatus:e.forwardStatus,forwardingType:e.forwardingType}),bt(e.forwardingType)){case c.Immediate.name:h.localUser.cfData.Immediate.cfwAvailable=!0,h.localUser.cfData.Immediate.cfwNumber=e.forwardTo!==V.vm&&I.format(e.forwardTo),h.localUser.cfData.Immediate.cfwEnabled=e.forwardTo!==V.vm&&e.forwardStatus,h.localUser.cfData.VM.cfwAvailable=!0,h.localUser.cfData.VM.cfwNumber=V.vm,h.localUser.cfData.VM.cfwEnabled=e.forwardStatus&&e.forwardTo===V.vm&&e.forwardStatus;break;case c.NoAnswer.name:h.localUser.isOsBizCTIEnabled&&Qe()&&!e.forwardStatus?h.localUser.reroutingPhoneNumber="":h.circuitLabs.CALL_FORWARD_NO_REPLY&&h.localUser.isOSV&&(h.localUser.cfData.NoAnswer.cfwAvailable=!0,h.localUser.cfData.NoAnswer.cfwNumber=I.format(e.forwardTo),h.localUser.cfData.NoAnswer.cfwEnabled=e.forwardStatus);break;case"preferredDevice":Qe()&&(!e.forwardStatus&&ge(R.AlternativeNumber)?Ne(R.DefaultRouting):e.forwardStatus&&h.localUser.reroutingPhoneNumber&&Ne(R.AlternativeNumber))}e.hasOwnProperty("staticOndActive")&&(e.staticOndActive?(le=e.staticOndDN,e.staticOndDN===m.cleanPhoneNumber(h.localUser.reroutingPhoneNumber)?Ne(R.AlternativeNumber):(Ne(R.Other),h.localUser.otherRoutingNumber=I.format(e.staticOndDN))):(le="",(ge(R.AlternativeNumber)||ge(R.Other))&&Ne(R.DefaultRouting)),P.debug("[CstaSvc]: Publish /csta/staticOndUpdated event"),y.publish("/csta/staticOndUpdated")),e.hasOwnProperty("voicemailActive")&&(h.localUser.voicemailPBXEnabled=!0,h.localUser.voicemailActive=e.voicemailActive,h.localUser.voicemailRingDuration=e.voicemailRingDuration,Ee=e.voicemailRingDuration),e.hasOwnProperty("mainRingDuration")&&(h.localUser.ringDurationEnabled=!0,h.localUser.mainRingDuration=e.mainRingDuration,h.localUser.clientRingDuration=e.clientRingDuration,h.localUser.cellRingDuration=e.cellRingDuration,Ce=e.mainRingDuration,Te=e.clientRingDuration,pe=e.cellRingDuration,h.localUser.alternativeNumber=e.alternativeNumber,h.localUser.routeToCell=e.routeToCell,h.localUser.ringDurationConfigurable=e.hasOwnProperty("overrideProfile")?e.overrideProfile:!h.localUser.isOSV),h.circuitLabs.CALL_FORWARD_NO_REPLY&&e.forwardingCapsChanged&&(h.localUser.cfData.Immediate.cfwAvailable=h.localUser.cfData.NoAnswer.cfwAvailable=!1,H.getForwarding(Ut)),P.debug("[CstaSvc]: Publish /localUser/update event"),y.publish("/localUser/update",[h.localUser]),P.debug("[CstaSvc]: Publish /csta/forwardingEvent"),y.publish("/csta/forwardingEvent")}}(e);break;case"DoNotDisturbEvent":t=e,je()&&t&&ee?Dt(t.doNotDisturbOn):h.localUser.doNotDisturbOn=t.doNotDisturbOn;break;case"AgentReadyEvent":case"AgentNotReadyEvent":case"AgentBusyEvent":case"AgentLoggedOffEvent":case"AgentLoggedOnEvent":_t(e);break;default:P.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+e.name+")")}}catch(e){P.error(e)}},this.isPrimaryClient=function(){return ee},this.getDisplayInfo=We,this.getCallDevices=ht,this.getPushDevices=function(){var e=[];return Z||e.push(f.Desk),V&&V.cell&&e.push(f.Cell),e},this.getAnswerDevices=function(e){if(!e)return[];var t=[f.WebRTC];if(e.pickupSession)return t;var n=!1;if(Z||e.isOsBizSecondCall||t.push(f.Desk),V&&V.cell&&e.getPosition()!==f.Cell&&t.push(f.Cell),V&&V.vm&&!e.pickupNotification&&(h.localUser.voicemailActive||h.localUser.isOsBizCTIEnabled)&&(t.push(f.VM),n=!0),!h.localUser.isOsBizCTIEnabled)return t;switch(e.atcCallInfo&&e.atcCallInfo.isRecalledCall()&&t.shift(),h.localUser.selectedRoutingOption){case R.AlternativeNumber.name:e.getPosition()===f.Cell&&(t=n?[f.VM]:[]);break;case R.DeskPhone.name:e.getPosition()===f.Desk&&(t=[f.Desk],n&&t.push(f.VM));break;case R.CircuitClient.name:if(e.direction===s.INCOMING){var i=t.indexOf(f.Desk);-1!==i&&t.splice(i,1)}}return e.direction===s.INCOMING&&h.localUser.reroutingPhoneNumber&&!ge(R.AlternativeNumber)&&t.push(f.Cell),t},this.updateStaticOnd=function(e,t){if(Ze(t)){e=!!e,P.debug("[CstaSvc]: Request to update static OND status to "+e+" . _savedStaticOnd = "+le);var n={staticOndActive:e};if(e&&(n.staticOndDN=m.cleanPhoneNumber(h.localUser.reroutingPhoneNumber),!n.staticOndDN))return void(t&&t("Cannot activate static OND without the static OND DN"));if(e!==!!le||e&&n.staticOndDN!==le)et({request:"SetForwarding",device:ot(),staticOndActive:n.staticOndActive,staticOndDN:n.staticOndDN},(function(e){e?t&&t(e):(le=n.staticOndDN||"",t&&t(null))}));else t&&t(null)}},this.updateRoutingOption=function(e,t,n){h.localUser.isOsBizCTIEnabled?function(e,t,n){if(e!==t)switch(e){case R.AlternativeNumber.name:kt(t,(function(e){e?n&&n(e):H.setRoutingOptionReroutingNumber(h.localUser.reroutingPhoneNumber,n)}));break;case R.DeskPhone.name:kt(t,(function(e){e?n&&n(e):H.setAgentStateOSBiz(!1,R.CircuitClient.name,n)}));break;case R.CircuitClient.name:kt(t,(function(e){e?n&&n(e):H.setAgentStateOSBiz(!1,R.DeskPhone.name,n)}));break;default:kt(t,n)}else n&&n()}(e,t,n):function(e,t,n){switch(n=n||function(){},e){case R.AlternativeNumber.name:H.updateStaticOnd(!0,(function(e){e?n(e):H.setForwardingToVM(!1,n)}));break;case R.VM.name:H.setForwardingToVM(!0,(function(e){e?n(e):H.updateStaticOnd(!1,n)}));break;default:H.setForwardingToVM(!1,(function(e){e?n(e):de&&t!==R.AlternativeNumber.name&&t!==R.Other.name?n():H.updateStaticOnd(!1,n)}))}}(e,t,n)},this.setForwardingType=function(e,t,n,i){n=n||h.localUser.cfData[e].cfwNumber;var r={activateForward:!!(n=e===c.NoAnswer.name&&h.localUser.isOsBizCTIEnabled&&n?"N<"+m.cleanPhoneNumber(n)+">PreferredDevice":m.cleanPhoneNumber(n))&&!!t,forwardDN:n,forwardingType:yt(e)};H.setForwarding(r,i)},this.setForwardingImmediate=function(e,t,n){t=t||h.localUser.cfData.Immediate.cfwNumber;var i={activateForward:!!e,forwardDN:m.cleanPhoneNumber(t),forwardingType:"forwardImmediate"};H.setForwarding(i,n)},this.setForwardingToVM=function(e,t){if(H.getForwardingVMStatus()!==e){var n={activateForward:!!e,forwardDN:m.cleanPhoneNumber(V.vm),forwardingType:"forwardImmediate"};H.setForwarding(n,t)}else t&&t()},this.setForwardingNoAnswer=function(e,t,n){if(t&&!e)n&&n("Failed to set call forward no answer");else{var i={activateForward:!!t,forwardDN:e=h.localUser.isOsBizCTIEnabled&&e?"N<"+m.cleanPhoneNumber(e)+">PreferredDevice":m.cleanPhoneNumber(e),forwardingType:"forwardNoAns"};H.setForwarding(i,n)}},this.setRoutingOptionReroutingNumber=function(e,t){if(Ze(t)){var n=!!(e=e||"");e=n?"N<"+m.cleanPhoneNumber(e)+">PreferredDevice":"";var i=V.onsFQN;V.osmoDeviceList&&V.osmoDeviceList.length>1&&(i="N<"+V.onsFQN+"/"+V.osmoDeviceList[1]+">");var r={device:i,activateForward:n,forwardDN:e,forwardingType:"preferredDevice"};H.setForwarding(r,t)}},this.getForwardingData=function(){return V.forwardList},this.getForwardingImmediate=function(){var e=V.forwardList.find((function(e){return Ye(e.forwardingType)&&e.forwardDN!==V.vm}));return{status:!(!e||!e.forwardStatus),forwardDN:e&&e.forwardDN}},this.disableCallForwardingImmediate=function(e){H.getForwardingImmediate().status||h.localUser.isOsBizCTIEnabled&&H.getForwardingVMStatus()?H.setForwardingImmediate(!1,null,(function(){e&&e()})):e&&e()},this.getForwardingVMStatus=function(){return V.forwardList.some((function(e){return Ye(e.forwardingType)&&e.forwardDN===V.vm&&e.forwardStatus}))},this.getForwardingPreferredDevice=function(e,t){et({request:"GetForwarding",device:e},t)},this.getForwardingNoAnswer=function(){var e=V.forwardList.find((function(e){return"forwardNoAns"===e.forwardingType}));return{status:!(!e||!e.forwardStatus),forwardDN:e&&e.forwardDN}},this.disableCallForwardingNoAnswer=function(e){H.getForwardingNoAnswer().status?H.setForwardingNoAnswer(!1,null,(function(){e&&e()})):e&&e()},this.setVoicemail=function(e,t,n){if(Ze(n))if(t=t||Ee,h.localUser.pbxCallForwardToVoiceMailSupported&&h.localUser.voicemailPBXEnabled)if(P.debug("[CstaSvc]: Set voice mail duration to: ",t),e!==h.localUser.voicemailActive||e&&Ee!==t){var i={request:"SetForwarding",device:ot(),voicemailActive:e,voicemailRingDuration:e?t:void 0};ft((function(){et(i,(function(e){e?n&&n(e):(Ee=t,n&&n(null))}))}))}else n&&n(null);else n&&n("Cannot configure VM on PBX")},this.disableAllCallForwarding=function(){H.disableCallForwardingImmediate((function(){H.disableCallForwardingNoAnswer()}))},this.setRoutingTimers=function(e,t){if(Ze(t))if(h.localUser.ringDurationEnabled){if(P.debug("[CstaSvc]: Set routing timers to: ",e),Ce!==e.mainRingDuration||pe!==e.cellRingDuration||Te!==e.clientRingDuration||!h.localUser.routeToCell){var n={request:"SetForwarding",device:ot(),mainRingDuration:e.mainRingDuration||void 0,clientRingDuration:e.clientRingDuration||void 0,cellRingDuration:e.cellRingDuration||void 0,routeToCell:!0};ft((function(){et(n,(function(n){n?t&&t(n):(Ce=e.mainRingDuration||Ce,Te=e.clientRingDuration||Te,pe=e.cellRingDuration||pe,t&&t(null))}))}))}}else P.debug("[CstaSvc]: Cannot set routing timers"),t&&t("Cannot configure routing timers on PBX")},this.startCall=function(e,t,n,i){Ze(i)&&(e?h.localUser.isOsBizCTIEnabled&&e.isHolding()&&e.isRemote?V.supportedFeatures&&V.supportedFeatures.includes("zhOs")?(P.debug("[CstaSvc]: OSBiz supports exlussive hold for remote call. Send MakeCall"),H.makeCall(t,n,i)):H.retrieve(e,(function(t){t?i&&i("res_MakeCallFailed"):H.consultationCall(e,n,i)})):H.consultationCall(e,n,i):H.makeCall(t,n,i))},this.getHuntGroupList=function(){return ve},this},e}((Circuit=function(e){"use strict";var t=e.AtcCallInfo,n=e.Enums.AtcMessage,i=e.BusyHandlingOptions,r=e.ClientApiHandlerSingleton,o=e.Constants,a=e.DefaultAvatars,s=e.Enums,c=e.LocalCall,l=e.Proto,d=e.Enums.RedirectionTypes,u=e.RemoteCall,E=e.RoutingOptions,C=e.RtcParticipant,T=e.RtcSessionController,p=e.ScreenSharingController,S=e.Enums.ScreenDisplayAction,I=e.Enums.ScreenFeaturesByPriority,A=e.sdpParser,R=e.UserToUserHandlerSingleton,f=e.Utils,_=e.WebRTCAdapter,v=Object.values(e.Enums.VideoResolutionLevel);return e.CircuitCallControlSvcImpl=function(g,N,m,h,O,D,P,y,b,U,L,M){var w=e.Conversation,G=e.UserProfile;D.debug("New Service: CircuitCallControlSvc"),T.isCMR=g.isCMR;var k=function(){},H=this,V=r.getInstance(),B=R.getInstance(),F=f.isMobile(),x=!!h.cordova,W=[],K=null,Y=null,q=[],j=[],Q=null,z=!1,X=!1,J={},$=null,Z=!1,ee=!1,te={},ne=null,ie=null,re=null,oe=null,ae=null,se=null,ce=null,le=[o.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,o.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,o.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];function de(e){return b.getConversationAsGuestById(e)||b.getConversationFromCache(e)}function ue(){if(ie){var e=1e3*(ie.ttl||0);e=Math.max(e-6e4,0),ie.expirationTimestamp=Date.now()+e}}function Ee(t){if(t.audio=!!t.audio,t.video=!!t.video,t.desktop=!!t.desktop,g.isCMR)return t.hdVideo=t.video,t.minFrameRate=30,t.desktop=!1,void(t.hdDesktop=!1);if(t.video||(t.hdVideo=!1),t.desktop||(t.hdDesktop=!1),!e.isSDK&&(t.video||t.desktop)){var n=!(!F&&g.localUser.isICMixedUser&&!g.isICMode);t.video&&(t.hdVideo=!!(g.localUser.canUseHDVideo&&("boolean"==typeof t.hdVideo?t.hdVideo:n))),t.desktop&&(t.hdDesktop=!!(g.localUser.canUseHDScreenShare&&("boolean"==typeof t.hdDesktop?t.hdDesktop:n)))}}function Ce(e){return new O((function(t,n){var i=ie&&ie.expirationTimestamp||0;if(Date.now()<i){var r=new Date(i);return D.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+r),void t(ie)}D.debug("[CircuitCallControlSvc]: Get new TURN credentials");var a=M.createActionInfo(e,o.RtcDiagnosticsAction.RENEW_TURN_CREDENTIALS);V.renewTurnCredentials(e.callId,(function(i,r){g.$apply((function(){return a&&(a.data=JSON.stringify(r),M.finishActionInfo(e,a)),i?(D.error("[CircuitCallControlSvc]: Error renewing TURN credentials.",i),void n(i)):r&&r.length?(r=r[0],D.info("[CircuitCallControlSvc]: Received new TURN credentials=",r.turnServer),ie=r,ue(),void t(ie)):(D.error("[CircuitCallControlSvc]: Error renewing TURN credentials. No server(s) available."),void n("No TURN server(s) available"))}))}))}))}function Te(e){if(e){if(e.startsWith("res_"))return e;if(e===o.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(e===o.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(e===o.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(e===o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return e;if(e===o.ReturnCode.DISCONNECTED||e===o.ReturnCode.FAILED_TO_SEND)return"res_NotConnectedTryAgain"}return"res_JoinRTCSessionFailed"}function pe(e){return e.some((function(e){return e.isMeetingPointInvitee}))}function Se(){return K&&K.isMocked&&!K.isDirect&&K.participants.length>1}function Ie(){!$&&Se()&&($=m((function(){D.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),Se()?K.isEstablished()&&function(){if(f.randomBoolean()){var e=K.participants.filter((function(e){return e.pcState===s.ParticipantState.Active}));if(!(e.length<2)){e.push(g.localUser);var t={sessionId:K.callId},n=["first","second","third"],i=f.randomNumber(0,3),r=f.randomArrayCopy(e,i);-1===r.indexOf(e[0])&&f.randomBoolean()&&(r.unshift(e[0]),i<3&&i++);for(var o=0;o<i;o++)t[n[o]]=r[o].userId;D.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",t),Mt(t)}}}():(D.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),m.cancel($),$=null)}),2e3,0,!1))}function Ae(e,t){if(!e.checkState(s.CallState.Ringing)||(j.push(e),!t)){for(var n=0;n<W.length;n++)if(e.sameAs(W[n]))return D.debug("[CircuitCallControlSvc]: Updating call with callId = "+e.callId),void(W[n]=e);W.push(e),e===K&&Ie(),g.localUser.isOsBizCTIEnabled&&e.isTelephonyCall&&!e.isRemote&&K&&e!==K&&(Y=e),Q=null}}function Re(e){return!!e&&(g.localUser.remoteControlEnabled||g.isSessionGuest)}function fe(e){var t;for(t=0;t<W.length;t++)if(e.sameAs(W[t])){W.splice(t,1);break}for(t=0;t<j.length;t++)if(e.sameAs(j[t])&&!e.isHandoverInProgress){j.splice(t,1);break}for(t=0;t<q.length;t++)if(e.sameAs(q[t])){q.splice(t,1);break}e.isRemote?Q=null:(z=e.sessionCtrl&&e.sessionCtrl.isMuted(),Q=e,N((function(){Q===e&&(Q=null)}),3200))}function _e(e){e&&(D.debug("[CircuitCallControlSvc]: Publish /conversation/update event. convId = ",e.convId),P.publish("/conversation/update",[e]))}function ve(e,t){e&&e.state!==s.CallState.Terminated&&(D.debug("[CircuitCallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),P.publish("/call/state",t?[e,t]:[e]))}function ge(e,t){e&&(D.debug("[CircuitCallControlSvc]: Publish /call/rtp/iceConnectionState event. callId = "+e.callId+", iceState = "+t),P.publish("/call/rtp/iceConnectionState",[e.callId,t]))}function Ne(e,t,n){if(e){D.info("[CircuitCallControlSvc]: Terminating call...");var i=function(e){if(K&&K.sameAs(e)){var t=H.getIncomingCall();return!!(t&&t.replaces&&t.replaces.sameAs(e))}return!!(K&&K.replaces&&K.replaces.sameAs(e))}(e);se&&se.callId===e.callId&&se.cancel(),qt(e),e.isRemote||(t&&(e.terminateReason=t,function(e){switch(e){case s.CallClientTerminatedReason.DISCONNECTED:case s.CallClientTerminatedReason.FAILED_TO_SEND:case s.CallClientTerminatedReason.REQUEST_TIMEOUT:return!0;default:return!1}}(t)&&function(e){if(!e)return;var t="";switch(e.terminateReason){case s.CallClientTerminatedReason.DISCONNECTED:t=o.RtcClientInfoReason.DISCONNECTED;break;case s.CallClientTerminatedReason.FAILED_TO_SEND:t=o.RtcClientInfoReason.FAILED_TO_SEND;break;case s.CallClientTerminatedReason.REQUEST_TIMEOUT:t=o.RtcClientInfoReason.REQUEST_TIMEOUT;break;default:return}var n={userId:g.localUser.userId,convId:e.convId,clientInfoType:o.RtcClientInfoType.OFFLINE_JOIN_FAILURE,reason:t,timestamp:Date.now(),sessionId:e.callId},i=b.getConversationByRtcSession(e.callId);i&&i.call&&i.call.instanceId&&(n.instanceId=i.call.instanceId);D.info("[CircuitCallControlSvc]: Store new offline join failure. ",n),M.storeClientInfo(n)}(e)),M.forceFinishDeviceDiagnostics(e)),e.screenShareEventHandler&&(p.unregEvtHandlers(e.screenShareEventHandler),e.screenShareEventHandler=null),e.rejectGetScreenPromise&&(e.rejectGetScreenPromise(o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED),e.rejectGetScreenPromise=null),e.isOsBizSecondCall||function(e){var t=e&&e.sessionCtrl;t&&(t.onIceCandidate=null,t.onSessionDescription=null,t.sessionClosed=null,t.onSdpConnected=null,t.onIceConnected=null,t.onIceDisconnected=null,t.onRemoteVideoAdded=null,t.onRemoteVideoRemoved=null,t.onRemoteStreamUpdated=null,t.onDTMFToneChange=null,t.onRtcError=null,t.onRtcWarning=null,t.onLocalStreamEnded=null,t.onStatsThresholdExceeded=null,t.onStatsNoOutgoingPackets=null,t.onNetworkQuality=null)}(e),fe(e),e.terminate(),g.closePopoutCallStage&&g.closePopoutCallStage(e),K&&K.sameAs(e)?(N.cancel(K.terminateTimer),K=Y,Y=null):Y&&Y.sameAs(e)&&(N.cancel(Y.terminateTimer),Y=null);var r=de(e.convId);if(r&&r.call&&r.call.sameAs(e)&&!e.isHandoverInProgress){if(e.isTelephonyCall){var a=De()||Pe();r.call=a||null}else r.call=null;_e(r)}$&&!K&&(m.cancel($),$=null),n||(D.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",i),P.publish("/call/ended",[e,i]),e.ratingEvent&&pt(e.ratingEvent))}}function me(e){return K&&K.callId===e?K:Y&&Y.callId===e?Y:null}function he(e){var t;for(t=0;t<W.length;t++)if(W[t].callId===e)return W[t];for(t=0;t<j.length;t++)if(j[t].callId===e)return j[t];var n=b.getConversationByRtcSession(e);return n&&n.call&&!n.call.isAtcRemote&&n.call.state.established&&n.call.callId===e?(W.push(n.call),n.call):me(e)}function Oe(e,t){if(e.participantType===o.RTCParticipantType.TELEPHONY&&e.phoneNumber){var n=K.getParticipant(e.userId);if(n&&n.phoneNumber&&n.phoneNumber===e.phoneNumber)return;y.startReverseLookUp(e.phoneNumber,(function(n){if(t.isPresent()&&n){var i=K.getParticipant(e.userId);i&&(i.firstName=n.firstName,i.lastName=n.lastName,i.displayName=n.displayName,i.resolvedUserId=n.userId,D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",i.userId),P.publish("/call/participant/updated",[K.callId,i]))}}))}}function De(e){return W.find((function(t){return t.isTelephonyCall&&t.state.established&&!t.isHolding()&&(!e||!t.isRemote)}))||null}function Pe(e){return W.find((function(t){return t.isTelephonyCall&&t.state.established&&t.isHolding()&&(!e||!t.isRemote)}))||null}function ye(){return!g.localUser.selectedBusyHandlingOption||g.localUser.selectedBusyHandlingOption===i.DefaultRouting.name||g.localUser.isSTC}function be(e,t,n,i,r,o){if(e.atcCallInfo&&(!n&&e.atcCallInfo.peerFQN?n=e.atcCallInfo.peerFQN:n&&!e.atcCallInfo.peerFQN&&(e.atcCallInfo.peerFQN=n)),n&&e.peerUser&&e.peerUser.fqnLookedUp===n)o&&o();else if(e.setPeerUser(t,i,r),!r&&n){var a=null;o&&(a=N((function(){a=null,e.isPresent()&&(o(),o=null)}),2e3)),y.startReverseLookUp(n,(function(i){N.cancel(a),e.isPresent()&&(i?(e.setPeerUser(t,i.displayName,i.userId,n),o?o():ve(e)):o&&o())}))}else o&&o()}function Ue(e,t){var n,i=!e.participantType||e.participantType===o.RTCParticipantType.USER||e.participantType===o.RTCParticipantType.MEETING_POINT;if(e.userId===g.localUser.userId?n=g.localUser:i&&(n=y.getUserFromCache(e.userId)),!n){e.userDisplayName=e.userDisplayName||e.phoneNumber||g.i18n.map.res_Unknown;var r=e.userDisplayName.split(" ");e.participantType===o.RTCParticipantType.MEETING_POINT?(e.lastName=r[0],e.location=r.splice(1).join(" ").trim().slice(1,-1)):(e.firstName=r[0],e.lastName=r.splice(1).join(" ")),i?(n=G.extend({userId:e.userId,firstName:e.firstName,lastName:e.lastName,displayName:e.userDisplayName,location:e.location,userType:e.participantType===o.RTCParticipantType.MEETING_POINT?o.UserType.MEETING_POINT:o.UserType.REGULAR}),e.isSimulated?n.isSimulated=!0:(n.noData=!0,y.addUsersToCache(n,!0,!1))):(e.participantType===o.RTCParticipantType.SESSION_GUEST&&(e.userType=o.UserType.SESSION_GUEST),n=G.extend(e))}var a=C.createFromUser(n,s.ParticipantState.Active);return a.apiDisplayName=e.userDisplayName||e.phoneNumber,a.streamId=e.videoStreamId||"",a.screenStreamId=e.screenStreamId||"",a.mediaType=l.getMediaType(e.mediaTypes||t),a.muted=e.muted||!a.mediaType.audio,a.participantType=e.participantType||o.RTCParticipantType.USER,a.screenSharePointerSupported=!!e.screenSharePointerSupported,a.isModerator=!!e.isModerator,a.isMeetingGuest=e.isMeetingGuest,a.rtcSupportedFeatures=e.rtcSupportedFeatures||[],a.flags=e.flags||[],a.videoPointerTo=e.videoPointerTo,a}function Le(e,t){if(t&&t.length){var n=J[e];n?n.turnServers=t:J[e]={turnServers:t}}}function Me(e){switch(e){case o.ReturnCode.DISCONNECTED:return s.CallClientTerminatedReason.DISCONNECTED;case o.ReturnCode.FAILED_TO_SEND:return s.CallClientTerminatedReason.FAILED_TO_SEND;case o.ReturnCode.REQUEST_TIMEOUT:return s.CallClientTerminatedReason.REQUEST_TIMEOUT;default:return s.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED}}function we(e,t){e&&(D.debug("[CircuitCallControlSvc]: New call has been terminated during call setup. Call Id:",e.callId),e.callState!==s.CallState.Terminated&&Ne(e,s.CallClientTerminatedReason.USER_ENDED),t&&t("Call already terminated"))}function Ge(e,t,n,i){if(!Xt(e,n,i))return!1;K&&(Y=K);var r={clientId:V.clientId,isSessionGuest:g.isSessionGuest,midMappingEnabled:Ct(),isSTC:g.localUser.isSTC&&e.isTelephony,stcCapabilities:e.isTelephony?g.localUser.stcCapabilities:[],canReceiveHdVideo:g.localUser.canUseHDVideo||g.localUser.canUseHDScreenShare};if(n.replaces&&t.desktop&&(r.reuseDesktopStreamFrom=n.replaces.sessionCtrl),(K=new c(e,r)).setState(s.CallState.Initiated),K.pickUpFromUser=n.pickUpFromUser,K.pickUpUserId=n.pickUpUserId,Ae(K),function(e,t,n){e&&e.isRemote&&!e.isAtcRemote&&(D.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),n.handover&&(K.activeClient=e.activeClient,e.isTelephonyCall&&(e.atcCallInfo&&(K.atcCallInfo=e.atcCallInfo,K.setPosition(s.Targets.WebRTC)),be(K,e.peerUser.phoneNumber,null,e.peerUser.displayName),K.participants=e.participants),t.call=K),K.hadRemoteCall=!0,e.isTelephonyCall||Ne(e))}(e.call,e,n),K.setCallIdForTelephony(n.callId),K.setTransactionId(),(X||e.isTelephony)&&(D.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),K.disableRemoteVideo()),K.direction=s.CallDirection.OUTGOING,K.mediaType=t,n.replaces){K.replaces=n.replaces;var o=n.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.DESKTOP);o&&(D.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.replaces.callId),K.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,o),n.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,null)),(o=n.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO))&&(D.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",n.replaces.callId),K.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,o),n.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(n.joiningGroupCall&&(K.isJoiningGroupCall=!0),n.callOut&&(K.setPeerUsersAsParticipants(),K.isCallOut=!0),K.isTelephonyCall)if(n.handover){var a=$e(K.callId);a&&(K.atcCallInfo=a.atcCallInfo,a.isAtcConferenceCall()||be(K,a.peerUser.phoneNumber,null,a.peerUser.displayName),Ne(a)),K.handover=!0}else be(K,n.dialedDn,null,n.toName,n.userId),n.dtmfDigits&&(K.dtmfDigits=n.dtmfDigits);return ve(K),e.call&&e.call.isRemote&&n.handover||K.conferenceCall||(D.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),P.publish("/call/outgoing",[K])),K.isNewSession=!e.call||e.call!==K&&!n.handover,e.call=K,_e(e),!0}function ke(e,t){var n=Ct()?[o.RtcSupportedFeatures.MID_STREAM_MAPPING]:[];return e.isDirect&&n.push(o.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE),Re(e)&&!f.isMobile()&&(t&&t.mediaType&&t.mediaType.desktop?t.screenShareOptions&&t.screenShareOptions.screenControlSupported&&n.push(o.RtcSupportedFeatures.SCREEN_CONTROL):g.localUser.canStartScreenControl&&n.push(o.RtcSupportedFeatures.SCREEN_CONTROLLER)),Et(e)&&n.push(o.RtcSupportedFeatures.SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO),e.isDirect&&e.checkState(s.CallState.Initiated)&&n.push(o.RtcSupportedFeatures.CALL_PICKUP),n}function He(t,n,i,r){if(!K)return r(Te()),void D.error("[CircuitCallControlSvc]: joinSession failed because there's no local call");r=r||k,D.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",i.callId||t.rtcSessionId);var a=K,l=K.sessionCtrl,d=function(e){if(l.onSessionDescription=null,l.onClosed=null,K===a){K.mediaType=l.getMediaConstraints();var n={convId:t.convId,rtcSessionId:K.callId||t.rtcSessionId,ownerId:t.creatorId,sdp:e.sdp,mediaType:K.mediaType,callOut:i.callOut,handover:i.handover,sendInviteCancel:!i.callOut,replaces:i.replaces&&i.replaces.callId,isTelephonyConversation:K.isTelephonyCall,displayName:g.localUser.displayName,transactionId:K.transactionId,screenSharePointerSupported:!(!K.pointer||!K.pointer.isEnabled),rtcSupportedFeatures:ke(K),pickUpSession:i.pickUpSession};K.isTelephonyCall&&(n.fromDn=f.cleanPhoneNumber(g.localUser.callerId),n.fromName=g.localUser.displayName,n.fromUserId=g.localUser.userId,n.dialedDn=f.cleanPhoneNumber(i.dialedDn),n.toName=i.toName,n.toUserId=i.userId,n.noCallLog=g.localUser.noCallLog),t.isTemporary&&t.guestToken&&(n.guestToken=t.guestToken),g.localUser.hasTelephonyRole&&(n.fromName="Gru",n.fromDn="+19998455246");var s=M.createActionInfo(K,o.RtcDiagnosticsAction.JOIN);s&&(s.data=JSON.stringify(n.sdp)),V.joinRtcCall(n,(function(e){g.$apply((function(){if(M.finishActionInfo(K,s),K===a)if(e){var t=K.replaces,n=Me(e);K.hadRemoteCall?H.endCallWithCauseCode(K.callId,n):Ne(K,n),t&&(K=t),r(Te(e))}else D.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),K.conferenceCall&&(D.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),P.publish("/conference/participant/joining",[K])),r(null,i.warning,K);else we(a,r)}))}))}else we(a,r)},u=function(e){if(K===a){var t=Me(e);if(D.warn("[CircuitCallControlSvc]: Failed to initiate call. ",e),i.handover)Ne(K,t);else if(K.setDisconnectCause(o.DisconnectCause.CALL_SETUP_FAILED,e),K.hadRemoteCall)H.endCallWithCauseCode(K.callId,t);else{var n=K.isDirect?"terminateRtcCall":"leaveRtcCall";V[n](K.callId,K.disconnectCause,(function(e){e&&D.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e)})),Ne(K,t)}r(Te(e))}else we(a,r)},E=function(){l.onClosed=null,l.onSessionDescription=null,a&&a.state===s.CallState.Initiated&&a.terminateReason===s.CallClientTerminatedReason.USER_ENDED?r&&r():r&&r(Te())};(K.isNewSession?function(t,n,i){return new O((function(r,a){var s={convId:t.convId,rtcSessionId:n.callId,ownerId:t.creatorId,mediaNode:n.getMediaNode(),isTelephonyConversation:t.isTelephony,replaces:i.replaces&&i.replaces.callId,desiredRegion:i.desiredRegion};M.startDiagnostics(n),n.isDirect||M.startJoinDelayTimer(n);var l=M.createActionInfo(n,o.RtcDiagnosticsAction.PREPARE);V.prepareSession(s,(function(t,i,s){g.$apply((function(){if(l&&(l.data=t?t.toString():JSON.stringify(i),M.finishActionInfo(n,l)),t)return t===o.ErrorCode.RTC_CONCURRENT_INCOMING_CALL?D.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."):t===o.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE?D.error("[CircuitCallControlSvc]: No media nodes available, call not possible."):t===o.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE?D.error("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."):D.error("[CircuitCallControlSvc]: Error retrieving start session data. ",t),void a(t);if(!i||!i.length)return D.error("[CircuitCallControlSvc]: Error getting TURN credentials. No server(s) available."),void a("No TURN server(s) available");if(D.info("[CircuitCallControlSvc]: Received new TURN credentials"),i=i[0],ie=i,ue(),n.isTelephonyCall&&s&&s!==n.callId){var d=de(n.convId);if(d&&(f.isMobile()||e.isSDK)){n.setCallIdForTelephony(s);var u=new c(d,{clientId:n.clientId});d.call=u,u.terminate(),D.debug("[CircuitCallControlSvc]: Publish /call/ended event"),P.publish("/call/ended",[u,!0]),d.call=n,_e(d),D.debug("[CircuitCallControlSvc]: Publish /call/moved event"),P.publish("/call/moved",[u.callId,n.callId]),ve(n)}else{var E=n.callId;n.setCallIdForTelephony(s),ve(n,E)}}r(ie)}))}))}))}(t,K,i):Ce(K)).then((function(e){e&&(Le(t.rtcSessionId,e.turnServer),l.setTurnUris(e.turnServer),l.setTurnCredentials(e)),function e(){Ee(n),l.warmup(n,null,(function(){K===a?g.$apply((function(){D.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),l.onSessionDescription=d,l.onClosed=E,It(K),l.start(n,null)})):we(a,r)}),(function(t){if(n.audio&&(n.video||n.hdVideo))return D.info("[CircuitCallControlSvc]: Fetching audio and video media failed, trying again without video"),n.video=!1,n.hdVideo=!1,void e();g.$apply(u.bind(null,t))}),i.screenShareOptions)}()})).catch(u)}function Ve(e){Ye(e,(function(e){e?D.error("[CircuitCallControlSvc]: Failed to stop the screen control. ",e):D.debug("[CircuitCallControlSvc]: Successfully stopped screen control")}))}function Be(e,t){D.info("[CircuitCallControlSvc]: changeMediaType - data: ",e);var n=me(e.callId);if(!n)return D.warn("[CircuitCallControlSvc]: changeMediaType - Cannot find local call"),void t("No active call");if(!n.isEstablished())return D.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void t("Call not established");var i=n.sessionCtrl;if(i.isConnStable()){var r=function(r){e.dontReuseAudioStream&&(i.dontReuseAudioStream=!1),P.publish("/call/changeMediaType/completed",[n,r]),t(r)};P.publish("/call/changeMediaType/started",[n,e]),i.dontReuseAudioStream=e.dontReuseAudioStream;var o=function(t){i.onSessionDescription=null,n.setTransactionId(e.transactionId);var o={rtcSessionId:n.callId,sdp:t.sdp,mediaType:e.mediaType,transactionId:n.transactionId,screenSharePointerSupported:!(!n.pointer||!n.pointer.isEnabled),hosted:e.hosted,replaces:e.replaces,rtcSupportedFeatures:ke(n,e),videoPointerTo:void 0===e.videoPointerTo?n.videoPointerTo:e.videoPointerTo};V.changeMediaType(o,(function(e){g.$apply((function(){n.clearTransactionId(),e?(i.renegotiationFailed(e),r(e)):D.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")}))}))},a=n.localMediaType.desktop;Ce(n).then((function(t){if(i.setTurnUris(t.turnServer),i.setTurnCredentials(t),i.onSessionDescription=o,"boolean"==typeof e.hold){(e.hold?i.holdCall:i.retrieveCall)((function(e){e?(D.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),i.onSessionDescription=null,i.renegotiationFailed(e),r("Error in hold/retrieve media")):r()}))}else{n.lastMediaType=n.mediaType;var s={changeDesktopMedia:e.changeDesktopMedia,screenShareOptions:e.screenShareOptions,videoOptions:e.videoOptions,isDirectUpgradingToConf:!!(n.isDirect&&e.hosted&&e.replaces)};Ee(e.mediaType),i.changeMediaType(e.mediaType,s,(function(t){g.$apply((function(){if(t)D.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",t),i.onSessionDescription=null,i.renegotiationFailed(t),a&&!n.localMediaType.desktop&&i.updateScreenControlData(!1,!1),r(t||"Error changing media");else{var o=n.screenOwnerId===g.localUser.userId;a&&!n.localMediaType.desktop?(D.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),P.publish("/screenshare/ended"),n.pointer.isSupported=n.pointer.isEnabled=!1,o&&Ve(n.callId)):!o||!e.screenShareOptions||e.screenShareOptions.screenIndex===ae&&e.screenShareOptions.screenControlSupported||Ve(n.callId),ae=e.screenShareOptions&&e.screenShareOptions.screenIndex||null,r()}}))}))}})).catch((function(e){r(Te(e))}))}else t("Connection not stable")}function Fe(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: offerScreenControl - There is no local call"),void n("No active call");if(!t)return D.warn("[CircuitCallControlSvc]: offerScreenControl - controllerId was not provided"),void n("Controller not specified");var r=function(i){D.warn("[CircuitCallControlSvc]: offerScreenControl - Failed to offer screen control. ",i),H.rejectScreenControlRequest(e,t),n(i)};if(i.isEstablished())if(i.hasLocalScreenShare()&&Re(i)){var o=i.sessionCtrl;if(o.isConnStable()){o.onSessionDescription=function(e){if(o.onSessionDescription=null,e.sdp&&e.sdp.sdp&&e.sdp.sdp.includes("webrtc-datachannel")){i.screenOwnerId=g.localUser.userId,i.screenControllerId=t;var a={rtcSessionId:i.callId,sdp:e.sdp,controllerId:i.screenControllerId};V.offerScreenControl(a,(function(e){g.$apply((function(){e?(D.debug("[CircuitCallControlSvc]: Failed to offer screen control. ",e),n(e)):(D.debug("[CircuitCallControlSvc]: offerScreenControl was successful. Wait for the SCREEN_CONTROL_ACCEPTED event."),n())}))}))}else i.screenOwnerId=null,i.screenControllerId=null,r("Failed to create data channel")},Ce(i).then((function(e){o.setTurnUris(e.turnServer),o.setTurnCredentials(e),o.updateScreenControlData(!0,!0),o.offerScreenControl((function(e){e&&g.$apply((function(){D.warn("[CircuitCallControlSvc]: offerScreenControl failed - reason: ",e),o.onSessionDescription=null,o.updateScreenControlData(!1,!1),r(e)}))}))})).catch(r)}else r("Connection not stable")}else r("Screen control not possible");else r("Call not established")}function xe(e,t){var n=H.getActiveCall();n&&n.callId===e&&n.sessionCtrl.adaptScreenShareForRemoteControl(t)}function We(e,t,n,i){e.screenOwnerId=t,e.screenControllerId=n;var r=e.screenOwnerId===g.localUser.userId,o=r||e.screenControllerId===g.localUser.userId;e.screenOwner=null,e.screenController=null,r||n&&n!==g.localUser.userId?e.screenController=e.participants.find((function(t){return t.userId===e.screenControllerId})):o&&(e.screenOwner=e.participants.find((function(t){return t.userId===e.screenOwnerId}))),g.remoteControlActive=o,e.remoteControlActive=o,t||n||(e.preventScreenControlRequestInConf=!1),e.sessionCtrl.updateScreenControlData(o,r),i&&(D.debug("[CircuitCallControlSvc]: Publish /screenControl/updated event"),P.publish("/screenControl/updated",[e])),r?xe(e.callId,!0):o||xe(e.callId,!1)}function Ke(e,t){try{var n=me(e.sessionId);if(!n)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!n.isEstablished())return void D.info("[CircuitCallControlSvc]: The local call is not established");if(e.clientID&&V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);g.$apply((function(){var t;if(e.sdp){var i=e.sdp.type,r=n.sessionCtrl;if("offer"===i){We(n,e.ownerId,g.localUser.userId,!1);r.onSessionDescription=function(e){r.onSessionDescription=null;var t={rtcSessionId:n.callId,sdp:e.sdp,ownerId:n.screenOwnerId};V.acceptScreenControl(t,(function(e){g.$apply((function(){if(e)D.error("[CircuitCallControlSvc]: acceptScreenControl failed. ",e),We(n,null,null,!0);else{D.debug("[CircuitCallControlSvc]: acceptScreenControl was successful");var t=n.participants.find((function(e){return e.userId===n.screenOwnerId}));D.debug("[CircuitCallControlSvc]: Publish /screenControl/accepted event"),P.publish("/screenControl/accepted",[n,t])}}))}))}}else We(n,g.localUser.userId,n.screenControllerId,!1);Ce(n).then((function(t){r.setTurnUris(t.turnServer),r.setTurnCredentials(t),r.establishScreenControl(e.sdp,(function(e){e?g.$apply((function(){D.warn("[CircuitCallControlSvc]: Screen control event could not be processed - reason: ",e),r.onSessionDescription=null})):D.debug("[CircuitCallControlSvc]: Screen control event was successfully processed.")}))})).catch((function(e){D.error("[CircuitCallControlSvc]: getTurnCredentials error: ",e)}))}else t=n,V.rejectScreenControl({rtcSessionId:t.callId},(function(e){g.$apply((function(){e?D.error("[CircuitCallControlSvc]: rejectScreenControl sending error"):(D.debug("[CircuitCallControlSvc]: rejectScreenControl was successful."),We(t,null,null,!0))}))}))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling "+t+" event. ",e)}}function Ye(e,t,n){t=t||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: stopScreenControl - There is no local call"),void t("No active call");if(!i.isEstablished())return D.info("[CircuitCallControlSvc]: stopScreenControl - The local call is not established"),void t("Call not established");var r=i.sessionCtrl;r&&r.stopScreenControl((function(e){e?g.$apply((function(){D.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e),r.onSessionDescription=null,t(e)})):(We(i,null,null,!0),n||V.stopScreenControl({rtcSessionId:i.callId},(function(e){g.$apply((function(){e?t(e):(D.debug("[CircuitCallControlSvc]: stopScreenControl was successful."),t())}))})))}))}function qe(e,t,n,i,r){if(!e)return null;if(e.isTemporary&&!t&&!e.guestToken)return D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[e]),null;var o=new u(e);return o.setState(t?s.CallState.ActiveRemote:s.CallState.Started),n&&(n.instanceId&&o.setInstanceId(n.instanceId),o.screenOwnerId=n.screenOwnerId,o.screenControllerId=n.screenControllerId,n.hosted&&o.setDirectUpgradedToConf()),i&&o.setCallIdForTelephony(i),Ae(o),t&&(o.setActiveClient(t),et(o),n&&(1===n.participants.length&&n.callOut&&(o.pullNotAllowed=!0),o.mediaType=l.getMediaType(n.mediaTypes))),"function"==typeof r&&r(o),e.call=o,_e(e),ve(o),o}function je(e){if(e.isGuestInvite){fe(e);var t=de(e.convId);t&&t.isTemporary&&(D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[t]))}else e.setState(s.CallState.Started),e.activeClient=null,ve(e),q.some((function(t,n){return t.callId===e.callId&&(q.splice(n,1),!0)}))}function Qe(e){V.declineRtcCall({convId:e.convId,rtcSessionId:e.sessionId,cause:o.InviteRejectCause.BUSY,transactionId:e.transactionId})}function ze(e,t,n){var i=new c(e,{clientId:V.clientId,midMappingEnabled:Ct()});i.setInstanceId(t.instanceId),i.setTransactionId(t.transactionId),i.setState(s.CallState.Ringing),t.from&&be(i,t.from.phoneNumber,t.from.fullyQualifiedNumber,t.from.displayName,null,(function(){D.debug("atccall/firstcall"),P.publish(n?"/atccall/firstcall":"/atccall/secondcall",[i])}))}function Xe(e,t,n,i){if(i=i||k,fe(e=e||K),!e||e.state!==s.CallState.Ringing&&e.state!==s.CallState.Answering)return D.debug("[CircuitCallControlSvc]: call invalid to be declined"),void i("Call Invalid");D.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",e.callId);var r={convId:e.convId,rtcSessionId:e.callId,cause:t.type,transactionId:e.transactionId},o=[e];(t.err&&o.push(t.err),V.declineRtcCall(r,(function(e){g.$apply((function(){e?(D.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",e),i(e)):i()}))})),e.isDirect)||qe(de(e.convId));D.debug("[CircuitCallControlSvc]: Publish /call/declining event"),P.publish("/call/declining",o),Ne(e,t.type,n)}function Je(e,t,n,i,r){if(!(e=e||K))return D.debug("[CircuitCallControlSvc]: There is no local call"),void(r&&N(r));if(e.terminateTimer)return D.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(r&&N(r));if(r=r||k,e.checkState([s.CallState.Ringing,s.CallState.Answering]))Xe(e,{type:t||o.InviteRejectCause.DECLINE},!1,r);else{var a;if(D.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",e.callId),e.clearAtcHandoverInProgress(),e.activeClient)return qe(a=de(e.convId),e.activeClient,null,null,(function(e){K.isTelephonyCall&&(e.atcCallInfo=K.atcCallInfo,e.peerUser=K.peerUser)})),void Ne(e,n);if(e.isDirect)V.terminateRtcCall(e.callId,e.disconnectCause,(function(e){g.$apply((function(){e&&D.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e),r&&r(e)}))}),e.pickUpUserId||e.pickUpFromUser&&e.pickUpFromUser.userId);else{if(!e.isTestCall&&(a=de(e.convId))&&(e.participants.length||a.isTemporary||e.hadRemoteCall)){var c=qe(a);e.isDirectUpgradedToConf&&c.setDirectUpgradedToConf()}g.localUser.userId===e.screenOwnerId&&Ve(e.callId),V.leaveRtcCall(e.callId,e.disconnectCause,(function(e){g.$apply((function(){e&&D.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",e),r&&r(e)}))}))}n===s.CallClientTerminatedReason.PAGE_UNLOADED&&(e.terminateReason=n,e.qosSubmitted=!0,L.sendQOSData(e,e.mediaType,e.sessionCtrl.getLastSavedStats())),i||(e.directCall?(D.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),P.publish("/call/terminating",[K])):e.conferenceCall?(D.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),P.publish("/conference/leaving",[e])):(D.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),P.publish("/group/leaving",[e]))),e.outgoingFailed()?(e.terminateTimer=N((function(){e.terminateTimer=null,Ne(e,n)}),3200),e.terminateReason=n):Ne(e,n)}}function $e(e){return q.find((function(t){return t.callId===e}))||null}function Ze(e){return j.find((function(t){return t.callId===e}))||null}function et(e){q.some((function(t,n){return t===e||t.callId===e.callId&&(q[n]=e,!0)}))||q.push(e)}function tt(e,t){t.streamId&&(e.isMocked||e.participants.forEach((function(n){n.streamId===t.streamId&&n.userId!==t.userId&&(n.streamId="",D.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[n.userId,t.streamId]),K.setParticipantRemoteVideoStream(n),D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),P.publish("/call/participant/updated",[e.callId,n]))})))}function nt(e,t){var n=de(e.convId);g.isSessionGuest||t.setActions(n,g.localUser)}function it(e,t){var n=0;t&&t.flags&&(t.flags.includes(o.RTCSessionParticipantFlag.CPU_LOAD)?n=2:t.flags.includes(o.RTCSessionParticipantFlag.CPU_LOAD_TRANSCODE)&&(n=1)),n>(e.vrsOverloadLevel||0)&&(e.vrsOverloadLevel=n,D.debug("[CircuitCallControlSvc]: Publish /call/vrsOverloadLevelChanged event. userId =",t.userId+", level = "+n),P.publish("/call/vrsOverloadLevelChanged",[e,t]))}function rt(e,t,n,i){var r=e.addParticipant(t,n,i);return r&&(tt(e,r),nt(e,r),it(e,r),t.noData&&!t.reqPending&&(D.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",t.userId),y.getUserById(t.userId,(function(n,i){i&&(D.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",t.userId),e.isPresent()&&e.hasParticipant(t.userId)&&(t.firstName=i.firstName,t.lastName=i.lastName,D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",t.userId),P.publish("/call/participant/updated",[e.callId,t])))})))),r}function ot(e,t,n){var i=e.updateParticipant(t,n);return i&&(tt(e,i),nt(e,i),it(e,i)),i}function at(e,t,n){var i=s.ParticipantState.Terminated;switch(n){case o.RTCSessionParticipantLeftCause.CONNECTION_LOST:case o.RTCSessionParticipantLeftCause.STREAM_LOST:i=s.ParticipantState.ConnectionLost;break;case o.RTCSessionParticipantLeftCause.REMOVED:i=s.ParticipantState.Removed;break;case o.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:i=s.ParticipantState.OffStage}e.setParticipantState(t,i);var r=e.removeParticipant(t);if(!e.hasOtherParticipants()){if(!e.conferenceCall)return D.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),P.publish("/group/terminated",[e]),void Je(e,null,s.CallClientTerminatedReason.NO_USERS_LEFT,!0);e.setState(s.CallState.Waiting)}if(r){e.updateMediaType(),!e.isRemote&&r.isCMP&&r.isMeetingPointInvitee&&!pe(e.participants)&&(e.setMeetingPointInviteState(!1),H.enableRemoteAudio(e.callId)),e.conferenceCall&&(D.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),P.publish("/conference/participant/left",[e,n]));var a=n?{leftCause:n}:null;D.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),P.publish("/call/participant/removed",[e.callId,r,a])}ve(e)}function st(e,t){if(e&&t&&t.state&&t.state!==o.RecordingInfoState.INITIAL&&(t.recordingMediaTypes&&t.recordingMediaTypes.includes(o.RecordingMediaType.TEXT)&&(e.transcription.state=t.state,D.debug("[CircuitCallControlSvc]: Publish /call/transcription/info event"),P.publish("/call/transcription/info",[e])),!t.recordingMediaTypes||t.recordingMediaTypes.includes(o.RealtimeMediaType.AUDIO)||t.recordingMediaTypes.includes(o.RealtimeMediaType.VIDEO))){if(function(e,t){e.recordingMediaTypes=t.recordingMediaTypes,e.state!==t.state?(e.notifyByCurtain=t.state===o.RecordingInfoState.START_PENDING||t.state===o.RecordingInfoState.STARTED&&e.state===o.RecordingInfoState.START_PENDING,e.notifyByUser=!e.notifyByCurtain||t.state===o.RecordingInfoState.START_PENDING&&e.state!==o.RecordingInfoState.STARTED):(e.notifyByCurtain=!1,e.notifyByUser=!1);e.state=t.state,e.duration=t.duration||e.duration,e.reason=t.reason,e.recordingUserId=null,e.recordingUser=null,t.state===o.RecordingInfoState.STARTED&&(e.resumeTime=Date.now(),t.layout&&t.layout.layoutMapping&&t.layout.layoutMapping.length&&t.layout.layoutName===o.RecordingVideoLayoutName.SINGLE_VIDEO&&(e.recordingUserId=t.layout.layoutMapping[0].tileContent));t.starter&&t.starter.userId&&t.starter.userId!==e.starter.userId&&(e.starter=t.starter,e.starter.userId===g.localUser.userId?e.starter.res="res_StartedRecording_You":(e.starter.name=e.starter.displayName,e.starter.res=e.starter.name?"res_StartedRecording_Other":"res_StartedRecording"))}(e.recording,t),e.recording.recordingUserId&&(e.recording.recordingUser=e.getParticipant(e.recording.recordingUserId),!e.recording.recordingUser))return void y.getUserById(e.recording.recordingUserId,(function(t,n){n&&!t?(e.recording.recordingUser=n,D.debug("[CircuitCallControlSvc]: User info retrieved. Publish /call/recording/info event"),P.publish("/call/recording/info",[e])):D.error("[CircuitCallControlSvc]: Cannot retrieve recording user data.",t||"")}));D.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),P.publish("/call/recording/info",[e])}}function ct(e){K&&void 0!==e&&K.attendeeCount!==e&&(K.attendeeCount=e,K.updateCallState(),D.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),P.publish("/call/attendeeCountChanged",[K.callId,K.attendeeCount]))}function lt(e,t){return new O((function(n,i){e&&!e.screenShareEventHandler?e.isVdi?n({}):(e.screenShareEventHandler=p.getScreen((function(t){N((function(){e.screenShareEventHandler=null,e.rejectGetScreenPromise=null,n(t||{})}),0)}),(function(t){N((function(){e.screenShareEventHandler=null,e.rejectGetScreenPromise=null,t===o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?i(t):i("res_AccessToDesktopFailed")}),0)}),t),e.rejectGetScreenPromise=function(t){D.warn("[CircuitCallControlSvc]: Cancelling getScreen promise for call ID: ",e.callId),i(t)}):i("res_ErrorMsgInternal")}))}function dt(t){return new O((function(n,i){var r=new T({disableTrickleIce:!0,isDirectCall:!0,candidatesCollectionTest:!0}),o=function(){D.debug("[CircuitCallControlSvc]: Terminate ICE candidates collection test"),r.onSessionDescription=null,r.onRtcError=null,r.terminate()};t&&(r.setTurnUris(t.turnServer),r.setTurnCredentials(t)),r.disableRemoteVideo(),r.onSessionDescription=function(i){var r=e.sdpParser.getIceCandidates(i.sdp.sdp);D.debug("[CircuitCallControlSvc]: testIceCandidates - candidates: ",r),o(),n({turnServers:t&&t.turnServer||[],candidates:r})},r.onRtcError=function(e){D.error("[CircuitCallControlSvc]: Error collecting candidates. ",e.error),o(),i(e.error)},D.debug("[CircuitCallControlSvc]: testIceCandidates - Start collection"),r.start({audio:!1})}))}function ut(e,t){if(e&&e.replaces){var n=he(e.replaces.callId);n&&(g.localUser.userId===n.screenOwnerId&&(e.restartScreenControlSession=!0,e.screenControllerId=n.screenControllerId),t&&Je(n,null,s.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV)),D.debug("[CircuitCallControlSvc]: Publish /call/moved event"),P.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null,ve(e)}}function Et(e){return!(!g.isCMR&&(e&&e.isDirect||f.isMobile()))}function Ct(){return _.unifiedPlanEnabled||"firefox"===_.browser}function Tt(e){return!!v.includes(e)||(D.error("[CircuitCallControlSvc]: Invalid video resolution: ",e),!1)}function pt(e){D.debug("[CircuitCallControlSvc]: Publish /call/showRatingDialog event"),P.publish("/call/showRatingDialog",[e])}function St(e,t){if(D.debug("[CircuitCallControlSvc]: handleRtcError: ",t.error),"res_RemoteControlSessionStopped"===t.error)return Ve(e.callId),void P.publish("/screenControl/terminated",[e]);(P.publish("/call/rtcError",[e,t.error]),e.checkState([s.CallState.Ringing,s.CallState.Answering]))?Xe(e,{type:!g.isCMR||"res_AccessToMediaInputDevicesFailed"!==t.error&&"res_AccessToAudioInputDeviceFailed"!==t.error?o.InviteRejectCause.BUSY:o.InviteRejectCause.TEMPORARILY_UNAVAILABLE}):e.sameAs(K)&&("res_CallMediaFailed"===t.error?(e.setDisconnectCause(o.DisconnectCause.NEGOTIATION_FAILED),H.endCallWithCauseCode(e.callId,s.CallClientTerminatedReason.ICE_TIMED_OUT)):"res_CallMediaDisconnected"===t.error?(e.setDisconnectCause(o.DisconnectCause.STREAM_LOST),H.endCallWithCauseCode(e.callId,s.CallClientTerminatedReason.LOST_MEDIA_STREAM),V.pingServer()):e.isEstablished()||H.endCall(e.callId))}function It(e){var t=e&&e.sessionCtrl;t?(t.onIceCandidate=At.bind(null,e),t.onSdpConnected=Rt.bind(null,e),t.onIceConnected=ft.bind(null,e),t.onIceDisconnected=_t.bind(null,e),t.onRemoteVideoAdded=vt.bind(null,e),t.onRemoteVideoRemoved=gt.bind(null,e),t.onRemoteStreamUpdated=Nt.bind(null,e),t.onDTMFToneChange=mt.bind(null,e),t.onRtcError=ht.bind(null,e),t.onRtcWarning=Ot.bind(null,e),t.onLocalStreamEnded=Dt.bind(null,e),t.onQosAvailable=Pt.bind(null,e),t.onStatsThresholdExceeded=yt.bind(null,e),t.onStatsNoOutgoingPackets=bt.bind(null,e),t.onNetworkQuality=Ut.bind(null,e),t.onGetUserMediaException=Lt.bind(null,e)):D.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",e)}function At(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var n={rtcSessionId:e.callId,userId:g.localUser.userId,origin:t.origin,candidates:t.candidates.map(JSON.stringify.bind(JSON))},i=M.createActionInfo(e,o.RtcDiagnosticsAction.ICE_CANDIDATES);i&&(i.data=n.candidates,i.isEndOfCandidates=t.endOfCandidates),V.sendIceCandidates(n,(function(t){M.finishActionInfo(e,i),t&&D.warn("Failed to send ICE candidate: ",t)}))}function Rt(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),P.publish("/call/sdpConnected",[e]);var n=M.createActionInfo(e,o.RtcDiagnosticsAction.SDP_CONNECTED);M.finishActionInfo(e,n),e.isTelephonyCall?(e.state.established||e.setState(s.CallState.Waiting),e.updateCallState()):e.isDirect&&e.setState(s.CallState.Active),e.sdpOrigin=t.sdpOrigin,ve(e),M.finishDeviceDiagnostics(e),e.instanceId?(D.debug("[CircuitCallControlSvc]: InstanceId is available. Send call connected diagnostics data."),M.sendCallConnected(e)):(D.debug("[CircuitCallControlSvc]: InstanceId is not available. Postpone sending call connected diagnostics data."),e.callConnectedPostponed=!0)}))}function ft(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onIceConnected. pcType:",t.pcType),g.$apply((function(){"audio/video"===t.pcType?(e.isEstablished()&&e.disconnectCause&&e.disconnectCause.cause===o.DisconnectCause.STREAM_LOST&&(e.disconnectCause=null),ge(e,"connected")):"screen control"===t.pcType&&We(e,e.screenOwnerId,e.screenControllerId,!0)}))}function _t(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onIceDisconnected. pcType:",t.pcType),g.$apply((function(){"audio/video"===t.pcType&&e.isEstablished()&&!e.isHeld()?(e.setDisconnectCause(o.DisconnectCause.STREAM_LOST),ge(e,"disconnected")):"screen control"===t.pcType&&(Ye(e.callId),We(e,null,null,!0))}))}function vt(){D.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}function gt(){D.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}function Nt(e){D.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),P.publish("/call/remoteStreamUpdated",[e])}))}function mt(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),g.$apply((function(){t.tone?(D.debug("[CircuitCallControlSvc]: Sent DTMF Digit"),P.publish("/call/singleDigitSent",[e,t.tone])):""===t.tone&&(D.info("[CircuitCallControlSvc]: Digits played completely"),P.publish("/call/digitsSent",[e]))}))}function ht(e,t){g.$apply((function(){St(e,t)}))}function Ot(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),g.$apply((function(){P.publish("/call/rtcWarning",[e,t.warning])}))}function Dt(e,t){if(D.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),t.isDesktop&&K.hasLocalScreenShare())D.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),K.isEstablished()?H.removeScreenShare(K.callId):H.endCall(K.callId);else{if(ce)return;ce=N((function(){ce=null,H.renegotiateMedia(e.callId,(function(t){t&&g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),P.publish("/call/localStreamEnded",[e])}))}))}),500,!1)}}function Pt(e,t){if(D.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),t.renegotiationInProgress&&(e.terminateReason=s.CallClientTerminatedReason.MEDIA_RENEGOTIATION),e.sessionCtrl){if(e.qosSubmitted)return void D.info("[CircuitCallControlSvc]: QoS already submitted for call Id:",e.callId);L.sendQOSData(e,e.lastMediaType,t.qos,t.lastSavedStats,t.streamQualityData)}t.renegotiationInProgress&&(e.terminateReason=null,e.updateMediaDevices())}function yt(e,t){Z||(D.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsThresholdExceeded. Cleared: ",!(!t||!t.cleared)),g.$apply((function(){t&&t.cleared?P.publish("/call/rtp/threshholdExceeded/cleared",[e.callId]):P.publish("/call/rtp/threshholdExceeded/detected",[e.callId])})))}function bt(e){D.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsNoOutgoingPackets. Publish /call/rtp/noOutgoingPackets event"),g.$apply((function(){P.publish("/call/rtp/noOutgoingPackets",[e.callId])}))}function Ut(e,t){t&&g.$apply((function(){var n=null;if(_.unifiedPlanEnabled)t.quality&&(n=t.quality.level),e.networkQuality=n,D.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",n);else{var i=t.quality;n={userId:g.localUser.userId,audio:{qualityLevel:i.qualityLevel.value,currentPlSend:i.currentPlSend,currentPlReceive:i.currentPlReceive,firstTimeLowQuality:i.firstTimeLowQuality}},D.debug("[CircuitCallControlSvc]: Publish legacy /call/network/quality event for quality=",n.audio.qualityLevel)}P.publish("/call/network/quality",[e.callId,n])}))}function Lt(e,t){D.debug("[CircuitCallControlSvc]: RtcSessionController - onGetUserMediaException. Publish /call/getUserMediaException event"),g.$apply((function(){P.publish("/call/getUserMediaException",[e,t.info])}))}function Mt(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(t.isDirect||t.participants.length<2)return void D.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var n=[];if(e.first&&n.push(e.first),e.second&&n.push(e.second),e.third&&n.push(e.third),!t.setActiveSpeakers(n))return;D.debug("[CircuitCallControlSvc]: Publish /call/participants/activeSpeakers event. ",n),P.publish("/call/participants/activeSpeakers",[t.callId,n])}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",e)}}function wt(e){if(D.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),e.participants&&0!==e.participants.length){var t=b.getConversationByRtcSession(e.rtcSessionId);if(t&&(t.hasJoined||t.isTemporary)&&(e.turnServers&&Le(e.rtcSessionId,e.turnServers),!Ze(e.rtcSessionId))){var n,i=!1;if(e.participants.some((function(e){return e.userId===g.localUser.userId&&(n=e,e.clientId===V.clientId&&(i=!0),!0)})),t.call){var r=t.call;return r.isRemote&&t.isTemporary&&n?(t.call.setState(s.CallState.ActiveRemote),r.setActiveClient(n),et(r),void(r.mediaType=l.getMediaType(e.mediaTypes))):void D.debug("[CircuitCallControlSvc]: Conversation already has an associated call")}if(t.type!==o.ConversationType.DIRECT||e.hosted||n){if(i){var a=function(t){t&&D.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",e.rtcSessionId)},c={disconnectCause:o.DisconnectCause.CONNECTION_LOST,disconnectReason:o.DisconnectReason.CALL_LOST};if(t.type===o.ConversationType.DIRECT)return void V.terminateRtcCall(e.rtcSessionId,c,a);V.leaveRtcCall(e.rtcSessionId,c,a)}qe(t,n,e,e.rtcSessionId,(function(t){n&&Gt(t,e)}))}}}else D.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",e.rtcSessionId)}function Gt(e,t){e&&e.isTelephonyCall&&t&&t.participants&&t.participants.length<=2&&t.participants.some((function(t){return t.participantType===o.RTCParticipantType.TELEPHONY&&(be(e,t.phoneNumber,null,t.userDisplayName),!0)}))}function kt(e){var t=!1;return me(e.rtcSessionId)&&e.participants&&(t=e.participants.some((function(e){return e.userId===g.localUser.userId&&e.clientId===V.clientId}))),t}function Ht(){return V.injectHasActiveCall(H.hasActiveCall),new O((function(e,t){ee||g.isSessionGuest?(D.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),V.getActiveSessions((function(n,i){g.$apply((function(){n&&D.error("[CircuitCallControlSvc]: Error getting active sessions: ",n),i=i||[],f.emptyArray(q);for(var r=W.length-1;r>=0;r--)W[r].isRemote&&(W[r].guestToken?q.push(W[r]):Ne(W[r]));var o=null,a=!1,c=!1,l=[];i.forEach((function(e){var t=me(e.rtcSessionId);if(t){if(kt(e))return a=a||t===K,c=c||t===Y,D.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void H.renegotiateMedia(t.callId,(function(n){t.screenOwnerId===g.localUser.userId&&(n||e.screenOwnerId!==g.localUser.userId?(D.debug("[CircuitCallControlSvc]: There was a renegotiation error or remote control has been terminated on backend"),Ve(t.callId)):(D.debug("[CircuitCallControlSvc]: Starting a screen control session."),Fe(t.callId,e.screenControllerId,(function(e){e?D.error("[CircuitCallControlSvc]: Could not start the screen control session"):D.debug("[CircuitCallControlSvc]: Successfully started the screen control session.")})))),n?We(t,null,null,!0):We(t,e.screenOwnerId,e.screenControllerId,!0),P.publish("/call/sessionInitialized",[t])}));Ne(t,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}(o=b.getConversationByRtcSession(e.rtcSessionId))&&o.hasJoined?wt(e):e.invitedGuests&&e.invitedGuests.includes(g.localUser.userId)?(D.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),l.push(b.createConversationAsGuestFromSummary(e.convId))):o||(D.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),l.push(b.getConversationPromise(e.convId)))})),P.publish("/activeSessions/received"),Y&&!c&&Ne(Y,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),K&&!a&&Ne(K,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),l.length>0?function(e,t,n){D.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),O.all(e).then((function(e){var n=e.map((function(e){return e.convId}));D.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",n),D.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),V.getActiveSessions((function(e,i){g.$apply((function(){e&&(D.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),i=[]),i.forEach((function(e){-1!==n.indexOf(e.convId)&&(kt(e)||wt(e))})),t()}))}))})).catch((function(e){D.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",e),n(e)}))}(l,e,t):e()}))}))):t("Not ready to initialize active sessions")}))}function Vt(e,t){var n={rtcSessionId:e,transactionId:t};V.changeMediaReject(n,(function(e){e?D.error("[CircuitCallControlSvc]: changeMediaReject sending error"):D.debug("[CircuitCallControlSvc]: changeMediaReject sent")}))}function Bt(e,t,n){if(n||(e.call.pickupNotification?(D.debug("[CircuitCallControlSvc]: Publish /call/pickupNotification event"),P.publish("/call/pickupNotification",[e.call])):(D.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),P.publish("/call/incoming",[e.call]))),U){var i={type:e.call.isGuestInvite&&!e.call.pickupNotification?s.NotificationType.INCOMING_INVITATION_AS_GUEST:e.call.mediaType.video?s.NotificationType.INCOMING_VIDEO_CALL:s.NotificationType.INCOMING_VOICE_CALL,userId:t,extras:{conversation:e,call:e.call}};e.isTelephony&&e.call.peerUser&&(i.userId=e.call.peerUser.userId,i.userId||(i.user=e.call.peerUser),i.extras.phoneNumber=e.call.peerUser.phoneNumber,i.extras.displayName=e.call.peerUser.displayName),U.show(i)}e.call.startRingingTimer((function(){Xe(e.call,{type:o.InviteRejectCause.TIMEOUT},!1)}))}function Ft(e,t){if(t&&t.redirectingUser){var n=t.redirectingUser;i=e,r=n.phoneNumber,o=n.fullyQualifiedNumber,a=n.displayName,s=d.CallForward,i.redirectingUser&&i.redirectingUser.redirectionType||(i.setRedirectingUser(r,o,a,null,s),o?y.startReverseLookUp(o,(function(e){e&&i.isPresent()&&(i.setRedirectingUser(r,o,e.displayName,e.userId,s),ve(i))})):ve(i))}var i,r,o,a,s}function xt(e,n){if(e&&n){var r={autoAnswer:!1,callPickedUp:!1,replaces:null,replacesActiveRemote:!1,userIsMuted:!1};if(e.replaces&&$e(e.replaces))r.replacesActiveRemote=!0;else if(!function(e,t,n){if(!K)return!0;if(K.callId===e.replaces)n.userIsMuted=K.sessionCtrl&&K.sessionCtrl.isMuted(),n.replaces=K;else if(K.terminateTimer){if(K.callId===e.sessionId)return D.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),Qe(e),!1;Ne(K)}else{if(K.callId===e.sessionId)return K.isDirect?(D.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),Qe(e)):D.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."),!1;if(!K.isEstablished()&&(!e.pickUpSession||e.pickUpSession!==K.callId)&&(!t.isTelephony||ye()))return D.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),Qe(e),!1}return!0}(e,n,r))return;if(n.isTelephony?function(e,t){e.to&&e.to.displayName&&e.to.displayName.startsWith("handover-from")?(D.debug("[CircuitCallControlSvc]: Received handover call"),ne?(t.autoAnswer=!0,N.cancel(ne),ne=null):(D.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),t.replacesActiveRemote=!0)):re&&(t.autoAnswer=!0,N.cancel(re),re=null)}(e,r):Q&&Q.callId===e.replaces&&(r.userIsMuted=z,r.replaces=Q,Q=null),Ze(e.sessionId))D.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");else{if(!r.replacesActiveRemote&&!e.pickUpSession&&!r.replaces&&j.length>=1&&!r.autoAnswer&&(!n.isTelephony||ye()))return D.debug("[CircuitCallControlSvc]: Reject second incoming call."),void Qe(e);if(function(e,t,n){if(t.isTelephony&&!n.autoAnswer&&!n.replacesActiveRemote){if(g.localUser.selectedRoutingOption===E.DeskPhone.name&&g.localUser.isATC)return ze(t,e,!0),!1;if(!g.localUser.selectedBusyHandlingOption||g.localUser.selectedBusyHandlingOption===i.DefaultRouting.name||g.localUser.isSTC){if(K&&K.isPresent()&&Y&&Y.isPresent())return D.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),Qe(e),!1}else if(K||j.length>=1||!f.isEmptyArray(q)||t.call&&t.call.isAtcRemote&&!t.call.pickupNotification)return ze(t,e),!1}return!0}(e,n,r))!function(e,n,i,r){var o=e.mediaType||["AUDIO"];rt(i,Ue({userId:e.userId},o),s.ParticipantState.Calling),i.ringingTimeout=e.ringingTimeout||i.ringingTimeout;var a=l.getMediaType(o);i.mediaType=a,a.desktop&&D.debug("[CircuitCallControlSvc]: INVITE for a Screen Share");if(r.replacesActiveRemote)return void Ae(i,!0);Ae(i);var c=function(){g.$apply((function(){if(i.state!==s.CallState.Terminated){It(i),D.debug("[CircuitCallControlSvc]: New alerting call: ",i.callId),n.call&&!n.isTelephony&&(D.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),Ne(n.call));var o=null;if(n.call&&n.call.isAtcRemote&&(o=n.call.callId,n.call.pickupNotification&&r.autoAnswer&&function(e,n){if(e&&n){var i=e.getRedirectingUser();n.atcCallInfo||(n.atcCallInfo=new t,n.setCstaState(s.CstaCallState.Active)),n.setRedirectingUser(i.phoneNumber,i.fullyQualifiedNumber,i.displayName,i.userId,d.CallPickedUp),n.pickUpFromUser=i}}(n.call,i)),n.call=i,n.isTelephony&&r.autoAnswer?(D.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),P.publish("/atccall/replace",[i,o])):_e(n),r.replaces)H.answerCall(i.callId,r.replaces.localMediaType,(function(e){e||r.userIsMuted&&K.sessionCtrl&&K.sessionCtrl.mute()}));else{if(g.isCMR&&(a.video=!0,a.videoResolution=g.videoResolution,r.autoAnswer=!!g.inviterUserId),r.autoAnswer)return i.isTelephonyCall&&e.from&&!r.callPickedUp&&be(i,e.from.phoneNumber,e.from.fullyQualifiedNumber,e.from.displayName,null,(function(){Ft(i,e.telephonyInfo)})),void H.answerCall(i.callId,a);V.sendProgress(i.callId,e.userId,g.localUser.userId,(function(e){e&&D.error("[CircuitCallControlSvc]: sendProgress error",e)})),i.isTelephonyCall&&e.from&&!i.transferredOnRinging?be(i,e.from.phoneNumber,e.from.fullyQualifiedNumber,e.from.displayName,null,(function(){n.call===i&&Bt(n,e.userId),Ft(i,e.telephonyInfo)})):Bt(n,e.userId)}}else D.debug("[CircuitCallControlSvc]: New alerting call has been terminated already")}))},u=function(e){D.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call: ",e),P.publish("/call/warmupFailed",[e,i]),Ne(i,null,!0),n.isTemporary&&(D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[n]))},E=i.sessionCtrl,C=(T=n.rtcSessionId,p=J[T],p&&p.turnServers&&p.turnServers.length?p.turnServers:null);var T,p;if(!_.enabled)return D.warn("[CircuitCallControlSvc]: Client does not support WebRTC."),void u("res_NoWebRTC");Ce(i).then((function(t){if(i.isPresent()){var n;if(C?(D.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",C),E.setTurnUris(C)):(D.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),E.setTurnUris(t.turnServer)),E.setTurnCredentials(t),D.debug("[CircuitCallControlSvc]: Set TURN credentials"),i.replaces)n=i.replaces.localMediaType;else{var r="firefox"===_.browser,o="android"===_.browser;n={audio:!r&&!o&&!x,video:!1}}Yt(n,(function(t){E.warmup(t,e.sdp,c,u)}))}else D.debug("[CircuitCallControlSvc]: There is no incoming call anymore")})).catch(u)}(e,n,function(e,n,i){var r={isAtcPullCall:n.isTelephony&&i.autoAnswer&&"offer"===e.sdp.type&&!oe&&!g.localUser.isOsBizCTIEnabled,clientId:V.clientId,midMappingEnabled:Ct(),isSTC:g.localUser.isSTC&&n.isTelephony,stcCapabilities:n.isTelephony?g.localUser.stcCapabilities:[],canReceiveHdVideo:g.localUser.canUseHDVideo||g.localUser.canUseHDScreenShare};i.replaces&&i.replaces.localMediaType.desktop&&(r.reuseDesktopStreamFrom=i.replaces.sessionCtrl);var o=new c(n,r);o.setCallIdForTelephony(e.sessionId),o.setInstanceId(e.instanceId),o.setTransactionId(e.transactionId),K&&e.pickUpSession===K.callId&&(i.replaces=K,i.replaces.pickUpUserId=e.userId,o.pickUpFromUser=i.replaces.peerUser);if(i.replaces){o.replaces=i.replaces;var a=i.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.DESKTOP);a&&(D.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",i.replaces.callId),o.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,a),i.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,null),g.localUser.userId===i.replaces.screenOwnerId&&(o.restartScreenControlSession=!0,o.screenControllerId=i.replaces.screenControllerId)),(a=i.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO))&&(D.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",i.replaces.callId),o.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,a),i.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,null))}X&&(D.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),o.disableRemoteVideo());if(o.setState(s.CallState.Ringing),o.direction=s.CallDirection.INCOMING,g.localUser.isATC&&o.isTelephonyCall&&(o.atcCallInfo=new t,e.atcAdvancing&&(D.debug("[CircuitCallControlSvc] This ATC call has already advanced to the desk phone"),o.atcAdvancing=!0,o.sessionCtrl.setIgnoreNextConnection(!0)),oe)){o.atcCallInfo.setCstaConnection(oe.atcCallInfo.getCstaConnection());var l=oe.peerUser;o.setPeerUser(l.phoneNumber,l.displayName,l.userId);var u=oe.getRedirectingUser();o.setRedirectingUser(u.phoneNumber,u.fullyQualifiedNumber,u.displayName,u.userId,d.CallPickedUp),oe=null,i.callPickedUp=!0}return o}(e,n,r),r)}}else D.error("[CircuitCallControlSvc]: processInvite called without evt or conversation")}function Wt(e,t){e&&t&&(e.hasJoined||e.isTemporary?t.some((function(t){var n;return e.rtcSessionId===t.rtcSessionId&&(D.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),t.participants&&0!==t.participants.length?(t.participants.some((function(e){return e.userId===g.localUser.userId&&(n=e,!0)})),e.type===o.ConversationType.DIRECT&&!t.hosted&&!n||(e.call?(D.debug("[CircuitCallControlSvc]: Conversation already has an associated call"),!0):(qe(e,n,t,null,(function(e){n?Gt(e,t):e.conferenceCall&&(D.debug("[CircuitCallControlSvc]: Publish /conference/started event"),P.publish("/conference/started",[e]))})),!0))):(D.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId),!0))})):D.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session."))}function Kt(e,t,n,i){t=Object.assign({},t),e.type===o.ConversationType.LARGE&&g.isSessionGuest&&(t.audio=!1,D.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",t)),Yt(t,(function(t,r){if(r){if(e.isTelephony)return D.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Terminate local call."),Ne(K),void i("res_MakeCallFailedNoMic");n.warning=r}He(e,t,n,i)}))}function Yt(e,t){return Ee(e),D.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",e),!g.browser.msie||g.isSessionGuest||g.localUser.hasPermission(o.SystemPermission.IE_PLUGIN_SUPPORT)?(e=e?f.shallowCopy(e):{audio:!0,video:!1},F||x||!e.audio&&!e.video?(D.debug("[CircuitCallControlSvc]: Normalized mediaType = ",e),void t(e)):(D.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void _.getMediaSources((function(i,r){e.video&&(!r||r.length<1)&&(D.warn("[CircuitCallControlSvc]: No camera detected"),e.video=!1,n="res_AnswerWarnNoCamera"),e.audio&&(!i||i.length<1)&&(e.audio=!1,D.warn("[CircuitCallControlSvc]: No microphone detected"),n="res_AnswerWarnNoCamera"===n?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailedWarning"),D.debug("[CircuitCallControlSvc]: Normalized mediaType = ",e),t(e,n)})))):(D.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void P.publish("/iePlugin/permissionDenied"));var n}function qt(e){e&&e.activeNotification&&!e.isHandoverInProgress&&(U&&U.dismiss(e.activeNotification),e.activeNotification=null)}function jt(e){H.mute(e),H.disableRemoteAudio(e)}function Qt(e,t,n){if(n=n||k,!e||!t)return D.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void n("Invalid arguments");if(e.isDirect&&!e.upgradeToConfSupported)return D.error("[CircuitCallControlSvc]: addParticipant - Cannot upgrade call to conference"),void n("Cannot upgrade to conference");var i=t.cmrData;delete t.cmrData;var r=t.dialOutPhoneNumber,a=r?{userId:"gtc-callout-"+r.replace(/[+ ]+/g,""),phoneNumber:f.cleanPhoneNumber(r),displayName:t.displayName,resolvedUserId:t.userId,participantType:o.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:t;if(!a.userId)return D.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void n("Missing userId");if(e.hasParticipant(a.userId)||a.resolvedUserId&&e.hasParticipant(a.resolvedUserId))return D.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void n("Participant exists");D.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",a.userId);var c=f.shallowCopy(e.mediaType);c.audio=!0;var l={rtcSessionId:e.callId,userId:a.userId,mediaType:c};r&&(l.from={phoneNumber:f.cleanPhoneNumber(g.localUser.callerId),displayName:g.localUser.displayName},l.to={phoneNumber:a.phoneNumber,displayName:a.displayName,resolvedUserId:a.resolvedUserId}),V.addParticipantToRtcSession(l,(function(t){g.$apply((function(){if(t){if(t===o.ErrorCode.PERMISSION_DENIED)return D.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void n("res_MaxConversationParticipantsLimit");D.warn("[CircuitCallControlSvc]: Failed to add participant"),n("res_AddParticipantToRtcSessionFailed")}else{if(D.debug("[CircuitCallControlSvc]: Add participant request was successful"),e.direction=s.CallDirection.OUTGOING,!e.isRemote){var r=Ue(a,["AUDIO"]),c=s.ParticipantState.Initiated,l=rt(e,r,c);l&&(l.isCMP&&(l.isMeetingPointInvitee=!0,l.cmrData=i||{},e.setMeetingPointInviteState(!0),jt(e.callId)),D.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),P.publish("/call/participant/added",[e.callId,l]))}n()}}))}))}function zt(e,t){var n=t?e.getParticipant(t):null;D.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),P.publish("/call/localUser/muted",[e.callId,e.remotelyMuted,e.locallyMuted,n]),n&&e.remotelyMuted&&U&&U.show({type:s.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Muted,text:g.i18n.localize("res_MutedByNotification",[n.displayName])}})}function Xt(e,t,n){if(n=n||k,j.length>=1)return n("res_CannotJoinMultipleSessions"),!1;if(K&&K.isPresent())if(K.isTelephonyCall){if(!e.isTelephony||!g.localUser.isRegisterTC)return n("res_CannotJoinMultipleSessions"),!1;if(Y)return n("res_CannotInitiateThirdPhoneCall"),!1}else if(!t.replaces)return n("res_CannotJoinMultipleSessions"),!1;for(var i=0;i<W.length;i++)if(!W[i].state.established&&W[i].isTelephonyCall)return D.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),n("res_JoinRTCSessionFailed"),!1;if(e.isTelephony){if(!t.handover&&(t.dialedDn=t.dialedDn?t.dialedDn.trim():null,!t.dialedDn))return n("Missing Dialed DN"),!1;if(!g.localUser.callerId)return n("Missing Caller ID"),!1;if(g.localUser.isOsBizCTIEnabled&&!t.handover&&e.call)return n("res_CannotJoinMultipleSessions"),!1}return!0}function Jt(e,t){return e=e||{},t&&Object.assign(e,t),e.callOut=!!e.callOut,e.handover=!!e.handover,e}function $t(e,t,n,i){t=t||{},i=i||{};var r="[CircuitCallControlSvc]: "+(n=n||"addRemoveMedia")+": ",o=me(e),a=null,s={};if(o)s=o.localMediaType,"boolean"==typeof t.desktop&&o.videoPointerTo&&(t.video=!1,i.videoPointerTo=null);else{if(!(a=Ze(e))||a.callId!==e)return D.warn(r+"There is no local call"),O.reject("No active call");s=a.mediaType}D.debug(r,t);var c={callId:e,dontReuseAudioStream:!!i.dontReuseAudioStream,mediaType:Object.assign({},s,t),videoPointerTo:i.videoPointerTo||null};return"boolean"==typeof t.video&&"boolean"!=typeof t.hdVideo&&delete c.mediaType.hdVideo,"boolean"==typeof t.desktop&&"boolean"!=typeof t.hdDesktop&&delete c.mediaType.hdDesktop,Et(o)||(t.video?c.mediaType.desktop=!1:t.desktop&&(c.mediaType.video=!1)),new O((function(e,t){a?Yt(c.mediaType,(function(n){a.sessionCtrl.replaceLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,null),a.sessionCtrl.warmup(n,null,(function(){D.debug(r+"re-warmup succeeded"),e()}),(function(e){D.warn(r+"re-warmup failed - ",e),t(e)}))})):Be(c,(function(n){n?(D.warn(r+"failed - ",n),t(n)):e()}))}))}function Zt(e,t,n){if(e){var i={ToggleWhiteboard:e.whiteboardEnabled,ToggleScreenShare:e.hasRemoteScreenShare()||e.hasLocalScreenShare(),ToggleConferencePoll:!!e.isPollStarted},r=i.ToggleWhiteboard+i.ToggleScreenShare+i.ToggleConferencePoll;D.debug("[CircuitCallControlSvc]: Number of call features enabled for CMRs",r),n?r>=2&&e.previousScreenFeaturesState[t]!==i[t]&&(e.screenEnabledFeature=t,D.debug("[CircuitCallControlSvc]: Selected feature to show on invited CMR:",e.screenEnabledFeature)):r<2?(e.screenEnabledFeature=null,D.debug("[CircuitCallControlSvc]: There is nothing selected to show on invited CMR")):t===e.screenEnabledFeature&&I.some((function(t){return!!i[t]&&(e.screenEnabledFeature=t,D.debug("[CircuitCallControlSvc]: Selected feature to show on invited CMR:",e.screenEnabledFeature),!0)})),e.previousScreenFeaturesState=i,e.isMeetingPointInvited&&e.participants.filter((function(i){if(!i.isMeetingPointInvitee)return!1;if("boolean"==typeof i.cmrData.isWhiteboardActive)return!1;if(t===S.ToggleConferencePoll.name)return!1;var o=r;return o&&e.isPollStarted&&(o-=1),n?(i.cmrData.selectedFeature=o>=2?t:null,!0):(o<2?i.cmrData.selectedFeature=null:i.cmrData.selectedFeature===t&&(t===S.ToggleScreenShare.name?i.cmrData.selectedFeature=S.ToggleWhiteboard.name:i.cmrData.selectedFeature=S.ToggleScreenShare.name),!0)}))}}function en(e,t){var n=H.getActiveCall();if(!n||n.callId!==e)return O.reject("Call not found");if(!t||!t.length)return O.reject("Invalid configuration");if(se&&se.callId===e)se.configuration=t;else{se&&se.cancel();var i={callId:e,configuration:t};i.promise=new O((function(t,n){i.timeout=N((function(){if(se===i){se=null,D.debug("[CircuitCallControlSvc]: Set video receiver configuration to ",i.configuration);var r={rtcSessionId:e,configuration:i.configuration};V.setVideoReceiverConfiguration(r,(function(e){g.$apply((function(){e?n(e):t()}))}))}}),500,!1),i.cancel=function(){se===i&&(se=null,D.debug("[CircuitCallControlSvc] Canceling pending setVideoReceiverConfiguration request"),n("Cancelled"),N.cancel(i.timeout))}})),se=i}return se.promise}function tn(e){return Array.isArray(e)?new O((function(t){var n={};e.forEach((function(e){!e.isAnonymous&&e.ownerUserId&&(n[e.ownerUserId]=!0)}));var i=Object.keys(n);D.debug("[CircuitCallControlSvc] Get user(s) associated with question(s)"),y.getUsersByIds(i,(function(i,r){n={},r&&r.forEach((function(e){n[e.userId]=e})),e.forEach((function(e){!e.isAnonymous&&e.ownerUserId&&(e.user=n[e.ownerUserId]),e.user||(e.user={userId:e.ownerUserId||"anonymous",isSessionGuest:!0,avatarColor:"grey",avatar:a.SESSION_GUEST.avatar,avatarLarge:a.SESSION_GUEST.avatarLarge,initials:e.isAnonymous?"?":f.displayNameToInitials(e.displayName)})})),t()}))})):O.reject("questions is mandatory")}function nn(e){try{var t=e.isGuestInvite&&!g.isCMR,n=de(e.convId);if(!n){D.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var i=e.sessionId;if(te[i]=e,t)b.createConversationAsGuestFromSummary(e.convId).then((function(e){te[i]&&(D.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),xt(te[i],e),delete te[i])})).catch((function(){D.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete te[i]}));else{var r={randomLoaded:!0,sessionId:e.sessionId};b.getConversationById(e.convId,r,(function(e,t){e?D.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):te[i]?(D.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),xt(te[i],t)):(D.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),V.getActiveSessions((function(e,n){g.$apply((function(){e&&(D.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),n=[]),Wt(t,n)}))}))),delete te[i]}))}return}if(t&&!n.isTemporary&&(n=b.createConversationAsGuest(n)),!n.hasJoined&&!t)return void D.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");g.$apply((function(){xt(e,n)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",e)}}function rn(e,t){e.session.hosted&&t.isDirect?t.setDirectUpgradedToConf():t.isDirectUpgradedToConf&&!e.session.hosted&&t.clearDirectUpgradedToConf()}function on(e){return"function"!=typeof e?k:function(t){g.$apply((function(){e(t)}))}}if(P.subscribe("/conversation/update",(function(e,t){if(t){var n=me(e.rtcSessionId);n&&!n.isDirect&&(D.debug("[CircuitCallControlSvc]: Received /conversation/update event"),void 0!==t.isModerated&&n.participants.forEach((function(t){t.setActions(e,g.localUser)})))}})),P.subscribe("/conversation/upgrade",(function(e,t){if(D.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+e.convId+". New convId = ",t.convId),e.call&&t.convId!==e.convId&&(e.call.checkState(s.CallState.Active)||e.type!==o.ConversationType.DIRECT&&e.call.checkState(s.CallState.Waiting)))if(D.debug("[CircuitCallControlSvc]: Move Session"),e.type===o.ConversationType.DIRECT&&t.type===o.ConversationType.GROUP){var n=Jt({callOut:!0,handover:!1,replaces:e.call});Ge(t,e.call.localMediaType,n)&&He(t,e.call.localMediaType,n,(function(n){n||e.call.sessionCtrl&&e.call.sessionCtrl.isMuted()&&t.call.sessionCtrl&&t.call.sessionCtrl.mute()}))}else{var i={sessionId:e.rtcSessionId,conversationId:e.convId,newSessionId:t.rtcSessionId,newConversationId:t.convId};V.moveRtcSession(i,(function(e){e&&D.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",e)}))}})),P.subscribe("/conversation/left",(function(e){D.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = ",e.convId),e&&e.call&&H.hideRemoteCall(e.call.callId)})),P.subscribe("/conversation/participants/add",(function(e,t){D.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),e&&t&&t.forEach((function(t){Qt(e,t)}))})),P.subscribe("/csta/handover",(function(){D.debug("[CircuitCallControlSvc]: Received /csta/handover event."),ne=N((function(){ne=null}),6e3)})),P.subscribe("/atccall/moveFailed",(function(){D.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),ne&&(N.cancel(ne),ne=null)})),P.subscribe("/atccall/pickUpInProgress",(function(e){D.debug("[CircuitCallControlSvc]: Received /atccall/pickUpInProgress event."),oe=e,re=N((function(){re=null,oe=null}),4e3)})),P.subscribe("/conversations/loadComplete",(function(){D.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),ee=!0,Ht()})),P.subscribe("/registration/state",(function(e){D.debug("[CircuitCallControlSvc]: Received /registration/state event"),e!==RegistrationState.Registered?(K&&K.isTestCall&&Ne(K,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),j.forEach((function(e){D.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),Ne(e,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})),e!==RegistrationState.Disconnected&&e!==RegistrationState.Waiting||W.forEach((function(e){Ne(e,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}))):g.isSessionGuest&&K&&Ht()})),P.subscribe("/conversation/re-added",(function(e){D.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",e.convId),V.getSession(e.rtcSessionId,(function(t,n){t?D.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",t):n.participants&&n.participants.length>0&&g.$apply((function(){Wt(e,[n])}))}))})),P.subscribe("/call/meetingPointInvitee",(function(e){if(D.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),e){var t=me(e);t&&(t.setMeetingPointInviteState(!0),jt(e))}})),P.subscribe("/call/removeConferenceAsGuest",(function(e){D.debug("CircuitCallControlSvc]: /call/removeConferenceAsGuest"),H.removeConferenceAsGuest(e)})),e.isElectron){var an=function(e,t,n){try{if(!K||!K.hasLocalScreenShare())return void D.debug("[CircuitCallControlSvc]: No local screen share. Ignore DESKTOP_APP event.");if(t.userId=n.srcUserId,i=t.userId,!K||!K.participants.some((function(e){return e.userId===i})))return void D.debug("[CircuitCallControlSvc]: Event sender is not a participant. Ignore DESKTOP_APP event.");y.getUserById(t.userId,(function(n,i){!n&&K&&K.hasLocalScreenShare()&&(t.name=i.displayName,require("electron").ipcRenderer.send(e,t))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP event.",e)}var i};B.on("DESKTOP_APP.PARTICIPANT_POINTER",(function(e,t){D.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),an("participant-pointer",e,t)}))}return B.on("ATC.ADVANCING",(function(e){try{if(e.type===n.ADVANCING){D.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var t=Ze(e.rtcSessionId);t&&(t.atcAdvancing=!0,t.sessionCtrl.setIgnoreNextConnection(!0))}}catch(e){D.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",e)}})),V.on("RTCCall.SDP_ANSWER",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);t.isDirect&&M.startJoinDelayTimer(t),g.$apply((function(){var n=e.sdp;if(n){var i=M.createActionInfo(t,o.RtcDiagnosticsAction.SDP_ANSWER);n.sdp&&"sdp"!==n.sdp&&"data"!==n.sdp||(n.sdp="sdp",D.debug("[CircuitCallControlSvc]: This is a mocked call"),t.setMockedCall()),t.setInstanceId(e.instanceId),t.sessionCtrl.setRemoteDescription(n,(function(e){t.clearTransactionId(),e&&(t.setDisconnectCause(o.DisconnectCause.REMOTE_SDP_FAILED,"type="+n.type+" origin="+A.getOrigin(n.sdp)),Je(t,null,s.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED),i&&(i.data=e)),M.finishActionInfo(t,i)}))}e.localMute&&H.mute(t.callId,(function(e){e&&D.warn("[CircuitCallControlSvc]: Error synchronizing client mute state. Error: ",e)}))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",e)}})),V.on("RTCCall.ICE_CANDIDATES",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES");var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(V.clientId!==e.clientId)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);t.sessionCtrl.addIceCandidates(e.origin,e.candidates);var n=M.createActionInfo(t,o.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES);n&&(n.data=e.candidates,M.finishActionInfo(t,n))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",e)}})),V.on("RTCSession.SESSION_UPDATED",(function(e){g.$apply((function(){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var t=e.session.participants.find((function(e){return e.userId===g.localUser.userId})),n=me(e.sessionId);if(t){var i=$e(e.sessionId);if(i)return D.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),i.mediaType=l.getMediaType(e.session.mediaTypes),i.setActiveClient(t),rn(e,i),void ve(i);if(Ze(e.sessionId))return void D.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!n||n.callId!==e.sessionId&&!De(!0))return void function(e,t){var n,i=b.getConversationByRtcSession(e.sessionId);if(i)n=O.resolve(i);else{if(!t.isMeetingGuest)return void D.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");D.debug("[CircuitCallControlSvc]: Local user is guest of this session"),n=b.createConversationAsGuestFromSummary(e.session.convId)}t.clientId!==V.clientId?n.then((function(n){qe(n,t,e.session,e.sessionId,(function(t){t.voicemailConnected=e.session.participants.some((function(e){return e.participantType===o.RTCParticipantType.VOICE_MAIL})),Gt(t,e.session)}))})).catch((function(e){D.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)})):D.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event.")}(e,t);if(t.clientId!==V.clientId)return void function(e,t,n){var i,r=de(n.convId);i=!r&&t.isMeetingGuest?b.createConversationAsGuestFromSummary(e.session.convId):O.resolve(r);var o=null,a=null,c=null;n.isTelephonyCall&&(o=n.peerUser.phoneNumber,a=n.peerUser.displayName,c=n.participants),e.session.screenControllerId&&g.localUser.userId===e.session.screenOwnerId&&Ve(e.sessionId);var l=n.atcCallInfo,d=n.pickUpFromUser,u=n.pickUpUserId;Ne(n,s.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),i.then((function(n){qe(n,t,e.session,e.sessionId,(function(e){e.atcCallInfo=l,e.isTelephonyCall&&(be(e,o,null,a),e.participants=c),e.pickUpFromUser=d,e.pickUpUserId=u}))})).catch((function(e){D.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)}))}(e,t,n);n.remotelyMuted!==t.muted&&(n.remotelyMuted=t.muted,zt(n))}else if(!n||!n.isLarge)return void D.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event.");n.instanceId||n.setInstanceId(e.session.instanceId),function(e,t,n){e.session.muted!==t.sessionMuted&&(t.sessionMuted=e.session.muted,D.debug("[CircuitCallControlSvc]: Publish /call/muted event"),P.publish("/call/muted",[t])),e.session.locked!==t.sessionLocked&&(t.sessionLocked=e.session.locked,D.debug("[CircuitCallControlSvc]: Publish /call/locked event"),P.publish("/call/locked",[t])),e.stageAction&&(e.stageAction===o.StageAction.USER_ENTERED_STAGE?t.raiseHandState.onStage=!0:e.stageAction===o.StageAction.USER_LEFT_STAGE&&(t.raiseHandState.onStage=!1),D.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),P.publish("/call/raiseHand/stageAction",[e.stageAction])),e.session.curtain&&(t.curtain=e.session.curtain,D.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),P.publish("/call/curtain",[t.curtain]),t.curtain.curtainClosed&&(g.isSessionGuest||t.isGuestInvite)&&(D.debug("[CircuitCallControlSvc]: Clear active speakers for guests while curtain is closed"),t.setActiveSpeakers([]),P.publish("/call/participants/activeSpeakers",[t.callId,[]]))),e.session.testMode&&!g.isSessionGuest&&(t.testMode=e.session.testMode,D.debug("[CircuitCallControlSvc]: Publish /call/testMode event (session updated)"),P.publish("/call/testMode",[t]));var i=!!e.session.whiteBoardEnabled;t.whiteboardEnabled!==i&&(t.whiteboardEnabled=i,P.publish("/call/whiteboard/update",[t]));var r=!!e.session.pollEnabled;t.pollEnabled!==r&&(t.pollEnabled=r,P.publish("/call/poll/update",[t]));var a=n&&n.videoPointerTo||null;t.videoPointerTo!==a&&(t.videoPointerTo=a,D.debug("[CircuitCallControlSvc]: Set videoPointerTo to ",a||"null"),P.publish("/call/videoPointer/changed",[t]))}(e,n,t),rn(e,n),n.screenControllerId=e.session.screenControllerId||null,n.screenOwnerId=e.session.screenOwnerId||null,n.preventScreenControlRequestInConf=n.screenControllerId&&n.screenOwnerId&&n.screenControllerId!==g.localUser.userId&&n.screenOwnerId!==g.localUser.userId,n.hadRemoteCall=!1;var r=function(e,t){var n={addedParticipants:[],updatedParticipants:[],removedParticipantIds:[]},i=e.session.participants||[];if(g.isCMR||i.some((function(e,t){return e.userId===g.localUser.userId&&(i.splice(t,1),!0)})),t.isDirect||t.isAtcConferenceCall()||(n.removedParticipantIds=t.participants.filter((function(e){return e.pcState!==s.ParticipantState.Initiated})).map((function(e){return e.userId}))),i.length>0||t.conferenceCall){var r=l.getMediaType(e.session.mediaTypes);if(r.audio=r.audio||t.localMediaType.audio,r.video=r.video||t.localMediaType.video,r.desktop=r.desktop||t.localMediaType.desktop,t.mediaType=r,t.activeClient=null,r.desktop!==t.previousScreenFeaturesState.ToggleScreenShare){var o=t.hasRemoteScreenShare()||t.hasLocalScreenShare();Zt(t,S.ToggleScreenShare.name,o)}ut(t,i.length>0),t.isAtcConferenceCall()||i.forEach((function(e){var i=!1,r=Ue(e),o=r.muted?s.ParticipantState.Muted:s.ParticipantState.Active,a=t.getParticipant(e.userId);if(Oe(r,t),a){f.removeArrayElement(n.removedParticipantIds,e.userId);var c=a.pcState,l=a.videoStream;a.streamId===r.streamId&&a.screenStreamId===r.screenStreamId&&a.hasSameMediaType(r)||(i=!0);var d=ot(t,r,o);d&&(i||d.pcState!==c||d.videoStream!==l)&&n.updatedParticipants.push(d)}else{var u=rt(t,r,o);u&&n.addedParticipants.push(u)}}))}return n}(e,n);e.session.recentActiveSpeakers=e.session.recentActiveSpeakers||[],n.recentActiveSpeakers=e.session.recentActiveSpeakers.filter((function(e){return n.hasParticipant(e)}));var a=n.state;ct(e.session.attendeeCount),(n.conferenceCall||n.checkState(s.CallState.Answering))&&(n.isEstablished()||n.setState(s.CallState.Waiting),n.updateCallState()),n.checkState(a)||ve(n),n.conferenceCall&&!n.hasOtherParticipants()&&e.participantId===g.localUser.userId&&(D.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),P.publish("/conference/starting",[n])),r.removedParticipantIds.forEach((function(e){var t=n.removeParticipant(e);t&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",e),P.publish("/call/participant/removed",[n.callId,t]))})),r.updatedParticipants.length>0&&(D.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),P.publish("/call/participants/updated",[n.callId,r.updatedParticipants])),r.addedParticipants.length>0&&(D.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),P.publish("/call/participants/added",[n.callId,r.addedParticipants])),n.isTestCall||(e.session.recordings?e.session.recordings.forEach((function(e){st(n,e)})):st(n,e.session.recordingInfo)),n.isJoiningGroupCall=!1,Ie(),We(n,n.screenOwnerId,n.screenControllerId,!0),(c=n).callConnectedPostponed&&(c.callConnectedPostponed=!1,D.debug("[CircuitCallControlSvc]: Send pending call connected diagnostics data for instanceId = ",c.instanceId),M.sendCallConnected(c))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",e)}var c}))})),V.on("RTCSession.SESSION_STARTED",(function(e){if(ee)try{D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var t=me(e.sessionId);if(t&&t.isTestCall)return void D.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");e.session.turnServers&&Le(e.sessionId,e.session.turnServers);var n=de(e.convId);if(!n){D.info("[CircuitCallControlSvc]: Could not find corresponding conversation");var i=1===e.session.participants.length&&e.session.participants[0].userId;if(e.callOut&&i!==g.localUser.userId)return;return D.info("[CircuitCallControlSvc]: Get the conversation from the server"),void b.getConversationById(e.convId,{randomLoaded:!0},(function(e,t){e?D.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(D.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),V.getActiveSessions((function(e,n){g.$apply((function(){e&&(D.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),n=[]),Wt(t,n)}))})))}))}if(!n.hasJoined)return void D.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");g.$apply((function(){if(t)t.instanceId||t.setInstanceId(e.session.instanceId),D.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),D.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",t.state.name);else if(e.callOut){var i;oe&&oe.callId===e.sessionId&&(D.debug("[CircuitCallControlSvc]: The call was picked up by a remote client"),i=oe.pickUpFromUser,H.ignorePickupCall()),e.session.participants.some((function(t){return t.userId===g.localUser.userId&&t.clientId!==V.clientId&&(qe(n,t,e.rtcSession,e.sessionId,(function(e){e.pullNotAllowed=!0,i&&(e.pickUpFromUser=i)})),!0)}))}else if(n.type===o.ConversationType.GROUP||n.type===o.ConversationType.LARGE){var r=e.session.participants.find((function(e){return e.userId===g.localUser.userId&&e.clientId!==V.clientId}));qe(n,r,e.rtcSession,e.sessionId,(function(e){r||(D.debug("[CircuitCallControlSvc]: Publish /conference/started event"),P.publish("/conference/started",[e]))}))}ct(e.session.attendeeCount)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",e)}else D.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.")})),V.on("RTCSession.PARTICIPANT_JOINED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var t=e.participant.userId;if(g.localUser.userId===t)return void D.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var n=$e(e.sessionId);if(n)return void g.$apply((function(){n.pullNotAllowed&&(n.pullNotAllowed=!1),n.isTelephonyCall&&!n.atcCallInfo&&be(n,e.participant.phoneNumber,null,e.participant.userDisplayName)}));var i=me(e.sessionId);if(!i)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!i.isEstablished()&&i.direction===s.CallDirection.INCOMING)return void D.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");g.$apply((function(){e.participant.participantType===o.RTCParticipantType.VOICE_MAIL&&i.sessionCtrl.setCallStatsOptions({sendOnlyStream:!0}),!i.isTelephonyCall||i.atcCallInfo&&i.peerUser||be(i,e.participant.phoneNumber,null,e.participant.userDisplayName),i.checkState([s.CallState.Delivered,s.CallState.Waiting])&&(i.checkState(s.CallState.Delivered)?i.setState(s.CallState.Waiting):i.conferenceCall&&i.sessionCtrl.isConnected()&&i.setState(s.CallState.Active),i.activeClient=null,ut(i,!0));var n=Ue(e.participant),r=n.muted?s.ParticipantState.Muted:s.ParticipantState.Active;if(i.isTelephonyCall||Oe(n,i),i.hasParticipant(t)){var a=ot(i,n,r);a&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),P.publish("/call/participant/updated",[i.callId,a]))}else{var c=rt(i,n,r);c&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),P.publish("/call/participant/added",[i.callId,c]))}var l=e.userEnteredStage?{userEnteredStage:e.userEnteredStage}:null,d=i.getParticipant(n.userId);D.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),P.publish("/call/participant/joined",[i,d,l]),Ie(),i.updateMediaType(),i.isTestCall||i.recording.recordingUserId!==d.userId||(i.recording.recordingUser=d),ve(i)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",e)}})),V.on("RTCSession.SESSION_MOVED",(function(e){try{if(D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),te[e.oldRtcSessionId])return D.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete te[e.oldRtcSessionId];var t=he(e.oldRtcSessionId);if(!t)return void D.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var n=de(e.oldConversationId),i=de(e.newConversationId);if(!n||!i)return void D.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");g.$apply((function(){if(function(e,t,n){var i;i=n.isRemote?new u(t):new c(t,{clientId:n.clientId}),t.call=i,i.terminate(),D.debug("[CircuitCallControlSvc]: Publish /call/ended event"),P.publish("/call/ended",[i,!0]),t.call=null,_e(t),n.updateCall(e),e.call=n,_e(e),D.debug("[CircuitCallControlSvc]: Publish /call/moved event"),P.publish("/call/moved",[i.callId,n.callId]),ve(n)}(i,n,t),t.isRemote)D.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");else if(i.creatorId===g.localUser.userId){var e={};n.participants.forEach((function(t){e[t.userId]=!0})),i.participants.forEach((function(n){e[n.userId]||Qt(t,n)}))}}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",e)}})),V.on("RTCCall.INVITE",(function(e){ee?(D.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE"),g.isCMR?function(e){if(g.localUser.userPresenceState.state===o.PresenceState.BUSY)return D.info("[CircuitCallControlSvc]: CMR is updating its software. Reject the INVITE with cause BUSY."),void Qe(e);if(g.inviterUserId)g.inviterUserId===e.userId?nn(e):(D.info("[CircuitCallControlSvc]: INVITE is not from controlling user. Reject the INVITE with cause BUSY."),Qe(e));else{if(!g.circuitLabs.CMR_CONTROL_PANEL)return D.info("[CircuitCallControlSvc]: Control panel feature disabled on CMR. Reject the INVITE with cause BUSY."),void Qe(e);if(!g.displaysInfo||!g.displaysInfo.controller)return D.info("[CircuitCallControlSvc]: CMR does not have Control panel. Reject the INVITE with cause BUSY."),void Qe(e);te[e.sessionId]=e,V.isAllowedToAddCmr(e.userId,(function(t,n){te[e.sessionId]===e&&(delete te[e.sessionId],n?(g.cmrInviterUserId=e.userId,nn(e)):(t?D.error("[CircuitCallControlSvc]: Failed to check IS_ALLOWED_TO_ADD_CMR. ",t):D.info("[CircuitCallControlSvc]: Inviter is not allowed to add CMR. Reject the INVITE with cause BUSY."),Qe(e)))}))}}(e):nn(e)):D.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.")})),V.on("RTCSession.PARTICIPANT_LEFT",(function(e){g.$apply((function(){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var t=g.localUser.userId===e.userId,n=me(e.sessionId);if(t){if(n&&!n.isDirect&&!n.isEstablished()&&!le.includes(e.cause))return void D.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");!function(e,t){var n=t&&e.cause===o.RTCSessionParticipantLeftCause.REMOVED&&e.requesterId&&t.getParticipant(e.requesterId),i=[e.sessionId,e.cause];n&&i.push(n),D.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),P.publish("/localUser/leftConference",i),n&&U&&U.show({type:s.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_RemovedFromConferenceTitle,text:g.i18n.localize("res_RemovedFromConferenceBy",[n.displayName])}})}(e,n)}var i=$e(e.sessionId);if(i)return D.info("[CircuitCallControlSvc]: Event is for active remote call."),void(t&&je(i));if(!n)return void function(e){var t=Ze(e.sessionId);if(t&&!t.isDirect&&t.hasParticipant(e.userId)){D.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),at(t,e.userId,e.cause);var n=de(t.convId);n&&(qe(n),Ne(t,s.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else D.info("[CircuitCallControlSvc]: Event is not for local or alerting call. Ignore it.")}(e);if(n.isTestCall)return void D.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(!t||e.userId!==n.screenOwnerId&&e.userId!==n.screenControllerId||Ve(n.callId),n.isDirect&&!n.isDirectUpgradedToConf)return void(t||e.cause!==o.RTCSessionParticipantLeftCause.CONNECTION_LOST&&e.cause!==o.RTCSessionParticipantLeftCause.STREAM_LOST?D.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):n.setParticipantState(e.userId,s.ParticipantState.ConnectionLost));var r=e.userId,a=de(n.convId);if(t){if(qe(a),e.cause===o.RTCSessionParticipantLeftCause.REMOVED){var c=n.getParticipant(e.requesterId);P.publish("/call/droppedRemotely",[n,c])}else if(le.includes(e.cause))return void St(n,{error:"res_CallMediaFailed"});Ne(n,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause)}else{if(e.cause===o.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var l=a.participants.some((function(e){return e.userId===r})),d=function(e,t){e||(D.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),P.publish("/call/participant/rejected",[n.callId,t]))};return void(l?y.getUserById(r,d):d())}at(n,r,e.cause);var u=n.hasRemoteScreenShare()||n.hasLocalScreenShare();u!==n.previousScreenFeaturesState.ToggleScreenShare&&Zt(n,S.ToggleScreenShare.name,u)}n.screenControlSupported&&!n.hasRemoteScreenShare()&&(n.screenControlSupported=!1)}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",e)}}))})),V.on("RTCCall.SDP_FAILED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",e.cause);var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client");if(t.instanceId||t.setInstanceId(e.instanceId),e.cause===o.SdpFailedCause.SESSION_TERMINATED)return void D.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");g.$apply((function(){t.isEstablished()?t.sessionCtrl.renegotiationFailed("SDP failed received"):e.cause===o.SdpFailedCause.MAX_PARTICIPANTS_REACHED?St(t,{error:"res_JoinRTCSessionFailedPermission"}):t.isDirect&&t.isCallOut||(e.cause===o.SdpFailedCause.SESSION_STARTED_FAILED?Ne(t,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause):Je(t,null,s.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",e)}})),V.on("RTCSession.SESSION_TERMINATED",(function(e){try{if(D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),J[e.sessionId]&&delete J[e.sessionId],te[e.sessionId])return D.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete te[e.sessionId];var t=he(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",e.sessionId);if(t.terminateTimer)return void D.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");t.isTelephonyCall&&ne&&(D.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),t.setAtcHandoverInProgress(),N.cancel(ne),ne=null),g.$apply((function(){var n=e.cause;if(D.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",n),P.publish("/call/terminated",[t,n]),Ne(t,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+n),g.localUser.isOsBizCTIEnabled){var i=t.isOsBizFirstCall?H.findOsBizSecondCall():H.findOsBizFirstCall();i&&!i.checkState(s.CallState.Terminated)&&(P.publish("/call/terminated",[i]),Ne(i))}}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",e)}})),V.on("RTCCall.INVITE_CANCEL",(function(e){try{if(V.clientId===e.clientID)return void D.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(te[e.sessionId])return D.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete te[e.sessionId];g.$apply((function(){D.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",e.cause);var t=Ze(e.sessionId);if(t){if(!t.isDirect||e.cause===o.InviteCancelCause.ACCEPT){var n=de(t.convId),i=e.cause===o.InviteCancelCause.ACCEPT?{clientId:e.clientID}:null;qe(n,i,null,e.sessionId,(function(e){i&&e.isTelephonyCall&&be(e,t.peerUser.phoneNumber,null,t.peerUser.displayName)}))}var r=s.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;e.cause===o.InviteCancelCause.ACCEPT?r=s.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:e.cause===o.InviteCancelCause.REVOKED&&(r=s.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),Ne(t,r)}else if(D.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),e.cause===o.InviteCancelCause.ACCEPT){var a=he(e.sessionId);a&&a.isRemote&&(D.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),a.activeClient={clientId:e.clientID},a.setState(s.CallState.ActiveRemote),et(a),ve(a))}}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",e)}})),V.on("RTCCall.INVITE_FAILED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!t.isDirect){var n=t.getParticipant(e.userId);if(e.to){n.displayName=e.to.displayName;var i=ot(t,n);i&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),P.publish("/call/participant/updated",[t.callId,i]))}if(n&&n.isActive())return void D.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",e.userId)}if(e.clientID&&V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);t.isTelephonyCall&&e.to&&be(t,e.to.phoneNumber,e.to.fullyQualifiedNumber,e.to.displayName,e.to.userId),g.$apply((function(){var n,i=t,r=e.cause,a=e.userId;switch(r){case o.InviteFailedCause.NOT_REACHABLE:n=s.ParticipantState.Offline,i.isDirect&&i.setState(s.CallState.Failed);break;case o.InviteFailedCause.BUSY:n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Busy);break;case o.InviteFailedCause.DECLINE:n=s.ParticipantState.Declined,i.isDirect&&i.setState(s.CallState.Declined);break;case o.InviteFailedCause.TIMEOUT:n=s.ParticipantState.Timeout,i.isDirect&&i.setState(s.CallState.NotAnswered);break;case o.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case o.InviteFailedCause.INVALID_NUMBER:n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Failed);break;case o.InviteFailedCause.REVOKED:n=s.ParticipantState.Removed,i.isDirect&&i.setState(s.CallState.Failed);break;default:D.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",e.cause),n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Failed)}if(i.isDirect)i.setParticipantState(a,n),ve(i),i.hasVideo()&&i.removeParticipant(a),Je(i,null,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+r,!0);else{i.setParticipantState(a,n);var c=i.removeParticipant(a);c&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),P.publish("/call/participant/removed",[i.callId,c]),f.isEmptyArray(i.participants)&&(i.conferenceCall?i.checkState(s.CallState.Waiting)||(i.setState(s.CallState.Waiting),ve(i)):(i.setState(s.CallState.NotAnswered),ve(i),Je(null,null,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+r,!0))))}}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",e)}})),V.on("RTCSession.ACTIVE_SPEAKER",Mt),V.on("RTCSession.VIDEO_ACTIVE_SPEAKER",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var t=me(e.sessionId);if(!t)return void D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var n=t.getParticipant(e.userId);if(!n)return void D.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",e.userId);if(n.streamId===e.videoStreamId)return void D.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");g.$apply((function(){n.streamId=e.videoStreamId,tt(t,n),t.setParticipantRemoteVideoStream(n),t.checkForActiveRemoteVideo(),D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),P.publish("/call/participant/updated",[t.callId,n])}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",e)}})),V.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",(function(e){try{if(D.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED"),Ze(e.sessionId))return void Vt(e.sessionId,e.transactionId);var t=me(e.sessionId);if(!t||t.isRemote)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(e.clientID&&V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);if(t.activeClient)return void D.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!t.isEstablished()&&t.direction===s.CallDirection.INCOMING||!t.isDirect)return void Vt(t.callId,e.transactionId);g.$apply((function(){if(e.sdp){var n=t.sessionCtrl;if(!n.isConnStable())return void Vt(t.callId,e.transactionId);t.setTransactionId(e.transactionId),t.isTelephonyCall&&t.atcAdvancing&&"nooffer"!==e.sdp.type&&t.sessionCtrl.setIgnoreTurnOnNextPC();var i=function(i){n.onSessionDescription=null;var r={rtcSessionId:t.callId,sdp:i.sdp,transactionId:e.transactionId};V.changeMediaAccept(r,(function(e){g.$apply((function(){t.clearTransactionId(),e?D.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):D.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")}))}))};t.atcAdvancing=!1,Ce(t).then((function(r){(n.setTurnCredentials(r),A.isNoOfferSdp(e.sdp))?Be({callId:t.callId,transactionId:e.transactionId,mediaType:t.localMediaType,hosted:e.hosted,replaces:e.replaces},(function(e){e&&D.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")})):(t.lastMediaType=t.mediaType,n.onSessionDescription=i,n.setRemoteDescription(e.sdp,(function(i){i&&(n.onSessionDescription=null,t.transactionId===e.transactionId?Vt(t.callId,e.transactionId):D.warn("[CircuitCallControlSvc]: TransactionId: "+e.transactionId+" has already been completed."))})))})).catch((function(){Vt(t.callId,e.transactionId)}))}else Vt(t.callId,e.transactionId)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTED event. ",e)}})),V.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var t=me(e.sessionId);if(!t)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(t.isDirect)return void D.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(e.clientID&&V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: Event is not for this client: ",V.clientId);if(t.activeClient)return void D.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(e.removeMediaTypes){var n=null;e.removeMediaTypes.includes(o.RealtimeMediaType.AUDIO)&&(n={audio:!1}),e.removeMediaTypes.includes(o.RealtimeMediaType.VIDEO)&&((n=n||{}).video=!1),t.localMediaType.desktop&&e.removeMediaTypes.includes(o.RealtimeMediaType.DESKTOP_SHARING)&&((n=n||{}).desktop=!1),n&&g.$apply((function(){var i=null;if(void 0!==n.desktop){var r=e.removeMediaTypes.includes(o.RealtimeMediaType.AUDIO);D.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),P.publish("/screenshare/forceStop/started",[e.userId,r]),i=function(n){if(D.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),P.publish("/screenshare/forceStop/ended",[n]),!n){var i=e.userId&&t.getParticipant(e.userId),r=i&&i.displayName;U&&U.show({type:s.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Screenshare,text:r?g.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[r]):g.i18n.map.res_ScreenShareRemotelyDisabled}})}}}$t(t.callId,n,"changeMediaForced").then((function(){i&&i()})).catch((function(e){i&&i(e)}))}))}}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",e)}})),V.on("RTCCall.RTC_QUALITY_RATING_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCCall.RTC_QUALITY_RATING_EVENT");var t=K||Y;if(t)return D.info("[CircuitCallControlSvc]: Postpone call quality rating during call"),void(t.ratingEvent=e);g.$apply((function(){pt(e)}))})),V.on("RTCCall.IFRAME_STATISTICS",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCCall.IFRAME_STATISTICS"),g.$apply((function(){U&&U.show({type:s.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Screenshare,text:g.i18n.localize("res_ScreenShareIFrameDelay",[Math.round(e.receiveDuration/1e3)])}})}))})),V.on("RTCSession.PARTICIPANT_UPDATED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var t=me(e.sessionId),n=$e(e.sessionId)||t;if(n&&n.callId===e.sessionId&&n.isTelephonyCall&&!n.atcCallInfo&&g.localUser.userId!==e.participant.userId&&be(n,e.participant.phoneNumber,null,e.participant.userDisplayName),!t)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");g.$apply((function(){var n=e.participant.userId,i=e.participant.muted;if(g.localUser.userId!==n)if(t.isEstablished()||t.direction!==s.CallDirection.INCOMING){var r=t.getParticipant(e.participant.userId);if(r){var o=!r.videoPointerTo&&e.participant.videoPointerTo&&g.localUser.userId===e.participant.videoPointerTo,a=Ue(e.participant),c=a.muted?s.ParticipantState.Muted:s.ParticipantState.Active,l=r.muted!==a.muted,d=!r.hasSameMediaType(a)||r.streamId!==a.streamId,u=r.mediaType,E=ot(t,a,c);if(E){if(Oe(E,t),d){if(t.updateMediaType(),t.previousScreenFeaturesState.ToggleScreenShare!==t.mediaType.desktop){var C=t.hasRemoteScreenShare()||t.hasLocalScreenShare();Zt(t,S.ToggleScreenShare.name,C)}t.screenOwnerId!==E.userId||E.mediaType.desktop||(D.warn("[CircuitCallControlSvc]: screenOwnerId is no longer sharing the screen. Stop remote control."),Ve(t.callId))}(d||l||o)&&(D.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),P.publish("/call/participant/updated",[t.callId,E,u]))}ve(t)}else D.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",n)}else D.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");else t.remotelyMuted!==i&&(t.remotelyMuted=i,zt(t,e.mutedBy))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",e)}})),V.on("RTCSession.SESSION_RECORDING_INFO",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var t=me(e.sessionId);t?g.$apply((function(){st(t,e.recordingInfo)})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var t=me(e.sessionId);t?g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),P.publish("/call/sessionTerminateTimerChanged",[t.callId,e.endTime])})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var t=me(e.sessionId);t?g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),P.publish("/call/sessionTerminateTimerChanged",[t.callId,null])})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var t=me(e.sessionId);if(t){var n=e.type||o.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED;n!==o.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED||void 0!==e.attendeeCount&&t.attendeeCount!==e.attendeeCount?g.$apply((function(){switch(n){case o.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED:ct(e.attendeeCount);break;case o.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUESTED:t.preventScreenControlRequestInConf=!0;break;case o.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUEST_CLEARED:t.preventScreenControlRequestInConf=!1;break;case o.SessionAttributesChangedEventType.SCREEN_CONTROL_ESTABLISHED:We(t,e.screenControl.screenOwnerId,e.screenControl.screenControllerId,!0);break;case o.SessionAttributesChangedEventType.SCREEN_CONTROL_ENDED:We(t,null,null,!0);break;default:D.warn("[CircuitCallControlSvc]: Unexpected SessionAttributesChangedEventType - ",n)}})):D.debug("[CircuitCallControlSvc]: No changes")}else D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCCall.PROGRESS",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var t=me(e.sessionId);if(t)if(t.isDirect&&(t.instanceId||t.setInstanceId(e.instanceId),e.sdp||t.earlyMedia||e.progressType!==o.RTCProgressType.ALERTING?e.sdp&&e.progressType!==o.RTCProgressType.EARLY_CONNECT&&(t.earlyMedia=!0,t.receivedAlerting&&(D.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/stopped, call ID: ",t.callId),P.publish("/sound/call/alerting/stopped",[t]))):(t.isTelephonyCall&&(D.debug("[CircuitCallControlSvc]: Pre-allocate a new peer connection in case of immediate renegotiations"),t.sessionCtrl.prepareForRenegotiation()),t.receivedAlerting=!0,D.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/started, call ID: ",t.callId),P.publish("/sound/call/alerting/started",[t]))),t.checkState([s.CallState.Initiated,s.CallState.Delivered])){e.to&&t.isTelephonyCall&&!g.localUser.isATC&&be(t,e.to.phoneNumber,e.to.fullyQualifiedNumber,e.to.displayName,e.to.userId);try{g.$apply((function(){!e.sdp||"answer"!==e.sdp.type&&"pranswer"!==e.sdp.type||(e.sdp.type="pranswer",t.isPranswer=!0,t.sessionCtrl.setRemoteDescription(e.sdp,(function(n){n&&(t.setDisconnectCause(o.DisconnectCause.REMOTE_SDP_FAILED,"type="+e.sdp.type+" origin="+A.getOrigin(e.sdp.sdp)),Je(t,null,s.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))}))),t.setState(s.CallState.Delivered),ve(t)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",e)}}else D.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",t.state.name);else D.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.")})),V.on("RTCSession.INVITE_TO_STAGE_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT");var t=me(e.sessionId);t?(t.raiseHandState.videoAllowed=e.allowedMediaTypes.includes(o.RealtimeMediaType.VIDEO),t.raiseHandState.screenshareAllowed=e.allowedMediaTypes.includes(o.RealtimeMediaType.DESKTOP_SHARING),g.$apply((function(){var t={invitedByUserId:e.invitedByUserId,allowedMediaTypes:e.allowedMediaTypes,expirationTime:f.delayOrTimestamp(e.expirationDelay,e.expirationTime)};D.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",e.questionNumber),P.publish("/call/raiseHand/invite",[e.questionNumber,t])}))):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),me(e.sessionId)?g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",e.questionNumber),P.publish("/call/raiseHand/invite",[e.questionNumber,null])})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.QUESTION_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),me(e.sessionId)?g.$apply((function(){tn([e.question]).then((function(){D.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",e.question.questionNumber),P.publish("/call/raiseHand/question",[e.question,e.subType])}))})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.CURTAIN_EVENT",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),me(e.sessionId)?g.$apply((function(){K.curtain=e.curtain,D.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),P.publish("/call/curtain",[K.curtain])})):D.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")})),V.on("RTCSession.SCREEN_CONTROL_REQUESTED",(function(t){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REQUESTED");var n=me(t.sessionId);if(n){if(!n.hasLocalScreenShare()||!e.isElectron||!Re(n))return D.info("[CircuitCallControlSvc]: Screen control is not possible for local call. Reject it."),void H.rejectScreenControlRequest(n.callId,t.controllerId);var i=n.participants.find((function(e){return e.userId===t.controllerId}));return i?i.isSessionGuest||!g.localUser.remoteControlExternalEnabled&&i.isExternal?(D.info("[CircuitCallControlSvc]: Externals and Guests are not allowed to control. Reject it."),void H.rejectScreenControlRequest(n.callId,t.controllerId)):void g.$apply((function(){if(D.debug("[CircuitCallControlSvc]: Publish /screenControl/requested event"),P.publish("/screenControl/requested",[n,i]),!n.activeNotification){var e={type:s.NotificationType.SCREEN_CONTROL_REQUESTED,userId:t.controllerId,extras:{call:n,controllerId:t.controllerId}};U.show(e)}})):(D.info("[CircuitCallControlSvc]: Cannot find controller in participants list. Reject it."),void H.rejectScreenControlRequest(n.callId,t.controllerId))}D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")})),V.on("RTCSession.SCREEN_CONTROL_OFFERED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_OFFERED"),Ke(e,"SCREEN_CONTROL_OFFERED")})),V.on("RTCSession.SCREEN_CONTROL_ACCEPTED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_ACCEPTED"),Ke(e,"SCREEN_CONTROL_ACCEPTED")})),V.on("RTCSession.SCREEN_CONTROL_REJECTED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=me(e.sessionId);t?g.$apply((function(){Ye(e.sessionId),D.debug("[CircuitCallControlSvc]: Publish /screenControl/rejected event"),P.publish("/screenControl/rejected",[t])})):D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")})),V.on("RTCSession.SCREEN_CONTROL_REQUEST_REJECTED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=me(e.sessionId);t?g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /screenControl/requestRejected event"),P.publish("/screenControl/requestRejected",[t])})):D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")})),V.on("RTCSession.SCREEN_CONTROL_FAILED",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_FAILED");var t=me(e.sessionId);t?g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /screenControl/failed event"),P.publish("/screenControl/failed",[t]),Ye(e.sessionId,null,!0)})):D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")})),V.on("RTCSession.HANDOVER_SCREEN_CONTROL",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.HANDOVER_SCREEN_CONTROL");var t=me(e.sessionId);if(!t)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void D.info("[CircuitCallControlSvc]: The local call is not established");if(e.clientID&&V.clientId!==e.clientID)return void D.debug("[CircuitCallControlSvc]: handoverScreenControl event is not for this client: ",V.clientId);Fe(t.callId,t.screenControllerId,(function(e){e?(D.error("[CircuitCallControlSvc]: Could not transfer the screen control to the active user client."),Ve(t.callId)):(t.restartScreenControlSession=!1,D.debug("[CircuitCallControlSvc]: Successfully transferred the screen control to the active user client."))}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.HANDOVER_SCREEN_CONTROL event. ",e)}})),V.on("RTCSession.SCREEN_CONTROL_TERMINATED",(function(e){try{D.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_TERMINATED");var t=me(e.sessionId);if(!t)return void D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void D.info("[CircuitCallControlSvc]: The local call is not established");t.localMediaType.desktop&&(D.info("[CircuitCallControlSvc]: Stop screen control"),t.sessionCtrl.stopScreenControl((function(e){e?D.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e):D.debug("[CircuitCallControlSvc]: stopScreenControl was successful.")}))),g.$apply((function(){We(t,null,null,!0)}))}catch(e){D.error("[CircuitCallControlSvc]: Exception handling RTCSession.SCREEN_CONTROL_TERMINATED event. ",e)}})),V.on("RTCSession.LIVE_TRANSCRIPTION",(function(e){D.debug("[CircuitCallControlSvc]: Received RTCSession.LIVE_TRANSCRIPTION");var t=me(e.sessionId);t?e.text&&g.$apply((function(){e.timestamp=Date.now(),e.user=e.userId===g.localUser.userId?g.localUser:t.getParticipant(e.userId);var n=t.transcription;e.intermediate?(D.info("[CircuitCallControlSvc]: Handle intermediate transcription from ",e.userId),e.text+=" ...",n.intermediate=n.intermediate||[],n.intermediate.some((function(t){return t.userId===e.userId&&(t.timestamp=e.timestamp,t.text=e.text,!0)}))||n.intermediate.push(e)):(D.info("[CircuitCallControlSvc]: Handle final transcription from ",e.userId),n.intermediate&&n.intermediate.some((function(t,i){return t.userId===e.userId&&(n.intermediate.splice(i,1),!0)})),n.history=n.history||[],n.history.push(e),n.history.length>10&&n.history.shift());D.debug("[CircuitCallControlSvc]: Publish /call/liveTranscription event"),P.publish("/call/liveTranscription",[t,e])})):D.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")})),V.on("Team.NOTIFY",(function(e){D.debug("[CircuitCallControlSvc]: Received Team.NOTIFY"),e.callingUser?D.debug("[CircuitCallControlSvc]: This is a team notification for an incoming phone call. Let CstaSvc handle it."):H.getActiveCall()||H.getIncomingCall()?D.debug("[CircuitCallControlSvc]: Ignore event as the user has other calls"):e.callingUserId!==g.localUser.userId?oe&&oe.pickupSession===e.rtcSessionId?D.debug("[CircuitCallControlSvc]: Ignore event for call that is already notified"):g.$apply((function(){y.getUsersByIds([e.callingUserId,e.calledUserId],(function(n,i){var r,a;n?D.error("[CircuitCallControlSvc]: Error getting users"):i&&i.length&&2===i.length?(i.forEach((function(t){t.userId===e.callingUserId?r=t:a=t})),b.getDirectConversation(r.userId,(function(n,i){!n&&i||(i={rtcSessionId:e.rtcSessionId,convId:e.rtcSessionId,type:o.ConversationType.DIRECT,participants:[{userId:r.userId}]},i=b.createConversationAsGuest(i)),(oe=new u(i)).atcCallInfo=new t,oe.startRingingTimer=k,oe.setState(s.CallState.Ringing),oe.setRedirectingUser(null,null,a.displayName,a.userId,d.CallPickupNotification),oe.pickUpFromUser=a,oe.pickupSession=e.rtcSessionId,i.call=oe,_e(i),Bt(i,r.userId)}))):D.error("[CircuitCallControlSvc]: Unexpected result from getUsersByIds")}))})):D.debug("[CircuitCallControlSvc]: Ignore event as the calling user is the local user")})),V.on("Team.NOTIFY_CANCEL",(function(e){D.debug("[CircuitCallControlSvc]: Received Team.NOTIFY_CANCEL"),oe&&!oe.isTelephonyCall&&e.rtcSessionId===oe.pickupSession&&g.$apply((function(){H.ignorePickupCall()}))})),this.simulateRtcSessionEvent=function(e,t){var n={type:o.ContentType.RTC_SESSION,rtcSession:e};if(t){var i=H.getActiveCall();i&&(n.rtcSession.sessionId=i.callId)}V.simulateEvent(n)},this.initActiveSessionsForSdk=function(){return ee=!0,Ht()},this.initForUnitTests=function(){ee=!0},this.setDisableRemoteVideoByDefault=function(e){D.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!e),X=!!e},this.getDisableRemoteVideoByDefault=function(){return X},this.setClientDiagnosticsDisabled=function(e){Z=e},this.getCalls=function(){return W},this.getPhoneCalls=function(e){return W.filter((function(t){return t.isTelephonyCall&&(!e||!t.isRemote)}))},this.getEstablishedLocalPhoneCalls=function(){return W.filter((function(e){return e.isTelephonyCall&&e.state.established&&!e.isRemote}))},this.getActiveCall=function(e){return e?me(e):K&&K.replaces?K.replaces:K||null},this.hasActiveCall=function(){return!!K},this.isConnectionInProgress=function(e){var t=H.getActiveCall(e);return!!t&&!t.sessionCtrl.isConnStable()},this.getIncomingCall=function(){return j[0]||null},this.getActiveRemoteCall=function(){return q},this.joinGroupCall=function(e,t,n){if(n=n||k,!e)return D.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void n("Missing callId");var i=he(e);if(!i||!i.isRemote||i.state.name!==s.CallState.Started.name||i.activeClient)return D.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void n("Invalid call");var r=de(i.convId);if(!r||!r.call||r.call.callId!==i.callId)return D.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void n("Invalid conversation");i.isGuestInvite&&r.type===o.ConversationType.LARGE&&(D.info("[CircuitCallControlSvc]: in-circuit guest is joining large conference without audio"),t.audio=!1);var a=Jt({callOut:!1,handover:!1,joiningGroupCall:!0});Ge(r,t,a,n)&&Kt(r,t,a,n)},this.makeCall=function(e,t,n){if(n=n||k,!e)return D.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void n("Missing convId");var i=de(e);if(!i)return D.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",e),void n("Conversation not found");var r=Jt({callOut:!0,handover:!1});Ge(i,t,r,n)&&Kt(i,t,r,n)},this.pickupTeamCall=function(e,t,n){if(n=n||k,oe)if(oe.callId===e){var i=function(e){var i=Jt({callOut:!0,handover:!1,pickUpSession:oe.pickupSession,pickUpFromUser:oe.pickUpFromUser});Ge(e,t,i,n)&&Kt(e,t,i,n)},r=de(oe.convId);if(r){if(!r.isTemporary)return void i(r);D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[r])}b.createConversation(o.ConversationType.DIRECT,[{userId:oe.peerUser.userId}],null,(function(e,t){if(e||!t)return D.error("[CircuitCallControlSvc]: pickupTeamCall - Unable to create direct conversation. Err: ",e),void n("Failed to create conversation");i(t)}))}else n("Invalid callId");else n("No call to be picked up")},this.ignorePickupCall=function(){if(oe){D.info("[CircuitCallControlSvc]: Ignore pickup notification. callId = ",oe.callId),qt(oe);var e=de(oe.convId);e&&e.isTemporary&&(D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[e])),Ne(oe),D.info("[CircuitCallControlSvc]: Publish /call/terminated"),P.publish("/call/terminated",[oe]),oe=null}},this.makeEchoTestCall=function(e,t,n){H.makeEchoTestCallWithOptions(e,null,t,n)},this.makeEchoTestCallWithOptions=function(e,t,n,i){n=n||k,i=i||k;var r=g.isSessionGuest&&g.localUser.conversationId||"echo_"+g.localUser.clientId,o={creatorId:g.localUser.userId,convId:r,rtcSessionId:"echo_"+g.localUser.clientId,participants:[{userId:g.localUser.userId}],testCall:!0};n((o=w.extend(o)).rtcSessionId),N((function(){var n=Jt({callOut:!1,handover:!1},t);Ge(o,e,n,i)&&He(o,e,n,i)}),200)},this.dialNumber=function(e,t,n,i){i=i||k,b.getTelephonyConversation((function(r,o){if(r||!o)i(r);else{var a=Jt({callOut:!0,handover:!1,dialedDn:e,toName:t});Ge(o,n,a,i)&&Kt(o,n,a,i)}}))},this.dialPhoneNumber=function(e,t){t=t||k,e=e||{},b.getTelephonyConversation((function(n,i){if(n||!i)t(n);else{var r=Jt({callOut:!0,handover:!1,dialedDn:e.dialedDn,toName:e.toName,userId:e.userId,dtmfDigits:e.dtmfDigits});if(!Xt(i,r,t))return;if(K&&K.isTelephonyCall&&!K.isHolding())return void H.holdCall(K.callId,(function(n){n?t&&t(n):Ge(i,e.mediaType,r,t)&&Kt(i,e.mediaType,r,t)}));Ge(i,e.mediaType,r,t)&&Kt(i,e.mediaType,r,t)}}))},this.startConference=function(e,t,n){H.startConferenceWithOptions(e,t,null,n)},this.startConferenceWithOptions=function(e,t,n,i){if(t=t||{audio:!0,video:!1},i=i||k,!e)return D.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void i("Missing convId");var r=de(e);if(!r)return D.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",e),void i("Conversation not found");if(r.type!==o.ConversationType.GROUP&&r.type!==o.ConversationType.LARGE)return D.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void i("Invalid conversation type");var a=Jt({callOut:!1,handover:!1},n);Ge(r,t,a,i)&&Kt(r,t,a,i)},this.answerCall=function(e,t,n){n=n||k;var i,r,a,c=null;if(j.some((function(t,n){return e===t.callId&&(c=t,i=n,!0)})),!c)return D.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void n("No alerting call");function l(){if(c.isPresent()){Y=K,K=c,Ie(),j.splice(i,1),qt(K),K.stopRingingTimer(),K.setState(K.isATCCall?s.CallState.Waiting:s.CallState.Answering);var e=de(K.convId);if(!e||!e.call||e.call.callId!==K.callId)return D.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),Xe(K,{type:o.InviteRejectCause.BUSY},!1),void n("Conversation not found");ve(K),function(e,t,n,i){if(K){var r=K,o=r.sessionCtrl;n=n||{};o.onSessionDescription=function(a){o.onSessionDescription=null;var s={convId:e.convId,rtcSessionId:r.callId||e.rtcSessionId,ownerId:e.creatorId,sdp:a.sdp,mediaType:t,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:e.isTelephony,displayName:g.localUser.displayName,transactionId:r.transactionId,rtcSupportedFeatures:ke(r)};function c(e){g.$apply((function(){r.clearTransactionId(),e?(Ne(r,Me(e)),i(Te(e))):(D.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),i(null,n.warning,r))}))}s.sdp&&"offer"===s.sdp.type?V.joinRtcCall(s,c):(M.startJoinDelayTimer(r),V.answerRtcCall(s,c))},o.start(t,null)||(Ne(r,s.CallClientTerminatedReason.RTC_SESSION_START_FAILED),i(Te()))}else D.warn("[CircuitCallControlSvc]: joinSessionCalled invoked without _primaryLocalCall")}(e,r,{warning:a},n)}else n("No call to answer")}function d(){Yt(t,(function(e,t){if(t){var i=b.getConversationFromCache(c.convId);if(i&&i.isTelephony)return D.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Do not answer call."),void n("res_AnswerCallFailedNoMic")}r=e,a=t,l()}))}if(!K||!K.isPresent()||c.replaces||K.isTelephonyCall&&c.isTelephonyCall&&g.localUser.isRegisterTC){if(K&&K.isTelephonyCall&&g.localUser.isRegisterTC&&!K.isHolding())return void H.holdCall(K.callId,(function(e){e?n(e):d()}))}else Je(K,null,s.CallClientTerminatedReason.USER_ENDED),Y&&Je(Y,null,s.CallClientTerminatedReason.USER_ENDED);d()},this.endCall=function(e,t){var n=o.InviteRejectCause.DECLINE,i=H.getActiveCall();i&&i.callId===e&&(i.isEstablished()||i.direction===s.CallDirection.OUTGOING)&&(n=null),H.endCallWithCauseCode(e,n,t)},this.endCallWithCauseCode=function(e,t,n){var i=s.CallClientTerminatedReason.USER_ENDED,r=o.InviteRejectCause.DECLINE;t&&(i=t,o.InviteRejectCause[t]&&(r=t));var a=me(e);if(a)a.replaces&&a.checkState(s.CallState.Answering)?n("Auto answer in progress"):a.terminateTimer?(Ne(a,i),n&&N(n)):Je(a,r,i,!1,n);else if(K&&K.replaces&&K.replaces.callId===e)Je(K.replaces,r,i,!1,n);else{var c=he(e);if(c)return void(c.terminateTimer?(Ne(c),n&&N(n)):Je(c,r,i,!1,n));var l=Ze(e);if(l)Xe(l,{type:r},!1,n);else{D.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var d=b.getConversationByRtcSession(e);d&&d.call&&(d.call=null,_e(d)),n&&n("Call not found")}}},this.endConference=function(e,t){var n=he(e);n?g.isSessionGuest||n.isGuestInvite?t&&t("Not allowed"):function(e,t){if(t=t||k,e.isDirect)return D.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),void N(t);D.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",e.callId),V.terminateRtcCall(e.callId,e.disconnectCause,(function(n){g.$apply((function(){if(n&&(D.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",n),e===K)){var i=de(e.convId);i&&e.isEstablished()&&qe(i)}t&&t(n)}))})),e===K&&Ne(e,s.CallClientTerminatedReason.USER_ENDED)}(n,t):t&&t("Call not found")},this.startScreenShare=function(e,t,n){if(n=n||k,!e)return D.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void n("Invalid convId");var i=de(e);if(!i)return D.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",e),void n("Conversation not found");var r={audio:!0,video:!1,desktop:!0};t&&"string"==typeof t&&(t={screenShareType:t});var o=Jt({callOut:!0,handover:!1,screenShareOptions:t});Ge(i,r,o,n)&&He(i,r,o,(function(e){e||(D.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),P.publish("/screenshare/started")),n(e)}))},this.addScreenShare=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void n("No active call");var r=Object.assign({},i.localMediaType);r.desktop=!0,Et(i)||(r.video=!1),t&&"string"==typeof t&&(t={screenShareType:t}),ae=null,lt(i,t).then((function(o){var a={callId:e,mediaType:r,screenShareOptions:{screenIndex:o.screenIndex,streamId:o.streamId,screenType:t&&t.screenShareType,pointer:o.pointer,screenControlSupported:o.screenControlSupported,mediaStream:o.mediaStream}};i.videoPointerTo&&(a.mediaType.video=!1,a.videoPointerTo=null),Be(a,(function(e){if(e)return D.warn("[CircuitCallControlSvc]: AddScreenShare failed: ",e),void n(e);D.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),P.publish("/screenshare/started"),n()}))})).catch((function(e){n(e)}))},this.addMediaStream=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void n("No active call");var r=Object.assign({},i.localMediaType);r.desktop=!0,Et(i)||(r.video=!1),Be({callId:e,mediaType:r,screenShareOptions:{mediaStream:t}},(function(e){e?(D.warn("[CircuitCallControlSvc]: addMediaStream failed: ",e),n("res_AddMediaStreamFailed")):n()}))},this.addVideoStream=function(e,t,n){return new O((function(i,r){var o=me(e);if(!o)return D.warn("[CircuitCallControlSvc]: addVideoStream - There is no local call"),void r("No active call");if(!t)return D.warn("[CircuitCallControlSvc]: addVideoStream - There is stream to be added"),void r("No stream to be added");var a=Object.assign({},o.localMediaType);a.video=!0,Et(o)||(a.desktop=!1),Be({callId:e,mediaType:a,videoPointerTo:n&&n.videoPointerTo||null,videoOptions:{mediaStream:t}},(function(e){e?(D.warn("[CircuitCallControlSvc]: addVideoStream failed: ",e),r("res_AddVideoFailed")):i()}))}))},this.removeMediaStream=function(e,t){t=t||k,$t(e,{desktop:!1},"removeMediaStream").then(t).catch((function(){t("res_RemoveMediaStreamFailed")}))},this.requestScreenControl=function(e){return new O((function(t,n){D.debug("[CircuitCallControlSvc]: requestScreenControl...");var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: requestScreenControl - There is no local call"),void n("No active call");if(!i.hasRemoteScreenShare())return D.warn("[CircuitCallControlSvc]: requestScreenControl - Local call does not have remote screenshare"),void n("No screen share");if(!i.screenControlSupported)return D.warn("[CircuitCallControlSvc]: requestScreenControl - Screen control not supported by presenter"),void n("Not supported");var r=i.participants.find((function(e){return e.mediaType.desktop}));if(!r)return D.warn("[CircuitCallControlSvc]: requestScreenControl - Could not find screenshare presenter"),void n("No presenter");var o={rtcSessionId:i.callId,ownerId:r.userId};V.requestScreenControl(o,(function(e){g.$apply((function(){e?(D.error("[CircuitCallControlSvc]: Failed to request screen control. ",e),n(e)):(D.debug("[CircuitCallControlSvc]: requestScreenControl was successful. Wait for the SCREEN_CONTROL_OFFERED event."),t(),D.debug("[CircuitCallControlSvc]: Publish /screenControl/request event"),P.publish("/screenControl/request",[i,r]))}))}))}))},this.offerScreenControl=function(e,t){return new O((function(n,i){D.debug("[CircuitCallControlSvc]: offerScreenControl..."),Fe(e,t,(function(e){e?i(e):n()}))}))},this.rejectScreenControlRequest=function(e,t){return new O((function(n,i){D.debug("[CircuitCallControlSvc]: rejectScreenControlRequest...");var r=me(e);if(!r)return D.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - There is no local call"),void i("No active call");if(!t)return D.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - controllerId was not provided"),void i("No active call");var o={rtcSessionId:e,controllerId:t};V.rejectScreenControlRequest(o,(function(e){e?(D.error("[CircuitCallControlSvc]: Failed to reject screen control request. ",e),i(e)):(D.debug("[CircuitCallControlSvc]: rejectScreenControlRequest was successful."),We(r,null,null,!0),n())}))}))},this.stopScreenControl=function(e){return new O((function(t,n){Ye(e,(function(e){e?n(e):t()}))}))},this.sendDataMessage=function(e){D.debug("[CircuitCallControlSvc]: Sending WebRTC data");var t=H.getActiveCall();t&&t.sessionCtrl&&t.sessionCtrl.sendDataMessage(e)||D.error("[CircuitCallControlSvc]: Cannot send WebRTC data")},this.selectMediaToShare=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void n("No active call");D.debug("[CircuitCallControlSvc]: selectMediaToShare...");var r=Object.assign({},i.localMediaType);r.desktop=!0,Et(i)||(r.video=!1),t&&"string"==typeof t&&(t={screenShareType:t}),lt(i,t).then((function(i){Be({callId:e,mediaType:r,changeDesktopMedia:!0,screenShareOptions:{screenIndex:i.screenIndex,streamId:i.streamId,screenType:t&&t.screenShareType,pointer:i.pointer,screenControlSupported:i.screenControlSupported,mediaStream:i.mediaStream}},n)})).catch((function(e){n(e)})),P.publish("/screenshare/changed")},this.removeScreenShare=function(e,t){t=t||k,$t(e,{desktop:!1},"removeScreenShare").then(t).catch((function(){t("res_RemoveScreenShareFailed")}))},this.addAudio=function(e,t){t=t||k,$t(e,{audio:!0},"addAudio").then(t).catch((function(){t("Renegotiate for receive-only media failed")}))},this.removeAudio=function(e,t){t=t||k,$t(e,{audio:!1},"removeAudio").then(t).catch((function(){t("Renegotiate for receive-only media failed")}))},this.enableRemoteAudio=function(e){var t=me(e);t?t.remoteAudioDisabled&&(t.enableRemoteAudio(),D.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),P.publish("/call/remoteStreamUpdated",[t])):D.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(e){var t=me(e);t?t.remoteAudioDisabled||(t.disableRemoteAudio(),D.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),P.publish("/call/remoteStreamUpdated",[t])):D.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(e,t){t=t||k,$t(e,{video:!0},"addVideo").then(t).catch((function(){t("res_AddVideoFailed")}))},this.removeVideo=function(e,t){t=t||k,$t(e,{video:!1},"removeVideo").then(t).catch((function(){t("res_RemoveVideoFailed")}))},this.disableRemoteVideoOnly=function(e,t){t=t||k;var n=me(e);if(!n)return D.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");if(D.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable())if(n.remoteVideoDisabled)t("Remote video and screen share are already disabled");else if(n.remoteVideoScreenOnlyAllowed)t("Remote video is already disabled");else{var i=function(e){n.disableRemoteVideoScreenOnly(),D.warn("[CircuitCallControlSvc]: disableRemoteVideoOnly failed: ",e),t("res_ToggleVideoFailed")},r=n.enableRemoteVideoScreenOnly();if(n.supportsVideoReceiverConfiguration())en(n.callId,r).then((function(){P.publish("/call/toggleRemoteVideo"),t()})).catch(i);else P.publish("/call/toggleRemoteVideo"),Be({callId:e,mediaType:n.localMediaType},(function(e){e?i(e):t()}))}else t("Connection not stable")},this.enableRemoteVideo=function(e,t){t=t||k;var n=me(e);if(!n)return D.warn("[CircuitCallControlSvc]: enableRemoteVideo - There is no local call"),void t("No active call");if(D.debug("[CircuitCallControlSvc]: enableRemoteVideo..."),n.sessionCtrl.isConnStable()){var i=n.enableRemoteVideo(),r=function(){t(),!n.remoteVideoDisabled&&P.publish("/call/toggleRemoteVideo")},o=function(e){n.enableRemoteVideoScreenOnly(),D.warn("[CircuitCallControlSvc]: enableRemoteVideo failed: ",e),t("res_ToggleVideoFailed")};if(n.supportsVideoReceiverConfiguration())en(n.callId,i).then(r).catch(o);else Be({callId:e,mediaType:n.localMediaType},(function(e){e?o(e):r()}))}else t("Connection not stable")},this.toggleRemoteVideo=function(e,t){t=t||k;var n=me(e);if(!n)return D.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");if(D.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable()){var i;n.remoteVideoDisabled?i=n.enableRemoteVideo():(i=n.disableRemoteVideo(),P.publish("/call/toggleRemoteVideo"));var r=function(){t(),n.state&&n.state.established&&n.remoteControlActive&&!n.hasRemoteScreenShare()&&Ve(n.callId),!n.remoteVideoDisabled&&P.publish("/call/toggleRemoteVideo")},o=function(e){n.remoteVideoDisabled?n.enableRemoteVideo():n.disableRemoteVideo(),D.warn("[CircuitCallControlSvc]: toggleRemoteVideo failed: ",e),t("res_ToggleVideoFailed")};if(n.supportsVideoReceiverConfiguration())D.debug("New video receiver configuration: ",i),en(n.callId,i).then(r).catch(o);else Be({callId:e,mediaType:n.localMediaType},(function(e){e?o(e):r()}))}else t("Connection not stable")},this.changeHDVideo=function(t,n,i,r){i=i||k;var o=me(t);if(!o)return D.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void i("No active call");if(!o.localMediaType.video)return D.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void i("No video");if(n=!!n,!e.isSDK&&!g.localUser.canUseHDVideo)return D.warn("[CircuitCallControlSvc]: changeHDVideo - User does not have HD video permission"),void i("No HD permission");if(D.debug("[CircuitCallControlSvc]: changeHDVideo - hdVideo = ",n),o.localMediaType.hdVideo===n)return D.debug("[CircuitCallControlSvc]: changeHDVideo - No changes"),void i(null,null);Tt(r)||(r=null);var a=Object.assign({},o.localMediaType);a.hdVideo=n,a.videoResolution=r,Be({callId:t,mediaType:a},(function(e){if(e)D.warn("[CircuitCallControlSvc]: changeHDVideo failed: ",e),i("res_ToggleVideoFailed");else{var t=null;r&&r!==o.localMediaType.videoResolution&&(t="res_ToggleVideoResolutionNotSupported"),i(null,t)}}))},this.changeVideoResolution=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: changeVideoResolution - There is no local call"),void n("No active call");if(!i.localMediaType.video||!i.localMediaType.hdVideo)return D.warn("[CircuitCallControlSvc]: changeVideoResolution - Local call has no HD video"),void n("No HD video");if(D.debug("[CircuitCallControlSvc]: changeVideoResolution - newResolution = ",t),Tt(t)){if(i.localMediaType.videoResolution===t)return D.debug("[CircuitCallControlSvc]: changeVideoResolution - No changes"),void n(null,null);var r=Object.assign({},i.localMediaType);r.videoResolution=t,Be({callId:e,mediaType:r},(function(e){e?(D.warn("[CircuitCallControlSvc]: changeVideoResolution failed: ",e),n("res_ToggleVideoFailed")):n(null,i.localMediaType.videoResolution!==t?"res_ToggleVideoResolutionNotSupported":null)}))}else n("Invalid resolution")},this.toggleVideo=function(e,t){t=t||k;var n=me(e);if(!n)return D.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void t("No active call");$t(e,{video:!n.localMediaType.video},"toggleVideo").then(t).catch((function(){t("res_ToggleVideoFailed")}))},this.toggleCamera=function(e,t,n){if(n=n||k,t){var i=me(e);return i?i.localMediaType.video?void _.getMediaSources((function(i,r){var o=r.find((function(e){return e.id===t}));o?(f.addDeviceToPreferredList(T.videoDevices,o),$t(e,{},"toggleCamera").then(n).catch((function(){n("res_ToggleVideoFailed")}))):n("Device not found")})):(D.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void n("No video")):(D.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void n("No active call"))}n("No device ID")},this.renegotiateMedia=function(e,t,n){t=t||k,$t(e,{},"renegotiateMedia",n).then(t).catch((function(e){t(e||"Renegotiate media failed")}))},this.setMediaType=function(e,t,n){if(n=n||k,!me(e))return D.warn("[CircuitCallControlSvc]: setMediaType - There is no local call"),void n("No active call");D.debug("[CircuitCallControlSvc]: setMediaType..."),Be({callId:e,mediaType:t},(function(e){e?(D.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),n("Renegotiate media failed")):n()}))},this.holdCall=function(e,t){t=t||k;var n=me(e);return n?n.isHolding()||n.isHoldInProgress()?(D.debug("[CircuitCallControlSvc]: holdCall - The call is already held"),void t()):(D.debug("[CircuitCallControlSvc]: holdCall..."),n.setHoldInProgress(),void Be({callId:e,mediaType:n.localMediaType,hold:!0},(function(e){n.clearHoldInProgress(),e?(D.warn("[CircuitCallControlSvc]: Failed to hold the call"),t("res_HoldCallFailed")):t()}))):(D.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void t("No active call"))},this.retrieveCall=function(e,t){t=t||k;var n=me(e);if(!n.isHolding())return D.debug("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void t();D.debug("[CircuitCallControlSvc]: retrieveCall..."),n.setRetrieveInProgress(),Be({callId:e,mediaType:n.localMediaType,hold:!1},(function(e){if(n.clearRetrieveInProgress(),e)D.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),t("res_RetrieveCallFailed");else{n===Y&&(Y=K,K=n);var i=de(K.convId);i.call=K,_e(i),t()}}))},this.swapCall=function(e,t){if(t=t||k,!(Y=H.getPhoneCalls(!0).length>1?Pe(!0):null)||!K)return D.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void t("No calls to swap");if(Y&&Y.callId!==e)return D.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void t("Wrong callId");var n=Y.callId,i=K.callId;H.holdCall(i,(function(e){e?t&&t(e):H.retrieveCall(n,t)}))},this.pullRemoteCall=function(e,t,n){n=n||k;var i=$e(e);if(!i)return D.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void n("No active remote call");if(i.pullNotAllowed)n("res_PullCallNotAllowed");else{var r=de(i.convId);if(!r||!r.isTelephony&&r.call.callId!==e)return D.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void n("Conversation not found");!0,K&&K.isTelephonyCall?H.holdCall(K.callId,(function(e){e?n&&n(e):o()})):o()}function o(){var t=i.activeClient||{},o={audio:!0,video:!(!t.mediaType||!t.mediaType.video)};o.video=!1;var a=Jt({callOut:!1,handover:!0,callId:e,pickUpFromUser:i.pickUpFromUser,pickUpUserId:i.pickUpUserId});Ge(r,o,a,n)&&Kt(r,o,a,n)}},this.endRemoteCall=function(e,t){t=t||k;var n=$e(e);if(!n)return D.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void t("No active remote call");var i=de(n.convId);if(!i||i.call.callId!==e)return D.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void t("Conversation not found");!function(e,t){D.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",e.callId),e.isDirect?V.terminateRtcCall(e.callId,e.disconnectCause,(function(e){g.$apply((function(){e&&D.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",e),t(e)}))})):V.leaveRtcCall(e.callId,e.disconnectCause,(function(e){g.$apply((function(){e&&D.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",e),t(e)}))}))}(n,(function(e){e?t("res_EndRemoteCallFailed"):(je(n),t())}))},this.hideRemoteCall=function(e){var t=he(e);t?Ne(t):D.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(e,t,n){n=n||k;var i=me(e);return!i||i.isDirect?(D.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void n("Call invalid")):t&&t.userId?(t.isCMP&&t.isMeetingPointInvitee&&!pe(i.participants)&&(i.setMeetingPointInviteState(!1),H.enableRemoteAudio(e)),D.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",t.userId),void function(e,t){if(t=t||k,K){var n=K.getParticipant(e);if(n)if(n.actions.includes(s.ParticipantAction.Drop)){var i={rtcSessionId:K.callId,userId:e};V.removeSessionParticipant(i,(function(e){g.$apply((function(){e?(D.warn("[CircuitCallControlSvc]: Failed to remove participant"),t("res_RemoveParticipantFailed")):t()}))}))}else D.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",n.pcState.name),t("Participant not active");else D.error("[CircuitCallControlSvc]: call participant not found: ",e),t("Participant not found")}else t("No active call")}(t.userId,n)):(D.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void n("Participant invalid"))},this.addParticipantToCall=function(e,t,n){var i=me(e);i?Qt(i,t,n):(D.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),n&&n("Invalid callId"))},this.addParticipantToRtcSession=function(e,t,n){var i=he(e);i?Qt(i,t,n):(D.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),n&&n("Invalid callId"))},this.mute=function(e,t){t=t||k;var n=me(e);if(!n||e!==n.callId)return D.warn("[CircuitCallControlSvc]: mute - There is no local call"),void t("Call not valid");n.locallyMuted?t("Call already muted"):(D.debug("[CircuitCallControlSvc]: Mute the local call"),n.mute((function(){g.$apply((function(){D.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),P.publish("/call/localUser/mutedSelf",[e,!0]),H.muteParticipant(n.callId,g.localUser,(function(e){e&&D.warn("[CircuitCallControlSvc]: Error synchronizing local mute with backend.",e)})),t()}))})))},this.unmuteLocally=function(e){e=e||k,K?K.locallyMuted?(D.debug("[CircuitCallControlSvc]: Unmute the local call"),K.unmute((function(t){g.$apply((function(){t||(D.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),P.publish("/call/localUser/mutedSelf",[K.callId,!1])),e(t)}))}))):e():e("Call not found")},this.unmute=function(e,t){t=t||k;var n=me(e);n?n.isMuted()?H.unmuteLocally((function(e){e?t(e):H.unmuteParticipant(n.callId,g.localUser,t)})):t("Call not muted"):D.warn("[CircuitCallControlSvc]: unmute - There is no local call")},this.toggleMute=function(e,t){t=t||k;var n=me(e);return n?n.isLocalMuteAllowed()?void(n.isMuted()?H.unmute(n.callId,t):H.mute(n.callId,t)):(D.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void t()):(D.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void t("Call not valid"))},this.muteParticipant=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return D.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void n("Participant invalid");D.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!0};V.muteParticipant(o,(function(e){g.$apply((function(){e?(D.warn("[CircuitCallControlSvc]: Failed to mute participant"),n("res_MuteParticipantFailed")):n()}))}))},this.hasUnmutedParticipants=function(e){var t=me(e);return t&&e===t.callId?t.hasUnmutedParticipants():(D.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(e,t){t=t||k;var n=me(e);if(!n||e!==n.callId)return D.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void t("Call invalid");if(n.hasUnmutedParticipants()){D.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var i={rtcSessionId:n.callId,muted:!0,excludedUserIds:[g.localUser.userId]};V.muteRtcSession(i,(function(e){g.$apply((function(){e?(D.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),t("res_MuteAllOtherParticipantsFailed")):t()}))}))}},this.unmuteParticipant=function(e,t,n){n=n||k;var i=me(e);if(!i)return D.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return D.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void n("Participant invalid");if(r!==g.localUser.userId)return D.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void n("Cannot unmute others");D.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!1};V.muteParticipant(o,(function(e){g.$apply((function(){e?(D.warn("[CircuitCallControlSvc]: Failed to unmute participant"),n("res_UnmuteParticipantFailed")):(i.remotelyMuted=!1,zt(i),n())}))}))},this.toggleMuteParticipant=function(e,t,n){if(n=n||k,!me(e))return D.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void n("Call invalid");t&&t.userId?t.muted?H.unmuteParticipant(e,t,n):H.muteParticipant(e,t,n):(D.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),n("Participant invalid"))},this.stopRingingTone=function(e){var t=Ze(e);t?(t.ringToneStopped=!0,D.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",e),P.publish("/call/ringingTone/stop",[e])):D.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",e)},this.endActiveCall=function(e){e=e||k,K?H.endCall(K.callId,e):e("No active call")},this.startRecording=function(e,t,n){if(!K)return D.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void e("No active call");var i;i="boolean"==typeof t?{audio:!0,video:t,text:!1}:t instanceof Object?t:{audio:!0,video:!0,text:!1},n=n||{layoutName:o.RecordingVideoLayoutName.SINGLE,layoutMapping:[]};var r={convId:K.convId,rtcSessionId:K.callId,recordingMediaTypes:i,videoLayout:n};V.startRecording(r,on(e))},this.stopRecording=function(e,t){if(!K)return D.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void e("No active call");var n={convId:K.convId,rtcSessionId:K.callId,recordingMediaTypes:t||{audio:!0,video:!0,text:!1}};V.stopRecording(n,on(e))},this.startTranscription=function(){return new O((function(e,t){H.startRecording((function(n){n?(D.error("[CircuitCallControlSvc]: Failed to start transcription. ",n),t(n)):e()}),{text:!0})}))},this.stopTranscription=function(){return new O((function(e,t){H.stopRecording((function(n){n?(D.error("[CircuitCallControlSvc]: Failed to stop transcription. ",n),t(n)):e()}),{text:!0})}))},this.switchRecordingLayout=function(e,t){if(!K)return D.warn("[CircuitCallControlSvc]: switchRecordingLayout - There is no local call"),void t("No active call");if(!e||!e.layoutName)return D.warn("[CircuitCallControlSvc]: switchRecordingLayout - Missing or invalid videoLayout"),void t("Invalid videoLayout");var n={rtcSessionId:K.callId,videoLayout:e};V.switchRecordingLayout(n,on(t))},this.startRecordingParticipant=function(e){return new O((function(t,n){if(!K)return D.warn("[CircuitCallControlSvc]: startRecordingParticipant - There is no local call"),void n("No active call");var i={layoutName:o.RecordingVideoLayoutName.SINGLE_VIDEO,layoutMapping:[{tileId:"Video",tileContent:e}]};K.recording.isActive()?(D.info("[CircuitCallControlSvc]: startRecordingParticipant - Switch layout to record userId = ",e),H.switchRecordingLayout(i,(function(e){e?n(e):t()}))):(D.info("[CircuitCallControlSvc]: startRecordingParticipant - Start recording call with focus on userId = ",e),H.startRecording((function(e){e?n(e):t()}),{audio:!0,video:!0,text:!1},i))}))},this.submitCallQualityRating=function(e,t,n){if(!e||!e.hasOwnProperty("rating")||!t)return D.warn("[CircuitCallControlSvc]: submitCallQualityRating - Missing rating or call data"),void(n&&n("No rating data"));Object.assign(e,t),V.submitCallQualityRating([e],(function(e){g.$apply((function(){n&&n(e),e||(D.debug("[CircuitCallControlSvc]: Publish /call/rated event"),P.publish("/call/rated"))}))}))},this.raiseQuestion=function(e,t,n){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void n("No active event");var i={convId:K.convId,rtcSessionId:K.callId,question:e,displayName:g.localUser.displayName,isAnonymous:!!t};V.raiseQuestion(i,(function(e,t){g.$apply((function(){n&&n(e,t)}))}))},this.inviteToStage=function(e,t){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void t("No active event");var n={convId:K.convId,rtcSessionId:K.callId,questionNumber:e,allowedMediaTypes:[o.RealtimeMediaType.AUDIO,o.RealtimeMediaType.VIDEO,o.RealtimeMediaType.DESKTOP_SHARING]};V.inviteToStage(n,on(t))},this.inviteToStageAnswer=function(e,t,n){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void n("No active event");var i={convId:K.convId,rtcSessionId:K.callId,questionNumber:e,isAccepted:!!t};t&&ie&&(D.debug("[CircuitCallControlSvc]: inviteToStageAnswer - force renewal of turn credentials"),ie.expirationTimestamp=0),V.inviteToStageAnswer(i,(function(i){g.$apply((function(){!i&&t?H.addAudio(K.callId,(function(t){t?(D.debug("[CircuitCallControlSvc]: inviteToStageAnswer - Unable to access a microphone, sending decline"),H.inviteToStageAnswer(e,!1),t="res_AccessToAudioInputDeviceFailed"):H.unmuteLocally(),n&&n(t)})):n&&n(i)}))}))},this.inviteToStageCancel=function(e,t){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void t("No active event");var n={convId:K.convId,rtcSessionId:K.callId,questionNumber:e};V.inviteToStageCancel(n,on(t))},this.removeFromStage=function(e,t){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void t("No active event");var n={convId:K.convId,rtcSessionId:K.callId,userToRemoveId:e||g.localUser.userId};V.removeFromStage(n,on(t))},this.getQuestions=function(e,t,n){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void n("No active event");var i={convId:K.convId,rtcSessionId:K.callId,startQuestionNumber:e,numberOfQuestions:t};V.getQuestions(i,(function(e,t){g.$apply((function(){e?n(e):tn(t).then((function(){n(null,t)}))}))}))},this.updateQuestionState=function(e,t,n){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void n("No active event");var i={convId:K.convId,rtcSessionId:K.callId,questionNumber:e,newQuestionState:t};V.updateQuestionState(i,(function(e,t){g.$apply((function(){n&&n(e,t)}))}))},this.openCurtain=function(e){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void e("No active event");var t={convId:K.convId,rtcSessionId:K.callId};V.openCurtain(t,on(e))},this.closeCurtain=function(e,t,n,i){if(!K||!K.isLarge)return D.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void i("No active event");var r={curtainState:e};t&&(r.message=t),n&&(r.pauseDuration=n);var o={convId:K.convId,rtcSessionId:K.callId,curtain:r};V.closeCurtain(o,on(i))},this.getNodeState=function(e,t,n){var i={convId:"noCall",nodeType:e,tenantId:t||""};V.getNodeState(i,(function(e,t){g.$apply((function(){e&&D.error("[CircuitCallControlSvc]: Failed to get node(s). ",e),n&&n(e,t)}))}))},this.canSendWebRTCDigits=function(){return K&&K.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(e,t,n){return n=n||k,me(e)?t?/^[\d#*,]+$/.exec(t)?void function(e,t,n){var i=me(e);if(!i)return D.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),void n("Invalid callId");D.info("[CircuitCallControlSvc]: Sending DTMF Digits. Num of digits: ",t&&t.length),i.sessionCtrl.sendDTMFDigits(t)?n():(D.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),n("res_CannotSendDTMF"))}(e,t,n):(D.error("[CircuitCallControlSvc]: Digits cannot be sent: "+t+" (Allowed: 0-9,#,*)"),void n("res_InvalidDtmf")):void n("res_InvalidDtmf"):(D.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void n("Call not valid"))},this.disableIncomingVideo=function(e){K&&K.sameAs(e)&&(D.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",K.callId),K.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(e){K&&K.sameAs(e)&&(D.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",K.callId),K.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(e){var t=me(e);t?t.pointer&&t.pointer.isSupported?(t.pointer.isEnabled=!t.pointer.isEnabled,Be({callId:t.callId,transactionId:t.transactionId,mediaType:t.localMediaType})):D.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):D.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=he,this.findLocalCallByCallId=me,this.findActivePhoneCall=De,this.findHeldPhoneCall=Pe,this.sendParticipantPointer=function(e,t,n){var i={content:{type:"PARTICIPANT_POINTER",x:t,y:n,userId:g.localUser.userId},destUserId:e};B.sendDesktopAppRequest(i,(function(e){e?D.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",e):D.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")}))},this.removeCallFromList=fe,this.isSecondCall=function(){return K||j.length>=1||!f.isEmptyArray(q)},this.updateActiveCallMediaDevices=function(){K&&K.updateMediaDevices()},this.addSimulatedParticipants=function(){var e=H.getActiveCall();if(e&&!e.isDirect&&e.isMocked&&!(e.participants.length>0)){var t=function(){e.isPresent()&&0!==e.participants.length&&(at(e,e.participants[0].userId),e.participants.length>0&&N(t,2500))},n=function(i){var r,a=Ue((r={isSimulated:!0,userId:(5e4+i).toString(),mediaTypes:[o.RealtimeMediaType.AUDIO],muted:!1},i>0&&!(i%6)?(r.participantType=o.RTCParticipantType.MEETING_POINT,r.userDisplayName="CMR ("+i+")"):(r.participantType=o.RTCParticipantType.SESSION_GUEST,r.userDisplayName=[Math.floor(i/10),i%10].join(" "),i%9||r.mediaTypes.push(o.RealtimeMediaType.VIDEO)),r));!e.isMeetingPointInvited&&a.isCMP&&(a.isMeetingPointInvitee=!0,a.cmrData={},e.setMeetingPointInviteState(!0),jt(e.callId));var c=rt(e,a,s.ParticipantState.Active);P.publish("/call/participant/added",[e.callId,c]),P.publish("/call/participant/joined",[e,c]),Ie(),i<19?N((function(){e.isPresent()&&n(i+1)}),2500):N(t,12e4)};n(0),e.setState(s.CallState.Active),ve(e)}},this.hasScreenControlFeature=Re,this.canStartScreenShare=function(e){var t=me(e);if(!t)return D.warn("[CircuitCallControlSvc]: canStartScreenShare - There is no local call"),!1;if(!t.hasRemoteScreenShare())return!0;if(!t.participants.some((function(e){return e.isModerator&&e.mediaType&&e.mediaType.desktop})))return!0;if(g.isSessionGuest||t.isGuestInvite)return!1;var n=b.getConversationFromCache(t.convId);return!!n&&n.userIsModerator(g.localUser)},this.canStartRecording=function(e){if(g.isSessionGuest)return!1;var t=me(e),n=b.getConversationFromCache(t.convId);return t&&n?!(t.isDirect||t.isGuestInvite||t.moderatorLeftNotifyTime||!t.checkState([s.CallState.Active,s.CallState.Waiting])||n.isModerated&&!n.userIsModerator(g.localUser)):(D.warn("[CircuitCallControlSvc]: canStartRecording - Cannot find active call or conversation"),!1)},this.canTakeScreenshot=function(e,t){if(g.browser.msie)return!1;var n=me(e);return!!n&&(t.mediaType&&t.mediaType.desktop?!!(n.isDirect&&t.streamId||t.streams&&t.streams.desktop):!(!g.localUser.isICMixedUser&&!g.localUser.isICOnlyUser)&&(t===g.localUser&&n.localStreams.video||!!t.hasVideoStream&&t.hasVideoStream()))},this.addConferenceAsGuest=function(e){var t=de(e);if(t&&t.isTemporary&&t.guestToken){D.debug("[CircuitCallControlSvc]: Create placeholder remote call for temporary guest conversation with convId = ",t.convId);var n=new u(t);n.setState(s.CallState.NotStarted),n.guestToken=t.guestToken,Ae(n),t.call=n,_e(t),ve(n)}else D.warn("[CircuitCallControlSvc]: addConferenceAsGuest - No temporary conversation or guest token is missing")},this.removeConferenceAsGuest=function(e){var t=he(e);if(t)if(t.isRemote){var n=de(t.convId);n&&n.isTemporary?(Ne(t),D.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),P.publish("/conversation/temporary/ended",[n])):D.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - No temporary conversation")}else D.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Cannot remove temporary conversation with active call");else D.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Could not find call")},this.testCandidatesCollection=function(e){return e?(D.debug("[CircuitCallControlSvc]: Test ICE candidates collection with TURN..."),new O((function(e,t){var n="echo_"+g.localUser.clientId,i={convId:g.isSessionGuest&&g.localUser.conversationId||n,rtcSessionId:n,ownerId:g.localUser.userId,isTelephonyConversation:!1,mediaNode:T.mediaNode};D.debug("[CircuitCallControlSvc]: testIceCandidates - Get TURN servers"),V.prepareSession(i,(function(i,r){if(i)return D.error("[CircuitCallControlSvc]: Failed to prepare session data. ",i),void t(i);if(!r||!r.length)return V.terminateRtcCall(n,o.DisconnectCause.HANGUP),D.error("[CircuitCallControlSvc]: Failed to prepare session data. No TURN servers."),void t("No TURN servers");var a=r[0];D.debug("[CircuitCallControlSvc]: testIceCandidates - TURN servers: ",a.turnServer),dt(a).then((function(t){V.terminateRtcCall(n,o.DisconnectCause.HANGUP,(function(){e(t)}))})).catch((function(e){V.terminateRtcCall(n,o.DisconnectCause.HANGUP,(function(){t(e)}))}))}))}))):(D.debug("[CircuitCallControlSvc]: Test ICE candidates collection without TURN..."),dt())},this.addCallToList=Ae,this.moveOsBizCalls=function(e,t){if(D.debug("[CircuitCallControlSvc]: Move oldCall: "+e.callId+" to newCall: "+t.callId),e.isOsBizFirstCall){var n=t.atcCallInfo;e.atcCallInfo=n,e.setPeerUser(e.atcCallInfo.peerDn,e.atcCallInfo.peerName),e.setCstaState(s.CstaCallState.Active),e.setState(s.CallState.Active),e.isOsBizFirstCall=!1,Ne(t)}else Ne(e),t.isOsBizFirstCall=!1,t.isOsBizSecondCall=!1},this.findOsBizFirstCall=function(){return W.find((function(e){return e.isOsBizFirstCall}))||null},this.findOsBizSecondCall=function(){return W.find((function(e){return e.isOsBizSecondCall}))||null},this.getCallToPickup=function(){return oe},this.getConferenceParticipants=function(e){return new O((function(t,n){D.debug("[CircuitCallControlSvc]: Get participants for call with callId = ",e);var i=he(e);return i?i.isRemote?void V.getSession(e,(function(e,i){g.$apply((function(){if(e||!i)D.warn("[CircuitCallControlSvc] Error retrieving RTC session. Err: ",e),n(e);else{var r=i.participants.map((function(e){return Ue(e)})),o=r.filter((function(e){return e.noData})).map((function(e){return e.userId}));y.getUsersByIds(o,(function(){t(r)}))}}))})):(D.warn("[CircuitCallControlSvc]: This is a local call. Return local participants."),void t(i.participants)):(D.warn("[CircuitCallControlSvc]: Call does not exist"),void n("Call does not exist"))}))},this.mergeCalls=function(e,t){return new O((function(n,i){D.debug("[CircuitCallControlSvc]: Merge calls ",[e,t]);var r=he(e),o=he(t);if(!r||!o)return D.warn("[CircuitCallControlSvc]: Call does not exist"),void i("Call does not exist");V.mergeRtcCalls(e,t,(function(e){e?(D.warn("[CircuitCallControlSvc]: Error merging calls. Err: ",e),i(e)):n()}))}))},this.changeInputDevices=function(e,t){var n=H.getActiveCall();return n&&n.callId===e?t&&(t.audio||t.video)?t.video||n.isVdi?new O((function(t,n){H.renegotiateMedia(e,(function(e){e?n(e):t()}))})):n.sessionCtrl.changeInputDevices(t):O.resolve():O.reject("Call not found")},this.setIncomingVideoStreams=function(e,t){var n=H.getActiveCall();if(n&&n.callId===e){if(H.isPinVideoSupported(e)){D.debug("[CircuitCallControlSvc]: Set video receiver configuration: ",t||"DEFAULT");var i=n.setIncomingVideoStreams(t);return i&&i.length?en(e,i):O.resolve()}return O.reject("Not supported")}return O.reject("Call not found")},this.isTranscriptionSupported=V.isTranscriptionSupported,this.updateScreenEnabledFeature=Zt,this.getNetworkQualityInfo=function(e){var t=H.getActiveCall(e);if(t&&t.sessionCtrl){var n=t.sessionCtrl.getLastSavedStats();if(n.quality)return n.quality}else D.warn("[CircuitCallControlSvc]: getNetworkQualityInfo: "+(e?"Call not found: "+e:"No active call"));return null},this.isPinVideoSupported=function(e){var t=e&&H.getActiveCall(e);return _.unifiedPlanEnabled&&(!t||t.supportsVideoReceiverConfiguration())},this},e}((Circuit=function(e){"use strict";var t=e.ClientApiHandlerSingleton,n=e.Constants,i=e.Proto,r=e.Utils,o=e.WebRTCAdapter,a=e.RtcSessionController;return e.DeviceDiagnosticSvcImpl=function(e,s,c,l,d){c.debug("New Service: DeviceDiagnosticSvc");var u=t.getInstance(),E=[],C=!(!d||e.isSessionGuest);function T(){if(C)if(0!==E.length){var e=JSON.stringify(E);if(e.length>6e4){c.warn("[DeviceDiagnosticSvc]: Stored device diagnostics exceeded max size. Discard old data.");var t="",n=e.length-5e4;E.some((function(i,r){return(t+=JSON.stringify(i)).length>n&&(c.warn("[DeviceDiagnosticSvc]: Number of discarded records: ",r+1),E.splice(0,r+1),e=JSON.stringify(E),!0)}))}d.setString(d.keys.RTC_CLIENT_INFOS,e)}else d.removeItem(d.keys.RTC_CLIENT_INFOS)}function p(e){e&&e.joinDelayTimer&&(s.cancel(e.joinDelayTimer),e.joinDelayTimer=null)}function S(e){return!(!e||!e.deviceDiagnostics)&&(e.deviceDiagnostics.data.actionInfo.some((function(e){return!e.complete}))||!e.deviceDiagnostics.iceGatheringFinished)}function I(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Force finish device diagnostics");var t=e.deviceDiagnostics;p(t),t.joinDelayed&&f(e),A(e)}}function A(e){e&&e.deviceDiagnostics&&(c.debug("[DeviceDiagnosticSvc]: Clear device diagnostics"),p(e.deviceDiagnostics),delete e.deviceDiagnostics)}function R(e){C&&(c.debug("[DeviceDiagnosticSvc]: Store device diagnostics to send when client reconnects"),E.push(e),T())}function f(t){if(t&&t.deviceDiagnostics){var o={sdpOrigin:t.sdpOrigin||null,userId:e.localUser.userId,convId:t.convId,clientInfoType:n.RtcClientInfoType.DEVICE_DIAGNOSTICS,reason:n.RtcClientInfoReason.JOIN_DELAY,timestamp:Date.now(),sessionId:t.callId,deviceDiagnostics:r.shallowCopy(t.deviceDiagnostics.data)};t.instanceId&&(o.instanceId=t.instanceId),A(t),c.debug("[DeviceDiagnosticSvc]: Sending device diagnostics..."),u.sendClientInfo([o],(function(e){e&&(c.debug("[DeviceDiagnosticSvc]: Failed to send device diagnostics. ",e),i.isOfflineFailure(e)&&R(o))}))}else c.debug("[DeviceDiagnosticSvc]: sendDeviceDiagnostics - Nothing to send")}function _(t){if(!t||!t.label||"string"!=typeof t.label)return"";var n=t.label;return n.startsWith("res_")?e.i18n.localize(n)||"":n}return C&&l.subscribe("/conversations/loadComplete",(function(){c.debug("[DeviceDiagnosticSvc]: Received /conversations/loadComplete event"),function(){if(E.length>0){var e=E;E=[],d.removeItem(d.keys.RTC_CLIENT_INFOS),c.info("[DeviceDiagnosticSvc]: Send offline join failures to backend"),u.sendClientInfo(e,(function(t){t?(c.error("[DeviceDiagnosticSvc]: Failed to send offline join failures. ",t),i.isOfflineFailure(t)&&(Array.prototype.unshift.apply(E,e),T())):c.debug("[DeviceDiagnosticSvc]: Sent offline join failures")}))}}()})),this.startDiagnostics=function(e){e&&!e.isRemote&&(c.info("[DeviceDiagnosticSvc]: Start diagnostics collection for callId = ",e.callId),e.deviceDiagnostics=e.deviceDiagnostics||{data:{actionInfo:[]}})},this.startJoinDelayTimer=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Start join delay timer for callId = ",e.callId);var t=e.deviceDiagnostics;p(t),t.joinDelayTimer=s((function(){t.joinDelayTimer=null,function(e){if(!e||!e.deviceDiagnostics)return;var t=e.deviceDiagnostics;if(c.debug("[DeviceDiagnosticSvc]: Join action delayed, preparing device diagnostics"),p(t),t.joinDelayed=!0,"undefined"!=typeof DeviceStatistics){var n=DeviceStatistics.getStatistics();c.info("[DeviceDiagnosticSvc]: Received native device diagnostics: ",n),t.data.usedRAMApp=n.usedRAMApp,t.data.availableRAMApp=n.availableRAMApp,t.data.usedRAMDevice=n.usedRAMDevice,t.data.availableRAMDevice=n.availableRAMDevice,t.data.virtualMemory=n.virtualMemory,t.data.usagePerCore=n.usagePerCore,t.data.numberOfCores=n.numberOfCores,t.data.networkType=n.networkType}}(e)}),3e3),t.joinDelayed=!1,t.waitingToSend=!1,t.iceGatheringFinished=!1,e.deviceDiagnostics=t}},this.createActionInfo=function(e,t){if(c.debug("[DeviceDiagnosticSvc]: Create action info ",t),!e||!e.deviceDiagnostics||!t)return null;var i={actionType:t};switch(t){case n.RtcDiagnosticsAction.SDP_ANSWER:case n.RtcDiagnosticsAction.SDP_CONNECTED:case n.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES:i.type=n.RtcActionInfoType.EVENT,i.timestampEvent=Date.now();break;default:i.type=n.RtcActionInfoType.REQUEST_RESPONSE,i.timestampRequest=Date.now()}return e.deviceDiagnostics.data.actionInfo.push(i),i},this.finishActionInfo=function(e,t){t&&(c.debug("[DeviceDiagnosticSvc]: Finish action info ",t.actionType),t.complete=!0,t.type===n.RtcActionInfoType.REQUEST_RESPONSE&&(t.timestampResponse=Date.now()),e&&e.deviceDiagnostics&&(t.isEndOfCandidates&&(e.deviceDiagnostics.iceGatheringFinished=!0,c.debug("[DeviceDiagnosticSvc]: Ice gathering finished")),e.deviceDiagnostics.waitingToSend&&!S(e)&&I(e)))},this.finishDeviceDiagnostics=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Finish device diagnostics");var t=e.deviceDiagnostics;p(t),t.joinDelayed?S(e)?(t.waitingToSend=!0,c.debug("[DeviceDiagnosticSvc]: Send device diagnostic delayed")):f(e):A(e)}},this.forceFinishDeviceDiagnostics=I,this.storeClientInfo=R,this.sendCallConnected=function(t){c.debug("[DeviceDiagnosticSvc]: Send call connected event to backend. call = ",t.callId);var i=("undefined"!=typeof DeviceStatistics?DeviceStatistics.getStatistics():null)||{};o.getMediaSources((function(o,s,l){var d=r.selectMediaDevice(o,a.recordingDevices);i.recordingDevice=_(d),d=r.selectMediaDevice(l,a.playbackDevices),i.playbackDevice=_(d),i.negotiationInfos=[];var E={sdpOrigin:t.sdpOrigin||void 0,userId:e.localUser.userId,convId:t.convId,clientInfoType:n.RtcClientInfoType.CALL_CONNECTED,reason:n.RtcClientInfoReason.CALL_CONNECTED,timestamp:Date.now(),sessionId:t.callId,deviceDiagnostics:i,instanceId:t.instanceId};u.sendClientInfo([E],(function(e){e&&c.debug("[DeviceDiagnosticSvc]: Failed to send call connected event. ",e)}))}))},C&&(E=d.getObjectSync(d.keys.RTC_CLIENT_INFOS)||[],Array.isArray(E)||(E=[]),T()),this},e}((Circuit=function(e){"use strict";var t=e.Enums.AtcInfoMessage,n=e.Enums.AtcMessage,i=e.Enums.AtcRegistrationState,r=e.ClientApiHandlerSingleton,o=e.Constants,a=e.PhoneNumberFormatter,s=e.RoutingOptions,c=e.UserToUserHandlerSingleton,l=e.Utils;return e.AtcRegistrationSvcImpl=function(d,u,E,C,T,p){E.debug("New Service: AtcRegistrationSvc");var S,I={state:o.TrunkState.DOWN,telephonyAvailableForTenant:!1,telephonyAvailableForUser:!1,conferenceDialOutAvailable:!1,phoneCallsAvailable:!1},A={cFC1:"pbxCallForwardToVoiceMailSupported",dND:"pbxDNDSupported",zCaOC:"pbxCampOnSupported",zPrfD:"pbxCallRoutingOptionsSupported",zGPC:"pbxCallPickupSupported"},R=r.getInstance(),f=c.getInstance(),_={},v=i.Disconnected,g=!1,N=null,m={},h=null,O=Object.assign({},I),D=null,P=!1,y=null,b=!1;S=l.isMobile()?o.DeviceType.MOBILE:e.isElectron?o.DeviceType.APPLICATION:o.DeviceType.WEB;var U=!1,L=!1,M=null,w=8,G=null,k=null;function H(){M&&(E.info("[AtcRegistrationSvc]: Cancel retry timer"),u.cancel(M),M=null)}function V(){G&&(E.info("[AtcRegistrationSvc]: Cancel renew timer"),u.cancel(G),G=null)}function B(){k&&(E.info("[AtcRegistrationSvc]: Cancel unregister timer"),u.cancel(k),k=null)}function F(e){e!==v&&(v=e,E.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State = ",e),C.publish("/atcRegistration/state",[e]),d.localUser.isRegisterTC&&e!==i.Registering&&J(O))}function x(){return!!d.localUser.telephonyAvailable!==!!d.localUser.callerId}function W(){H(),E.info("[AtcRegistrationSvc]: Retry ATC registration in "+w+" seconds"),M=u((function(){M=null,w<64&&(w=Math.min(2*w,64)),Y()}),1e3*w)}function K(e){(function(e){return!!e&&(e===o.ReturnCode.FAILED_TO_SEND||e===o.ReturnCode.REQUEST_TIMEOUT||503===e.code||480===e.code||408===e.code)})(e)&&T.isRegistered()&&v===i.Registering&&W(),F(i.Unregistered)}function Y(){var e=d.localUser,r={content:{type:n.REGISTER,phoneNumber:e.registerNumber,reroutingPhoneNumber:e.isOsBizCTIEnabled?"":l.cleanPhoneNumber(e.reroutingPhoneNumber),onsHash:e.onsSipAuthenticationHash||void 0,ondHash:e.ondSipAuthenticationHash||void 0,routeToDesk:e.selectedRoutingOption===s.DeskPhone.name&&!e.cfData.Immediate.cfwEnabled,tcPool:e.associatedTelephonyTrunkGroupId,pbxCallLog:!0,deviceType:S,userId:e.userId,conversationId:D.convId,rtcSessionId:D.rtcSessionId,lastItemTime:D.lastItemModificationTime,renewRegistration:U||void 0,sTC:e.isSTC||void 0},destUserId:e.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};H(),B(),_.phoneNumber=e.registerNumber,_.associatedTelephonyUserID=e.associatedTelephonyUserID,_.associatedTelephonyTrunkGroupId=e.associatedTelephonyTrunkGroupId,_.reroutingPhoneNumber=l.cleanPhoneNumber(e.reroutingPhoneNumber),_.onsSipAuthenticationHash=e.onsSipAuthenticationHash,_.ondSipAuthenticationHash=e.ondSipAuthenticationHash,y=e.selectedRoutingOption,b=!!e.cfData.Immediate.cfwEnabled,e.noCallLog=!1,F(i.Registering),E.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+_.phoneNumber+", associatedTelephonyUserID: "+_.associatedTelephonyUserID),P=!1,f.sendAtcRequest(r,(function(r,s){d.$apply((function(){if(g&&!D.call)return E.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),g=!1,void(r||!s||s.err?Y():(P=!0,q()));if(r||s&&s.err)return r=r||s.err,E.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",r),void K(r);if(s&&s.configurationData){if(E.info("[AtcRegistrationSvc]: Received ATC configuration data: ",s.configurationData),E.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server"),U=!1,e.isSTC)return F(i.Registered),j(o.TrunkState.UP),void(e.stcCapabilities=s.capabilities);w=8,_.configurationData=s.configurationData,_.reroutingPhoneNumber=s.configurationData.cell,_.capabilities=s.capabilities,e.isOsBizCTIEnabled||(e.reroutingPhoneNumber=a.format(s.configurationData.cell)),e.vmNumber=s.configurationData.vm,e.isOSV="OSV"===s.configurationData.pbx,e.isOS4K="OS4K"===s.configurationData.pbx,e.PBXCallLogSupported=_.capabilities&&_.capabilities.includes(o.AtcCapabilities.PBX_CALL_LOG),c=s.configurationData.supportedFeatures,Object.keys(A).forEach((function(e){var t=A[e];d.localUser[t]=!!c&&c.includes(e)})),function(e){d.localUser.telephonyConnectorData={pbxType:d.localUser.isOsBizCTIEnabled?"OSBiz":e.configurationData.pbx||"Unavailable",pbxVersion:e.configurationData.pbxVersion||"Unavailable",tcType:d.localUser.isOsBizCTIEnabled?"OSBIZ":"ATC"},e.telephonyConnectorData&&Object.assign(d.localUser.telephonyConnectorData,e.telephonyConnectorData)}(s),F(i.Registered),e.PBXCallLogSupported&&!e.noCallLog&&(!function(e){var i={content:{type:n.INFO,phoneNumber:d.localUser.cstaNumber,info:{type:t.ENABLE_PBX_CALL_LOG,status:e}},destUserId:d.localUser.associatedTelephonyUserID};f.sendAtcRequest(i)}(!0),e.noCallLog=e.isOSV),j(o.TrunkState.UP)}else F(i.Unregistered);var c}))}))}function q(){if(E.info("[AtcRegistrationSvc]: Unregister with ATC"),H(),B(),v!==i.Unregistered&&v!==i.Disconnected){if(T.state()===RegistrationState.Registered){var e={content:{type:n.UNREGISTER,phoneNumber:_.phoneNumber},destUserId:_.associatedTelephonyUserID};f.sendAtcRequest(e,(function(e){d.$apply((function(){e?E.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",e):E.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),P&&Y()}))}))}U=d.localUser.associatedTelephonyUserID!==_.associatedTelephonyUserID,_.associatedTelephonyUserID="",F(i.Unregistered)}else E.debug("[AtcRegistrationSvc]: The client is not registered with ATC")}function j(e){e!==h&&(h=e,E.debug("[AtcRegistrationSvc]: Set trunk state to ",h),O.state===h&&d.localUser.isRegisterTC||d.$apply((function(){z(Object.assign({},O,{state:h}))})))}function Q(){q(),w=64+l.randomNumber(0,64),W()}function z(e){if(e){E.debug("[AtcRegistrationSvc]: Handle telephony data change with state = ",e.state);var t=!!k;if(B(),d.localUser.isRegisterTC)if(e.state===o.TrunkState.DOWN){if(v===i.Registered)return O.state=o.TrunkState.DOWN,E.info("[AtcRegistrationSvc]: Start unregister timeout in case TC immediately reconnects"),void(k=u((function(){k=null,E.info("[AtcRegistrationSvc]: Unregister timeout has expired. state = ",O.state),O.state===o.TrunkState.DOWN&&Q()}),2e3));Q()}else if(O.state===o.TrunkState.DOWN&&e.state===o.TrunkState.UP)return O.state=o.TrunkState.UP,void(v===i.Registering?E.debug("[AtcRegistrationSvc]: Client is already registering. Wait..."):t?(E.debug("[AtcRegistrationSvc]: Client was pending unregistration. Send a registration refresh."),w=8,Y()):function(){H();var e=l.randomNumber(500,1e4);E.info("[AtcRegistrationSvc]: Delay ATC registration by "+e+" miliseconds"),M=u((function(){M=null,E.info("[AtcRegistrationSvc]: Retry timer has expired"),v===i.Unregistered?(w=8,Y()):E.info("[AtcRegistrationSvc]: State is not Unregistered, so cancel new registration")}),e)}());J(e)}}function X(){E.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",O),C.publish("/telephony/data",[Object.assign({},O),D,v])}function J(e){var t;e&&(O=e,d.localUser.isRegisterTC&&p.telephonyConvId?(O.state=v===i.Registered?o.TrunkState.UP:o.TrunkState.DOWN,O.defaultCallerId=null,O.isGTCEnabled=!0,t=v===i.Registered):(O.defaultCallerId=O.defaultCallerId||null,t=O.state!==o.TrunkState.DOWN&&h!==o.TrunkState.DOWN),O.telephonyAvailableForTenant=!!O.isGTCEnabled,O.telephonyAvailableForUser=!(!O.isGTCEnabled||d.localUser.isICOnlyUser||!d.localUser.callerId&&!O.defaultCallerId),O.conferenceDialOutAvailable=O.telephonyAvailableForTenant&&t,O.phoneCallsAvailable=O.telephonyAvailableForUser&&t,O.telephonyAvailableForUser?p.getTelephonyConversationPromise().then((function(e){D=e,X()})).catch((function(e){E.error("[AtcRegistrationSvc]: Failed to retrieve telephony conversation. ",e),O.telephonyAvailableForUser=!1,O.conferenceDialOutAvailable=!1,O.phoneCallsAvailable=!1,X()})):X())}function $(){p.telephonyConvId?(E.info("[AtcRegistrationSvc]: Getting telephony data"),R.getTelephonyData((function(e,t){d.$apply((function(){e?e!==o.ReturnCode.NO_RESULT&&(E.error("[AtcRegistrationSvc]: Error getting telephony data: ",e),J(O)):z(t)}))}))):(E.info("[AtcRegistrationSvc]: There is no telephony conversation. Set telephony state to DOWN."),J({state:o.TrunkState.DOWN}))}function Z(e){if(N&&N!==d.localUser.associatedTelephonyUserID&&(E.debug("[AtcRegistrationSvc]: Unsubscribe from previously associated TC presence"),m[N]||R.unsubscribePresence([N]),N=null,h=null,U=!0),d.localUser.associatedTelephonyUserID?N!==d.localUser.associatedTelephonyUserID&&(N=d.localUser.associatedTelephonyUserID,V(),d.localUser.isRegisterTC&&m[N]||R.subscribePresence([d.localUser.associatedTelephonyUserID],(function(e,t){if(e)return E.warn("[AtcRegistrationSvc]: Unable to subscribe to associated TC presence"),void(N=null);t&&t.length>0&&!d.localUser.isRegisterTC&&j(t[0].state===o.PresenceState.AVAILABLE?o.TrunkState.UP:o.TrunkState.DOWN)}))):h=null,!d.localUser.isRegisterTC||!d.localUser.registerNumber)return E.debug("[AtcRegistrationSvc]: User is not associated with ATC or STC"),v===i.Registered?(q(),$()):(e||x())&&$(),void F(i.Disconnected);if(b!==d.localUser.cfData.Immediate.cfwEnabled&&(b=d.localUser.cfData.Immediate.cfwEnabled,d.localUser.selectedRoutingOption===s.DeskPhone.name&&ee()),d.localUser.associatedTelephonyUserID!==_.associatedTelephonyUserID||d.localUser.registerNumber!==_.phoneNumber||d.localUser.onsSipAuthenticationHash!==_.onsSipAuthenticationHash||d.localUser.ondSipAuthenticationHash!==_.ondSipAuthenticationHash||v!==i.Registered&&v!==i.Registering||!d.localUser.isOsBizCTIEnabled&&l.cleanPhoneNumber(d.localUser.reroutingPhoneNumber)!==_.reroutingPhoneNumber){if(v===i.Registering)return E.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(g=!0);if(v===i.Registered){if(E.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),D.call)return E.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(g=!0);P=!0,q()}if(!P){if(!D)return E.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),p.getTelephonyConversationPromise().then((function(e){D=e,E.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),Z()})).catch((function(){E.error("[AtcRegistrationSvc]: Failed to retrieve telephony conversation. Cannot register with ATC."),J({state:o.TrunkState.DOWN})})),void(!e&&x()&&$());v!==i.ForcedUnregistered&&Y()}}else E.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same")}function ee(){if(v===i.Registered&&!d.localUser.isOsBizCTIEnabled){var e=d.localUser.selectedRoutingOption===s.DeskPhone.name&&!d.localUser.cfData.Immediate.cfwEnabled;E.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ",e);var r={content:{type:n.INFO,phoneNumber:d.localUser.cstaNumber,info:{type:t.SET_ROUTE_TO_DESK,status:e}},destUserId:d.localUser.associatedTelephonyUserID};f.sendAtcRequest(r)}}function te(e,t){V(),d.localUser.associatedTelephonyTrunkGroupId?(t=t||l.randomNumber(3e4,18e4),E.debug("[AtcRegistrationSvc]: Renew associated telephony connector in "+t+" miliseconds"),G=u((function(){G=null,E.debug("[AtcRegistrationSvc]: Renew associated telephony connector"),R.renewAssociatedTelephonyUser(d.localUser.associatedTelephonyUserID,(function(t){t&&(E.error("[AtcRegistrationSvc]: Failed to renew associated telephony connector. ",t),e&&te(!0,18e4))}))}),t)):E.debug("[AtcRegistrationSvc]: User is not associated to any pool. Ignore the TC reassignment request.")}function ne(){v===i.Registered?D.call&&!D.call.isRemote?E.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC re-register for now. If error persists on server another event will come later."):d.$apply((function(){E.info("[AtcRegistrationSvc]: New registration must be triggered."),P=!0,q()})):E.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}return C.subscribe("/localUser/telephonyConfigUpdated",(function(){T.isRegistered()&&p.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /localUser/telephonyConfigUpdated event"),Z())})),C.subscribe("/conversations/loadComplete",(function(){E.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),Z(!0)})),C.subscribe("/registration/state",(function(e){p.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /registration/state event"),e!==RegistrationState.LoggingOut&&e!==RegistrationState.Reconnecting&&e!==RegistrationState.Disconnected||(H(),V(),u(d.localUser.isRegisterTC?q:function(){O.state=o.TrunkState.DOWN,N=null,h=null,m={},J(O)})))})),C.subscribe("/conversation/update",(function(e){if(e.isTelephony){if(E.debug("[AtcRegistrationSvc]: Received /conversation/update event"),D=e,!g&&!L)return;if(e.call)E.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait...");else if(v!==i.Registering){if(L)return F(i.ForcedUnregistered),void(L=!1);g=!1,P=!0,q()}}})),C.subscribe("/user/settings/update",(function(){p.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),y!==d.localUser.selectedRoutingOption&&(y=d.localUser.selectedRoutingOption,ee()))})),R.on("User.TELEPHONY_DATA",(function(e){d.$apply((function(){try{var t=e.data;t&&(E.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",t),t.isGTCEnabled=!0,Object.keys(t).some((function(e){return O[e]!==t[e]&&(z(t),!0)})))}catch(e){E.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",e)}}))})),R.on("User.USER_PRESENCE_CHANGE",(function(e){if(e.userId){if(e.userId===N)E.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE for associated TC. newState = ",e.newState),j(e.newState.state===o.PresenceState.AVAILABLE?o.TrunkState.UP:o.TrunkState.DOWN);m[e.userId]&&(E.info("[AtcRegistrationSvc]: Publish /trunk/update event. newState = ",e.newState),C.publish("/trunk/update",[e.newState]))}})),R.on("User.ATC_REFRESH_FAILED",(function(){E.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),ne()})),f.on("ATC.REFRESH_FAILED",(function(){E.error("[AtcRegistrationSvc]: Received UserToUser.ATC.REFRESH_FAILED event."),ne()})),R.on("Account.TC_START_REASSIGNMENT",(function(e){E.debug("[AtcRegistrationSvc]: Account.TC_START_REASSIGNMENT event");var t=Math.max(e&&e.maxThrottlingTime||18e4,3e4);te(!0,3e4+l.randomNumber(0,t))})),f.on("ATC.INFO",(function(e){E.debug("[AtcRegistrationSvc]: Received ATC.INFO with data = ",e),d.localUser&&e.hasOwnProperty("pbxCallLogStatus")&&(d.localUser.noCallLog=!!e.pbxCallLogStatus)})),f.on("ATC.START_REASSIGNMENT",(function(){E.debug("[AtcRegistrationSvc]: Received ATC.START_REASSIGNMENT event"),te(!1)})),f.on("ATC.UNREGISTERED",(function(){E.error("[AtcRegistrationSvc]: Received UserToUser.ATC.UNREGISTERED event."),v===i.Registered?D.call&&!D.call.isRemote?(E.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC Unregistered event for now."),L=!0):d.$apply((function(){F(i.ForcedUnregistered)})):E.info("[AtcRegistrationSvc]: Client is not registered, ignoring Unregistered event.")})),this.initAtcForSdk=function(){E.debug("[AtcRegistrationSvc]: initAtcForSdk"),S=o.DeviceType.SDK,Z(!0)},this.atcState=function(){return v},this.getAtcRegistrationData=function(){return _.configurationData},this.getTelephonyData=function(e){if(!e){var t=v===i.Registering?I:O;return Object.assign({},t)}return"function"==typeof e&&(v===i.Registering?e("ATC Registering"):e(null,Object.assign({},O))),null},this.isExtendedAlertingSupported=function(){return!(!_||!_.capabilities)&&_.capabilities.includes(o.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){return!(!_||!_.capabilities)&&_.capabilities.includes(o.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this.subscribeConnectorPresence=function(e,t){(e=e.filter((function(e){return!m[e]}))).length&&(E.debug("[AtcRegistrationSvc]: Subscribe for connectors presence. ",e),R.subscribePresence(e,(function(e,n){d.$apply((function(){e?(E.error("[AtcRegistrationSvc]: Failed to subscribe to connectors presence. ",e),t&&t(e)):n&&(E.debug("[AtcRegistrationSvc]: Successfully subscribed for connectors presence"),n.forEach((function(e){m[e.userId]=!0})),t&&t(null,n))}))})))},this.unsubscribeConnectorPresence=function(e,t){e?e=e.filter((function(e){return!!m[e]&&(delete m[e],e!==N)})):(e=Object.keys(m).filter((function(e){return e!==N})),m={}),e.length&&(E.debug("[AtcRegistrationSvc]: Unsubscribe for connectors presence. ",e),R.unsubscribePresence(e,t))},this.isPBXCallLogSupported=function(){return!(!_||!_.capabilities)&&_.capabilities.includes(o.AtcCapabilities.PBX_CALL_LOG)},this},e}((Circuit=function(e){"use strict";var t=e.ChromeExtension,n=e.ExtensionConnHandlerSingleton,i=e.ScreenSharingController,r=e.Utils;return e.ExtensionSvcImpl=function(o,a,s,c,l,d,u,E){l.debug("New Service: ExtensionSvc");var C=r.convertVersionToNumber("1.2.1600"),T=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INTERNAL_ERROR:"INTERNAL_ERROR"}),p=this,S="object"==typeof n?n.getInstance():null,I="",A=!0,R=e.isElectron?require("electron").ipcRenderer:null;function f(){var e,t="edge"===o.browser.subType?"https://microsoftedge.microsoft.com/addons/detail/":"https://chrome.google.com/webstore/detail/";return"edge"===o.browser.subType?(l.info("[ExtensionSvc]: Set URL to Edge extension webstore link"),(e=E.getEdgeExtensionId())?(l.info("[ExtensionSvc]: Set Edge extension URL using Extension ID set in global properties: ",e),t+=e):(l.info("[ExtensionSvc]: Set Default Edge extension URL"),t="https://microsoftedge.microsoft.com/"),t):o.siemensAGUser?(t+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",l.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link"),t):((e=E.getChromeExtensionId())?l.info("[ExtensionSvc]: Set Chrome extension URL using Extension ID set in global properties: ",e):(e=function(){var e;switch(s.location.hostname){case"beta.circuit.com":e="jafbhekoolndfieffjkikfbmekjppnec",l.info("[ExtensionSvc]: Set extension ID to Beta-Circuit extension: ",e);break;case"circuitsandbox.net":e="ogdfpjnhdggplglemglldmioiblhkadm",l.info("[ExtensionSvc]: Set extension ID to Sandbox-Circuit extension: ",e);break;case"tandi.circuitsandbox.net":e="gdgfgnopapmocggkadgfkjekdlcohmdl",l.info("[ExtensionSvc]: Set extension ID to T&I-Circuit extension: ",e);break;case"teams.univergeblue.com":case"bluebeta.circuit.com":e="jhpcobccapenojpdohnfmhmdmppngdad",l.info("[ExtensionSvc]: Set extension ID to UNIVERGE BLUE TC extension: ",e);break;default:e="mhkbaognlahkdimlfcfhbeihldmjofgg",l.info("[ExtensionSvc]: Set extension ID to Circuit extension: ",e)}return e}(),l.info("[ExtensionSvc]: Set Chrome extension URL using Extension ID from host name: ",e)),t+=e)}function _(e,t,n){return l.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",e),S?S.isExtensionRunning()?(n&&(t=t||[]).push((function(e,t){o.$apply((function(){n(e,t)}))})),S[e].apply(S,t)):(l.debug("[ExtensionSvc]: Chrome extension is not running"),void(n&&a((function(){n("Extension not running")}),0))):(l.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(n&&a((function(){n("No ExtensionConnHandler")}),0)))}function v(e){return o.browser&&o.browser.chrome?A?null:(l.warn("[ExtensionSvc]: We are running an outdated extension:",I),e&&u&&u.error({message:"res_UnsupportedExtensionVersion"}),T.UNSUPPORTED_EXT_VERSION):T.UNSUPPORTED_BROWSER}if(i&&i.injectExtensionSvc(this,S),S){S.addEventListener("extensionInitialized",(function(e){o.$apply((function(){I=e.data.version,l.info("[ExtensionSvc]: Validate the installed extension version: ",I),"electron"!==I&&((A=r.convertVersionToNumber(I)>=C)||l.warn("[ExtensionSvc]: The installed extension version ("+I+") is not supported. Minimum version is 1.2.1600")),A&&(o.isBrowserExtRunning=!0,l.setExtensionVersion(I),l.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),d.publish("/chromeExt/initialized"))}))})),S.addEventListener("extensionUnregistered",(function(){o.$apply((function(){o.isBrowserExtRunning=!1,l.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),d.publish("/chromeExt/unregistered")}))}));var g=function(e,t){o.$apply((function(){var n=t.data&&t.data.data;l.debug("[ExtensionSvc]: Publish "+e+" event: ",n),d.publish(e,[n])}))};S.addEventListener("headsetAppLaunched",g.bind(null,"/chromeExt/headsetAppLaunched")),S.addEventListener("headsetAppUninstalled",g.bind(null,"/chromeExt/headsetAppUninstalled")),S.addEventListener("webRTCIPHandlingPolicyChanged",g.bind(null,"/chromeExt/webRTCIPHandlingPolicyChanged"))}return this.isExtensionRunning=function(){return S&&S.isExtensionRunning()&&A},this.getExtensionVersion=function(){return I},this.isExtensionVersionSupported=function(){return A},this.installExtension=function(e){return new c((function(t,n){if(p.isExtensionRunning())t();else{if(!u)return l.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void n(T.INTERNAL_ERROR);var i=v(e);if(i)n(i);else{u.confirm({message:"res_ActionInstallExtensionText",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0}).result.then((function(){p.inlineInstallation(e).then(t).catch(n)})).catch((function(){n(T.USER_CANCELLED_INSTALL)}))}}}))},this.inlineInstallation=function(e){return new c((function(t,n){var i=v(e);if(i)n(i);else{var r=f();l.debug("[ExtensionSvc]: Open store link for ",r),s.open(r),t()}}))},this.addEventListener=function(e,t){S&&S.addEventListener(e,t)},this.exchangeGetConnectionStatus=function(e,t){return _("exchangeGetConnectionStatus",[e],t)},this.exchangeConnect=function(e,t){return _("exchangeConnect",[e],t)},this.exchangeSearchContacts=function(e,t,n,i){return _("exchangeSearchContacts",[e,t,n],i)},this.exchangeGetCapabilities=function(e){return _("exchangeGetCapabilities",[],e)},this.exchangeAutodiscoverGetServer=function(e,t){return _("exchangeAutodiscoverGetServer",[e],t)},this.exchangeResolveContact=function(e,t,n){return _("exchangeResolveContact",[e,t],n)},this.exchangeGetContact=function(e,t,n){return _("exchangeGetContact",[e,t],n)},this.exchangeDisconnect=function(e){return _("exchangeDisconnect",[],e)},this.exchangeOnRenewedToken=function(e,t,n,i){return _("exchangeOnRenewedToken",[e,t,n],i)},this.storeExchCredentials=function(e,t){return _("exchangeStoreCredentials",[e],t)},this.getStoredCredentials=function(e,t){return _("getStoredCredentials",[e],t)},this.getAllPersonalContacts=function(e,t){return _("getAllPersonalContacts",[e],t)},this.syncAllPersonalContacts=function(e,t,n){return _("syncAllPersonalContacts",[e,t],n)},this.exchangeCancelReqCallback=function(e){return _("exchangeCancelReqCallback",[e])},this.getAppointments=function(e,t,n,i,r){return _("getAppointments",[e,t,n,i],r)},this.supportsGetAppointments=function(){return!(!o.localUser||!o.localUser.msExchangeEnabled)&&(!!p.isExtensionRunning()||!(!o.browser||!o.browser.chrome))},this.supportsExchangeAutodiscover=function(){return p.isExtensionRunning()},this.supportsExchangeAutodiscoverSvc=function(){return p.isExtensionRunning()},this.supportsExchangeAutodiscoverGetServer=function(){return"electron"===I||r.convertVersionToNumber(I)>=1023300},this.supportsOOO=function(){return"electron"===I||r.convertVersionToNumber(I)>=1022800},this.supportsUserAvailability=function(){return"electron"===I||r.convertVersionToNumber(I)>=1025800},this.getOooMsg=function(e,n,i,r){p.supportsOOO()||r&&r(null,{response:t.ExchangeConnResponse.UNSUPPORTED_METHOD}),_("getOooMsg",[e,n,i],r)},this.getUserAvailability=function(e,n,i){p.supportsUserAvailability()||i&&i(null,{response:t.ExchangeConnResponse.UNSUPPORTED_METHOD}),_("getUserAvailability",[e,n],i)},this.launchHeadsetIntegrationApp=function(e,t,n){return _("launchHeadsetIntegrationApp",[e,t],n)},this.getHeadsetIntegrationAppStatus=function(e,t){return _("getHeadsetIntegrationAppStatus",[e],t)},this.restartHeadsetApp=function(e,t){return _("restartHeadsetApp",[e],t)},this.supportsPolicySettings=function(){return"electron"===I||r.convertVersionToNumber(I)>=1023300},this.setIPHandlingPolicy=function(t,n,i){e.isElectron?(R.send("set-ip-handling-policy",t),i&&i(null)):_("setIPHandlingPolicy",[t,n],i)},this.getIPHandlingPolicy=function(t){"function"==typeof t&&(e.isElectron?(R.send("get-ip-handling-policy"),R.once("get-ip-handling-policy-response",(function(e,n){o.$apply((function(){t(null,{value:n||null})}))}))):_("getIPHandlingPolicy",[],t))},this.bringToFront=function(t){e.isElectron?R.send("focus-window"):_("bringToFront",[],t)},this.getFileFromExtension=function(e,t,n){return _("getFile",[e,t],n)},o.isBrowserExtRunning=p.isExtensionRunning(),this},e}((Circuit=function(e){"use strict";var t=e.BaseCall,n=e.Utils;return e.PubSubSvcImpl=function(e){e.debug("New Service: PubSubSvc");var i={},r={},o={},a=[];function s(t,n){try{null==n?n=[]:Array.isArray(n)||(n=[n]),t.apply(null,n)}catch(t){e.error(t)}}function c(e,t,n){e[t]&&e[t].slice(0).forEach((function(e){s(e,n)}))}function l(e,t,n){e[t]?e[t].includes(n)||e[t].push(n):e[t]=[n]}function d(e,t,n){if(e[t]){var i=e[t].indexOf(n);i>=0&&e[t].splice(i,1)}}return this.publish=function(l,d){(i[l]||r[l]||o[l]||a.length)&&(e.debug("[PubSubSvc]: Publishing "+l+" event"),c(i,l,d),function(e,i){r[e]&&(null==i?i=[]:Array.isArray(i)||(i=[i]),i=i.map((function(e){if(e&&"object"==typeof e){if(e.isConversationObject)return n.trimConvForMobile(e);if(e instanceof t)return n.trimCallForMobile(e)}return e})),r[e].slice(0).forEach((function(e){s(e,i)})))}(l,d),c(o,l,d),function(e,t){(t=t?Array.prototype.slice.call(t):[]).unshift(e),a.slice(0).forEach((function(e){s(e,t)}))}(l,d),delete o[l])},this.subscribe=function(e,t){l(i,e,t)},this.unsubscribe=function(e,t){d(i,e,t)},this.subscribeOnce=function(e,t){l(o,e,t)},this.unsubscribeOnce=function(e,t){d(o,e,t)},this.subscribeMobile=function(e,t){l(r,e,t)},this.unsubscribeMobile=function(e,t){d(r,e,t)},this.subscribeAll=function(e){!function(e){a.includes(e)||a.push(e)}(e)},this.unsubscribeAll=function(e){!function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1)}(e)},this.resetSubscriptions=function(){i={},r={},o={},a=[]},this},e}((Circuit=function(e){"use strict";var t=e.Utils,n={ACCESSIBILITY:"125328",AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",SHORTCUTS:t.isMacOs?"144499":"144490",TELEPHONY:"103733"};return e.UtilSvcImpl=function(e,n,i,r){r.debug("New Service: UtilSvc");var o=this;return this.promisify=function(e,t){return function(){var i=Array.prototype.slice.call(arguments);return new n((function(n,r){i.push((function(e){if(e)r(e);else{var t=Array.prototype.slice.call(arguments);switch(t.shift(),t.length){case 0:n();break;case 1:n(t[0]);break;default:n(t)}}})),e.apply(t,i)}))}},this.getFaqUrl=function(n){if(e.localUser){if(e.localUser.faqUrl&&t.DEFAULT_FAQ_URL!==e.localUser.faqUrl)return e.localUser.faqUrl+(n||"");if(e.localUser.helpUrl&&t.DEFAULT_HELP_URL!==e.localUser.helpUrl)return e.localUser.helpUrl}return"HELP"===n?t.DEFAULT_HELP_URL:t.DEFAULT_FAQ_URL+(n?"?articleId="+n:"")},this.isPartnerAdmin=function(t){return!(!e.localUser||!e.localUser.isPartnerAdmin)||(r.debug("[UtilSvc]: Cannot invoke request. Local user is not a partner admin."),t&&i((function(){t("Not partner admin")})),!1)},this.isTenantAdmin=function(t,n){return!!e.localUser&&(n&&n.tenantId!==e.localUser.tenantId?o.isPartnerAdmin(t):!!e.localUser.isTenantAdmin||(r.warn("[UtilSvc]: Local user is not a tenant admin"),t&&i((function(){t("Not tenant admin")})),!1))},this.hasOAuthAppChangeRights=function(){return!!e.localUser&&(!!e.localUser.hasDeveloperConsoleAccess||(r.warn("[UtilSvc]: Local user does not have rights for accessing the developer console"),!1))},this.hasOAuthAppViewRights=function(){return!!e.localUser&&(!!e.localUser.canViewDeveloperConsole||(r.warn("[UtilSvc]: Local user does not have rights for viewing the developer console."),!1))},this},e.Enums=e.Enums||{},e.Enums.FaqArticle=n,e}((Circuit=function(e){"use strict";var t=Object.freeze({Idle:"Idle",Active:"Active"});return e.Enums=e.Enums||{},e.Enums.IdleState=t,e.SdkHelperSvcImpl=function(n,i,r,o){var a,s=e.Enums.CallForwardingTypes,c=e.Enums.ConnectionState,l=e.Constants,d=e.Conversation,u=e.UserProfile,E=e.Utils,C=this,T={},p=null,S=e.ClientApiHandlerSingleton.getInstance(),I=[];function A(){return null}function R(){if(!n.localUser||!n.localUser.accounts||!n.localUser.accounts[0])return!1;var e=n.localUser,t=n.localUser.accounts[0],i=e.callerId;return t.telephonyConfiguration?(e.phoneNumber=t.telephonyConfiguration.phoneNumber||null,e.isATC?(e.callerId=t.telephonyConfiguration.phoneNumber,e.cstaNumber=E.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.registerNumber=e.cstaNumber,e.isRegisterTC=!0):e.isSTC?(e.callerId=t.telephonyConfiguration.phoneNumber,e.registerNumber=E.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.cstaNumber=null,e.isRegisterTC=!0):(e.callerId=t.telephonyConfiguration.callerId||e.phoneNumber||p,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1)):(e.phoneNumber=null,e.callerId=p,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1),i!==e.callerId}function f(){return new Promise((function(e,t){S.getTelephonyData((function(n,i){n?t(n):(p=i.defaultCallerId||null,e(i))}))}))}function _(){return new Promise((function(e,t){S.getTelephonyConversationId((function(n,i){n||!i?t("Telephony conversation not found"):C.getConversationById(i,null,(function(n,i){n||!i?t(n||"Error retrieving telephony conversation"):(a=i,e(i))}))}))}))}return o.subscribe("/telephony/data",(function(e){var t=!1;p!==e.defaultCallerId&&(p=e.defaultCallerId,E.updateTelephonyNumbers(n.localUser,e.defaultCallerId)&&(t=!0)),n.localUser.telephonyAvailable!==e.telephonyAvailableForUser&&(n.localUser.telephonyAvailable=e.telephonyAvailableForUser,t=!0),n.localUser.phoneCallsAvailable!==e.phoneCallsAvailable&&(n.localUser.phoneCallsAvailable=e.phoneCallsAvailable,t=!0),t&&o.publish("/localUser/update",[n.localUser])})),S.on("Account.TELEPHONY_CONFIGURATION_UPDATED",(function(e){if(e.configuration&&n.localUser){var t=n.localUser.accounts&&n.localUser.accounts[0];t&&(t.telephonyConfiguration=e.configuration,C.telephonyConfigChanged(),o.publish("/localUser/update",[n.localUser]),o.publish("/localUser/telephonyConfigUpdated"))}})),this.addConversationToCache=function(e){e&&e.convId&&(T[e.convId]=d.extend(e))},this.setLocalUser=function(e){e&&(e.canUseHDVideo=e.hasPermission(Circuit.Enums.SystemPermission.HD_VIDEO),e.canUseHDScreenShare=e.hasPermission(Circuit.Enums.SystemPermission.HD_SCREENSHARE),n.localUser=e,n.localUser.cfData={},Object.keys(s).forEach((function(e){n.localUser.cfData[e]={cfwType:e,cfwAvailable:!1}})),u.syncTelephonyConfig(e),R())},this.telephonyConfigChanged=function(){R(),u.syncTelephonyConfig(n.localUser)},this.getConversationPromise=function(e){return new Promise((function(t,n){if(e){var i=T[e];i?t(i):C.getConversationById(e,null,(function(e,i){e||!i?n("Conversation not found"):t(i)}))}else n()}))},this.getConversationById=function(e,t,n){"function"==typeof n&&S.getConversationById(e,(function(e,t){var i=d.extend(t);i&&(T[t.convId]=i),n(e,i)}))},this.getConversationByRtcSession=function(e){for(var t in r.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",e),T)if(T.hasOwnProperty(t)&&T[t].rtcSessionId===e)return T[t];return null},this.getConversationFromCache=function(e){return r.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",e),T[e]||null},this.getConversationAsGuestById=function(e){return I.find((function(t){return t.convId===e}))},this.getTelephonyData=f,Object.defineProperties(this,{showTelephonyConversation:{get:function(){return!(!n.localUser||!n.localUser.telephonyAvailable)},enumerable:!0},telephonyConvId:{get:function(){return a&&a.convId},enumerable:!0}}),this.getTelephonyConversationPromise=function(){return a?Promise.resolve(a):_()},this.getTelephonyConversation=function(e){if("function"==typeof e){if(a)return void window.setTimeout((function(){e(null,a)}));f().then(R).then(_).then((function(t){e(null,t)})).catch(e)}},this.getCachedTelephonyConversation=function(){return a},this.isConversationsLoadComplete=function(){return!!n.localUser},this.updateLastCallTime=function(){},this.createConversationAsGuest=function(e){var t=d.extend({convId:e.convId,type:e.type,topic:e.topic,rtcSessionId:e.rtcSessionId,creatorId:e.creatorId,participants:[{userId:n.localUser.userId}],creatorTenantId:e.creatorTenantId||n.localUser.tenantId,isTemporary:!0,creationTime:e.creationTime||Date.now()});return I.some((function(t,n){return t.convId===e.convId&&(I.splice(n,1),!0)})),I.push(t),r.debug("[SDK]: Created temporary (as guest) conversation for session:",t.rtcSessionId),setTimeout((function(){e.isExtended?(r.debug("[SDK]: Publish /conversation/navigate/reload event"),o.publish("/conversation/navigate/reload",[t])):(r.debug("[SDK]: Publish /conversation/new event"),o.publish("/conversation/new",[t]))})),t},this.createConversationAsGuestFromSummary=function(e){return new Promise((function(t,n){e?S.getConversationSummary(e,null,(function(e,i){e?n("[SDK] getConversationSummary request failed"):t(C.createConversationAsGuest(i))})):n("convId is required")}))},this.sendQOSData=function(e,t,n){r.debug("[SdkHelperSvc]: sendQOSData - call stats: ",n)},this.state=function(){switch(S.getConnState()){case c.Disconnected:return"Disconnected";case c.Connecting:return"Connecting";case c.Reconnecting:return"Reconnecting";case c.Connected:return"Registered";default:return""}},this.isRegistered=function(){return S.getConnState()===c.Connected},this.getSetting=function(){return null},this.getUserIdleState=function(){return t.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.startAutoSnooze=function(){},this.cancelAutoSnooze=function(){},this.snooze=function(){},this.resume=function(){},this.getUserFromCache=A,this.getUser=A,this.getUserById=function(e,t){t&&t(l.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(e,t){t&&t(null)},this},e}((Circuit=function(e){"use strict";return e.Enums.SystemPermission=e.Constants.SystemPermission,e.Enums.DeviceType=e.Constants.DeviceType,e.Enums.CallStateName={},Object.getOwnPropertyNames(e.Enums.CallState).forEach((function(t){e.Enums.CallStateName[t]=t})),e.Enums.ConversationItemType=e.Constants.ConversationItemType,e.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},e.Enums.PresenceState=e.Constants.PresenceState,e.Enums.RTCItemType=e.Constants.RTCItemType,e.Enums.RTCParticipantType=e.Constants.RTCParticipantType,e.Enums.SystemItemType=e.Constants.SystemItemType,e.Enums.TextItemContentType=e.Constants.TextItemContentType,e.Enums.UserBusyHandlingOptions=e.Constants.UserBusyHandlingOptions,e.Enums.UserType=e.Constants.UserType,e.Enums.UserState=e.Constants.UserState,e.Enums.SearchDirection=e.Constants.SearchDirection,e.Enums.ParticipantCriteria=e.Constants.GetConversationParticipantCriteria,e.Enums.ConversationParticipantType=e.Constants.ConversationParticipantType,e.Enums.RetrieveAction=e.Constants.RetrieveAction,e.Enums.RecordingInfoState=e.Constants.RecordingInfoState,e.Enums.RecordingInfoState=e.Constants.RecordingInfoState,e.Enums.SearchScope=e.Constants.SearchScope,e.Enums.SearchStatusCode=e.Constants.SearchStatusCode,e.Enums.SessionClosedReason=e.Constants.SessionClosedReason,e.Enums.GetAccountsFilterCriteria=e.Constants.GetAccountsFilterCriteria,e.Enums.AccountStatus=e.Constants.AccountStatus,e.Enums.GetAccountsSorting=e.Constants.GetAccountsSorting,e.Enums.SortOrder=e.Constants.SortOrder,e.Enums.SearchContext=e.Constants.SearchContext,e.Enums.Locale=e.Constants.Locale,e.Enums.VideoResolution={VGA:"VGA",HD:"HD",FHD:"FHD",NONE:"NONE"},e.Enums.FormControlType=e.Constants.CPaaSFormMetaDataControlType,e.Enums.RecordingVideoLayoutName=e.Constants.RecordingVideoLayoutName,e.Enums.JournalFilter=e.Constants.JournalFilter,e.Enums.GuestJoinError={BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",GUM_FAILED:"GUM_FAILED",INVALID_TOKEN:"INVALID_TOKEN",NO_GUEST_ACCESS:"NO_GUEST_ACCESS",NO_SESSION:"NO_SESSION",SERVICE_EXCEPTION:"SERVICE_EXCEPTION"},e.Enums.MonitorSessionError={BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",CLIENT_BUSY:"CLIENT_BUSY",INVALID_TOKEN:"INVALID",MONITOR_CANCELED:"MONITOR_CANCELED",MONITOR_IN_PROGRESS:"MONITOR_IN_PROGRESS",NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",TIMEOUT:"TIMEOUT"},e}((Circuit=function(e){"use strict";var t;return e.ExtensionConnHandlerSingleton={getInstance:function(){return t||(t=new e.ExtensionConnHandler),t}},e}((Circuit=function(e){"use strict";var t=e.BaseEventTarget,n=e.ChromeExtension,i=e.logger,r=e.Utils;function o(){o.parent.constructor.call(this,i);var t,a,s=this,c={},l=0,d=!1,u=window.BgExchangeConnectorHandler;if(e.isElectron){if(u){a=u.getInstance();var E=function(e){e.data&&e.data.keysToOmitFromLogging&&(e.keysToOmitFromLogging=e.data.keysToOmitFromLogging.map((function(e){return"data."+e})),delete e.data.keysToOmitFromLogging),I(e)};t=Object.create(i,{sendResponse:{value:function(e,t,i){var r={type:n.BgMsgType.RESPONSE,reqId:e,suppressLog:!!i,data:t};E(r)}},sendInternalEvent:{value:function(e){i.error("[ExtensionConnHandler]: Unexpected internal event: ",e)}},sendExchangeConnEvent:{value:function(e,t){var i={type:n.BgMsgType.EVENT,target:n.BgTarget.EXCHANGE_CONNECTOR,suppressLog:!!t,data:e};E(i)}}});window.chrome={storage:{local:{set:function(e,t){window.localStorage.setItem("exchange",JSON.stringify(e,(function(e,t){if("string"!=typeof e||"$"!==e.charAt(0))return t}))),t&&t()},get:function(e,t){t&&t(JSON.parse(window.localStorage.getItem("exchange")))},clear:function(e){window.localStorage.removeItem("exchange"),e&&e()}}},runtime:{},windows:{create:function(){}},permissions:{contains:function(e,t){t(!0)}}}}setTimeout((function(){i.info("[ExtensionConnHandler]: Raise extensionInitialized"),d=!0;var e=s.createEvent("extensionInitialized");e.data={version:"electron"},s.dispatch(e)}),1e3)}function C(e,t){e=e||function(){};var r=++l,o=window.setTimeout((function(){c[r]&&(i.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",r),delete c[r],e(n.ResponseError.TIMEOUT))}),t||5e3);return c[r]={cb:e,timer:o},r}function T(e,t){i.info("[ExtensionConnHandler]: Dispatching event: ",e);var n=s.createEvent(e);n.data=t,s.dispatch(n)}function p(r,o,c,l){return r?s.isExtensionRunning()?function(r,o,s,c){r.type===n.BgMsgType.REQUEST&&(r.reqId=C(o,s));c||i.msgSend("[ExtensionConnHandler]: ",r);if(r.suppressLog=c,e.isElectron&&a&&r.type===n.BgMsgType.REQUEST&&r.target===n.BgTarget.EXCHANGE_CONNECTOR)return window.setTimeout((function(){a.onWebClientMsg(t,r,e.__server)}),0),r.reqId;var l=new CustomEvent(n.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(r)});try{document&&document.dispatchEvent(l)}catch(e){return i.warning("[ExtensionConnHandler]: Error sending message: "+l,e),!1}return r.reqId}(r,o,c,l):(i.info("[ExtensionConnHandler]: Chrome extension is not running"),o&&window.setTimeout((function(){o("Extension not running")}),0),!1):(i.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),o&&window.setTimeout((function(){o("Invalid message")}),0),!1)}function S(){i.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),d=!1,i.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var e=s.createEvent("extensionUnregistered");s.dispatch(e)}function I(e){if(e.target!==n.BgTarget.LOG)switch(e.suppressLog||i.msgRcvd("[ExtensionConnHandler]: ",e),e.type){case n.BgMsgType.REQUEST:case n.BgMsgType.EVENT:!function(e){switch(e.target){case n.BgTarget.INTERNAL:switch(e.data.type){case n.BgInternalMsgType.INIT_MSG:i.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),d=!0,p({target:n.BgTarget.INTERNAL,data:{type:n.BgInternalMsgType.INIT_MSG_ACK}}),T("extensionInitialized",e.data);break;case n.BgInternalMsgType.EXTENSION_DISCONNECTED:i.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),S();break;default:i.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type:",e.data.type)}break;case n.BgTarget.HEADSET_APP:switch(e.data.type){case n.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:T("headsetAppLaunched",e.data);break;case n.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:T("headsetAppUninstalled",e.data);break;default:i.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type:",e.data.type)}break;case n.BgTarget.PRIVACY_SETTINGS:e.data.type===n.BgPrivacySettingsMsgType.IP_HANDLING_POLICY_CHANGED?T("webRTCIPHandlingPolicyChanged",e.data):i.warning("[ExtensionConnHandler]: Received unknown PRIVACY_SETTINGS msg type:",e.data.type);break;default:e.suppressLog||i.info("[ExtensionConnHandler]: Dispatching event:",e.target);var t=s.createEvent(e.target);t.data=e.data,t.suppressLog=e.suppressLog,e.reqId&&e.type===n.BgMsgType.REQUEST&&(t.reqId=e.reqId),s.dispatch(t)}}(e);break;case n.BgMsgType.RESPONSE:!function(e){if(c[e.reqId]){var t=c[e.reqId];t.timer&&window.clearTimeout(t.timer),delete c[e.reqId],e.data&&e.data.error?(t.cb(e.data.error),e.data.error===n.ResponseError.UNREGISTERED&&S()):t.cb(null,e.data),e.suppressLog||i.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(c).length)}else i.info("[ExtensionConnHandler]: No registered callback for reqId =",e.reqId)}(e);break;default:i.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",e.type)}else i.logMsg(e.data.log.level,e.data.log.messages)}this.isExtensionRunning=function(){return d},this.getScreenShareUserMedia=function(e){p({target:n.BgTarget.SCREEN_SHARE,type:n.BgMsgType.REQUEST,data:{type:n.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},e)},this.exchangeConnect=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{method:n.BgExchangeMsgType.CONNECT,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,18e4)},this.exchangeDisconnect=function(e){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{method:n.BgExchangeMsgType.DISCONNECT,object:{}}},e,65e3)},this.exchangeGetConnectionStatus=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.exchangeGetCapabilities=function(e){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{method:n.BgExchangeMsgType.GET_CAPABILITIES}},e,65e3)},this.exchangeAutodiscoverGetServer=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{method:n.BgExchangeMsgType.AUTODISCOVER_GET_SERVER,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,65e3)},this.exchangeCancelReqCallback=function(e){return i.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",e),function(e){return!(!e||!c[e])&&(delete c[e],!0)}(e)},this.exchangeSearchContacts=function(e,t,i,r){return p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:t,resultCount:i}},keysToOmitFromLogging:["data.key"]},r,65e3)},this.exchangeResolveContact=function(e,t,i){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.RESOLVE_CONTACT,object:t},keysToOmitFromLogging:["data.key"]},i,65e3)},this.exchangeGetContact=function(e,t,i){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_CONTACT,object:{email:t}},keysToOmitFromLogging:["data.key"]},i,65e3)},this.exchangeOnRenewedToken=function(e,t,i,r){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.RESPONSE,data:{key:e,method:n.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:t,token:i}},keysToOmitFromLogging:["data.key","data.object.token"]},r,65e3)},this.exchangeStoreCredentials=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{method:n.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:e},keysToOmitFromLogging:["data.object"]},t,65e3)},this.getAllPersonalContacts=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.getAppointments=function(e,t,i,r,o){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_APPOINTMENTS,startDate:t,endDate:i,resCount:r},keysToOmitFromLogging:["data.key"]},o,65e3)},this.syncAllPersonalContacts=function(e,t,i){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:t},keysToOmitFromLogging:["data.key","data.syncState"]},i,65e3)},this.getStoredCredentials=function(e,t){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.getOooMsg=function(e,t,i,r){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_OOO_MSG,fromEmail:t,email:i},keysToOmitFromLogging:["data.key"]},r,65e3)},this.getUserAvailability=function(e,t,i){p({target:n.BgTarget.EXCHANGE_CONNECTOR,type:n.BgMsgType.REQUEST,data:{key:e,method:n.BgExchangeMsgType.GET_USER_AVAILABILITY,email:t},keysToOmitFromLogging:["data.key","data.email"]},i,65e3)},this.getHeadsetIntegrationAppStatus=function(t,r){"function"==typeof r&&(e.isElectron?window.setTimeout((function(){i.debug("[ExtensionConnHandler]: Return status INSTALLED for desktop app"),r(null,{status:n.HeadsetAppStatus.INSTALLED})}),0):p({target:n.BgTarget.HEADSET_APP,type:n.BgMsgType.REQUEST,data:{type:n.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:t}},r))},this.launchHeadsetIntegrationApp=function(e,t,i){p({target:n.BgTarget.HEADSET_APP,type:n.BgMsgType.REQUEST,data:{type:n.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:e,localizedStrings:t}},i,18e4)},this.restartHeadsetApp=function(e,t){p({target:n.BgTarget.HEADSET_APP,type:n.BgMsgType.REQUEST,data:{type:n.BgHeadsetAppMsgType.RESTART_HEADSET_APP,appId:e}},t)},this.setIPHandlingPolicy=function(e,t,i){p({target:n.BgTarget.PRIVACY_SETTINGS,type:n.BgMsgType.REQUEST,data:{type:n.BgPrivacySettingsMsgType.SET_IP_HANDLING_POLICY,policy:e,localizedStrings:t}},i,18e4)},this.getIPHandlingPolicy=function(e){p({target:n.BgTarget.PRIVACY_SETTINGS,type:n.BgMsgType.REQUEST,data:{type:n.BgPrivacySettingsMsgType.GET_IP_HANDLING_POLICY}},e)},this.bringToFront=function(e){p({target:n.BgTarget.INTERNAL,type:n.BgMsgType.REQUEST,data:{type:n.BgInternalMsgType.BRING_TO_FRONT}},e)},this.getFile=function(e,t,i){p({target:n.BgTarget.INTERNAL,type:n.BgMsgType.REQUEST,data:{type:n.BgInternalMsgType.GET_FILE,name:e,lang:t}},i)},r.getBrowserInfo().chrome&&document&&document.addEventListener(n.DOMEvent.FROM_EXTENSION,(function(e){if(e&&e.detail)try{I(JSON.parse(e.detail))}catch(e){i.error("[ExtensionConnHandler]: Error parsing JSON object. ",e)}}))}return r.inherit(o,t),o.prototype.name="ExtensionConnHandler",e.ExtensionConnHandler=o,e}((Circuit=function(e){"use strict";var t=Circuit.logger;return e.CstaParser=function(){function e(e){var t=null;return e&&e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&(t=e.extn.pDa.prvt.zEpid),t}function n(e){e&&Object.keys(e).forEach((function(t){e[t]=""===e[t]||"true"===e[t]}))}function i(e){if(!e)return{};var t={};return e.sP&&(t.rSP=e.sP,n(t.rSP.cCSs)),e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&void 0!==e.extn.pDa.prvt.zxSP&&(t.eSP=e.extn.pDa.prvt.zxSP,n(t.eSP)),t}function r(e){return{forwardingType:e.fTe,forwardStatus:"true"===e.fS,forwardDN:e.fDNN}}function o(e){return{name:e.zgNM,pilotDn:e.zgDN,available:"false"===e.zMB}}function a(e){if(e.extn&&e.extn.pDa&&e.extn.pDa.prvt){var t=[];if(e.extn.pDa.prvt.zeMBSL)return Array.isArray(e.extn.pDa.prvt.zeMBSL.zeMBS)?e.extn.pDa.prvt.zeMBSL.zeMBS.forEach((function(e){t.push(o(e))})):t.push(o(e.extn.pDa.prvt.zeMBSL.zeMBS)),t}return null}function s(e){return{recordId:e.rID,callID:e.cID,recordType:e.rTp,createdTime:e.cTm,result:e.res,callDuration:e.cDr,callingDevice:e.clDv||"",calledDevice:e.cldDv||"",answeringDevice:e.aDv||""}}this.genCstaRequest=function(e){try{switch(e.request){case"AcceptCall":return function(e){return{AC:{cTBA:{cID:e.callToBeAccepted.cID,dID:e.callToBeAccepted.dID}}}}(e);case"AlternateCall":return function(e){return{ACl:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"AnswerCall":return function(e){return{AnC:{cTBAd:{cID:e.callToBeAnswered.cID,dID:e.callToBeAnswered.dID}}}}(e);case"CallBackCallRelated":return function(e){return{CB:{cC:{cID:e.callBackConnection.cID,dID:e.callBackConnection.dID}}}}(e);case"CallBackNonCallRelated":return function(e){return{CBNC:{orD:e.orD,tD:e.tD}}}(e);case"CallLogSnapShot":return function(e){return{CLS:{sub:e.device}}}(e);case"CancelCallBack":return function(e){return{CCB:{orD:e.orD,tD:e.tD}}}(e);case"ClearConnection":return function(e){return{CCn:{coTBC:{cID:e.connectionToBeCleared.cID,dID:e.connectionToBeCleared.dID},rsn:e.reason}}}(e);case"ConferenceCall":return function(e){return{CoC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"ConsultationCall":return function(e){return{CnC:{cnD:e.consultedDevice||void 0,eCl:{cID:e.existingCall.cID,dID:e.existingCall.dID}}}}(e);case"DeflectCall":return function(e){var t={cTBD:{cID:e.callToBeDiverted.cID,dID:e.callToBeDiverted.dID},nD:e.newDestination};e.autoAnswer&&(t.extn={pDa:{prvt:{zdT:"Auto-Answer"}}});return{DCl:t}}(e);case"GenerateDigits":return function(e){return{GD:{cTSD:{cID:e.connectionToSendDigits.cID,dID:e.connectionToSendDigits.dID},cTS:e.charactersToSend}}}(e);case"GenGetConfiguration":return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}};case"GetAgentState":return function(e){var t={dvc:e.device};e.group&&(t.aG=e.group);return{GAS:t}}(e);case"GetDoNotDisturb":return function(e){return{GDND:{dvc:e.device}}}(e);case"GetForwarding":return function(e){return{GF:{dvc:e.device}}}(e);case"GetLogicalDeviceInformation":return function(e){return{GLDI:{dvc:e.device}}}(e);case"GetMessageWaitingIndicator":return function(e){return{GMWI:{dvc:e.device}}}(e);case"GetMicrophoneMute":return function(e){return{GMM:{dvc:e.device}}}(e);case"GroupPickupCall":return function(e){return{GPC:{nD:e.newDestination}}}(e);case"HoldCall":return function(e){var t={cTBH:{cID:e.callToBeHeld.cID,dID:e.callToBeHeld.dID}};e.holdOptions&&(t.extn={zhOs:e.holdOptions});return{HC:t}}(e);case"MakeCall":return function(e){return{MC:{caD:e.callingDevice,cDN:e.calledDirectoryNumber,aOe:e.autoOriginate}}}(e);case"ReconnectCall":return function(e){return{RC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID||void 0,dID:e.activeCall.dID||void 0}}}}(e);case"RetrieveCall":return function(e){return{RCl:{cTBRd:{cID:e.callToBeRetrieved.cID,dID:e.callToBeRetrieved.dID}}}}(e);case"SetAgentState":return function(e){var t={dvc:e.device,rAS:e.state};e.group&&(t.grp=e.group);return{SAS:t}}(e);case"SetBusy":return function(e){return{zSBN:{dvc:e.device,zbO:e.busyState}}}(e);case"SetDoNotDisturb":return function(e){return{SDND:{dvc:e.device,dNDO:e.doNotDisturbOn}}}(e);case"SetForwarding":return function(e){var t={SF:{dvc:e.device,aF:e.activateForward,fDNN:e.forwardDN,fTe:e.forwardingType,riC:e.ringCount}},n={};void 0!==e.staticOndActive?n={zsOA:!0===e.staticOndActive?"true":"false",zsOD:e.staticOndDN||""}:void 0!==e.voicemailActive||void 0!==e.voicemailRingDuration?n={zvMA:"boolean"==typeof e.voicemailActive?e.voicemailActive.toString():void 0,zvMRD:e.voicemailRingDuration?e.voicemailRingDuration.toString():void 0}:(void 0!==e.mainRingDuration&&(n.zmRD=e.mainRingDuration.toString()||""),void 0!==e.clientRingDuration&&(n.zcRD=e.clientRingDuration.toString()||""),void 0!==e.cellRingDuration&&(n.zcpRD=e.cellRingDuration.toString()||""),void 0!==e.alternativeNumber&&(n.zcPN=e.alternativeNumber),void 0!==e.routeToCell&&(n.zrTCN=e.routeToCell?"true":"false"));Object.keys(n).length>0&&(t.SF.extn={pDa:{prvt:n}});return t}(e);case"SetMicrophoneMute":return function(e){return{SMM:{dvc:e.device,mMO:e.mute}}}(e);case"SingleStepTransferCall":return function(e){var t={atC:{cID:e.activeCall.cID,dID:e.activeCall.dID},tTo:e.transferredTo};if(e.autoAnswer||e.seamlessHandover){var n={};e.autoAnswer&&(n.ztTgt="Auto-Answer"),e.seamlessHandover&&(n.zseHo="true"),t.extn={pDa:{prvt:n}}}return{SSTC:t}}(e);case"SnapshotCall":return function(e){return{SC:{sO:{cID:e.snapshotObject.cID,dID:e.snapshotObject.dID}}}}(e);case"SnapshotDevice":return function(e){var t={sO:e.snapshotObject};e.osmo&&(t.extn={pDa:{prvt:{zxsm:e.osmo}}});return{SDe:t}}(e);case"TransferCall":return function(e){return{TC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e)}t.error("CSTA: Unsupported CSTA request: "+e.request)}catch(e){t.error(e)}return null},this.parseEvent=function(n){try{if(!n)return t.error("[CstaParser]: Invalid event"),null;var r=JSON.parse(n);if(!r||r.parsererror)return t.error("[CstaParser]: Error parsing CSTA event: ",n),r&&r.parsererror.div&&t.error("[CstaParser]: "+r.parsererror.div),null;var o=Object.keys(r)[0];switch(o){case"ABE":return{category:"LogicalDeviceFeature",name:"AgentBusyEvent",agentReady:!1,huntGroupList:a(r.ABE)};case"ALOE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentLoggedOffEvent",huntGroupList:a(e.ALOE)}}(r);case"ALOEt":return function(e){return{category:"LogicalDeviceFeature",name:"AgentLoggedOnEvent",huntGroupList:a(e.ALOEt)}}(r);case"ANRE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentNotReadyEvent",agentReady:!1,huntGroupList:a(e.ANRE),agentDevice:e.ANRE&&e.ANRE.aD&&e.ANRE.aD.dIr||"",agentGroup:e.ANRE&&e.ANRE.aG||""}}(r);case"ARE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentReadyEvent",agentReady:!0,huntGroupList:a(e.ARE),agentDevice:e.ARE&&e.ARE.aD&&e.ARE.aD.dIr||"",agentGroup:e.ARE&&e.ARE.aG||""}}(r);case"AWAC":return function(e){return{category:"LogicalDeviceFeature",name:"AgentWorkingAfterCallEvent",agentReady:!1,huntGroupList:a(e.AWAC)}}(r);case"BISE":return function(e){return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:e.BISE.dvc.dIr||""}}(r);case"CBE":return function(e){var t=e.CBE;return{category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:t.orD.dIr,targetDevice:t.tD.dIr,callBackSetCanceled:t.cBSC}}(r);case"CCEt":return function(t){var n=t.CCEt,r={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:n.drC,releasingDevice:n.rD.dIr||"",localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r.pickupNotificationTerminated=r.releasingDevice&&r.releasingDevice.includes("Pickup Group Number"),r}(r);case"CIE":return function(t){var n=t.CIE,r={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:n.cnncn,device:n.dvc.dIr||"",callingDevice:n.caD&&n.caD.dIr||"",servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r.pickupNotificationEarly=r.device&&r.device.includes("Pickup Group Number"),r}(r);case"CLE":return function(e){var t=e.CLE,n={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]};t.cLL&&t.cLL.cLE&&(t.cLL.cLE.rID?n.callLogList.push(s(t.cLL.cLE)):t.cLL.cLE.forEach((function(e){n.callLogList.push(s(e))})));return n}(r);case"CoE":return function(t){var n=t.CoE,r={category:"CallControl",name:"ConferencedEvent",primaryOldCall:n.pOC,secondaryOldCall:n.sOC,conferencingDevice:n.coD.dIr||"",addedParty:n.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return n.cnC.cLI.forEach((function(e){var t={connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)};r.conferenceConnections.push(t)})),r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"DCCE":return function(e){var t=e.DCCE,n={category:"DeviceMaintenance"};t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&t.extn.pDa.prvt.zdP&&(n.name="true"===t.extn.pDa.prvt.zdP?"BackInServiceEvent":"OutOfServiceEvent");return n}(r);case"DE":return function(t){var n=t.DE,r={category:"CallControl",name:"DeliveredEvent",connection:n.cnncn,alertingDevice:n.aDe.dIr||"",callingDevice:n.caD.dIr||"",networkCallingDevice:n.ntCD&&n.ntCD.dIr||"",calledDevice:n.cDe.dIr||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"DEt":return function(t){var n=t.DEt,r={category:"CallControl",name:"DivertedEvent",connection:n.cnncn,divertingDevice:n.dvD.dIr||"",newDestination:n.nD.dIr||"",callingDevice:n.caD&&n.caD.dIr||"",lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"DGE":return function(e){var t=e.DGE;return{category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:t.cnncn,digitGeneratedList:t.dGL,keysToOmitFromLogging:["digitGeneratedList"]}}(r);case"DNDE":return function(e){var t=e.DNDE;return{category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:t.dvc.dIr||"",doNotDisturbOn:"true"===t.dNDO}}(r);case"EEt":return function(t){var n=t.EEt,r={category:"CallControl",name:"EstablishedEvent",establishedConnection:n.eCn,answeringDevice:n.anD.dIr||"",callingDevice:n.caD.dIr||"",networkCallingDevice:n.ntCD&&n.ntCD.dIr||"",calledDevice:n.cDe.dIr||"",lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"FE":return function(t){var n=t.FE,r={category:"CallControl",name:"FailedEvent",failedConnection:n.fC,failingDevice:n.fD.dIr||"",callingDevice:n.caD.dIr||"",localConnectionInfo:n.lCI,calledDevice:n.cDe.dIr,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"FEt":return function(e){var t=e.FEt,n={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:t.dvc.dIr||"",forwardingType:t.fTe,forwardStatus:"true"===t.fS,forwardTo:t.fTo};t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(t.extn.pDa.prvt.zsOA&&(n.staticOndActive="true"===t.extn.pDa.prvt.zsOA,n.staticOndDN=t.extn.pDa.prvt.zsOD),t.extn.pDa.prvt.zvMA&&(n.voicemailActive="true"===t.extn.pDa.prvt.zvMA),t.extn.pDa.prvt.zoP&&(n.overrideProfile="true"===t.extn.pDa.prvt.zoP),t.extn.pDa.prvt.zvMRD&&(n.voicemailRingDuration=parseInt(t.extn.pDa.prvt.zvMRD,10)),t.extn.pDa.prvt.zmRD&&(n.mainRingDuration=parseInt(t.extn.pDa.prvt.zmRD,10)),t.extn.pDa.prvt.zcRD&&(n.clientRingDuration=parseInt(t.extn.pDa.prvt.zcRD,10)),t.extn.pDa.prvt.zcpRD&&(n.cellRingDuration=parseInt(t.extn.pDa.prvt.zcpRD,10)),t.extn.pDa.prvt.hasOwnProperty("zcPN")&&(n.alternativeNumber=t.extn.pDa.prvt.zcPN),t.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(n.routeToCell="true"===t.extn.pDa.prvt.zrTCN),t.extn.pDa.prvt.hasOwnProperty("zfCC")&&(n.forwardingCapsChanged="true"===t.extn.pDa.prvt.zfCC));return n}(r);case"HE":return function(t){var n=t.HE,r={category:"CallControl",name:"HeldEvent",heldConnection:n.hCn,holdingDevice:n.hD.dIr||"",localConnectionInfo:n.lCI,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"MWE":return function(e){var t=e.MWE;return{category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:t.tD.dIr||"",messageWaitingOn:"true"===t.mWO}}(r);case"OE":return function(t){var n=t.OE,r={category:"CallControl",name:"OfferedEvent",offeredConnection:n.oCn,offeredDevice:n.oDe.dIr||"",callingDevice:n.caD.dIr||"",calledDevice:n.cDe.dIr||"",localConnectionInfo:n.lCI,lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"OOSE":return function(e){return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:e.OOSE.dvc.dIr||""}}(r);case"QE":return function(t){var n=t.QE,r={category:"CallControl",name:"QueuedEvent",queuedConnection:n.qC,queue:n.q.dIr||"",callingDevice:n.caD.dIr||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"ReE":return function(t){var n=t.ReE,r={category:"CallControl",name:"RetrievedEvent",retrievedConnection:n.rCn,retrievingDevice:n.reD.dIr||"",localConnectionInfo:n.lCI,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"SCFE":return function(e){var t=e.SCFE,n={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:t.prC.cIDD,localConnectionState:t.prC.lCSe},cause:t.cs};t.sC&&(n.secondaryCall={connectionID:t.sC.cIDD,localConnectionState:t.sC.lCSe});return n}(r);case"SIE":return function(t){var n=t.SIE,r={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:n.iCn,initiatingDevice:n.iD.dIr||"",cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"TE":return function(t){var n=t.TE,r={category:"CallControl",name:"TransferredEvent",primaryOldCall:n.pOC,secondaryOldCall:n.sOC,transferringDevice:n.tDe.dIr||"",transferredToDevice:n.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}},o=n.tCs.cLI;Array.isArray(o)||(o=[o]);return r.transferredConnections=o.map((function(e){return{connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)}})),r.servicesPermitted=i(n),r.epid=e(n),r}(r)}t.info("[CstaParser]: Unsupported CSTA event: ",o)}catch(e){t.error("[CstaParser]: Error parsing CSTA event: ",e)}return null},this.parseResponse=function(n,o){try{if(!n||!o)return t.error("[CstaParser]: Invalid response"),null;var s=JSON.parse(o);if(!s||s.parsererror)return t.error("[CstaParser]: Error parsing CSTA response: ",o),s&&s.parsererror.div&&t.error("[CstaParser]: "+s.parsererror.div),null;if(s.CSTA&&(s.CSTAErrorCode=s.CSTA),s.CSTAErrorCode)return t.debug("[CstaParser]: Received error response for: ",n),function(e){if(!e.CSTAErrorCode)return t.error("[CstaParser]: The given response is not an error code: ",e),null;var n=null,i=Object.keys(e.CSTAErrorCode)[0];switch(i){case"oprt":case"operation":n="Operation Error";break;case"scrt":case"security":n="Security Error";break;case"sIy":case"stateIncompatibility":n="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":n="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":n="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":n="Performance Management Error";break;case"pDa":case"privateDataInformation":n="Private Data Information Error"}if(!n)return t.error("[CstaParser]: Unrecognized Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"};return{error:!0,errorCategory:n,errorValue:e.CSTAErrorCode[i]}}(s);if(s.ISEC)return t.debug("[CstaParser]: Received internal service error response for: ",n),function(e){if(!e.ISEC)return t.error("[CstaParser]: The given response is not an internal service error code: ",e),null;if("code"!==Object.keys(e.ISEC)[0])return t.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"};return{error:!0,errorCategory:"Code",errorValue:e.ISEC.code}}(s);switch(n){case"AcceptCall":return function(e){return t.debug("[CstaParser]: Received CSTA Accept Call response: ",e),e.ACR}(s);case"AlternateCall":return function(e){return t.debug("[CstaParser]: Received CSTA Alternate Call response: ",e),e.ACRe}(s);case"AnswerCall":return function(e){return t.debug("[CstaParser]: Received CSTA Answer Call response: ",e),e.AnCR}(s);case"CallBackCallRelated":return function(e){return t.debug("[CstaParser]: Received CSTA Call Back call related response: ",e),e.CBR}(s);case"CallBackNonCallRelated":return function(e){return t.debug("[CstaParser]: Received CSTA Call Back non call related response: ",e),e.CBNCe}(s);case"CallLogSnapShot":return function(e){return t.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",e),e.CLSR}(s);case"CancelCallBack":return function(e){return t.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",e),e.CCBR}(s);case"ClearConnection":return function(e){return t.debug("[CstaParser]: Received CSTA Clear Connection response: ",e),e.ClCR}(s);case"ConferenceCall":return function(e){return t.debug("[CstaParser]: Received CSTA Conference Call response: ",e),{conferenceCall:e.CoCR.coC}}(s);case"ConsultationCall":return function(e){return t.debug("[CstaParser]: Received CSTA Consultation Call response: ",e),e.CnCR}(s);case"DeflectCall":return function(e){return t.debug("[CstaParser]: Received CSTA Deflect Call response: ",e),e.DCRe}(s);case"GenerateDigits":return function(e){return t.debug("[CstaParser]: Received CSTA Generate Digits response: ",e),e.GDR}(s);case"GetAgentState":return function(e){t.debug("[CstaParser]: Received CSTA GetAgentState response",e);var n=e.GASR;return{loggedOnState:n.aSL&&n.aSL.aSE&&"true"===n.aSL.aSE.lOS,agentState:n.aSL&&n.aSL.aSE&&n.aSL.aSE.aIo&&"agentReady"===n.aSL.aSE.aIo.aII.aS?"ready":"notReady",huntGroupList:a(n)}}(s);case"GetDoNotDisturb":return function(e){return t.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",e),{doNotDisturbOn:"true"===e.GDNDe.dNDO}}(s);case"GetForwarding":return function(e){if(t.debug("[CstaParser]: Received CSTA Get Forwarding response: ",e),e.GetForwardingResponse)return function(e){var t={forwardList:[]};e.forwardingList.forwardListItem.forwardStatus?(e.forwardingList.forwardListItem.forwardStatus="true"===e.forwardingList.forwardListItem.forwardStatus,t.forwardList.push(e.forwardingList.forwardListItem)):e.forwardingList.forwardListItem.forEach((function(e){e.forwardStatus="true"===e.forwardStatus,t.forwardList.push(e)}));e.extensions&&e.extensions.privateData&&e.extensions.privateData.private&&(t.staticOndDN=e.extensions.privateData.private.staticOndDN,t.staticOndActive="true"===e.extensions.privateData.private.staticOndActive);return t}(e.GetForwardingResponse);var n=e.GFR,i={forwardList:[]};n.fL.fLI.fS?i.forwardList.push(r(n.fL.fLI)):n.fL.fLI.forEach((function(e){i.forwardList.push(r(e))}));n.extn&&n.extn.pDa&&n.extn.pDa.prvt&&(n.extn.pDa.prvt.zsOA&&(i.staticOndActive="true"===n.extn.pDa.prvt.zsOA,i.staticOndDN=n.extn.pDa.prvt.zsOD),i.voicemailActive="true"===n.extn.pDa.prvt.zvMA,n.extn.pDa.prvt.zoP&&(i.overrideProfile="true"===n.extn.pDa.prvt.zoP),n.extn.pDa.prvt.zvMRD&&(i.voicemailRingDuration=parseInt(n.extn.pDa.prvt.zvMRD,10)),n.extn.pDa.prvt.zmRD&&(i.mainRingDuration=parseInt(n.extn.pDa.prvt.zmRD,10)),n.extn.pDa.prvt.zcRD&&(i.clientRingDuration=parseInt(n.extn.pDa.prvt.zcRD,10)),n.extn.pDa.prvt.zcpRD&&(i.cellRingDuration=parseInt(n.extn.pDa.prvt.zcpRD,10)),n.extn.pDa.prvt.hasOwnProperty("zcPN")&&(i.alternativeNumber=n.extn.pDa.prvt.zcPN),n.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(i.routeToCell="true"===n.extn.pDa.prvt.zrTCN));return i}(s);case"GetLogicalDeviceInformation":return function(e){return t.debug("[CstaParser]: Received CSTA Get Logical Device Information response: ",e),{hasPhysicalDeviceInformation:"true"===e.GLDIe.hPE}}(s);case"GetMessageWaitingIndicator":return function(e){return t.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",e),{messageWaitingOn:"true"===e.GMWIe.mWO}}(s);case"GetMicrophoneMute":return function(e){return t.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",e),{mute:"true"===e.GMMR.mML.mMI.mMO}}(s);case"GroupPickupCall":return function(e){return t.debug("[CstaParser]: Received CSTA GroupPickupCall response",e),e.GPCR}(s);case"HoldCall":return function(e){return t.debug("[CstaParser]: Received CSTA Hold Call response: ",e),e.HCR}(s);case"MakeCall":return function(e){return t.debug("[CstaParser]: Received CSTA MakeCall response",e),e.MCR}(s);case"ReconnectCall":return function(e){return t.debug("[CstaParser]: Received CSTA Reconnect Call response: ",e),e.RCR}(s);case"RetrieveCall":return function(e){return t.debug("[CstaParser]: Received CSTA Retrieve Call response: ",e),e.RCRe}(s);case"SetAgentState":return function(e){return t.debug("[CstaParser]: Received CSTA SetAgentState response",e),e.SASR}(s);case"SetBusy":return function(e){return t.debug("[CstaParser]: Received CSTA Set Busy response: ",e),e.zSBNe}(s);case"SetDoNotDisturb":return function(e){return t.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",e),e.SDNDe}(s);case"SetForwarding":return function(e){return t.debug("[CstaParser]: Received CSTA Set Forwarding response: ",e),e.hasOwnProperty("SFR")?e.SFR:e.SetForwardingResponse}(s);case"SetMicrophoneMute":return function(e){return t.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",e),{mute:"true"===e.SMMR.mML.mMI.mMO}}(s);case"SingleStepTransferCall":return function(e){t.debug("[CstaParser]: Received CSTA SST Call response: ",e);var n=e.SSTCe,i={transferredCall:n.trC};n.extn&&n.extn.pDa&&n.extn.pDa.prvt&&(i.seamlessHandover="true"===n.extn.pDa.prvt.zseHo);return i}(s);case"SnapshotCall":return function(n){t.debug("[CstaParser]: Received CSTA Snapshot Call response: ",n);var r=n.SCR,o={endpoints:[],callingDevice:r.caD&&r.caD.dIr||"",calledDevice:r.cDe&&r.cDe.dIr||"",servicesPermitted:{}},a=function(e){var t=function(e){return{deviceOnCall:e.dOC.dIr||"",callIdentifier:e.cI,localConnectionState:e.lCI,servicesPermitted:i(e)}}(e);o.endpoints.push(t),!o.callingDevice&&o.calledDevice&&t.deviceOnCall!==o.calledDevice&&(o.callingDevice=t.deviceOnCall)};r.cRID.sDa.sCRIo&&(r.cRID.sDa.sCRIo.dOC?a(r.cRID.sDa.sCRIo):r.cRID.sDa.sCRIo.forEach((function(e){a(e)})));return o.servicesPermitted=i(r),o.epid=e(r),o}(s);case"SnapshotDevice":return function(e){t.debug("[CstaParser]: Received CSTA Snapshot Device response: ",e);var n=e.SnDR,i={activeCalls:[]};function r(e){var t,n={connectionId:(t=e).cIr,localCallState:t.lCS&&t.lCS.cCSe&&t.lCS.cCSe.lCSe};n.connectionId&&n.connectionId.cID&&i.activeCalls.push(n)}n.cRID.sDa.sDRI&&(n.cRID.sDa.sDRI.cIr?r(n.cRID.sDa.sDRI):n.cRID.sDa.sDRI.forEach((function(e){r(e)})));n.extn&&n.extn.pDa&&n.extn.pDa.prvt&&(i.deskPhoneRegistered="true"===n.extn.pDa.prvt.zdP);return i}(s);case"TransferCall":return function(e){return t.debug("[CstaParser]: Received CSTA TransferCall response: ",e),{transferredCall:e.TCR.trC}}(s)}t.error("CSTA: Unsupported CSTA response for request: ",n)}catch(e){t.error(e)}return null}},e}((Circuit=function(e){"use strict";var t;return e.UserToUserHandlerSingleton={getInstance:function(){return t||(t=new e.UserToUserHandler),t}},e}((Circuit=function(e){"use strict";var t=e.ClientApiHandlerSingleton,n=e.Constants,i=e.logger,r=e.Utils,o=Object.freeze({ADVANCING:"ADVANCING",CSTA:"CSTA",INFO:"INFO",PRIMARYCLIENT:"PRIMARYCLIENT",REGISTER:"REGISTER",REGISTER_RESPONSE:"REGISTER_RESPONSE",SETTINGS:"SETTINGS",START_REASSIGNMENT:"START_REASSIGNMENT",TALK:"TALK",UNREGISTER:"UNREGISTER",UNREGISTERED:"UNREGISTERED"}),a=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK",ENABLE_PBX_CALL_LOG:"ENABLE_PBX_CALL_LOG"}),s=Object.freeze({TRANSFER:"TRANSFER"}),c=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE",CONVERSATION_NAVIGATE_REQUEST:"CONVERSATION_NAVIGATE_REQUEST",CONVERSATION_NAVIGATE_RESPONSE:"CONVERSATION_NAVIGATE_RESPONSE",CLICK_TO_ANSWER_REQUEST:"CLICK_TO_ANSWER_REQUEST",CLICK_TO_ANSWER_RESPONSE:"CLICK_TO_ANSWER_RESPONSE",START_CONFERENCE_REQUEST:"START_CONFERENCE_REQUEST",START_CONFERENCE_RESPONSE:"START_CONFERENCE_RESPONSE",NAVIGATE_REQUEST:"NAVIGATE_REQUEST",NAVIGATE_REQUEST_RESPONSE:"NAVIGATE_REQUEST_RESPONSE"}),l=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",INVALID_CONVERSATION_TYPE:"INVALID_CONVERSATION_TYPE",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",CONVERSATION_NAVIGATE_FAILED:"CONVERSATION_NAVIGATE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED",START_CONFERENCE_FAILED:"START_CONFERENCE_FAILED",NAVIGATE_REQUEST_FAILED:"NAVIGATE_REQUEST_FAILED"}),d=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",CHANGE_LAYOUT_REQUEST:"CHANGE_LAYOUT_REQUEST",CHANGE_LAYOUT_RESPONSE:"CHANGE_LAYOUT_RESPONSE",TOGGLE_WHITEBOARD:"TOGGLE_WHITEBOARD",TOGGLE_SCREENSHARING:"TOGGLE_SCREENSHARING",TOGGLE_CONFERENCEPOLL:"TOGGLE_CONFERENCEPOLL",TOGGLE_SHOW_VIDEO:"TOGGLE_SHOW_VIDEO",SWAP_DISPLAYS_REQUEST:"SWAP_DISPLAYS_REQUEST",SWAP_DISPLAYS_RESPONSE:"SWAP_DISPLAYS_RESPONSE",DOWNLOAD_SYSTEM_LOGS_REQUEST:"DOWNLOAD_SYSTEM_LOGS_REQUEST",DOWNLOAD_SYSTEM_LOGS_RESPONSE:"DOWNLOAD_SYSTEM_LOGS_RESPONSE",WHITEBOARD_STATUS_UPDATE_REQUEST:"WHITEBOARD_STATUS_UPDATE_REQUEST"}),u=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED",TOGGLE_SCREENSHARING_FAILED:"TOGGLE_SCREENSHARING_FAILED",TOGGLE_CONFERENCEPOLL_FAILED:"TOGGLE_CONFERENCEPOLL_FAILED",TOGGLE_WHITEBOARD_FAILED:"TOGGLE_WHITEBOARD_FAILED",TOGGLE_SHOW_VIDEO_FAILED:"TOGGLE_SHOW_VIDEO_FAILED",CHANGE_LAYOUT_FAILED:"CHANGE_LAYOUT_FAILED",SWAP_DISPLAYS_FAILED:"SWAP_DISPLAYS_FAILED"}),E=Object.freeze({DIAL:"DIAL"}),C=Object.freeze({TEAM_PICKUP:"TEAM_PICKUP"});function T(e){var o={},a={},s=e||t.getInstance();function c(e){e&&window.setTimeout((function(){e(n.ReturnCode.INVALID_MESSAGE)}),0)}function l(e,t,a){return t&&t.content&&t.content.type?(i.debug("[UserToUserHandler]: Sending request "+e+"."+t.content.type),t.content.requestId=t.content.requestId||r.createTransactionId(),o[t.content.requestId]?(i.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void c(a)):void s.sendUserToUserRequest(e,t,(function(r){if(r)return i.error("[UserToUserHandler]: Failed to send request: ",r),void(a&&a(r));e===n.UserRoutingMessageType.SDK?a&&a():function(e,t){if(t){var r=window.setTimeout((function(e){i.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",e),o[e]&&(delete o[e],t(n.ReturnCode.REQUEST_TIMEOUT),i.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(o).length))}),2e4,e);o[e]={cb:t,timer:r}}}(t.content.requestId,a)}))):(i.error("[UserToUserHandler]: Invalid UserToUser request data - ",t),void c(a))}function d(e,t){try{if(t.routing&&t.routing.srcClientId===s.clientId)return void i.info("[UserToUserHandler]: Ignore own UserToUser event");var r;try{r=JSON.parse(t.data)}catch(e){return void i.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(r.requestId){var c=o[r.requestId];if(c)return c.timer&&window.clearTimeout(c.timer),delete o[r.requestId],c.cb&&c.cb(null,r),void i.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(o).length)}var l=e+"."+r.type,d=a[l];d&&0!==d.length?(e===n.UserRoutingMessageType.SDK&&(r=r.message),d.forEach((function(e){e.cb(r,t.routing)}))):i.info("[UserToUserHandler]: There is no registered event handler for ",l)}catch(e){i.error("[UserToUserHandler]: Exception handling UserToUser event. ",e)}}s.on("UserToUser.ATC",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.ATC event"),d(n.UserRoutingMessageType.ATC,e)})),s.on("UserToUser.DESKTOP_APP",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",e.data),d(n.UserRoutingMessageType.DESKTOP_APP,e)})),s.on("UserToUser.CONTACT_CARD",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",e.data),d(n.UserRoutingMessageType.CONTACT_CARD,e)})),s.on("UserToUser.CMP",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",e.data),d(n.UserRoutingMessageType.CMP,e)})),s.on("UserToUser.MOBILE_BREAKOUT",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",e.data),d(n.UserRoutingMessageType.MOBILE_BREAKOUT,e)})),s.on("UserToUser.SDK",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",e.data),d(n.UserRoutingMessageType.SDK,e)})),s.on("UserToUser.STC",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.STC event: ",e.data),d(n.UserRoutingMessageType.STC,e)})),s.on("UserToUser.TEAM_PICKUP",(function(e){i.debug("[UserToUserHandler]: Received UserToUser.TEAM_PICKUP event: ",e.data),d(n.UserRoutingMessageType.TEAM_PICKUP,e)})),this.cancelReqCallback=function(e){var t=o[e];t&&(t.cb=null)},this.sendAtcRequest=function(e,t){l(n.UserRoutingMessageType.ATC,e,t)},this.sendContactCardRequest=function(e,t){l(n.UserRoutingMessageType.CONTACT_CARD,e,t)},this.sendDesktopAppRequest=function(e,t){l(n.UserRoutingMessageType.DESKTOP_APP,e,t)},this.sendMeetingPointRequest=function(e,t){l(n.UserRoutingMessageType.CMP,e,t)},this.sendMobileBreakoutEvent=function(e,t){l(n.UserRoutingMessageType.MOBILE_BREAKOUT,e,t)},this.sendStcRequest=function(e,t){l(n.UserRoutingMessageType.STC,e,t)},this.sendSdkRequest=function(e,t){e&&e.content&&delete e.content.requestId,l(n.UserRoutingMessageType.SDK,e,t)},this.sendTeamPickupRequest=function(e,t){l(n.UserRoutingMessageType.TEAM_PICKUP,e,t)},this.on=function(e,t){e&&"function"==typeof t&&(a[e]=a[e]||[],a[e].some((function(e){return e.cb===t}))||a[e].push({cb:t}))},this.off=function(e,t){if(e||t)if(t){if(e&&"function"==typeof t){var n=a[e];n&&n.some((function(e,i){return e.cb===t&&(n.splice(i,1),!0)}))}}else delete a[e];else a={}}}return T.prototype.constructor=T,T.prototype.name="UserToUserHandler",e.UserToUserHandler=T,e.Enums=e.Enums||{},e.Enums.AtcInfoMessage=a,e.Enums.AtcMessage=o,e.Enums.StcMessage=s,e.Enums.ContactCardMessage=c,e.Enums.ContactCardResponseCode=l,e.Enums.MeetingPointMessage=d,e.Enums.MeetingPointResponseCode=u,e.Enums.MobileBreakoutMessage=E,e.Enums.TeamPickupMessage=C,e}((Circuit=function(e){"use strict";var t;return e.ClientApiHandlerSingleton={getInstance:function(){return t||(t=new e.ClientApiHandler),t}},e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.PrivateData,i=e.Proto,r=e.Utils;function o(o){var a,s,c,l,d=e.logger,u=function(){},E=["teaser","navigableItem.missedOutcall.convReference.topic","navigableItem.missedOutcallGuestInvite.convReference.topic","navigableItem.spacesAdd.spaceReference.name","navigableItem.spacesMention.itemReference.subject","navigableItem.spacesMention.spaceReference.name","navigableItem.spacesRequestAccept.spaceReference.name","navigableItem.spacesRequestToJoin.spaceReference.name","navigableItem.spacesTagAdd.itemReference.subject","navigableItem.spacesTagAdd.spaceReference.name","navigableItem.spacesTagAdd.tagReference.tag","navigableItem.spacesTagRemove.itemReference.subject","navigableItem.spacesTagRemove.spaceReference.name","navigableItem.spacesTagRemove.tagReference.tag","navigableItem.spaceUserMassImport.spaceReference.name","navigableItem.teamIBelongToHasBeenDeleted.teamReference.teamName","navigableItem.teamUserDeletedFromTeam.teamReference.teamName","navigableItem.teamUserInvitationAccepted.teamReference.teamName","navigableItem.teamUserInvitationDeclined.teamReference.teamName","navigableItem.teamUserInvitedToJoin.teamReference.teamName","navigableItem.teamUserLeftTeam.teamReference.teamName","navigableItem.spacesBestAnswerEdited.spaceReference.name","navigableItem.spacesBestAnswerMarked.spaceReference.name","navigableItem.spacesBestAnswerUnmarked.spaceReference.name","navigableItem.spacesBestAnswerDeleted.spaceReference.name","systemStreamItem.removedFrom.convReference.topic","systemStreamItem.spacesRemove.spaceReference.name","systemStreamItem.spacesRequestDeclined.spaceReference.name"],C=this,T=new e.ConnectionHandler(o),p=!1,S=!1,I=0;function A(e,t,n,r,o,a,s){var c=i.Request(e,t,a);return p?o=null:r&&(c.keysToOmitFromLogging=r),T.sendMessage(c,(function(e,t){try{n(e,t)}catch(e){d.error("[ClientApiHandler]: Exception: ",e)}}),o||null,s),c.request.requestId}function R(e,t){Circuit.Error&&(a=new Circuit.Error(e),t&&(a.errObj=t,a.message=t.info))}function f(e,n,i,r){if(a=null,S=!1,e)return R(e),i(e),!1;if(n.sanitization&&(S=!0,d.info("[ClientApiHandler]: Sanitization stripped content: ",n.sanitization&&n.sanitization.sanitizedContent)),n.code===t.ReturnCode.NO_RESULT)return r?i(null,[]):(R(t.ReturnCode.NO_RESULT),i(t.ReturnCode.NO_RESULT)),!1;var o,s=n.code;switch(n.code){case t.ReturnCode.OK:case t.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case t.ReturnCode.CLOUD_TELEPHONY_EXCEPTION:case t.ReturnCode.SERVICE_EXCEPTION:n.errorInfo&&n.errorInfo.errorCode&&((s=n.errorInfo.errorCode)===t.ErrorCode.THIRDPARTY_ERROR&&n.errorInfo.thirdpartyError?s=n.errorInfo.thirdpartyError.type:s===t.ErrorCode.CIRCUIT_EXCEPTION&&n.errorInfo.circuitException?s=n.errorInfo.circuitException:s===t.ErrorCode.CLOUD_TELEPHONY_ERROR&&n.errorInfo.cloudTelephonyError&&(s=n.errorInfo.cloudTelephonyError),o=n.errorInfo)}return R(s=s||t.ReturnCode.UNEXPECTED_RESPONSE,o),i(s),!1}function _(e,t,n){t&&R(t),e&&e!==u&&window.setTimeout((function(){e(t,n)}),0)}function v(e){return"boolean"==typeof e?e:void 0}function g(e){if(e)return Array.isArray(e)?e.length?e:void 0:[e]}function N(e){return Array.isArray(e)&&e.length>0}function m(e){var n=[];return e?(e.audio&&n.push(t.RealtimeMediaType.AUDIO),e.video&&n.push(t.RealtimeMediaType.VIDEO),e.desktop&&n.push(t.RealtimeMediaType.DESKTOP_SHARING)):n.push(t.RealtimeMediaType.AUDIO),n}function h(e){var n=[];return e?(e.audio&&n.push(t.RecordingMediaType.AUDIO),e.video&&n.push(t.RecordingMediaType.VIDEO),e.text&&n.push(t.RecordingMediaType.TEXT)):n.push(t.RealtimeMediaType.AUDIO),n}function O(e){return e&&{fileId:e.fileId,fileName:e.fileName,mimeType:e.mimeType,size:e.size,itemId:e.itemId}}function D(e){return e&&e.map(O)}function P(e){return e&&{attachment:O(e.attachment),type:e.type,downloadLocation:e.downloadLocation,previewLocation:e.previewLocation,shareLinkToken:e.shareLinkToken}}function y(e){return e&&e.map(P)}function b(e){return{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,sdp:e.sdp,mediaType:m(e.mediaType),callOut:!!e.callOut,handover:!!e.handover,sendInviteCancel:!!e.sendInviteCancel,peerUserId:e.peerUserId||void 0,replaces:e.replaces,from:e.fromDn||e.fromName?{phoneNumber:e.fromDn,displayName:e.fromName,resolvedUserId:e.fromUserId}:void 0,to:e.dialedDn?{phoneNumber:e.dialedDn,displayName:e.toName||void 0,resolvedUserId:e.toUserId||void 0}:void 0,isTelephonyConversation:!!e.isTelephonyConversation,displayName:e.displayName,transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,asyncSupported:!0,noCallLog:e.noCallLog||void 0,guestToken:e.guestToken||void 0,rtcSupportedFeatures:e.rtcSupportedFeatures||void 0,pickUpSession:e.pickUpSession||void 0}}function U(e){e=e||u,d.debug("[ClientApiHandler]: getApiVersion...");var n={type:t.VersionActionType.GET_VERSION};A(t.ContentType.VERSION,n,(function(n,i){if(n||i.code!==t.ReturnCode.OK)I=0;else{var o=i.version.getVersion.version;d.info("[ClientApiHandler]: Setting client API version to ",o),I=r.convertVersionToNumber(o)}e()}))}function L(e,n){n=n||u,d.debug("[ClientApiHandler]: getStuff..."),e&&e.length||(e=Object.keys(t.GetStuffType));var i={type:t.UserActionType.GET_STUFF,getStuff:{types:e}};A(t.ContentType.USER,i,(function(i,o){if(f(i,o,n)){var a=o.user.getStuff;e.includes(t.GetStuffType.USER)&&(a.user.userPresenceState=a.userPresenceState,a.user.accounts=a.accounts||[],I=r.convertVersionToNumber(a.user.apiVersion),s=a.user.clientId,c=a.user.userId),n(null,a)}}),null,["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.pendingSystemNotifications.[].systemNotificationEvent.broadcastText","response.user.getStuff.recentSearches","response.user.getStuff.recentSpaceSearches","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"])}function M(e,n){n=n||u,d.debug("[ClientApiHandler]: getRegions ...");var i={type:t.GuestActionType.GET_REGIONS,getRegions:{token:{token:e}}};A(t.ContentType.GUEST,i,(function(e,t){f(e,t,n)&&n(null,t.guest.getRegions)}),null,["response.guest.getRegions.convTopic"])}function w(e){var t=e&&e.content||"";t=r.sanitize(t),t=r.sanitizeSymbols(t);return t=n.convertPrivateDataToContent(e,["conceptboards"])+t}function G(e,n){return!!C.isSpacesPollingSupported()||(d.warn("[ClientApiHandler]: The "+e+" operation is not supported by the backend"),_(n,t.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}function k(e,n){return!!N(n)||(d.warn("[ClientApiHandler]: Missing CMR settings"),_(e,t.ReturnCode.INVALID_MESSAGE),!1)}function H(e,n){return!!C.isSpacesQuestionsSupported()||(d.warn("[ClientApiHandler]: The "+e+" operation is not supported by the backend"),_(n,t.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}function V(e,n){return!!C.isSpacesPagesSupported()||(d.warn("[ClientApiHandler]: The "+e+" operation is not supported by the backend"),_(n,t.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}function B(e){return"function"!=typeof e?u:function(t,n){f(t,n,e)&&e(null)}}Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return s},set:function(e){"simulatedDirect"===e&&(s=e)}},clientApiVersion:{enumerable:!0,get:function(){return I}},hasLastRequestBeenSanitized:{enumerable:!0,get:function(){return S}}}),this.getLastError=function(){return a},this.connect=function(e,t,n){n&&T.setTarget(n),T.connect(e,t)},this.getConnState=T.getState.bind(T),this.disconnect=T.disconnect.bind(T),this.reconnect=T.reconnect.bind(T),this.pingServer=T.pingServer.bind(T),this.setPingInterval=T.setPingInterval.bind(T),this.setTarget=T.setTarget.bind(T),this.setProxyTarget=T.setProxyTarget.bind(T),this.setClientInfo=T.setClientInfo.bind(T),this.setToken=T.setToken.bind(T),this.setRelativeUrl=T.setRelativeUrl.bind(T),this.addEventListener=T.addEventListener.bind(T),this.removeEventListener=T.removeEventListener.bind(T),this.onMessage=T.onMessage.bind(T),this.injectHasActiveCall=T.injectHasActiveCall.bind(T),this.setDevelopmentMode=function(e){p=!!e,T.ommitKeysFromLog=!e},this.simulateEvent=function(e){var n={clientId:s,msgType:t.WSMessageType.EVENT,event:e};T.onMessage(n)},this.on=function(e,t){var n;switch(e){case"Account.TELEPHONY_CONFIGURATION_UPDATED":n=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"ActivityStream.ACTIVITY_CREATED":n=E.map((function(e){return"event.activity.create.item."+e}));break;case"ActivityStream.ACTIVITY_DELETED":n=E.map((function(e){return"event.activity.delete.item."+e}));break;case"Conversation.ADD_ITEM":n=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":n=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":n=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":n=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"ConversationUserData.LABEL_EDITED":n=["event.conversationUserData.labelEdited.labelEdited.value"];break;case"ConversationUserData.LABELS_ADDED":n=["event.conversationUserData.labelsAdded.labelsAdded.[].value"];break;case"RTCSession.ACTIVE_SPEAKER":n="*";break;case"RTCSession.LIVE_TRANSCRIPTION":n=["event.rtcSession.liveTranscriptionEvent.text"];break;case"RTCSession.POLL_ENABLED":n=["event.rtcSession.pollEnabledEvent.poll.question","event.rtcSession.pollEnabledEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STARTED":n=["event.rtcSession.pollStartedEvent.poll.question","event.rtcSession.pollStartedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STOPPED":n=["event.rtcSession.pollStoppedEvent.poll.question","event.rtcSession.pollStoppedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_UPDATED":n=["event.rtcSession.pollUpdatedEvent.poll.question","event.rtcSession.pollUpdatedEvent.poll.choices.[].choiceText"];break;case"RTCSession.QUESTION_EVENT":n=["event.rtcSession.questionEvent.question.questionText"];break;case"Search.BASIC_SEARCH_RESULT":n=["event.search.basicSearchResult.searchResults"];break;case"Space.BASIC_SEARCH_RESULT":n=["event.space.basicSearchResult.spaces"];break;case"Space.ITEM_CREATED":n=["event.space.itemCreated.item.topic.subject","event.space.itemCreated.item.poll.options.[].text","event.space.itemCreated.item.poll.subject","event.space.itemCreated.item.question.subject","event.space.itemCreated.item.wikiPageContent.subject","event.space.itemCreated.item.content","event.space.itemCreated.item.attachments","event.space.itemCreated.item.contentTags","event.space.itemCreated.item.tags"];break;case"Space.ITEM_UPDATED":n=["event.space.itemUpdated.item.topic.subject","event.space.itemUpdated.item.poll.options.[].text","event.space.itemUpdated.item.poll.subject","event.space.itemCreated.item.question.subject","event.space.itemCreated.item.wikiPageContent.subject","event.space.itemUpdated.item.content","event.space.itemUpdated.item.attachments","event.space.itemUpdated.item.contentTags","event.space.itemUpdated.item.tags"];break;case"Space.SPACE_UPDATED":n=["event.space.spaceUpated.space.name","event.space.spaceUpated.space.description","event.space.spaceUpated.space.tags"];break;case"Space.SPACE_DELETED":n=["event.space.spaceDeleted.spaceId"];break;case"System.BROADCAST":n=["event.system.systemNotificationEvent.broadcastText"];break;case"Team.TEAM_CREATED":n=["event.team.teamCreatedEvent.team.teamName"];break;case"Team.TEAM_UPDATED":n=["event.team.teamUpdatedEvent.team.teamName"];break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":n=["event.thirdParty.oAuthData"];break;case"User.CMR_SETTINGS_UPDATED":n=["event.user.cmrSettingsUpdatedEvent.setting"];break;case"User.USER_PRESENCE_CHANGE":n="*";break;case"UserToUser.ATC":n=["event.userToUser.userToUser.data"]}T.on(e,t,n)},this.unsubscribeAll=T.unsubscribeAll,this.isProfileTagsSupported=function(){return I>2090202},this.isTouchScreenReportSupported=function(){return I>2090202},this.isSharepointSupported=function(){return I>2090202},this.isHardPhoneOnlySupported=function(){return I>2090202},this.isPartnerAdministrationSupported=function(){return I>2090202},this.isSpacesPollingSupported=function(){return I>2090202},this.isSpacesQuestionsSupported=function(){return I>2090208},this.isSpacesPagesSupported=function(){return I>2090202},this.isExpertLMSupported=function(){return I>2090207},this.isLogitechSupported=function(){return I>2090207},this.isVdiDownloadPackagesSupported=function(){return I>2090210},this.getApiVersion=U,this.logout=function(e){e=e||u,d.debug("[ClientApiHandler]: logout...");var n={type:t.UserActionType.LOGOUT,logoff:{invalidate:!0}};A(t.ContentType.USER,n,B(e))},this.getUser=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getUser...");var i={type:t.UserActionType.GET_USER_BY_ID,getById:{userId:e}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.getById.user)}))},this.updateUser=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateUser...");var i={type:t.UserActionType.UPDATE,update:e};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.updateResult.user)}))},this.getLoggedOnUser=function(e){e=e||u,d.debug("[ClientApiHandler]: getLoggedOnUser...");var n={type:t.UserActionType.GET_LOGGED_ON};A(t.ContentType.USER,n,(function(t,n){var i,o;f(t,n,e)&&(i=(o=n.user.getLoggedOn).user,o.userPresenceState=o.userPresenceState||i.userPresenceState,i.userPresenceState=o.userPresenceState,i.accounts=o.accounts||[],I=r.convertVersionToNumber(i.apiVersion),s=i.clientId,c=i.userId,e(null,o))}),null,["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"])},this.getStuff=function(e,t){U(L.bind(this,e,t))},this.getSupportData=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getSupportData..."),!e)return d.warn("[ClientApiHandler]: userId was not provided to getSupportData"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.UserActionType.GET_SUPPORT_DATA,getSupportData:{userId:e}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.getSupportData)}))},this.setPresence=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setPresence...");var i={type:t.UserActionType.SET_PRESENCE,presence:{state:e.state,inTransit:e.inTransit,longitude:e.longitude,latitude:e.latitude,locationText:e.locationText,isAccurate:e.isAccurate,timeZoneOffset:e.timeZoneOffset,mobile:e.mobile,dndUntil:e.dndUntil,statusMessage:e.statusMessage||""}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.setPresence.state)}),["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"])},this.getPresence=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getPresence...");var r={type:t.UserActionType.GET_PRESENCE,getPresence:{userIds:e,full:!!n}};A(t.ContentType.USER,r,(function(e,t){f(e,t,i)&&i(null,t.user.getPresence.states)}),null,["response.user.getPresence.states"])},this.subscribePresence=function(e,n){n=n||u,d.debug("[ClientApiHandler]: subscribePresence...");var i={type:t.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e}};A(t.ContentType.USER,i,(function(e,t){if(f(e,t,n)){var i=t.user&&t.user.subscribePresence&&t.user.subscribePresence.states;n(null,i)}}),null,["response.user.subscribePresence.states"])},this.unsubscribePresence=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unsubscribePresence...");var i={type:t.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e}};A(t.ContentType.USER,i,B(n))},this.subscribeTenantPresence=function(e,n){n=n||u,d.debug("[ClientApiHandler]: subscribeTenantPresence...");var i={type:t.UserActionType.SUBSCRIBE_TENANT_PRESENCE,subscribeTenantPresence:{tenantId:e}};A(t.ContentType.USER,i,B(n))},this.unsubscribeTenantPresence=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unsubscribeTenantPresence...");var i={type:t.UserActionType.UNSUBSCRIBE_TENANT_PRESENCE,unsubscribeTenantPresence:{tenantId:e}};A(t.ContentType.USER,i,B(n))},this.updateStatusSubscription=function(e,n,i){var r;i=i||u,d.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",n),r=n?{type:t.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e,notificationSubscriptionType:t.NotificationSubscriptionType.ONLINE_STATUS}}:{type:t.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e,notificationSubscriptionType:t.NotificationSubscriptionType.ONLINE_STATUS}},A(t.ContentType.USER,r,B(i))},this.changePassword=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: changePassword...");var r={type:t.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:e,newPassword:n}};A(t.ContentType.USER,r,(function(e,t){f(e,t,i)&&i(null,t.user.changePasswordResult.changeResult)}),["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"])},this.subscribeDevices=function(e){e=e||u,d.debug("[ClientApiHandler]: subscribeDevices...");var n={type:t.UserActionType.SUBSCRIBE_DEVICES};A(t.ContentType.USER,n,(function(t,n){if(f(t,n,e)){var i=n.user&&n.user.subscribeDevices&&n.user.subscribeDevices.devices;e(null,i)}}))},this.unsubscribeDevices=function(e){e=e||u,d.debug("[ClientApiHandler]: unsubscribeDevices...");var n={type:t.UserActionType.UNSUBSCRIBE_DEVICES};A(t.ContentType.USER,n,B(e))},this.requestEmailChange=function(e,n,i){d.debug("[ClientApiHandler]: requestEmailChange");var r={type:t.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:e,emailAddress:n}};A(t.ContentType.USER,r,B(i))},this.getUsersByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getUsersByIds...");var i={type:t.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!0}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n,null)&&n(null,t.user.usersByIds.user)}),null,["response.user.usersByIds.user"])},this.getPartialUsersByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getPartialUsersByIds...");var i={type:t.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!1}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.usersByIds.user)}))},this.renewToken=function(e){e=e||function(e){e?d.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",e):d.debug("[ClientApiHandler]: Successfully renewed token.")},d.debug("[ClientApiHandler]: renewToken");var n={type:t.UserActionType.RENEW_TOKEN};A(t.ContentType.USER,n,B(e))},this.getUserSettings=function(e,n){n=n||u,e=e||t.UserSettingArea.ALL,d.debug("[ClientApiHandler]: getUserSettings...");var i={type:t.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:e}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.getUserSettings.settings)}))},this.setUserSettings=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: setUserSettings..."),!(e=g(e)))return d.warn("[ClientApiHandler]: No settings were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:e}};A(t.ContentType.USER,i,B(n))},this.getUserByEmail=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getUserByEmail..."),!e||"string"!=typeof e)return d.warn("[ClientApiHandler]: No emailAddress was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:e,excludeRoles:[t.UserRole.SUPPORT,t.UserRole.SYSTEM_ADMIN]}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.getUserByMail.user)}))},this.getUserByEmail2=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getUserByEmail2..."),!e||"object"!=typeof e)return d.warn("[ClientApiHandler]: No filter was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:e.emailAddress,excludeRoles:e.excludeRoles||[t.UserRole.SUPPORT,t.UserRole.SYSTEM_ADMIN],complete:v(e.complete),secondaryLookup:v(e.secondaryLookup)}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,t.user.getUserByMail.user)}))},this.getUsersByEmails=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getUsersByEmails...");var i={type:t.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:e.emailAddresses,xmppLookup:v(e.xmppLookup),complete:v(e.complete),secondaryLookup:v(e.secondaryLookup),excludeRoles:[t.UserRole.SUPPORT,t.UserRole.SYSTEM_ADMIN]}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n,!0)&&n(null,t.user.getUsersByMails.users)}))},this.changeUserEmail=function(e,n,i,r){i=i||u;var o={type:t.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:e,emailAddress:n}};A(t.ContentType.USER,o,(function(e,t){f(e,t,i)&&i(null,t.user.emailUpdate)}),null,null,r)},this.goToSleep=function(e,n){n=n||u,d.debug("[ClientApiHandler]: goToSleep...");var i={type:t.UserActionType.GO_TO_SLEEP,userId:e};A(t.ContentType.USER,i,B(n))},this.wakeUp=function(e){e=e||u,d.debug("[ClientApiHandler]: wakeUp...");var n={type:t.UserActionType.WAKE_UP};A(t.ContentType.USER,n,B(e))},this.getDevices=function(e){e=e||u,d.debug("[ClientApiHandler]: getDevices...");var n={type:t.UserActionType.GET_DEVICES};A(t.ContentType.USER,n,(function(t,n){f(t,n,e)&&e(null,n.user.getDevices.devices)}))},this.getTelephonyData=function(e){e=e||u,d.debug("[ClientApiHandler]: getTelephonyData...");var n={type:t.UserActionType.GET_TELEPHONY_DATA};A(t.ContentType.USER,n,(function(t,n){f(t,n,e)&&e(null,n.user.getTelephonyData.data)}))},this.getConnectedApps=function(e){e=e||u,d.debug("[ClientApiHandler]: getConnectedApps...");var n={type:t.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};A(t.ContentType.USER,n,(function(t,n){f(t,n,e,!0)&&e(null,n.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)}))},this.revokeAccessToken=function(e,n){n=n||u,d.debug("[ClientApiHandler]: revokeAccessToken...");var i={type:t.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:e}};A(t.ContentType.USER,i,B(n))},this.revokeAllManagedDevices=function(e){e=e||u,d.debug("[ClientApiHandler]: revokeAllManagedDevices...");var n={type:t.UserActionType.REVOKE_MANAGED_DEVICES};A(t.ContentType.USER,n,B(e))},this.getSecurityTokenInfo=function(e){e=e||u,d.debug("[ClientApiHandler]: getSecurityTokenInfo...");var n={type:t.UserActionType.GET_SECURITY_TOKEN_INFO};A(t.ContentType.USER,n,(function(t,n){f(t,n,e,!0)&&e(null,n.user.getSecurityTokenInfoResult.securityTokenInfo)}))},this.revokeSecurityToken=function(e,n){n=n||u,d.debug("[ClientApiHandler]: revokeSecurityToken...");var i={type:t.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:e}};A(t.ContentType.USER,i,B(n))},this.getUserTenantSettings=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getUserTenantSettings...");var i={type:t.UserActionType.GET_TENANT_SETTINGS};A(t.ContentType.USER,i,(function(t,n){f(t,n,e,!0)&&e(null,n.user.getTenantSettings.tenantSettings)}),null,null,n)},this.resetOpenScapeDevicePins=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: resetOpenScapeDevicePins...");var r={type:t.UserActionType.RESET_OPENSCAPE_DEVICE_PINS,resetOpenScapeDevicePins:{circuitUserId:e,directoryNumber:n}};A(t.ContentType.USER,r,(function(e,t){f(e,t,i)&&i(null,t.user.resetOpenScapeDevicePins.openScapeDevicePins)}),null,["response.user.resetOpenScapeDevicePins.openScapeDevicePins"])},this.setClientCapabilities=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setClientCapabilities...");var i={type:t.UserActionType.SET_CLIENT_CAPABILITIES,setClientCapabilities:{capabilities:e}};A(t.ContentType.USER,i,B(n))},this.getTenantIdToNameMap=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getTenantIdToNameMap...");var r={type:t.UserActionType.GET_TENANT_ID_TO_NAME_MAP,getTenantIdToNameMap:{secIds:e}};A(t.ContentType.USER,r,(function(e,t){f(e,t,n,!0)&&n(null,t.user.getTenantIdToNameMapResult.tenantIdToNameMap||[])}),null,null,i)},this.getRecentUsedCMRs=function(e){e=e||u,d.debug("[ClientApiHandler]: getRecentUsedCMRs...");var n={type:t.UserActionType.GET_RECENT_USED_CMRS};A(t.ContentType.USER,n,(function(t,n){f(t,n,e,!0)&&e(null,n.user.getRecentUsedCMRsResult.cmrUser||[])}))},this.addRecentUsedCMR=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addRecentUsedCMR...");var i={type:t.UserActionType.ADD_RECENT_USED_CMR,addRecentUsedCMR:{cmrUserId:e}};A(t.ContentType.USER,i,B(n))},this.isAllowedToAddCmr=function(e,n){n=n||u,d.debug("[ClientApiHandler]: isAllowedToAddCmr...");var i={type:t.UserActionType.IS_ALLOWED_TO_ADD_CMR,isAllowedToAddCMR:{inviterUserId:e}};A(t.ContentType.USER,i,(function(e,t){f(e,t,n)&&n(null,!!t.user.isAllowedToAddCmrResult.isAllowed)}))},this.startBasicSearch=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: startBasicSearch...");var r={type:t.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e,priorizedConvs:n||void 0,newSearch:!0}};A(t.ContentType.SEARCH,r,(function(e,t){f(e,t,i)&&i(null,t.search.startSearchResult.searchId)}))},this.startDetailSearch=function(e,n,i,r,o){o=o||u,d.debug("[ClientApiHandler]: startDetailSearch...");var a={type:t.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:e,convId:n,searchId:i||void 0,resultSetLimit:r||0}};A(t.ContentType.SEARCH,a,(function(e,t){f(e,t,o)&&o(null,t.search.startSearchResult.searchId)}))},this.cancelSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: cancelSearch...");var i={type:t.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};A(t.ContentType.SEARCH,i,B(n))},this.addRecentSearch=function(e,n){n=n||u;var i={type:t.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};A(t.ContentType.SEARCH,i,B(n))},this.startUserSearch=function(e,n){n=n||u;var i={type:t.SearchActionType.START_USER_SEARCH,startUserSearch:{query:e.query,reversePhoneNumberLookup:!!e.reversePhoneNumberLookup}};A(t.ContentType.SEARCH,i,(function(e,t){f(e,t,n)&&n(null,t.search.startSearchResult.searchId)}))},this.startAdvancedUserSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: startAdvancedUserSearch...");var i={type:t.SearchActionType.START_ADVANCED_USER_SEARCH,startAdvancedUserSearch:{searchContext:e.searchContext,query:e.query,searchExactAssignedPhoneNumber:e.searchExactAssignedPhoneNumber,resultSetLimit:e.resultSetLimit}};A(t.ContentType.SEARCH,i,(function(e,t){f(e,t,n)&&n(null,t.search.startSearchResult.searchId)}))},this.searchConversationParticipants=function(e,n,i){i=i||u;var r={type:t.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:e,convId:n}};A(t.ContentType.SEARCH,r,(function(e,t){f(e,t,i,!0)&&i(null,t.search.searchConversationParticipantsResult.participants||[])}))},this.createConversation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createConversation...");var i=e.type;i||(i=e.participants.length>2?t.ConversationType.GROUP:t.ConversationType.DIRECT);var r={type:t.ConversationActionType.CREATE,create:{type:i,topic:e.topic,description:e.description||void 0,participants:e.participants,locale:e.locale,systemTags:e.systemTags||void 0,eventSize:e.eventSize||void 0}};A(t.ContentType.CONVERSATION,r,(function(e,i){f(e,i,n)&&n(null,i.conversation.create.conversation,i.code===t.ReturnCode.ENTITY_ALREADY_EXISTS)}),["request.conversation.create.topic","request.conversation.create.description"],["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"])},this.updateConversation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateConversation...");var i={type:t.ConversationActionType.UPDATE,update:{convId:e.conversationId,topic:e.topic,description:e.description}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.update.conversation)}),["request.conversation.update.topic","request.conversation.update.description"],["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"])},this.addTextItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addTextItem...");var i=w(e),r={type:t.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:e.convId,parentId:e.parentId,contentType:e.contentType,subject:e.subject||void 0,content:i,attachmentMetaData:g(D(e.attachmentMetaData)),externalAttachmentMetaData:g(y(e.externalAttachmentMetaData)),preview:e.preview||void 0,formMetaData:e.form,mentionedUsers:g(e.mentionedUsers),conceptboards:g(e.conceptboards),sharedItems:g(e.sharedItems)}};r.addTextItem.preview&&r.addTextItem.preview.description&&(r.addTextItem.preview.description=r.addTextItem.preview.description.substr(0,255));A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,n)&&n(null,t.conversation.addTextItem.item)}),["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],["response.conversation.addTextItem.item.text"])},this.updateTextItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateTextItem...");var i=w(e),r={itemId:e.itemId,convId:e.convId,parentId:e.parentId,contentType:t.TextItemContentType.RICH,subject:e.subject,content:i,attachmentMetaData:g(D(e.attachmentMetaData)),preview:e.preview||{},formMetaData:e.form,clustered:e.clustered,externalAttachmentMetaData:g(y(e.externalAttachmentMetaData)),mentionedUsers:e.mentionedUsers,conceptboards:e.conceptboards,sharedItems:e.sharedItems};r.preview.description&&(r.preview.description=r.preview.description.substr(0,255)),r.externalAttachmentMetaData||(r.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),r.attachmentMetaData||(r.attachmentMetaData=[{}]);var o={type:t.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:r};A(t.ContentType.CONVERSATION,o,(function(e,t){f(e,t,n)&&n(null,t.conversation.updateTextItem.item)}),["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],["response.conversation.updateTextItem.item.text"])},this.deleteTextItem=function(e,n){if(n=n||u,!e||!e.itemId)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);d.debug("[ClientApiHandler]: deleteTextItem...");var i={type:t.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:e.itemId}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.deleteTextItem.item)}))},this.deleteRecording=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteRecording...");var i={type:t.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.deleteRecording.item)}))},this.updateRtcItemAttachments=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: updateRtcItemAttachments...");var r={type:t.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:e,attachments:D(n)}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.updateRtcItemAttachmentsResult.item)}))},this.getOpenConversations=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getOpenConversations...");var r={type:t.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getOpenConversations;i(null,n.conversations,n.lastItemIndex)}}),null,["response.conversation.getOpenConversations.conversations"])},this.getAllOpenConversations=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: getAllOpenConversations...");var o={type:t.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:n,ownIncluded:!0,sorting:i}};A(t.ContentType.CONVERSATION,o,(function(e,t){if(f(e,t,r,!0)){var n=t.conversation.getOpenConversations;r(null,n.conversations,n.lastItemIndex)}}),null,["response.conversation.getOpenConversations.conversations"])},this.joinOpenConversation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: JoinOpenConversation...");var i={type:t.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.joinOpenConversation.conv)}))},this.getConversationFeed=function(e,n,i,r,o,a,s){s=s||u,d.debug("[ClientApiHandler]: getConversationFeed...");var c={type:t.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:e,timestamp:n||void 0,minTotalItems:i||void 0,maxTotalUnread:r||void 0,commentsPerThread:o||void 0,maxUnreadPerThread:a||void 0}};A(t.ContentType.CONVERSATION,c,(function(e,t){if(f(e,t,s,!0)){var n=t.conversation.getConversationFeedResult;s(null,n.conversationThreads,n.hasOlderThreads)}}),null,["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"])},this.getConversationTopics=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: getConversationTopics...");var o={type:t.ConversationActionType.GET_CONVERSATION_TOPICS,getConversationTopics:{convId:e,timestamp:n||void 0,maxNumberOfTopics:i||void 0}};A(t.ContentType.CONVERSATION,o,(function(e,t){if(f(e,t,r,!0)){var n=t.conversation.getConversationTopicsResult;r(null,n.conversationTopics,n.hasOlderTopics)}}),null,["response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.system","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.system"])},this.pinTopic=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: pinTopic..."),!e||!e.convId||!e.topicId)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.ConversationActionType.PIN_TOPIC,pinTopic:{convId:e.convId,topicId:e.topicId}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.pinTopicResult.conversation)}),null,["response.conversation.pinTopicResult.conversation"])},this.unpinTopic=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: unpinTopic..."),!e||!e.convId||!e.topicId)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.ConversationActionType.UNPIN_TOPIC,unpinTopic:{convId:e.convId,topicId:e.topicId}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.unpinTopicResult.conversation)}),null,["response.conversation.unpinTopicResult.conversation"])},this.getThreadComments=function(e,n,i,r,o,a,s){s=s||u,d.debug("[ClientApiHandler]: getThreadComments...");var c={type:t.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:e,threadId:n,timestamp:i||void 0,timestampFilter:r||t.TimestampFilter.CREATION,direction:o||void 0,totalComments:a||void 0}};A(t.ContentType.CONVERSATION,c,(function(e,t){if(f(e,t,s,!0)){var n=t.conversation.getThreadCommentsResult;s(null,n.comments,n.hasMoreComments)}}),null,["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"])},this.getThreadsByItemIds=function(e,n){if(d.debug("[ClientApiHandler]: getThreadsByItemIds..."),n=n||u,!e)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);if(!e.convId)return d.warn("[ClientApiHandler]: No conversation id was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);if(!e.threadParams)return d.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:e.convId,threadParams:e.threadParams,timestampFilter:e.timestampFilter||void 0,orderBy:e.orderBy||void 0}};A(t.ContentType.CONVERSATION,i,(function(e,t){if(f(e,t,n,!0)){var i=t.conversation.getThreadsByItemIdsResult;n(null,i&&i.conversationThreadContext)}}),null,["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"])},this.getThreadsByIds=function(e,n){if(d.debug("[ClientApiHandler]: getThreadsByIds..."),n=n||u,!e)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);if(!e.convId)return d.warn("[ClientApiHandler]: No conversation id was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);if(!(e.threadIds instanceof Array&&e.threadIds.length>0))return d.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:e.convId,threadIds:e.threadIds,orderBy:e.orderBy||t.SortingType.TIMESTAMP_ASC,commentsPerThread:e.commentsPerThread||void 0}};A(t.ContentType.CONVERSATION,i,(function(e,t){if(f(e,t,n,!0)){var i=t.conversation.getThreadsByIdsResult;n(null,i&&i.conversationThreads)}}),null,["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"])},this.getConversations=function(e,n,i,r,o,a){a=a||u,d.debug("[ClientApiHandler]: getConversations...");var s=i?t.SearchDirection.BEFORE:t.SearchDirection.AFTER,c={type:t.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:e,modificationDate:n||void 0,direction:s,number:r||void 0,filter:o||t.ConversationFilter.ALL,sortByLastItem:!!i}};A(t.ContentType.CONVERSATION,c,(function(e,t){f(e,t,a,!0)&&a(null,t.conversation.getConversations.conversations)}),null,["response.conversation.getConversations.conversations"])},this.getSupportConversation=function(e){e=e||u,d.debug("[ClientApiHandler]: getSupportConversation...");var n={type:t.ConversationActionType.GET_SUPPORT_CONVERSATION};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e)&&e(null,n.conversation.getSupportConversation.conversation)}),null,["response.conversation.getSupportConversation.conversation.topLevelItem"])},this.getSupportConversationId=function(e){e=e||u,d.debug("[ClientApiHandler]: getSupportConversationId...");var n={type:t.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e)&&e(null,n.conversation.getSupportConversationId.conversationId)}))},this.getTelephonyConversationId=function(e){e=e||u,d.debug("[ClientApiHandler]: getTelephonyConversationId...");var n={type:t.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e)&&e(null,n.conversation.getTelephonyConversationId.conversationId)}))},this.getMarkedConversationsList=function(e){e=e||u,d.debug("[ClientApiHandler]: getMarkedConversationsList...");var n={type:t.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e)&&e(null,n.conversation.getMarkedConversationsList)}))},this.getFavoriteConversationIds=function(e){e=e||u,d.debug("[ClientApiHandler]: getFavoriteConversationIds...");var n={type:t.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.conversation.getFavoriteConversationIdResult.favoriteConversationIds)}))},this.markConversation=function(e,n){n=n||u;var i={type:t.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:e.convId,filter:e.markType}};A(t.ContentType.CONVERSATION,i,B(n))},this.unmarkConversation=function(e,n){n=n||u;var i={type:t.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:e.convId,filter:e.markType}};A(t.ContentType.CONVERSATION,i,B(n))},this.getConversationUserData=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getConversationUserData..."),e instanceof Array||(e=[e]);var r={type:t.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:e,userDataToInclude:n||void 0}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.getConversationUserData.userData)}))},this.getConversationItems=function(e,n,i,r,o,a){a=a||u,d.debug("[ClientApiHandler]: getConversationItems...");var s={type:t.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:e,modificationDate:n||void 0,creationDate:i||void 0,direction:r||void 0,number:o||void 0}};A(t.ContentType.CONVERSATION,s,(function(e,t){f(e,t,a,!0)&&a(null,t.conversation.getItemsByConversation.items)}),null,["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"])},this.getConversationAttachments=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getConversationAttachments...");var r={type:t.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:e,startPage:n.page||void 0,pageSize:n.size||void 0,orderType:n.type||void 0,orderDirection:n.direction||void 0}};A(t.ContentType.CONVERSATION,r,(function(e,t){if(f(e,t,i)){var n=t.conversation.getAttachments.attachments||[],r=t.conversation.getAttachments.nextPage.hasMoreAttachments?t.conversation.getAttachments.nextPage.lastIndex:null;i(null,n,r)}}))},this.getItemsByConversationItemId=function(e,n,i,r,o,a){a=a||u,d.debug("[ClientApiHandler]: getItemsByConversationItemId...");var s={type:t.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:e,itemId:n,direction:i||void 0,number:r||void 0,orderType:o||void 0}};A(t.ContentType.CONVERSATION,s,(function(e,t){f(e,t,a,!0)&&a(null,t.conversation.getItemsByConversationItemId.items)}),null,["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"])},this.getConversationById=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationById...");var i={type:t.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){if(f(e,t,n)){var i=t.conversation.getConversationById.conversation;i&&i.participants&&d.info("[ClientApiHandler]: Retrieved conversation has "+i.participants.length+" participant(s)"),n(null,i)}}),null,["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"])},this.getConversationsByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationsByIds...");var i={type:t.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getConversationsByIdsResult.conversations)}),null,["response.conversation.getConversationsByIdsResult.conversations"])},this.getItemById=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getItemById...");var i={type:t.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.getItemById.item)}),null,["response.conversation.getItemById.item.attachments","response.conversation.getItemById.item.externalAttachments","response.conversation.getItemById.item.rtc","response.conversation.getItemById.item.text","response.conversation.getItemById.item.system"])},this.getItemsByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getItemsByIds...");var i={type:t.ConversationActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getItemsByIds.items)}),null,["response.conversation.getItemsByIds.items.[].attachments","response.conversation.getItemsByIds.items.[].externalAttachments","response.conversation.getItemsByIds.items.[].rtc","response.conversation.getItemsByIds.items.[].text","response.conversation.getItemsByIds.items.[].system"])},this.setReadPointer=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setReadPointer...");var r={type:t.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:e,lastReadTimestamp:n}};A(t.ContentType.CONVERSATION,r,B(i))},this.getConversationByUser=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationByUser...");var i={type:t.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationByUser.conversation)}),null,["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"])},this.getConversationsByFilter=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationsByFilter...");var i={type:t.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:e.filterConnector,timestamp:e.timestamp||void 0,number:e.number,numberOfParticipants:e.numberOfParticipants,retrieveAction:e.retrieveAction||void 0}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationsByFilterResult||{})}),null,["response.conversation.getConversationsByFilterResult.conversations"])},this.subscribe=function(e,n){n=n||u,d.debug("[ClientApiHandler]: subscribe...");var i={type:t.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:e}};A(t.ContentType.CONVERSATION,i,B(n))},this.unsubscribe=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unsubscribe...");var i={type:t.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:e}};A(t.ContentType.CONVERSATION,i,B(n))},this.typing=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: typing...");var o={type:t.ConversationActionType.TYPING,typing:{conversationId:e,isTyping:n,parentItemId:i}};A(t.ContentType.CONVERSATION,o,B(r))},this.addParticipant=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addParticipant...");var i={type:t.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:e.convId,userId:e.userId,locale:e.locale}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.addParticipant)}))},this.removeParticipant=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: removeParticipant..."),!n||n instanceof Array||(n=[n]);var r={type:t.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.removeParticipant.conversation)}))},this.hardRemoveParticipant=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: hardRemoveParticipant..."),!n||n instanceof Array||(n=[n]);var r={type:t.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:n,hardRemove:!0}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.removeParticipant.conversation)}))},this.getConversationParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getConversationParticipants..."),n=n||{};var r={type:t.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:e,searchCriterias:n.searchCriterias||void 0,searchPointer:n.searchPointer||void 0,pageSize:n.pageSize||25,includePresence:!!n.includePresence}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.getConversationParticipantsResult)}))},this.getConversationDetails=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationDetails...");var i={type:t.ConversationActionType.GET_CONVERSATION_DETAILS,getConversationDetails:{conversationId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.conversationDetails)}),null,["response.conversation.conversationDetails.joinDetails.link","response.conversation.conversationDetails.joinDetails.tenantPIN","response.conversation.conversationDetails.joinDetails.sessionPIN"])},this.getConversationIdsRemovedFrom=function(e,n){d.debug("[ClientApiHandler]: getConversationIdsRemovedFrom...");var i={type:t.ConversationActionType.GET_CONVERSATION_IDS_REMOVED_FROM,getConversationIdsRemovedFrom:{timestamp:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.conversationIdsRemovedFrom.conversationIds)}))},this.getJoinDetails=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getJoinDetails...");var r={type:t.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:e,recreate:!!n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.getJoinDetails)}),null,["response.conversation.getJoinDetails.link","response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"])},this.setFlagItem=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: setFlagItem..."),!e)return d.warn("[ClientApiHandler]: No request parameters were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:e.convId,conversationItemId:e.itemId,conversationItemCreationTime:e.creationTime,conversationParentId:e.parentId}};A(t.ContentType.CONVERSATION,i,B(n))},this.clearFlagItem=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: clearFlagItem...");var r={type:t.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:e,conversationItemId:n}};A(t.ContentType.CONVERSATION,r,B(i))},this.getFlaggedItems=function(e){e=e||u,d.debug("[ClientApiHandler]: getFlaggedItems...");var n={type:t.ConversationActionType.GET_FLAGGED_ITEMS};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.conversation.getFlaggedItem.flaggedItems)}))},this.likeTextItem=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: likeTextItem...");var r={type:t.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:e,userId:n}};A(t.ContentType.CONVERSATION,r,B(i))},this.unlikeTextItem=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: unlikeTextItem...");var r={type:t.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:e,userId:n}};A(t.ContentType.CONVERSATION,r,B(i))},this.setConvAvatar=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setConvAvatar...");var r={type:t.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:n.s,imageL:n.b}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.setConversationAvatar.conversation)}))},this.deleteConvAvatar=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteConvAvatar...");var i={type:t.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:"",imageL:""}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)}))},this.moderateConversation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: moderateConversation...");var i={type:t.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.moderateResult)}))},this.unmoderateConversation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unmoderateConversation...");var i={type:t.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.moderateResult)}))},this.setConversationRetentionPolicy=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setConversationRetentionPolicy...");var r={type:t.ConversationActionType.SET_CONVERSATION_RETENTION_POLICY,setConversationRetentionPolicy:{convId:e,disabled:!!n}};A(t.ContentType.CONVERSATION,r,B(i))},this.updateGuestAccess=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: updateGuestAccess...");var r={type:t.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:e,guestAccessDisabled:!!n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.updateGuestAccessResult)}))},this.getConversationSummary=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getConversationSummary...");var r={type:t.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:e}};n&&(r.getConversationSummary.inviteToken={token:n}),A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.getConversationSummary.conversationSummary)}))},this.grantModeratorRights=function(e,n,i){i=i||u,n instanceof Array||(n=[n]),d.debug("[ClientApiHandler]: grantModeratorRights...");var r={type:t.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:e,userId:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.grantModeratorRightsResult)}))},this.dropModeratorRights=function(e,n,i){i=i||u,n instanceof Array||(n=[n]),d.debug("[ClientApiHandler]: dropModeratorRights...");var r={type:t.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:e,userId:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.dropModeratorRightsResult)}))},this.takeModerationRight=function(e,n){n=n||u,d.debug("[ClientApiHandler]: takeModerationRight...");var i={type:t.ConversationActionType.TAKE_MODERATION_RIGHT,takeModerationRight:{convId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.takeModerationRightResult.moderationTakenResult)}))},this.addJournalEntry=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addJournalEntry...");var i={type:t.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:e.convId,starter:e.starter,source:e.source,destination:e.destination,startTime:e.startTime,duration:e.duration,type:e.type,participants:e.participants,missedReason:e.missedReason}};A(t.ContentType.CONVERSATION,i,B(n))},this.setFavoritePosition=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setFavoritePosition...");var r={type:t.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:e,position:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t)}))},this.addLabels=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addLabels...");var i={type:t.ConversationActionType.ADD_LABELS,addLabels:{labels:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.addLabelsResult)}),["request.conversation.addLabels.labels"],["response.conversation.addLabelsResult.labels.[].value"])},this.assignLabels=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: assignLabels...");var r={type:t.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:e,labelIds:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.assignLabelsResult.labelIds)}))},this.unassignLabels=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: unassignLabels...");var r={type:t.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:e,labelIds:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i,!0)&&i(null,t.conversation.unassignLabelsResult.labelIds)}))},this.getAllLabels=function(e){e=e||u,d.debug("[ClientApiHandler]: getAllLabels...");var n={type:t.ConversationActionType.GET_LABELS};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.conversation.getLabelsResult.labels)}),null,["response.conversation.getLabelsResult.labels"])},this.removeLabels=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeLabels...");var i={type:t.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.removeLabelsResult.labelIds)}))},this.editLabel=function(e,n){n=n||u,d.debug("[ClientApiHandler]: editLabel...");var i={type:t.ConversationActionType.EDIT_LABEL,editLabel:{label:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.editLabelResult.label)}),["request.conversation.editLabel.label.value"],["response.conversation.editLabelResult.label.value"])},this.addFilter=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: addFilter...");var r={type:t.ConversationActionType.ADD_FILTER,addFilter:{filterName:e,root:n}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.addFilterResult)}))},this.removeFilter=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeFilters...");var i={type:t.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.removeFiltersResult.filterIds)}))},this.getAllFilters=function(e){e=e||u,d.debug("[ClientApiHandler]: getAllFilters...");var n={type:t.ConversationActionType.GET_FILTERS,getFilters:{}};A(t.ContentType.CONVERSATION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.conversation.getFiltersResult.filters)}))},this.editFilter=function(e,n){n=n||u,d.debug("[ClientApiHandler]: editFilter...");var i={type:t.ConversationActionType.EDIT_FILTER,editFilter:{filter:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.editFilterResult)}))},this.getUserDataSince=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getUserDataSince...");var i={type:t.ConversationActionType.GET_USER_DATA_SINCE,getUserDataSince:{sinceTime:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){if(f(e,t,n,!0)){var i=t.conversation.getUserDataSinceResult&&t.conversation.getUserDataSinceResult.changedUserData||[];n(null,i)}}))},this.getConferenceInvitationText=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getConferenceInvitationText...");var r={type:t.ConversationActionType.GET_CONFERENCE_INVITATION_TEXT,getConferenceInvitationText:{conversationId:n,language:e}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,i)&&i(null,t.conversation.getConferenceInvitationResult.invitationMessage)}),null,["response.conversation.getConferenceInvitationResult.invitationMessage"])},this.getConferenceInvitationExample=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getConferenceInvitationExample...");var r={type:t.ConversationActionType.GET_CONFERENCE_INVITATION_EXAMPLE,getConferenceInvitationExample:{language:e}};A(t.ContentType.CONVERSATION,r,(function(e,t){f(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)}),null,null,i)},this.deleteCallLog=function(e,n){var i={type:t.ConversationActionType.DELETE_JOURNAL_ENTRY,deleteJournalEntry:{journalEntryId:e}};A(t.ContentType.CONVERSATION,i,B(n))},this.getJournalEntries=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getJournalEntries...");var i={type:t.ConversationActionType.GET_JOURNAL_ENTRIES,getJournalEntries:{telephonyConversationId:e.convId,timestamp:e.timestamp||void 0,direction:e.direction||void 0,numberOfEntries:e.numberOfEntries||void 0,journalFilter:e.journalFilter||void 0}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getJournalEntriesResult.entries)}),null,["response.conversation.getJournalEntriesResult.entries.[].rtc.participants","response.conversation.getJournalEntriesResult.entries.[].rtc.rtcParticipants","response.conversation.getJournalEntriesResult.entries.[].rtc.ended","response.conversation.getJournalEntriesResult.entries.[].rtc.missed.pickingUpParticipant"])},this.setVoicemailAsHeard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setVoicemailAsHeard...");var i={type:t.ConversationActionType.SET_VOICEMAIL_HEARD,setVoicemailHeard:{journalEntryId:e}};A(t.ContentType.CONVERSATION,i,B(n))},this.getUnheardVoicemailsCount=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getUnheardVoicemailCount...");var i={type:t.ConversationActionType.GET_UNHEARD_VOICEMAILS_COUNT,getUnheardVoicemailsCount:{conversationId:e}};A(t.ContentType.CONVERSATION,i,(function(e,t){f(e,t,n)&&n(null,t.conversation.getUnheardVoicemailsCountResult.unheardVoicemailsCount||0)}))},this.setRecordingDeletionDelay=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setRecordingDeletionDelay...");var r={type:t.ConversationActionType.SET_RECORDING_DELETION_DELAY,setRecordingDeletionDelay:{itemId:e,extendedDelay:!!n}};A(t.ContentType.CONVERSATION,r,B(i))},this.deleteAllCallLogs=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: deleteAllCallLogs...");var r={type:t.ConversationActionType.DELETE_ALL_JOURNAL_ENTRIES,deleteAllJournalEntries:{telephonyConversationId:e,journalFilter:n}};A(t.ContentType.CONVERSATION,r,B(i))},this.joinRtcCall=function(e,n){n=n||u,d.debug("[ClientApiHandler]: joinRtcCall...");var i={type:t.RTCCallActionType.JOIN,join:b(e)};A(t.ContentType.RTC_CALL,i,B(n))},this.answerRtcCall=function(e,n){n=n||u,d.debug("[ClientApiHandler]: answerRtcCall...");var i={type:t.RTCCallActionType.ANSWER,answer:b(e)};A(t.ContentType.RTC_CALL,i,B(n))},this.sendIceCandidates=function(e,n){n=n||u,d.debug("[ClientApiHandler]: sendIceCandidates...");var i={type:t.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:e.rtcSessionId,userId:e.userId,origin:e.origin,candidates:e.candidates}};A(t.ContentType.RTC_CALL,i,B(n))},this.leaveRtcCall=function(e,n,i){n=n||{},i=i||u,d.debug("[ClientApiHandler]: leaveRtcCall...");var r={type:t.RTCCallActionType.LEAVE,leave:{rtcSessionId:e,disconnectCause:n.cause,disconnectReason:n.reason}};A(t.ContentType.RTC_CALL,r,B(i))},this.terminateRtcCall=function(e,n,i,r){n=n||{},i=i||u,d.debug("[ClientApiHandler]: terminateRtcCall...");var o={type:t.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:e,disconnectCause:n.cause,disconnectReason:n.reason,pickUpUser:r||void 0,cause:r?t.TerminateCause.PICKED_UP:void 0}};A(t.ContentType.RTC_CALL,o,B(i))},this.declineRtcCall=function(e,n){n=n||u,d.debug("[ClientApiHandler]: declineRtcCall...");var i={type:t.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:e.convId,rtcSessionId:e.rtcSessionId,cause:e.cause,transactionId:e.transactionId}};A(t.ContentType.RTC_CALL,i,B(n))},this.changeMediaType=function(e,n){n=n||u,d.debug("[ClientApiHandler]: changeMediaType...");var i={type:t.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,mediaTypes:m(e.mediaType),transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,hosted:e.hosted,replaces:e.replaces,rtcSupportedFeatures:e.rtcSupportedFeatures,videoPointerTo:e.videoPointerTo}};A(t.ContentType.RTC_CALL,i,B(n))},this.changeMediaAccept=function(e,n){n=n||u,d.debug("[ClientApiHandler]: changeMediaAccept...");var i={type:t.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,transactionId:e.transactionId}};A(t.ContentType.RTC_CALL,i,B(n))},this.changeMediaReject=function(e,n){n=n||u,d.debug("[ClientApiHandler]: changeMediaReject...");var i={type:t.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:e.rtcSessionId,transactionId:e.transactionId}};A(t.ContentType.RTC_CALL,i,B(n))},this.prepareSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: prepareSession... ");var i={type:t.RTCCallActionType.PREPARE,prepare:{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,mediaNode:e.mediaNode,desiredRegion:e.desiredRegion||"",isTelephonyConversation:e.isTelephonyConversation,replaces:e.replaces}};A(t.ContentType.RTC_CALL,i,(function(e,t){f(e,t,n)&&n(null,t.rtcCall.prepare.servers,t.rtcCall.prepare.newRtcSessionId)}),null,["response.rtcCall.prepare.servers.[].password"])},this.renewTurnCredentials=function(e,n){n=n||u,d.debug("[ClientApiHandler]: renewTurnCredentials... ");var i={type:t.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:e}};A(t.ContentType.RTC_CALL,i,(function(e,t){f(e,t,n)&&n(null,t.rtcCall.renewTurnCredentials.servers)}),null,["response.rtcCall.renewTurnCredentials.servers.[].password"])},this.sendProgress=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: sendProgress... ");var o={type:t.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:e,userId:i,invitingUser:n||"",type:t.RTCProgressType.ALERTING}};A(t.ContentType.RTC_CALL,o,B(r))},this.submitCallQualityRating=function(e,n){n=n||u,d.debug("[ClientApiHandler]: submitCallQualityRating...");var i={type:t.RTCCallActionType.SUBMIT_RTC_QUALITY_RATING,submitRtcQualityRating:{rating:e}};A(t.ContentType.RTC_CALL,i,B(n))},this.mergeRtcCalls=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: mergeRtcCalls ...");var r={type:t.RTCCallActionType.MERGE,merge:{sourceRtcSessionId:e,targetRtcSessionId:n}};A(t.ContentType.RTC_CALL,r,B(i))},this.lockRtcSession=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: lockRtcSession...");var r={type:t.RTCSessionActionType.LOCK,lock:{rtcSessionId:e,locked:!!n}};A(t.ContentType.RTC_SESSION,r,(function(e,t){f(e,t,i)&&i(null)}))},this.muteRtcSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: muteRtcSession...");var i={type:t.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,excludedUserIds:e.excludedUserIds||void 0}};A(t.ContentType.RTC_SESSION,i,B(n))},this.muteParticipant=function(e,n){n=n||u,d.debug("[ClientApiHandler]: muteParticipant...");var i={type:t.RTCSessionActionType.MUTE,mute:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,userIds:e.usersIds||void 0}};A(t.ContentType.RTC_SESSION,i,B(n))},this.addParticipantToRtcSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addParticipantToRtcCall...");var i={type:t.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId,from:e.from,to:e.to,mediaType:m(e.mediaType)}};A(t.ContentType.RTC_SESSION,i,B(n))},this.removeSessionParticipant=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeSessionParticipant...");var i={type:t.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.getActiveSessions=function(e){e=e||u,d.debug("[ClientApiHandler]: getActiveSessions...");var n={type:t.RTCSessionActionType.GET_ACTIVE_SESSIONS};A(t.ContentType.RTC_SESSION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.rtcSession.activeSessions.session)}))},this.getSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSession...");var i={type:t.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n)&&n(null,t.rtcSession.getSession.session)}))},this.moveRtcSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: moveRtcSession...");var i={type:t.RTCSessionActionType.MOVE,move:{oldRtcSessionId:e.sessionId,oldConversationId:e.conversationId,newConversationId:e.newConversationId,newRtcSessionId:e.newSessionId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.startRecording=function(e,n){n=n||u,d.debug("[ClientApiHandler]: startRecording...");var i={type:t.RTCSessionActionType.START_RECORDING,startRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,recordingMediaTypes:h(e.recordingMediaTypes)}};e.videoLayout&&(i.startRecording.layout=e.videoLayout),A(t.ContentType.RTC_SESSION,i,B(n))},this.stopRecording=function(e,n){n=n||u,d.debug("[ClientApiHandler]: stopRecording...");var i={type:t.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,recordingMediaTypes:h(e.recordingMediaTypes)}};A(t.ContentType.RTC_SESSION,i,B(n))},this.switchRecordingLayout=function(e,n){n=n||u,d.debug("[ClientApiHandler]: switchRecordingLayout...");var i={type:t.RTCSessionActionType.SWITCH_RECORDING_LAYOUT,switchRecordingLayout:{rtcSessionId:e.rtcSessionId,layout:e.videoLayout}};A(t.ContentType.RTC_SESSION,i,B(n))},this.requestScreenControl=function(e,n){n=n||u,d.debug("[ClientApiHandler]: requestScreenControl ...");var i={type:t.RTCSessionActionType.REQUEST_SCREEN_CONTROL,requestScreenControl:{rtcSessionId:e.rtcSessionId,ownerId:e.ownerId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.offerScreenControl=function(e,n){n=n||u,d.debug("[ClientApiHandler]: offerScreenControl ...");var i={type:t.RTCSessionActionType.OFFER_SCREEN_CONTROL,offerScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId,controllerId:e.controllerId||void 0}};A(t.ContentType.RTC_SESSION,i,B(n))},this.acceptScreenControl=function(e,n){n=n||u,d.debug("[ClientApiHandler]: acceptScreenControl ...");var i={type:t.RTCSessionActionType.ACCEPT_SCREEN_CONTROL,acceptScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.rejectScreenControl=function(e,n){n=n||u,d.debug("[ClientApiHandler]: rejectScreenControl ...");var i={type:t.RTCSessionActionType.REJECT_SCREEN_CONTROL,rejectScreenControl:{rtcSessionId:e.rtcSessionId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.rejectScreenControlRequest=function(e,n){n=n||u,d.debug("[ClientApiHandler]: rejectScreenControlRequest ...");var i={type:t.RTCSessionActionType.REJECT_SCREEN_CONTROL_REQUEST,rejectScreenControlRequest:{rtcSessionId:e.rtcSessionId,controllerId:e.controllerId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.stopScreenControl=function(e,n){n=n||u,d.debug("[ClientApiHandler]: stopScreenControl ...");var i={type:t.RTCSessionActionType.STOP_SCREEN_CONTROL,stopScreenControl:{rtcSessionId:e.rtcSessionId}};A(t.ContentType.RTC_SESSION,i,B(n))},this.setVideoReceiverConfiguration=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setVideoReceiverConfiguration ...");var i={type:t.RTCSessionActionType.SET_VIDEO_RECEIVER_CONFIGURATION,setVideoReceiverConfiguration:{rtcSessionId:e.rtcSessionId,configuration:e.configuration}};A(t.ContentType.RTC_SESSION,i,B(n))},this.raiseQuestion=function(e,n){n=n||u,d.debug("[ClientApiHandler]: raiseQuestion...");var i={type:t.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:e};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n)&&n(null,t.rtcSession.raiseQuestion.questionNumber)}),["request.rtcSession.raiseQuestion.question"])},this.inviteToStage=function(e,n){n=n||u,d.debug("[ClientApiHandler]: inviteToStage..."),e.allowedMediaTypes=e.allowedMediaTypes||m();var i={type:t.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.inviteToStageAnswer=function(e,n){n=n||u,d.debug("[ClientApiHandler]: inviteToStageAnswer...");var i={type:t.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.inviteToStageCancel=function(e,n){n=n||u,d.debug("[ClientApiHandler]: inviteToStageCancel...");var i={type:t.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.removeFromStage=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeFromStage...");var i={type:t.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.getQuestions=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getQuestions...");var i={type:t.RTCSessionActionType.GET_QUESTIONS,getQuestions:e};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.rtcSession.getQuestions.questions||[])}))},this.updateQuestionState=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateQuestionState...");var i={type:t.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.openCurtain=function(e,n){n=n||u,d.debug("[ClientApiHandler]: openCurtain...");var i={type:t.RTCSessionActionType.OPEN_CURTAIN,openCurtain:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.closeCurtain=function(e,n){n=n||u,d.debug("[ClientApiHandler]: closeCurtain...");var i={type:t.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.getNodeState=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getNodeState...");var i={type:t.RTCSessionActionType.GET_NODE_STATE,getNodeState:e};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.rtcSession.getNodeState.nodeData)}))},this.enableWhiteboard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: enableWhiteboard...");var i={type:t.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:e.rtcSessionId,viewbox:e.viewbox}};A(t.ContentType.RTC_SESSION,i,B(n))},this.disableWhiteboard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: disableWhiteboard...");var i={type:t.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.addWhiteboardElement=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addWhiteboardElement...");var i={type:t.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.removeWhiteboardElement=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeWhiteboardElement...");var i={type:t.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.updateWhiteboardElement=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateWhiteboardElement...");var i={type:t.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.clearWhiteboard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: clearWhiteboard...");var i={type:t.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.getWhiteboard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getWhiteboard...");var r={type:t.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:e};A(t.ContentType.RTC_SESSION,r,(function(e,t){if(f(e,t,n)){var r=t.rtcSession.getWhiteboard.whiteboard;i.normalizeWhiteboard(r,I),n(null,r)}}))},this.setWhiteboardBackground=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setWhiteboardBackground...");var i={type:t.RTCSessionActionType.SET_WHITEBOARD_BACKGROUND,setWhiteboardBackground:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.clearWhiteboardBackground=function(e,n){n=n||u,d.debug("[ClientApiHandler]: clearWhiteboardBackground...");var i={type:t.RTCSessionActionType.CLEAR_WHITEBOARD_BACKGROUND,clearWhiteboardBackground:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.toggleWhiteboardOverlay=function(e,n){n=n||u,d.debug("[ClientApiHandler]: toggleWhiteboardOverlay...");var i={type:t.RTCSessionActionType.TOGGLE_WHITEBOARD_OVERLAY,toggleWhiteboardOverlay:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.undoWhiteboard=function(e,n){n=n||u,d.debug("[ClientApiHandler]: undoWhiteboard...");var i={type:t.RTCSessionActionType.UNDO_WHITEBOARD,undoWhiteboard:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.sendClientInfo=function(e,n){n=n||u,d.debug("[ClientApiHandler]: sendClientInfo...");var i={type:t.RTCSessionActionType.SEND_CLIENT_INFO,sendClientInfo:{clientInfo:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.enableConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: enableConferencePoll...");var i={type:t.RTCSessionActionType.ENABLE_POLL,enablePoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.closeConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: closeConferencePoll...");var i={type:t.RTCSessionActionType.CLOSE_POLL,closePoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.disableConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: disableConferencePoll...");var i={type:t.RTCSessionActionType.DISABLE_POLL,disablePoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.getConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConferencePoll...");var i={type:t.RTCSessionActionType.GET_POLL,getPoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n)&&n(null,t.rtcSession.getPoll.poll)}),null,["response.rtcSession.getPoll.poll.question","response.rtcSession.getPoll.poll.choices.[].choiceText"])},this.makePollResultsVisible=function(e,n){n=n||u,d.debug("[ClientApiHandler]: makePollResultsVisible...");var i={type:t.RTCSessionActionType.MAKE_POLL_RESULTS_VISIBLE,makePollResultsVisible:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.startConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: startConferencePoll...");var i={type:t.RTCSessionActionType.START_POLL,startPoll:e};A(t.ContentType.RTC_SESSION,i,B(n),["request.rtcSession.startPoll.question","request.rtcSession.startPoll.choices"])},this.resumeConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: resumeConferencePoll...");var i={type:t.RTCSessionActionType.RESUME_POLL,resumePoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.stopConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: stopConferencePoll...");var i={type:t.RTCSessionActionType.STOP_POLL,stopPoll:e};A(t.ContentType.RTC_SESSION,i,(function(e,t){f(e,t,n)&&n(null,t.rtcSession.stopPoll.poll)}),null,["response.rtcSession.stopPoll.poll.question","response.rtcSession.stopPoll.poll.choices.[].choiceText"])},this.voteConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: voteConferencePoll...");var i={type:t.RTCSessionActionType.VOTE_POLL,votePoll:e};A(t.ContentType.RTC_SESSION,i,B(n))},this.exportConferencePoll=function(e,n){n=n||u,d.debug("[ClientApiHandler]: exportConferencePoll...");var i={type:t.RTCSessionActionType.EXPORT_POLL,exportPoll:{rtcSessionId:e}};A(t.ContentType.RTC_SESSION,i,B(n))},this.submitClientData=function(e,n){n=n||u,d.debug("[ClientApiHandler]: submitClientData...");var i={type:t.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:e}};A(t.ContentType.INSTRUMENTATION,i,(function(e,i){if(f(e,i,n)){var r=i.instrumentation&&i.instrumentation.submitClientData&&i.instrumentation.submitClientData.submitDataResult;n(null,r||t.SubmitDataResult.OK)}}))},this.submitQOSData=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: submitQOSData...");var r={type:t.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:e}};n&&(r.submitQOSData.clientStreamQuality=n),A(t.ContentType.INSTRUMENTATION,r,B(i))},this.getNotifications=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getNotifications...");var r={type:t.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:e,numberOfItems:n}},o=E.map((function(e){return"response.activityStream.getActivitiesByUserResult.activityItems.[]."+e}));A(t.ContentType.ACTIVITYSTREAM,r,(function(e,t){if(f(e,t,i,!0)){var n=t.activityStream.getActivitiesByUserResult;i(null,n)}}),null,o)},this.toggleReadUnread=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: toggleReadUnread...");var r={type:t.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:e,read:n}};A(t.ContentType.ACTIVITYSTREAM,r,(function(e,t){if(f(e,t,i)){var n=t.activityStream.updateResult;i(null,n.updatedItem)}}))},this.markAllNotificationsAsRead=function(e){e=e||u,d.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var n={type:t.ActivityStreamActionType.MARK_ALL_READ};A(t.ContentType.ACTIVITYSTREAM,n,(function(t,n){if(f(t,n,e)){var i=n.activityStream.markAllReadResult;e(null,i)}}))},this.getTenant=function(e){e=e||u,d.debug("[ClientApiHandler]: getTenant...");var n={type:t.AdministrationActionType.GET_TENANT};A(t.ContentType.ADMINISTRATION,n,(function(t,n){f(t,n,e)&&e(null,n.administration.getTenant.tenant)}))},this.addUser=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addUser...");var i={type:t.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale},password:e.password,packageId:e.packageId,accountTemplateId:e.accountTemplateId}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.addUserResult.user)}),["request.administration.addUser.password"])},this.addMeetingPointV2=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: addMeetingPointV2...");var r={type:t.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale,location:e.location,registrationCodeTtl:e.timeout||void 0},packageId:e.packageId}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.addMeetingPointV2Result)}),null,["response.administration.addMeetingPointV2Result.registrationCode"],i)},this.updateMeetingPointV2=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: updateMeetingPointV2...");var r={type:t.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:e.id,registrationCodeTtl:e.timeout||void 0}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateMeetingPointV2Result.registrationCode)}),null,["response.administration.updateMeetingPointV2Result.registrationCode"],i)},this.regenerateApiKey=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: regenerateApiKey...");var r={type:t.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.regenerateApiKey.apiKey)}),null,["response.administration.regenerateApiKey.apiKey"],i)},this.addPhoneOnlyUser=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: AddPhoneOnlyUser...");var r={type:t.AdministrationActionType.ADD_PHONE_ONLY_USER,addPhoneOnlyUser:{emailAddress:e.emailAddress||void 0,lastName:e.lastName,firstName:e.firstName,locale:e.locale,packageId:e.packageId}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.addPhoneOnlyUserResult.user)}),null,null,i)},this.addSharedDevice=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: addSharedDevice...");var r={type:t.AdministrationActionType.ADD_SHARED_DEVICE,addSharedDevice:{name:e.name,location:e.location||void 0,locale:e.locale||void 0,packageId:e.packageId}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.addSharedDeviceResult.user)}),null,null,i)},this.deleteUser=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: deleteUser...");var r={type:t.AdministrationActionType.DELETE_USER,deleteUser:{userId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.inviteUser=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: inviteUser...");var r={type:t.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:e.userAttributes.emailAddress,lastName:e.userAttributes.lastName,firstName:e.userAttributes.firstName},packageId:e.packageId,accountTemplateId:e.accountTemplateId}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.inviteUser.resultType)}),null,null,i)},this.inviteMultipleUsers=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: inviteMultipleUsers...");var r={type:t.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:e};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t)}),null,null,i)},this.invitePartnerUsers=function(e,n){n=n||u,d.debug("[ClientApiHandler]: invitePartnerUsers...");var i={type:t.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:e}};A(t.ContentType.ADMINISTRATION,i,B(n))},this.resendInvite=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: resendInvite...");var r={type:t.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.resendUserInvitation.resultType)}),null,null,i)},this.checkInvalidTenant=function(e,n){n=n||u,d.debug("[ClientApiHandler]: checkInvalidTenant...");var i={type:t.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.administration.checkInvalidTenants.tenantIds)}))},this.setTelephonyTrunkData=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: setTelephonyTrunkData...");var r={type:t.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n()}),null,null,i)},this.getTelephonyTrunkStatus=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var i={type:t.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.getTelephonyTrunkStatus)}),null,null,n)},this.getTelephonyTrunkGroups=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getTelephonyTrunkGroups..."),!e)return d.warn("[ClientApiHandler]: No query data provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUPS,getTelephonyTrunkGroups:{pageSize:e.pageSize,pagePointer:e.pagePointer||void 0,includeSharedTrunkGroups:e.includeSharedTrunkGroups||void 0}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupsResult)}),null,null,i)},this.getTelephonyTrunkGroup=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getTelephonyTrunkGroup..."),!e)return d.warn("[ClientApiHandler]: No trunk group id provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUP,getTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupResult)}))},this.addTelephonyTrunkGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: addTelephonyTrunkGroup..."),!e)return d.warn("[ClientApiHandler]: No trunk group data provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.ADD_TELEPHONY_TRUNK_GROUP,addTelephonyTrunkGroup:{telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.addTelephonyTrunkGroupResult)}),null,null,i)},this.removeTelephonyTrunkGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: removeTelephonyTrunkGroup..."),!e)return d.warn("[ClientApiHandler]: No trunk group id provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.REMOVE_TELEPHONY_TRUNK_GROUP,removeTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.removeTelephonyTrunkGroupResult.responseCode)}),null,null,i)},this.updateTelephonyTrunkGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateTelephonyTrunkGroup..."),!e)return d.warn("[ClientApiHandler]: No trunk group data provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_TELEPHONY_TRUNK_GROUP,updateTelephonyTrunkGroup:{telephonyTrunkGroupId:e.telephonyTrunkGroupId,telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateTelephonyTrunkGroupResult)}),null,null,i)},this.getTenantBridgeNumbers=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var i={type:t.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};A(t.ContentType.ADMINISTRATION,i,(function(t,n){if(f(t,n,e)){var i=n.administration.getTenantBridgeNumbers;e(null,i&&i.bridgeNumbers||[])}}),null,null,n)},this.setTenantBridgeNumbers=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var r={type:t.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n()}),null,null,i)},this.getTenantVoicemailNumbers=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getTenantVoicemailNumbers...");var i={type:t.AdministrationActionType.GET_TENANT_VOICEMAIL_NUMBERS};A(t.ContentType.ADMINISTRATION,i,(function(t,n){if(f(t,n,e,!0)){var i=n.administration.getTenantVoicemailNumbersResult;e(null,i&&i.voicemailNumber||[])}}),null,null,n)},this.setTenantVoicemailNumbers=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: setTenantVoicemailNumbers...");var r={type:t.AdministrationActionType.SET_TENANT_VOICEMAIL_NUMBERS,setTenantVoicemailNumbers:{voicemailNumber:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n()}),null,null,i)},this.addAutoConfigurableTrunk=function(e,n){e=e||u,d.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var i={type:t.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.addTrunk.configuration)}),null,null,n)},this.getTenantTelephonyConfiguration=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var i={type:t.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.getTenantTelephonyConfiguration.configuration)}),null,["response.administration.getTenantTelephonyConfiguration.configuration.apiKey"],n)},this.getTelephonyRoutingRules=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var r={type:t.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:e.pageSize,pagePointer:e.pagePointer}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyRoutingRulesResult)}),null,null,i)},this.addTelephonyRoutingRule=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var r={type:t.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.updateTelephonyRoutingRule=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var r={type:t.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,routeId:e.routeId||void 0,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.removeTelephonyRoutingRule=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var r={type:t.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.testTelephonyRoutingRules=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var r={type:t.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:e.destination,origin:e.origin||void 0,application:e.application||void 0,considerTelephonyConnectorsStates:!!e.considerTelephonyConnectorsStates}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.testTelephonyRoutingRulesResult)}),null,null,i)},this.updateTenantTelephonyConfiguration=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var r={type:t.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.setTrunkPassword=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: setTrunkPassword...");var r={type:t.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:e,password:n}};A(t.ContentType.ADMINISTRATION,r,B(i),["request.administration.setTrunkPassword.password"])},this.updateTrunk=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateTrunk...");var i={type:t.AdministrationActionType.UPDATE_TRUNK,updateTrunk:{trunkId:e.gtcUserId,displayName:e.gtcTrunkName,defaultCallerId:e.defaultCallerId}};A(t.ContentType.ADMINISTRATION,i,B(n))},this.startTrunkSoftSuspension=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: startTrunkSoftSuspension...");var r={type:t.AdministrationActionType.START_TRUNK_SOFT_SUSPENSION,startTrunkSoftSuspension:{trunkId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.cancelTrunkSoftSuspension=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: cancelTrunkSoftSuspension...");var r={type:t.AdministrationActionType.CANCEL_TRUNK_SOFT_SUSPENSION,cancelTrunkSoftSuspension:{trunkId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.getTrunkRemainingCalls=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getTrunkRemainingCalls...");var r={type:t.AdministrationActionType.GET_TRUNK_ACTIVE_CALLS,getTrunkActiveCalls:{trunkId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getTrunkActiveCallsResult.numberOfActiveCalls)}),null,null,i)},this.shareTrunkGroup=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: shareTrunkGroup...");var o={type:t.AdministrationActionType.SHARE_TRUNK_GROUP,shareTrunkGroup:{trunkGroupId:e,secTenantId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.unshareTrunkGroup=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: unshareTrunkGroup...");var o={type:t.AdministrationActionType.UNSHARE_TRUNK_GROUP,unshareTrunkGroup:{trunkGroupId:e,secTenantId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.setTenantSettings=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: setTenantSettings...");var r={type:t.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.updateTenantName=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateTenantName...");var i={type:t.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:e}};A(t.ContentType.ADMINISTRATION,i,B(n))},this.getTenantLoginProviders=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getTenantLoginProviders...");var i={type:t.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n,!0)&&n(null,t.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])}))},this.addTenantLoginProvider=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addTenantLoginProvider...");var i={type:t.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.saveTenantLoginProviderResult.storedProvider)}))},this.updateTenantLoginProvider=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateTenantLoginProvider...");var i={type:t.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.updateTenantLoginProviderResult.updatedLoginProvider)}))},this.deleteTenantLoginProvider=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var i={type:t.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:e.providerId,tenantId:e.tenantId}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.deleteTenantLoginProviderResult)}))},this.getOpenScapeUser=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getOpenScapeUser..."),!e)return d.warn("[ClientApiHandler]: No dn was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)}),null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],i)},this.getOpenScapeUserV2=function(e,n,i,r){if(i=i||u,d.debug("[ClientApiHandler]: getOpenScapeUserV2..."),!e)return d.warn("[ClientApiHandler]: No dn was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);if(!n)return d.warn("[ClientApiHandler]: No circuitUserId was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);var o={type:t.AdministrationActionType.GET_OPENSCAPE_USER_V2,getV2OpenScapeUser:{directoryNumber:e,circuitUserId:n}};A(t.ContentType.ADMINISTRATION,o,(function(e,t){f(e,t,i)&&i(null,t.administration.getOpenScapeUserResult)}),null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],r)},this.getThirdPartyDeviceData=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getThirdPartyDeviceData...");var r={type:t.AdministrationActionType.GET_THIRD_PARTY_DEVICE_INFO,getThirdPartyDeviceInfo:{directoryNumber:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo)}),null,["response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.authenticationPassword","response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.certContent"],i)},this.getVacantHomeDirectoryNumbers=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var i={type:t.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)}),null,null,n)},this.getVacantHomeDirectoryNumbersOfSite=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbersOfSite..."),!e)return d.warn("[ClientApiHandler]: No siteId was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE,getVacantHomeDirectoryNumbersOfSite:{siteId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getVacantHomeDirectoryNumbersOfSiteResult.directoryNumbers)}),null,null,i)},this.createOpenScapeUser=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createOpenScapeUser..."),!e)return d.warn("[ClientApiHandler]: No user data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:e};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createOpenScapeUserResult.user)}),null,null,i)},this.updateOpenScapeUser=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateOpenScapeUser..."),!e)return d.warn("[ClientApiHandler]: No user data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:e};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateOpenScapeUserResult.user)}),null,null,i)},this.deleteOpenScapeUser=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!e||!e.userId||!e.dn)return d.warn("[ClientApiHandler]: User id or dn was not provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:e.userId,directoryNumber:e.dn}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.deleteOpenScapeUserResult)}),null,null,i)},this.createOpenScapeSite=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createOpenScapeSite..."),!e)return d.warn("[ClientApiHandler]: No site data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_OPENSCAPE_SITE,createOpenScapeSite:{site:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createOpenScapeSiteResult.site)}),null,null,i)},this.getOpenScapeSite=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getOpenScapeSite..."),!e)return d.warn("[ClientApiHandler]: No siteId was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_OPENSCAPE_SITE,getOpenScapeSite:{siteId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeSiteResult.site)}),null,null,i)},this.updateOpenScapeSite=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateOpenScapeSite..."),!e)return d.warn("[ClientApiHandler]: No site data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_OPENSCAPE_SITE,updateOpenScapeSite:{site:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateOpenScapeSiteResult.site)}),null,null,i,3e5)},this.deleteOpenScapeSites=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: deleteOpenScapeSites...");var r={type:t.AdministrationActionType.DELETE_OPENSCAPE_SITES,deleteOpenScapeSites:{sites:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){if(f(e,t,n)){var i=t.administration&&t.administration.deleteOpenScapeSitesResult&&t.administration.deleteOpenScapeSitesResult.failedToBeDeleted||[];n(null,i)}}),null,null,i)},this.deleteOpenScapePublicRange=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: deleteOpenScapePublicRange...");var o={type:t.AdministrationActionType.DELETE_PUBLIC_NUMBER_RANGE,deletePublicNumberRange:{siteId:e,rangeId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r,3e5)},this.deleteSinglePublicNumber=function(e,n,i,r){if(i=i||u,d.debug("[ClientApiHandler]: deleteSinglePublicNumber..."),!e)return d.warn("[ClientApiHandler]: No siteId was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);if(!n)return d.warn("[ClientApiHandler]: No msnId was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);var o={type:t.AdministrationActionType.DELETE_OPENSCAPE_MSN_NUMBER,deleteOpenScapeMSNnumber:{siteId:e,msnId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.deleteOpenScapePrivateRange=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: deleteOpenScapePrivateRange...");var o={type:t.AdministrationActionType.DELETE_PRIVATE_NUMBER_RANGE,deletePrivateNumberRange:{siteId:e,rangeId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r,3e5)},this.getOpenScapeTenant=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getOpenScapeTenant...");var i={type:t.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.getOpenScapeTenantResult.tenant)}),null,null,n)},this.getManageableTenants=function(e){e=e||u,d.debug("[ClientApiHandler]: getManageableTenants...");var n={type:t.AdministrationActionType.GET_PARTNER_MANAGEABLE_TENANTS};A(t.ContentType.ADMINISTRATION,n,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getPartnerManageableTenantResult.tenants)}))},this.getCMRSettings=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getCMRSettings...");var i={type:t.AdministrationActionType.GET_CMR_SETTINGS,getCMRSettings:{userId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n,!0)&&n(e,t.administration.getCMRSettingsResult.settings)}))},this.setCMRSettings=function(e,n,i){if(i=i||u,d.debug("[ClientApiHandler]: setCMRSettings..."),function(e,n){return N(n)?!(!C.isTouchScreenReportSupported()&&(n.some((function(e,i){return e.key===t.CMRSettingKey.TOUCHSCREEN_DISPLAY&&(d.warn("[ClientApiHandler]: TOUCHSCREEN_DISPLAY setting is not supported by backend"),n.splice(i,1),!0)})),!n.length))||(_(e,t.ReturnCode.OPERATION_NOT_SUPPORTED),!1):(d.warn("[ClientApiHandler]: Missing CMR settings"),_(e,t.ReturnCode.INVALID_MESSAGE),!1)}(i,n)){var r={type:t.AdministrationActionType.SET_CMR_SETTINGS,setCMRSettings:{userId:e,settings:n}};A(t.ContentType.ADMINISTRATION,r,B(i))}},this.sendCMRCommand=function(e,n,i){if(i=i||u,d.debug("[ClientApiHandler]: sendCMRCommand..."),t.CMRCommand[e]&&n){var r={type:t.AdministrationActionType.SEND_CMR_COMMAND,sendCMRCommand:{command:e,cmrId:n}};A(t.ContentType.ADMINISTRATION,r,B(i))}else _(i,t.ReturnCode.INVALID_MESSAGE)},this.getCMRInfoById=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getCMRInfoById...");var i={type:t.AdministrationActionType.GET_CMR_INFO_BY_ID,getCMRInfoById:{userId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(e,t.administration.getCMRInfoByIdResult.cmrInfo)}),null,["response.administration.getCMRInfoByIdResult.cmrInfo.adminManagedSetting"])},this.getCMRInfoByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getCMRInfoByIds...");var i={type:t.AdministrationActionType.GET_CMR_INFO_BY_IDS,getCMRInfoByIds:{userId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n,!0)&&n(e,t.administration.getCMRInfoByIdsResult.cmrInfo)}))},this.getCMRFeaturesByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getCMRFeaturesByIds...");var i={type:t.AdministrationActionType.GET_CMR_FEATURES_BY_IDS,getCMRFeaturesByIds:{cmrId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n,!0)&&n(e,t.administration.getCMRFeaturesByIdsResult||[])}))},this.setAdminManagedCMRSettings=function(e,n,i){if(i=i||u,d.debug("[ClientApiHandler]: setAdminManagedCMRSettings..."),k(i,n)){var r={type:t.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS,setAdminManagedCMRSettings:{userId:e,setting:n}};A(t.ContentType.ADMINISTRATION,r,B(i),["request.administration.setAdminManagedCMRSettings.setting"])}},this.setAdminManagedCMRSettingsByIds=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: setAdminManagedCMRSettingsByIds..."),!N(e))return d.warn("[ClientApiHandler]: Missing CMR settings"),void _(n,t.ReturnCode.INVALID_MESSAGE);if(e.every((function(e){return k(n,e&&e.setting)}))){var i={type:t.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS,setAdminManagedCMRSettingsByIds:{settings:e}};A(t.ContentType.ADMINISTRATION,i,B(n))}},this.shareCMR=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: shareCMR...");var o={type:t.AdministrationActionType.SHARE_CMR,shareCMR:{cmrUserId:e,secIds:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.unshareCMR=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: unshareCMR...");var o={type:t.AdministrationActionType.UNSHARE_CMR,unshareCMR:{cmrUserId:e,secIds:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.getCMRSharedTenantInfo=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getCMRSharedTenantInfo...");var r={type:t.AdministrationActionType.GET_CMR_SHARED_TENANT_INFO,getCMRSharedTenantInfo:{cmrUserId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n,!0)&&n(null,t.administration.getCMRSharedTenantInfoResult.tenantIdToName||[])}),null,null,i)},this.getHuntGroups=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getHuntGroups...");var i={type:t.AdministrationActionType.GET_TENANT_HUNT_GROUPS,getTenantHuntGroups:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getTenantHuntGroupsResult.queryHuntGroupResponse||[])}),null,null,n)},this.createHuntGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createHuntGroup..."),!e)return d.warn("[ClientApiHandler]: No hunt group data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_HUNT_GROUP,createHuntGroup:{huntGroup:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createHuntGroupResult.huntGroup)}),null,null,i)},this.deleteHuntGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteHuntGroup..."),!e||!e.length)return d.warn("[ClientApiHandler]: No hunt group pilot DNs were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_HUNT_GROUP,deleteHuntGroup:{huntGroupPilots:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.getHuntGroupPilotDNs=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getHuntGroupPilotDNs...");var i={type:t.AdministrationActionType.GET_HUNT_GROUP_PILOT_CANDIDATES,getHuntGroupPilotCandidates:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getHuntGroupPilotCandidatesResult.huntGroupUsers||[])}),null,null,n)},this.getHuntGroupMemberDNs=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getHuntGroupMemberDNs...");var i={type:t.AdministrationActionType.GET_HUNT_GROUP_MEMBER_CANDIDATES,getHuntGroupMemberCandidates:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getHuntGroupMemberCandidatesResult.huntGroupUsers||[])}),null,null,n)},this.getHuntGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getHuntGroup..."),!e)return d.warn("[ClientApiHandler]: Hunt group pilot DN was not provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_HUNT_GROUP,getHuntGroup:{pilotDn:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getHuntGroupResult.huntGroup)}),null,null,i)},this.updateHuntGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateHuntGroup..."),!e)return d.warn("[ClientApiHandler]: No hunt group data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_HUNT_GROUP,updateHuntGroup:{updatedHuntGroup:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateHuntGroupResult.huntGroup)}),null,null,i)},this.updateHuntGroupList=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateHuntGroupList..."),!e)return d.warn("[ClientApiHandler]: No hunt group list data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_HUNT_GROUP_LIST,updateHuntGroupList:{pilotsDns:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.getITSPtemplates=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getITSPtemplates...");var i={type:t.AdministrationActionType.GET_OPENSCAPE_ITSP_TEMPLATES,getOpenscapeITSPTemplates:{}};A(t.ContentType.ADMINISTRATION,i,(function(n,i){if(f(n,i,e)){var r,o=i.administration.getOpenscapeITSPTemplatesResult.itspTemplates;if(o)try{r=JSON.parse(o)}catch(n){return d.error("[ClientApiHandler]: Error while parsing response in getITSPtemplates"),void e(t.ReturnCode.SERVICE_EXCEPTION)}e(null,r&&r.content)}}),null,null,n)},this.createITSP=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createITSP..."),!e)return d.warn("[ClientApiHandler]: No ITSP data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_OPENSCAPE_ITSP,createOpenscapeITSP:{itsp:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createOpenscapeITSPResult.provider)}),["request.administration.createOpenscapeITSP.itsp.username","request.administration.createOpenscapeITSP.itsp.password"],["response.administration.createOpenscapeITSPResult.provider.username","response.administration.createOpenscapeITSPResult.provider.password"],i,15e4)},this.getITSP=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getITSP..."),!e)return d.warn("[ClientApiHandler]: No ITSP id was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_OPENSCAPE_ITSP,getOpenscapeITSP:{id:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getOpenscapeITSPResult.provider)}),null,null,i)},this.getITSPs=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getITSPs...");var i={type:t.AdministrationActionType.GET_OPENSCAPE_ITSPS,getOpenscapeITSPs:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getOpenscapeITSPsResult.providers)}),null,null,n)},this.updateITSP=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateITSP..."),!e)return d.warn("[ClientApiHandler]: No ITSP data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_OPENSCAPE_ITSP,updateOpenscapeITSP:{itsp:e}};A(t.ContentType.ADMINISTRATION,r,B(n),["request.administration.updateOpenscapeITSP.itsp.username","request.administration.updateOpenscapeITSP.itsp.password"],["response.administration.updateOpenscapeITSPResult.provider.username","response.administration.updateOpenscapeITSPResult.provider.password"],i,15e4)},this.deleteITSPs=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteITSP..."),!e)return d.warn("[ClientApiHandler]: No ITSP ids were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_OPENSCAPE_ITSP,deleteOpenscapeITSP:{itspIds:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.deleteOpenscapeITSPResult.providers)}),null,null,i,15e4)},this.assignITSPToSite=function(e,n,i,r,o){if(r=r||u,d.debug("[ClientApiHandler]: assignITSPToSite..."),!e)return d.warn("[ClientApiHandler]: No ITSP id was provided"),void _(r,t.ReturnCode.INVALID_MESSAGE);if(!n)return d.warn("[ClientApiHandler]: No site id was provided"),void _(r,t.ReturnCode.INVALID_MESSAGE);var a={type:t.AdministrationActionType.ASSIGN_OPENSCAPE_ITSP_TO_SITE,assignOpenscapeITSPToSite:{itspid:e,siteid:n,defaultHomeDN:i}};A(t.ContentType.ADMINISTRATION,a,B(r),null,null,o)},this.unassignITSPFromSite=function(e,n,i,r){if(i=i||u,d.debug("[ClientApiHandler]: unassignITSPFromSite..."),!e)return d.warn("[ClientApiHandler]: No ITSP id was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);if(!n)return d.warn("[ClientApiHandler]: No site id was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);var o={type:t.AdministrationActionType.UNASSIGN_OPENSCAPE_ITSP_TO_SITE,unassignOpenscapeITSPFromSite:{itspid:e,siteid:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.findOpenscapeSitesByITSP=function(e,n,i,r){if(i=i||u,d.debug("[ClientApiHandler]: findOpenscapeSitesByITSP..."),!e)return d.warn("[ClientApiHandler]: No ITSP id was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);var o={type:t.AdministrationActionType.FIND_OPENSCAPE_SITES_BY_ITSP,findOpenscapeSitesByITSP:{itspid:e,partnerLookupOnly:n}};A(t.ContentType.ADMINISTRATION,o,(function(e,t){f(e,t,i)&&i(null,t.administration.findOpenscapeSitesByITSPResult.siteList||[])}),null,null,r)},this.getPickupGroupMemberDNs=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getPickupGroupMemberDNs...");var i={type:t.AdministrationActionType.GET_PICKUP_GROUP_MEMBER_CANDIDATES,getPickupGroupMemberCandidates:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getPickupGroupMemberCandidatesResult.pickupGroupUsers||[])}),null,null,n)},this.createPickupGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createPickupGroup..."),!e)return d.warn("[ClientApiHandler]: No pickup group data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_PICKUP_GROUP,createPickupGroup:{pickupGroup:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createPickupGroupResult.pickupGroupResponse)}),null,null,i)},this.getPickupGroupList=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getPickupGroupList...");var i={type:t.AdministrationActionType.GET_TENANT_PICKUP_GROUPS,getTenantPickupGroups:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getTenantPickupGroupsResult.queryPickupGroupResponse||[])}),null,null,n)},this.deletePickupGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deletePickupGroup..."),!e||!e.length)return d.warn("[ClientApiHandler]: No pickup group ids were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_PICKUP_GROUPS,deletePickupGroups:{pickupGroupId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.getPickupGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getPickupGroup..."),!e)return d.warn("[ClientApiHandler]: Pickup group id was not provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_PICKUP_GROUP,getPickupGroup:{pickupGroupId:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getPickupGroupResult.pickupGroup)}),null,null,i)},this.updatePickupGroup=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updatePickupGroup..."),!e)return d.warn("[ClientApiHandler]: No pickup group data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_PICKUP_GROUP,updatePickupGroup:{pickupGroup:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration)}),null,null,i)},this.getExecutiveAssistantGroupList=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getExecutiveAssistantGroupList...");var i={type:t.AdministrationActionType.GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS,getTenantExecutiveAssistantGroups:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getTenantExecutiveAssistantGroupsResult.queryExecutiveAssistantGroupResponse||[])}),null,null,n)},this.getExecutiveAssistantGroupMemberCandidates=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getExecutiveAssistantGroupMemberCandidates...");var i={type:t.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES,getExecutiveAssistantGroupMemberCandidates:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getExecutiveAssistantGroupMemberCandidatesResult.executiveAssistantGroupUsers||[])}),null,null,n)},this.createExecutiveAssistantGroup=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: createExecutiveAssistantGroup...");var r={type:t.AdministrationActionType.CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC,createExecutiveAssistantGroupAsync:{executiveAssistantGroup:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i,15e4)},this.getExecutiveAssistantGroup=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getExecutiveAssistantGroup...");var r={type:t.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP,getExecutiveAssistantGroup:{eaGroupName:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n,!0)&&n(null,t.administration.getExecutiveAssistantGroupResult.executiveAssistantGroup||{})}),null,null,i)},this.deleteExecutiveAssistantGroups=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteExecutiveAssistantGroup..."),!e||!e.length)return d.warn("[ClientApiHandler]: No Executive-Assistant group names were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_EXECUTIVE_ASSISTANT_GROUPS,deleteExecutiveAssistantGroups:{executiveAssistantGroupName:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i,15e4)},this.validateTransferTarget=function(e,n,i,r){if(i=i||u,d.debug("[ClientApiHandler]: validateTransferTarget..."),!n||!e)return d.warn("[ClientApiHandler]: No siteId or transferTarget was provided"),void _(i,t.ReturnCode.INVALID_MESSAGE);var o={type:t.AdministrationActionType.VALIDATE_TRANSFER_TARGET,validateTransferTarget:{siteId:e,transferTarget:n}};A(t.ContentType.ADMINISTRATION,o,(function(e,t){f(e,t,i)&&i(null,t.administration.validateTransferTargetResult.number)}),null,null,r)},this.createAutomatedAttendantConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createAutomatedAttendantConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_AUTOMATED_ATTENDANT_CONFIGURATION,createAutomatedAttendantConfiguration:{automatedAttendantConfiguration:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i,15e4)},this.getAutomatedAttendantConfigurations=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getAutomatedAttendantConfigurations...");var i={type:t.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATIONS,getAutomatedAttendantConfigurations:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getAutomatedAttendantConfigurationsResult.automatedAttendantConfigurations||[])}),null,null,n)},this.getAutomatedAttendantConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getAutomatedAttendantConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Automated Attendant access number was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATION,getAutomatedAttendantConfiguration:{automatedAttendantNumber:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getAutomatedAttendantConfigurationResult.automatedAttendantConfiguration)}),null,null,i)},this.updateAutomatedAttendantConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateAutomatedAttendantConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION,updateAutomatedAttendantConfiguration:{updatedAutoAttendant:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration)}),null,null,i,15e4)},this.deleteAutomatedAttendantConfigurations=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteAutomatedAttendantConfigurations..."),!e)return d.warn("[ClientApiHandler]: No Automated Attendant access numbers were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS,deleteAutomatedAttendantConfigurations:{autoAttendants:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i,15e4)},this.getUcaasPhoneLdapSettings=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getUcaasPhoneLdapSettings...");var i={type:t.AdministrationActionType.GET_LDAP_CONFIGURATION_FOR_PHONE,getLDAPConfigurationForPhone:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e)&&e(null,n.administration.getLDAPConfigurationForPhoneResult.ldapConfigurationForPhone)}),null,["response.administration.getLDAPConfigurationForPhoneResult.ldapConfigurationForPhone.password"],n)},this.saveUcaasPhoneLdapSettings=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: saveUcaasPhoneLdapSettings...");var r={type:t.AdministrationActionType.ADD_LDAP_CONFIGURATION_FOR_PHONE,addLDAPConfigurationForPhone:{ldapConfigurationForPhone:e}};A(t.ContentType.ADMINISTRATION,r,B(n),["request.administration.addLDAPConfigurationForPhone.ldapConfigurationForPhone.password"],null,i)},this.createApplicationFrameworkConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createApplicationFrameworkConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.CREATE_APPLICATION_FRAMEWORK_CONFIGURATION,createApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.createApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)}),null,null,i,15e4)},this.getApplicationFrameworkConfigurations=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getApplicationFrameworkConfigurations...");var i={type:t.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATIONS,getApplicationFrameworkConfigurations:{}};A(t.ContentType.ADMINISTRATION,i,(function(t,n){f(t,n,e,!0)&&e(null,n.administration.getApplicationFrameworkConfigurationsResult.applicationFrameworkConfigurations||[])}),null,null,n)},this.getApplicationFrameworkConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: getApplicationFrameworkConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Application Framework access number was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATION,getApplicationFrameworkConfiguration:{accessNumber:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.getApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)}),null,null,i)},this.updateApplicationFrameworkConfiguration=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: updateApplicationFrameworkConfiguration..."),!e)return d.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION,updateApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)}),null,null,i,15e4)},this.deleteApplicationFrameworkConfigurations=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: deleteApplicationFrameworkConfigurations..."),!e)return d.warn("[ClientApiHandler]: No Application Framework access numbers were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS,deleteApplicationFrameworkConfigurations:{ids:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i,15e4)},this.hasSomeSinglePublicNumberReserved=function(e,n,i){if(n=n||u,!(e&&e.msnNumbers&&e.customerId&&e.sitePrefix))return d.warn("[ClientApiHandler]: Missing mandatory data"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.IS_MSN_RESERVED,isMSNReserved:{msnNumbers:e.msnNumbers,customerId:e.customerId,sitePrefix:e.sitePrefix}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.isMSNReservedResult.isMSNReserved)}),null,null,i)},this.hasReservedDNsInSiteRanges=function(e,n,i){if(n=n||u,!(e&&e.siteId&&e.modifiedDidNumberRanges&&e.modifiedPrivateNumberRanges))return d.warn("[ClientApiHandler]: Missing mandatory data"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.AdministrationActionType.HAS_RESERVED_DNS_IN_SITE_RANGES,hasReservedDNsInSiteRanges:{siteId:e.siteId,publicRanges:e.modifiedDidNumberRanges,privateRanges:e.modifiedPrivateNumberRanges}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.hasReservedDNsInSiteRangesResult.hasReservedDNs)}),null,null,i)},this.getSystemNotifications=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getSystemNotifications...");var r={type:t.AdministrationActionType.GET_SYSTEM_NOTIFICATIONS,getSystemNotifications:{systemNotificationType:e}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n,!0)&&n(null,t.administration.getSystemNotificationsResult.systemNotifications||[])}),null,["response.administration.getSystemNotificationsResult.systemNotifications.[].broadcastText"],i)},this.addSystemNotification=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: addSystemNotification...");var r={type:t.AdministrationActionType.ADD_SYSTEM_NOTIFICATION,addSystemNotification:{type:e.type,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.addSystemNotificationResult.systemNotification)}),["request.administration.addSystemNotification.broadcastText"],["response.administration.addSystemNotificationResult.systemNotification.broadcastText"],i)},this.removeSystemNotification=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: removeSystemNotification...");var r={type:t.AdministrationActionType.REMOVE_SYSTEM_NOTIFICATION,removeSystemNotification:{id:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.updateSystemNotification=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: updateSystemNotification...");var r={type:t.AdministrationActionType.UPDATE_SYSTEM_NOTIFICATION,updateSystemNotification:{id:e.id,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};A(t.ContentType.ADMINISTRATION,r,(function(e,t){f(e,t,n)&&n(null,t.administration.updateSystemNotificationResult.systemNotification)}),["request.administration.updateSystemNotification.broadcastText"],["response.administration.updateSystemNotificationResult.systemNotification.broadcastText"],i)},this.enablePartnerAdministration=function(e,n){e=e||u,d.debug("[ClientApiHandler]: enablePartnerAdministration...");var i={type:t.AdministrationActionType.ENABLE_PARTNER_ADMINISTRATION};A(t.ContentType.ADMINISTRATION,i,B(e),null,null,n)},this.disablePartnerAdministration=function(e,n){e=e||u,d.debug("[ClientApiHandler]: disablePartnerAdministration...");var i={type:t.AdministrationActionType.DISABLE_PARTNER_ADMINISTRATION};A(t.ContentType.ADMINISTRATION,i,B(e),null,null,n)},this.getResellerInfo=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getResellerInfo...");var i={type:t.AdministrationActionType.GET_RESELLER_INFO,getResellerInfo:{partnerId:e}};A(t.ContentType.ADMINISTRATION,i,(function(e,t){f(e,t,n)&&n(null,t.administration.getResellerInfoResult.resellerInfo)}))},this.setSupportType=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: setSupportType...");var r={type:t.AdministrationActionType.SET_SUPPORT_TYPE,setSupportType:{supportType:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.setSupportEmail=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setSupportEmail...");var i={type:t.AdministrationActionType.SET_SUPPORT_EMAIL_ADDRESS,setSupportEmailaddress:{supportEmailaddress:e}};A(t.ContentType.ADMINISTRATION,i,B(n))},this.exportUserData=function(e,n,i,r){i=i||u,d.debug("[ClientApiHandler]: exportUserData...");var o={type:t.AdministrationActionType.EXPORT_DATA_USER,exportDataUser:{data:e,userId:n}};A(t.ContentType.ADMINISTRATION,o,B(i),null,null,r)},this.exportDomainData=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: exportDomainData...");var r={type:t.AdministrationActionType.EXPORT_DATA_TENANT,exportDataTenant:{data:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.getApplicationsList=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getApplicationsList...");var r={type:t.CPaaSActionType.GET_OAUTH_APPLICATIONS};A(t.ContentType.CPAAS,r,(function(e,i){e||i.code!==t.ReturnCode.NO_RESULT?f(e,i,n)&&n(null,i.cpaas.getOauthApplicationsResult):n(null,{applications:[]})}),null,null,i)},this.getApplicationDetails=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getApplicationsDetails...");var r={type:t.CPaaSActionType.GET_OAUTH_APPLICATION,getOauthApplication:{clientId:e}};A(t.ContentType.CPAAS,r,(function(e,t){f(e,t,n)&&n(null,t.cpaas.getOauthApplicationResult.application)}),null,null,i)},this.suspendApplication=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: suspendApplication ...");var r={type:t.CPaaSActionType.SUSPEND_OAUTH_APPLICATION,suspendOAuthApplication:{clientId:e}};A(t.ContentType.CPAAS,r,B(n),null,null,i)},this.unsuspendApplication=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: unsuspendApplication ...");var r={type:t.CPaaSActionType.UNSUSPEND_OAUTH_APPLICATION,unsuspendOAuthApplication:{clientId:e}};A(t.ContentType.CPAAS,r,B(n),null,null,i)},this.recreateClientSecret=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: recreateClientSecret...");var r={type:t.CPaaSActionType.RECREATE_CLIENT_SECRET,recreateClientSecret:{clientId:e}};A(t.ContentType.CPAAS,r,(function(e,t){f(e,t,n)&&n(null,t.cpaas.recreateClientSecretResult.clientSecret)}),null,null,i)},this.deleteApplication=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: deleteApplication...");var r={type:t.CPaaSActionType.DELETE_OAUTH_APPLICATION,deleteOAuthApplication:{clientId:e}};A(t.ContentType.CPAAS,r,B(n),null,null,i)},this.createOAuthApplication=function(e,n,i){if(n=n||u,d.debug("[ClientApiHandler]: createOAuthApplication..."),!e)return d.warn("[ClientApiHandler]: No application data were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.CPaaSActionType.CREATE_OAUTH_APPLICATION,createOAuthApplication:e};A(t.ContentType.CPAAS,r,(function(e,t){f(e,t,n)&&n(null,t.cpaas.createOAuthApplicationResult)}),null,null,i)},this.updateApplication=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: updateApplication...");var r={type:t.CPaaSActionType.UPDATE_OAUTH_APPLICATION,updateOAuthApplication:e};A(t.ContentType.CPAAS,r,(function(e,t){f(e,t,n)&&n(null,t.cpaas.updateOAuthApplicationResult.application)}),null,null,i)},this.createIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createIncomingWebhook...");var i={type:t.CPaaSActionType.CREATE_INCOMING_WEBHOOK,createIncomingWebhook:e};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n)&&n(null,t.cpaas.createIncomingWebhookResult.webhook)}))},this.deleteIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteIncomingWebhook...");var i={type:t.CPaaSActionType.DELETE_INCOMING_WEBHOOK,deleteIncomingWebhook:{webhookId:e}};A(t.ContentType.CPAAS,i,B(n))},this.getIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getIncomingWebhook...");var i={type:t.CPaaSActionType.GET_INCOMING_WEBHOOK,getIncomingWebhook:{webhookId:e}};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n)&&n(null,t.cpaas.getIncomingWebhookResult.webhook)}))},this.getTenantBots=function(e){e=e||u,d.debug("[ClientApiHandler]: getTenantBots...");var n={type:t.CPaaSActionType.GET_TENANT_BOTS};A(t.ContentType.CPAAS,n,(function(t,n){f(t,n,e)&&e(null,n.cpaas.getTenantBotsResult.tenantBots)}))},this.getIncomingWebhooks=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getIncomingWebhooks...");var i={type:t.CPaaSActionType.GET_INCOMING_WEBHOOKS,getIncomingWebhooks:e};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n)&&(t.cpaas.getIncomingWebhooksResult.webhook=t.cpaas.getIncomingWebhooksResult.webhook||[],n(null,t.cpaas.getIncomingWebhooksResult))}))},this.suspendIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: suspendIncomingWebhook...");var i={type:t.CPaaSActionType.SUSPEND_INCOMING_WEBHOOK,suspendIncomingWebhook:{webhookId:e}};A(t.ContentType.CPAAS,i,B(n))},this.unsuspendIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unsuspendIncomingWebhook...");var i={type:t.CPaaSActionType.UNSUSPEND_INCOMING_WEBHOOK,unsuspendIncomingWebhook:{webhookId:e}};A(t.ContentType.CPAAS,i,B(n))},this.updateIncomingWebhook=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateIncomingWebhook...");var i={type:t.CPaaSActionType.UPDATE_INCOMING_WEBHOOK,updateIncomingWebhook:e};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n)&&n(null,t.cpaas.updateIncomingWebhookResult.webhook)}))},this.getExchangeSettings=function(e){e=e||u,d.debug("[ClientApiHandler]: getExchangeSettings...");var n={type:t.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:t.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}};A(t.ContentType.THIRDPARTYCONNECTORS,n,(function(t,n){f(t,n,e)&&e(null,n.thirdpartyconnectors.getSettings.exchange)}),null,["response.thirdpartyconnectors.getSettings.exchange"])},this.saveExchangeSettings=function(e,n){n=n||u,d.debug("[ClientApiHandler]: saveExchangeSettings..."),p&&(e.encryptionKey=String(Date.now()));var i={type:t.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:t.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:e}};A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.exchange)}),["request.thirdpartyconnectors.saveSettings.exchange"],["response.thirdpartyconnectors.saveSettings.exchange"])},this.getThirdpartyProviderSettings=function(e,n){if(n=n||u,e=e||{},d.debug("[ClientApiHandler]: getThirdpartyProviderSettings..."),p)_(n,null,{encryptionKey:e.emailAddress});else{var i={type:t.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:t.ThirdPartyConnectorType.CLIENT_THIRDPARTY}};A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getSettings.clientThirdparty)}),null,["response.thirdpartyconnectors.getSettings.clientThirdparty"])}},this.saveThirdpartyProviderSettings=function(e,n){if(n=n||u,e=e||{},d.debug("[ClientApiHandler]: saveThirdpartyProviderSettings..."),p)_(n,null,{encryptionKey:e.emailAddress});else{var i={type:t.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:t.ThirdPartyConnectorType.CLIENT_THIRDPARTY,clientThirdparty:{encryptionKey:""}}};A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.clientThirdparty)}),["request.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"],["response.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"])}},this.connectToThirdParty=function(e,n){var i;switch(n=n||u,d.debug("[ClientApiHandler]: connectToThirdParty "+e+"..."),e){case t.ThirdPartyConnectorType.BOX:case t.ThirdPartyConnectorType.ZAPIER:case t.ThirdPartyConnectorType.GOOGLE_CONTACTS:case t.ThirdPartyConnectorType.GOOGLE_DRIVE:case t.ThirdPartyConnectorType.ONE_DRIVE:case t.ThirdPartyConnectorType.CONCEPTBOARD:case t.ThirdPartyConnectorType.MEISTERTASK:case t.ThirdPartyConnectorType.MS_SHAREPOINT:i={type:t.ThirdPartyConnectorsActionType.CONNECT,connect:{type:e}};break;default:return void _(n,t.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,i){f(e,i,n)&&(i.thirdpartyconnectors.connect?n(null,i.thirdpartyconnectors.connect.authorizeUrl):n(t.ThirdPartyError.UNSUPPORTED_PROVIDER))}),null,["response.thirdpartyconnectors.connect.authorizeUrl"])},this.refreshConnectionToThirdParty=function(e,n,i){var r;if(i=i||u,d.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+e+"..."),e===t.ThirdPartyConnectorType.GOOGLE_CONTACTS){r={type:t.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:e,refreshToken:n}};A(t.ContentType.THIRDPARTYCONNECTORS,r,(function(e,n){f(e,n,i)&&(n.thirdpartyconnectors.refreshConnectionResult?i(null,n.thirdpartyconnectors.refreshConnectionResult):i(t.ThirdPartyError.UNSUPPORTED_PROVIDER))}),["request.thirdpartyconnectors.refreshConnection.refreshToken"],["response.thirdpartyconnectors.refreshConnectionResult"])}else _(i,t.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getFolderItems=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getFolderItems for ",e.provider),e.provider===t.ThirdPartyConnectorType.MS_SHAREPOINT&&!C.isSharepointSupported())return d.warn("[ClientApiHandler]: The getFolderItems operation for Sharepoint is not supported by the backend"),void _(n,t.ReturnCode.OPERATION_NOT_SUPPORTED);var i;switch(e.provider){case t.ThirdPartyConnectorType.BOX:i={type:t.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:e.provider,id:e.folderId,index:e.indexCursor,pageSize:e.pageSize}};break;case t.ThirdPartyConnectorType.GOOGLE_DRIVE:case t.ThirdPartyConnectorType.ONE_DRIVE:case t.ThirdPartyConnectorType.MS_SHAREPOINT:i={type:t.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:e.provider,syncpointId:e.syncpointId||void 0,id:e.folderId,siteId:e.siteId||void 0,driveId:e.driveId||void 0,folderType:e.folderType||void 0,contentType:e.contentType||void 0,cursor:e.indexCursor,pageSize:e.pageSize,accessToken:e.accessToken||void 0}};break;default:return void _(n,t.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(t,i){f(t,i,n)&&n(null,{folder:e.folderId,items:i.thirdpartyconnectors.getFolderItemsResult})}),["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"])},this.getConnectionStatus=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConnectionStatus "+e+"...");var i={type:t.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:e}};A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getConnectionStatus.connected)}))},this.disconnectFromThirdParty=function(e,n,i){var r;switch(i=i||u,d.debug("[ClientApiHandler]: disconnectFromThirdParty "+e+"..."),e){case t.ThirdPartyConnectorType.BOX:case t.ThirdPartyConnectorType.ZAPIER:case t.ThirdPartyConnectorType.GOOGLE_CONTACTS:case t.ThirdPartyConnectorType.GOOGLE_DRIVE:case t.ThirdPartyConnectorType.ONE_DRIVE:case t.ThirdPartyConnectorType.MEISTERTASK:case t.ThirdPartyConnectorType.MS_SHAREPOINT:r={type:t.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:e,accessToken:n||void 0}};break;default:return void _(i,t.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(t.ContentType.THIRDPARTYCONNECTORS,r,B(i),["request.thirdpartyconnectors.disconnect.accessToken"])},this.shareFolderItems=function(e,n){if(n=n||u,e){var i,r=e.provider,o=e.itemsData;if(d.debug("[ClientApiHandler]: shareFolderItems "+r+"..."),r===t.ThirdPartyConnectorType.MS_SHAREPOINT&&!C.isSharepointSupported())return d.warn("[ClientApiHandler]: The shareFolderItems operation for Sharepoint is not supported by the backend"),void _(n,t.ReturnCode.OPERATION_NOT_SUPPORTED);switch(r){case t.ThirdPartyConnectorType.BOX:case t.ThirdPartyConnectorType.ZAPIER:case t.ThirdPartyConnectorType.GOOGLE_DRIVE:case t.ThirdPartyConnectorType.ONE_DRIVE:case t.ThirdPartyConnectorType.MS_SHAREPOINT:i={type:t.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:r,shareItems:o,conversationId:e.convId,accessToken:e.accessToken||void 0}};break;default:return void _(n,t.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.shareFolderItems)}),["request.thirdpartyconnectors.shareFolderItems.accessToken"],["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"])}else _(n,t.ReturnCode.MISSING_REQUIRED_PARAMETER)},this.unshareItems=function(e,n){n=n||u,d.debug("[ClientApiHandler]: ushareItems "+e.provider+"..."),_(n,t.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getOAuthDataSession=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getOAuthDataSession...");var i={type:t.ThirdPartyConnectorsActionType.GET_OAUTH_DATA_SESSION,getOAuthDataSession:{provider:e}};A(t.ContentType.THIRDPARTYCONNECTORS,i,(function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getOAuthDataSessionResult)}),null,["response.thirdpartyconnectors.getOAuthDataSessionResult"])},this.getGlobalProperty=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getGlobalProperty...");var i={type:t.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:e}};A(t.ContentType.SYSTEM,i,(function(e,t){f(e,t,n)&&n(null,t.system.getGlobalPropertyResult.property)}))},this.getGlobalProperties=function(e,n){n=n||u,e instanceof Array||(e=[e]),d.debug("[ClientApiHandler]: getGlobalProperties...");var i={type:t.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:e}};A(t.ContentType.SYSTEM,i,(function(e,t){f(e,t,n)&&n(null,t.system.getGlobalPropertiesResult.property)}))},this.validateSessionInvite=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: validateSessionInvite...");var r={type:t.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:e},configurableTextsLanguage:n||void 0}};A(t.ContentType.GUEST,r,(function(e,t){f(e,t,i)&&i(null,t.guest.validateSessionInviteToken)}),null,["response.guest.validateSessionInviteToken.convTopic"])},this.validateSessionPin=function(e,n,i){if(i=i||u,d.debug("[ClientApiHandler]: validateSessionPin..."),!(e=e&&e.replace(/[^\d]/g,"")))return d.warn("[ClientApiHandler]: Invalid PIN"),void _(i,t.ReturnCode.SERVICE_EXCEPTION);var r={type:t.GuestActionType.VALIDATE_SESSION_PIN,validateSessionPIN:{pin:e,configurableTextLanguage:n||void 0}};A(t.ContentType.GUEST,r,(function(e,t){f(e,t,i)&&i(null,t.guest.validateSessionInviteToken)}),["request.guest.validateSessionPIN.pin"],["response.guest.validateSessionInviteToken.convTopic"])},this.getRegions=function(e,t){U(M.bind(this,e,t))},this.getJoiningInstructions=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getJoiningInstructions ...");var r={type:t.GuestActionType.GET_JOINING_INSTRUCTIONS,getJoiningInstructions:{token:{token:e},language:n}};A(t.ContentType.GUEST,r,(function(e,t){f(e,t,i)&&i(null,t.guest.getJoiningInstructionsResult)}),null,["response.guest.getJoiningInstructionsResult"])},this.registerSessionGuest=function(e,n){n=n||u,d.debug("[ClientApiHandler]: registerSessionGuest...");var i={type:t.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:e.token},firstName:e.firstName,lastName:e.lastName,forTestCall:e.testCall,locale:e.locale,userId:c||void 0,oldClientId:s||void 0,previousServer:l||void 0}};A(t.ContentType.GUEST,i,(function(e,t){if(f(e,t,n)){var i=t.guest.registerSessionGuestResult;I=r.convertVersionToNumber(i.apiVersion),l=i.connectedBackend,s=i.clientId,c=i.userId,n(null,i)}}),null,["response.guest.registerSessionGuestResult.guestContext"])},this.sendUserToUserRequest=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+e+", data: ",n);var r={type:t.ContentType.USER_TO_USER,userToUser:{type:e,routing:{destUserId:n.destUserId,srcUserId:c,destClientId:n.destClientId,srcClientId:s},data:JSON.stringify(n.content)}};A(t.ContentType.USER_TO_USER,r,(function(e,t){f(e,t,i)&&i(null,t.userToUser)}),["request.userToUser.userToUser.data"])},this.getPackages=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getPackages...");var i={type:t.AccountActionType.GET_ASSIGNED_PACKAGES};A(t.ContentType.ACCOUNT,i,(function(t,n){f(t,n,e)&&e(null,n.account.getAssignedPackages.packages||[])}),null,null,n)},this.getAccounts=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: getAccounts...");var r={type:t.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:e.searchCriterias,sorting:e.sorting,ordering:e.ordering,searchPointer:e.searchPointer,pageSize:e.pageSize,excludedTags:e.excludedTags}};A(t.ContentType.ACCOUNT,r,(function(e,t){f(e,t,n)&&n(null,t.account.getAccounts)}),null,["response.account.getAccounts.accounts"],i)},this.getAccountByUserId=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getAccountByUserId...");var i={type:t.AccountActionType.GET_ACCOUNT_BY_USER_ID,getAccountByUserId:{userId:e}};A(t.ContentType.ACCOUNT,i,(function(e,t){f(e,t,n)&&n(null,t.account.getAccountByUserId.account)}))},this.migrateAccount=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: migrateAccount...");var r={type:t.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:e.accountId,accountTemplateId:e.accountTemplateId}};A(t.ContentType.ACCOUNT,r,(function(e,t){f(e,t,n)&&n(null,t.account.migrateAccount)}),null,null,i)},this.migrateMultipleUsers=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: migrateMultipleUsers...");var r={type:t.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:e.accountIds,accountTemplateId:e.accountTemplateId}};A(t.ContentType.ACCOUNT,r,(function(e,t){f(e,t,n)&&n(null,t)}),null,null,i)},this.suspendAccount=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: suspendAccount...");var r={type:t.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:e}};A(t.ContentType.ACCOUNT,r,B(n),null,null,i)},this.unsuspendAccount=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: unsuspendAccount...");var r={type:t.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:e}};A(t.ContentType.ACCOUNT,r,B(n),null,null,i)},this.suspendUser=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: suspendUser...");var r={type:t.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.unsuspendUser=function(e,n,i){n=n||u,d.debug("[ClientApiHandler]: unsuspendUser...");var r={type:t.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:e}};A(t.ContentType.ADMINISTRATION,r,B(n),null,null,i)},this.assignTelephonyConfiguration=function(e,n,i,o){i=i||u,d.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var a={type:t.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:e,configuration:{phoneNumber:r.cleanPhoneNumber(n.phoneNumber),callerId:r.cleanPhoneNumber(n.callerId),reroutingPhoneNumber:r.cleanPhoneNumber(n.reroutingPhoneNumber),onsSipAuthenticationHash:n.onsSipAuthenticationHash||"",ondSipAuthenticationHash:n.ondSipAuthenticationHash||"",associatedTelephonyUserID:n.associatedTelephonyUserID||"",associatedTelephonyTrunkGroupId:n.associatedTelephonyTrunkGroupId||"",associatedTelephonyUserType:n.associatedTelephonyUserType||void 0}}};A(t.ContentType.ACCOUNT,a,B(i),["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"],null,o)},this.renewAssociatedTelephonyUser=function(e,n){n=n||u,d.debug("[ClientApiHandler]: renewAssociatedTelephonyUser...");var i={type:t.AccountActionType.RENEW_ASSOCIATED_TELEPHONY_USER,renewAssociatedTelephonyUser:{currentAssociatedTelephonyUserId:e}};A(t.ContentType.ACCOUNT,i,B(n))},this.getTechnicalAdminUserId=function(e,n){e=e||u,d.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var i={type:t.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};A(t.ContentType.ACCOUNT,i,(function(t,n){f(t,n,e)&&e(null,n.account.getTechnicalAdminUserIdResult.technicalAdminUserId)}),null,null,n)},this.addAccountPermission=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: addAccountPermission...");var r={type:t.AccountActionType.ADD_ACCOUNT_PERMISSION,addAccountPermission:{accountId:e,permissionName:n}};A(t.ContentType.ACCOUNT,r,B(i))},this.removeAccountPermission=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: removeAccountPermission...");var r={type:t.AccountActionType.REMOVE_ACCOUNT_PERMISSION,removeAccountPermission:{accountId:e,permissionName:n}};A(t.ContentType.ACCOUNT,r,B(i))},this.submitFormData=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: submitFormData...");var r={type:t.CPaaSActionType.SUBMIT_FORM_DATA,submitFormData:{itemId:e,form:n}};A(t.ContentType.CPAAS,r,B(i))},this.getUserData=function(e){e=e||u,d.debug("[ClientApiHandler]: getUserData...");var n={type:t.UserDataActionType.GET_USER_DATA};A(t.ContentType.USER_DATA,n,(function(t,n){f(t,n,e)&&e(null,n.userData.getUserData)}))},this.getTenantIntegrations=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getTenantIntegrations...");var i={type:t.CPaaSActionType.GET_TENANT_INTEGRATIONS,getTenantIntegrations:{state:e.state,pageSize:e.pageSize,searchPointer:e.searchPointer}};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n,!0)&&n(null,t.cpaas.getTenantIntegrationsResult.integrations||[])}))},this.getConversationIntegrations=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getConversationIntegrations...");var i={type:t.CPaaSActionType.GET_CONVERSATION_INTEGRATIONS,getConversationIntegrations:{convId:e.convId,pageSize:e.pageSize,searchPointer:e.searchPointer}};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n,!0)&&n(null,t.cpaas.getConversationIntegrationsResult.integrations||[])}))},this.getIntegrationData=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getIntegrationData...");var i={type:t.CPaaSActionType.GET_INTEGRATION_DATA,getIntegrationData:{key:e.key,type:e.type,payload:JSON.stringify({convId:e.convId})}};A(t.ContentType.CPAAS,i,(function(e,t){f(e,t,n)&&n(null,t.cpaas.getIntegrationDataResult)}))},this.enableConversationIntegration=function(e,n){n=n||u,d.debug("[ClientApiHandler]: enableConversationIntegration...");var i={type:t.CPaaSActionType.ENABLE_CONVERSATION_INTEGRATION,enableConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId,configMap:e.configMap}};A(t.ContentType.CPAAS,i,B(n))},this.updateConversationIntegration=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateConversationIntegration...");var i={type:t.CPaaSActionType.UPDATE_CONVERSATION_INTEGRATION,updateConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId,oldConvIntegrationId:e.oldConvIntegrationId,configMap:e.configMap}};A(t.ContentType.CPAAS,i,B(n))},this.disableConversationIntegration=function(e,n){n=n||u,d.debug("[ClientApiHandler]: disableConversationIntegration...");var i={type:t.CPaaSActionType.DISABLE_CONVERSATION_INTEGRATION,disableConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId}};A(t.ContentType.CPAAS,i,B(n))},this.createSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createSpace...");var i={type:t.SpaceActionType.CREATE,create:{name:e.name,type:e.type,accessModeType:e.accessModeType,status:e.status,description:e.description,smallPictureBase64:e.smallPictureBase64,largePictureBase64:e.largePictureBase64,tags:e.tags}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.createResult.space)}),["request.space.create.name","request.space.create.description","request.space.create.tags"],["response.space.createResult.space.name","response.space.createResult.space.description","response.space.createResult.space.tags"])},this.updateSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateSpace...");var i={type:t.SpaceActionType.UPDATE,update:{spaceId:e.spaceId,name:e.name||void 0,type:e.type,accessModeType:e.accessModeType,status:e.status,description:e.description,smallPictureBase64:e.smallPictureBase64,largePictureBase64:e.largePictureBase64,tags:e.tags,ownerId:e.ownerId,defaultRole:e.defaultRole,permissionAddParticipant:e.permissionAddParticipant,enableWikiPagesSetting:e.enableWikiPagesSetting,permissionAddWikiPage:e.permissionAddWikiPage}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.updateResult.space)}),["request.space.update.name","request.space.update.description","request.space.update.tags"],["response.space.updateResult.space.name","response.space.updateResult.space.description","response.space.updateResult.space.tags"])},this.deleteSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteSpace...");var i={type:t.SpaceActionType.DELETE,delete:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.subscribeForSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: subscribeForSpace...");var i={type:t.SpaceActionType.SUBSCRIBE,subscribe:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.unsubscribeForSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unsubscribeForSpace...");var i={type:t.SpaceActionType.UNSUBSCRIBE,unsubscribe:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.clearNCA=function(e){e=e||u,d.debug("[ClientApiHandler]: clearNCA...");var n={type:t.SpaceActionType.CLEAR_NCA};A(t.ContentType.SPACE,n,B(e))},this.getNCAData=function(e,n,i,r){if(r=r||u,d.debug("[ClientApiHandler]: getNCAData..."),!e)return d.warn("[ClientApiHandler]: Missing timestamp"),void _(r,t.ReturnCode.INVALID_MESSAGE);var o={type:t.SpaceActionType.GET_NCA_DATA,getNCAData:{timestamp:e,spaceId:n||void 0,topicId:i||void 0}};A(t.ContentType.SPACE,o,(function(e,t){f(e,t,r)&&r(null,t.space.getNCADataResult)}),null,["response.space.getNCADataResult.getTopicWithRepliesResult.topic.topic.subject","response.space.getNCADataResult.getTopicWithRepliesResult.topic.content","response.space.getNCADataResult.getTopicWithRepliesResult.topic.contentTags","response.space.getNCADataResult.getTopicWithRepliesResult.topic.poll.subject","response.space.getNCADataResult.getTopicWithRepliesResult.topic.poll.options.[].text","response.space.getNCADataResult.getTopicWithRepliesResult.topic.question.subject","response.space.getNCADataResult.getTopicWithRepliesResult.topic.tags","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].content","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].attachments","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].contentTags","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].sharedItems.[].containerName","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].sharedItems.[].topicSubject"])},this.existsSpaceName=function(e,n){n=n||u,d.debug("[ClientApiHandler]: existsSpaceName...");var i={type:t.SpaceActionType.EXISTS_SPACE_NAME,existsSpaceName:{spaceName:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.existsSpaceNameResult.exists)}),["request.space.existsSpaceName.spaceName"])},this.setGlobalSpacesConfiguration=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: setGlobalSpacesConfiguration..."),!e)return d.warn("[ClientApiHandler]: No settings were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.SpaceActionType.SET_GLOBAL_CONFIGURATION,setGlobalConfiguration:{globalSpaceCreationEnabled:!!e.globalSpaceCreationEnabled,allowExternalSpaceMembers:!!e.allowExternalSpaceMembers,defaultSpaceType:e.defaultSpaceType||t.SpaceType.SECRET}};A(t.ContentType.SPACE,i,B(n))},this.getGlobalSpacesConfiguration=function(e){e=e||u,d.debug("[ClientApiHandler]: getGlobalSpacesConfiguration...");var n={type:t.SpaceActionType.GET_GLOBAL_CONFIGURATION};A(t.ContentType.SPACE,n,(function(t,n){f(t,n,e)&&e(null,n.space.getGlobalConfigurationResult)}))},this.favoriteSpace=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: favoriteSpace...");var r={type:t.SpaceActionType.SET_FAVORITE_SPACE,setFavoriteSpace:{spaceId:e,position:n}};A(t.ContentType.SPACE,r,B(i))},this.unfavoriteSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unfavoriteSpace...");var i={type:t.SpaceActionType.REMOVE_FAVORITE_SPACE_MARKER,removeFavoriteSpaceMarker:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.getFavoriteSpaces=function(e){e=e||u,d.debug("[ClientApiHandler]: getFavoriteSpaces...");var n={type:t.SpaceActionType.GET_FAVORITE_SPACES};A(t.ContentType.SPACE,n,(function(n,i){i&&i.code===t.ReturnCode.NO_RESULT?e(null,{favoriteSpaces:[],maxFavoriteSpaces:0}):f(n,i,e)&&e(null,i.space.getFavoriteSpacesResult)}),null,["response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.name","response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.description","response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.tags"])},this.getSpaces=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: getSpaces...");var o={type:t.SpaceActionType.GET_SPACES,getSpaces:{number:e||void 0,timestamp:n||void 0,labelIds:i||void 0}};A(t.ContentType.SPACE,o,(function(e,t){f(e,t,r,!0)&&r(null,t.space.getSpacesResult.space||[])}),null,["response.space.getSpacesResult.space.[].name","response.space.getSpacesResult.space.[].description","response.space.getSpacesResult.space.[].tags"])},this.getSpacesByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSpacesByIds...");var i={type:t.SpaceActionType.GET_SPACES_BY_IDS,getSpacesByIds:{spaceIds:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n,!0)&&n(null,t.space.getSpacesByIdsResult.space||[])}),null,["response.space.getSpacesByIdsResult.space.[].name","response.space.getSpacesByIdsResult.space.[].description","response.space.getSpacesByIdsResult.space.[].tags"])},this.searchSpaceTags=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: searchSpaceSuggestedTags...");var r={type:t.SpaceActionType.SEARCH_TAGS,searchTags:{queryTag:e,numberOfResults:n||void 0}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i,!0)&&i(null,t.space.searchTagsResult.tags||[])}),null,["response.space.searchTagsResult.tags"])},this.getSpacesDirectory=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSpacesDirectory...");var i={type:t.SpaceActionType.GET_DIRECTORY,getDirectory:{sortBy:e.sortBy,sortOrder:e.sortOrder,filter:e.filter||void 0,query:e.query||void 0,numberOfResults:e.numberOfResults||void 0,pagePointer:e.pagePointer||void 0}};A(t.ContentType.SPACE,i,(function(e,i){i&&i.code===t.ReturnCode.NO_RESULT?n(null,{space:[],hasMore:!1}):f(e,i,n)&&n(null,i.space.getDirectoryResult)}),null,["response.space.getDirectoryResult.space.[].name","response.space.getDirectoryResult.space.[].description","response.space.getDirectoryResult.space.[].tags"])},this.getSpacesAdminDirectory=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSpacesAdminDirectory...");var i={type:t.SpaceActionType.GET_ADMIN_DIRECTORY,getAdminDirectory:{sortBy:e.sortBy,sortOrder:e.sortOrder,filter:e.filter||void 0,query:e.query||void 0,numberOfResults:e.numberOfResults||void 0,pagePointer:e.pagePointer||void 0}};A(t.ContentType.SPACE,i,(function(e,i){i&&i.code===t.ReturnCode.NO_RESULT?n(null,{space:[],hasMore:!1}):f(e,i,n)&&n(null,i.space.getAdminDirectoryResult)}),null,["response.space.getAdminDirectoryResult.space.[].name","response.space.getAdminDirectoryResult.space.[].description","response.space.getAdminDirectoryResult.space.[].tags"])},this.selectSpace=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: selectSpace...");var r={type:t.SpaceActionType.SELECT_SPACE,selectSpace:{spaceId:e,numberOfResults:n||void 0}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i)&&i(null,t.space.selectSpaceResult)}),null,["response.space.selectSpaceResult.space.name","response.space.selectSpaceResult.space.description","response.space.selectSpaceResult.space.tags","response.space.selectSpaceResult.welcomeBox","response.space.selectSpaceResult.items.[].topic.subject","response.space.selectSpaceResult.items.[].poll.subject","response.space.selectSpaceResult.items.[].poll.options.[].text","response.space.selectSpaceResult.items.[].question.subject","response.space.selectSpaceResult.items.[].content","response.space.selectSpaceResult.items.[].attachments","response.space.selectSpaceResult.items.[].contentTags","response.space.selectSpaceResult.items.[].tags","response.space.selectSpaceResult.pinnedTopics.[].subject"])},this.getParticipantsImportData=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getParticipantsImportData...");var i={type:t.SpaceActionType.GET_PARTICIPANTS_IMPORT_DATA,getParticipantsImportData:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.getParticipantsImportDataResult)}))},this.getSpacePreviewData=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getSpacePreviewData...");var r={type:t.SpaceActionType.GET_SPACE_PREVIEW_DATA,getSpacePreviewData:{spaceId:e,itemId:n||void 0}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i)&&i(null,t.space.getSpacePreviewDataResult)}),null,["response.space.getSpacePreviewDataResult.space.name","response.space.getSpacePreviewDataResult.space.description","response.space.getSpacePreviewDataResult.space.tags","response.space.getSpacePreviewDataResult.parentItem.topic.subject","response.space.getSpacePreviewDataResult.parentItem.poll.subject","response.space.getSpacePreviewDataResult.parentItem.poll.options.[].text","response.space.getSpacePreviewDataResult.parentItem.question.subject","response.space.getSpacePreviewDataResult.parentItem.content","response.space.getSpacePreviewDataResult.parentItem.contentTags","response.space.getSpacePreviewDataResult.parentItem.attachments","response.space.getSpacePreviewDataResult.parentItem.tags","response.space.getSpacePreviewDataResult.reply.content","response.space.getSpacePreviewDataResult.reply.attachments","response.space.getSpacePreviewDataResult.reply.contentTags"])},this.addSpaceParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: addSpaceParticipants...");var r={type:t.SpaceActionType.ADD_PARTICIPANTS,addParticipants:{spaceId:e,participants:n}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i)&&i(null,t.space.addParticipantsResult)}))},this.addSpaceParticipantsSearch=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: addSpaceParticipantsSearch...");var r={type:t.SpaceActionType.ADD_PARTICIPANTS_SEARCH,addParticipantsSearch:{spaceId:e,query:n}};A(t.ContentType.SPACE,r,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?i(null,{participants:[],hasMore:!1}):f(e,n,i)&&i(null,n.space.addParticipantsSearchResult)}))},this.updateSpaceParticipant=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: updateSpaceParticipant...");var r={type:t.SpaceActionType.UPDATE_PARTICIPANT,updateParticipant:{spaceId:e,userId:n.userId,role:n.role}};A(t.ContentType.SPACE,r,B(i))},this.removeSpaceParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: removeSpaceParticipants...");var r={type:t.SpaceActionType.REMOVE_PARTICIPANTS,removeParticipants:{spaceId:e,userIds:n}};A(t.ContentType.SPACE,r,B(i))},this.importSpaceParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: importSpaceParticipants...");var r={type:t.SpaceActionType.IMPORT_PARTICIPANTS,importParticipants:{spaceId:e,fileId:n}};A(t.ContentType.SPACE,r,B(i))},this.getSpaceParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getSpaceParticipants..."),n=n||{};var r={type:t.SpaceActionType.GET_PARTICIPANTS,getParticipants:{spaceId:e,sortBy:n.sortBy,sortOrder:n.sortOrder,filter:n.filter||void 0,query:n.query||"",pagePointer:n.pagePointer||void 0,numberOfResults:n.numberOfResults||void 0}};A(t.ContentType.SPACE,r,(function(e,n){if(n&&n.code===t.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,n,i)){var r=n.space.getParticipantsResult;r.participants=r.participants||[],i(null,r)}}))},this.getSpacePendingParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getSpacePendingParticipants...");var r={type:t.SpaceActionType.GET_PENDING_PARTICIPANTS,getPendingParticipants:{spaceId:e,pagePointer:n&&n.pagePointer||void 0,numberOfResults:n&&n.numberOfResults||void 0}};A(t.ContentType.SPACE,r,(function(e,n){if(n&&n.code===t.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,n,i)){var r=n.space.getPendingParticipantsResult;r.participants=r.participants||[],i(null,r)}}))},this.searchSpaceParticipants=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: searchSpaceParticipants...");var r={type:t.SpaceActionType.SEARCH_SPACE_PARTICIPANTS,searchSpaceParticipants:{spaceId:e,query:n}};A(t.ContentType.SPACE,r,(function(e,n){if(n&&n.code===t.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,n,i)){var r=n.space.searchSpaceParticipantsResult;r.participants=r.participants||[],i(null,r)}}))},this.joinSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: joinSpace...");var i={type:t.SpaceActionType.JOIN,join:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.joinResult.space)}),null,["response.space.joinResult.space.name","response.space.joinResult.space.description","response.space.joinResult.space.tags"])},this.leaveSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: leaveSpace...");var i={type:t.SpaceActionType.LEAVE,leave:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.requestSpaceAccess=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: requestSpaceAccess...");var r={type:t.SpaceActionType.REQUEST_ACCESS,requestAccess:{spaceId:e,reason:n}};A(t.ContentType.SPACE,r,B(i),["request.space.requestAccess.reason"])},this.grantSpaceAccess=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: grantSpaceAccess...");var r={type:t.SpaceActionType.GRANT_ACCESS,grantAccess:{spaceId:e,userId:n}};A(t.ContentType.SPACE,r,B(i))},this.denySpaceAccess=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: denySpaceAccess...");var o={type:t.SpaceActionType.DENY_ACCESS,denyAccess:{spaceId:e,userId:n,reason:i}};A(t.ContentType.SPACE,o,B(r),["request.space.denyAccess.reason"])},this.isExternalParticipantInSpace=function(e,n){n=n||u,d.debug("[ClientApiHandler]: isExternalParticipantInSpace...");var i={type:t.SpaceActionType.IS_EXTERNAL_PARTICIPANT_IN_SPACE,isExternalParticipantInSpace:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.isExternalParticipantInSpaceResult.atLeastOneExternalParticipant)}))},this.updateSpaceReadTimestamp=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: updateSpaceReadTimestamp...");var r={type:t.SpaceActionType.UPDATE_READ_TIMESTAMP,updateReadTimestamp:{spaceId:e,timestamp:n}};A(t.ContentType.SPACE,r,B(i))},this.assignSpaceLabels=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: assignSpaceLabels...");var r={type:t.SpaceActionType.ASSIGN_LABELS,assignLabels:{spaceId:e,labelIds:n}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i,!0)&&i(null,t.space.assignLabelsResult.labelIds||[])}))},this.unassignSpaceLabels=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: unassignSpaceLabels...");var r={type:t.SpaceActionType.UNASSIGN_LABELS,unassignLabels:{spaceId:e,labelIds:n}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i,!0)&&i(null,t.space.unassignLabelsResult.labelIds||[])}))},this.getSpaceTopics=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: getSpaceTopics...");var o={type:t.SpaceActionType.GET_TOPICS,getTopics:{spaceId:e,number:n||void 0,timestamp:i||void 0}};A(t.ContentType.SPACE,o,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?r(null,{items:[],hasMore:!1}):f(e,n,r)&&r(null,n.space.getTopicsResult)}),null,["response.space.getTopicsResult.items.[].topic.subject","response.space.getTopicsResult.items.[].poll.options.[].text","response.space.getTopicsResult.items.[].poll.subject","response.space.getTopicsResult.items.[].question.subject","response.space.getTopicsResult.items.[].content","response.space.getTopicsResult.items.[].attachments","response.space.getTopicsResult.items.[].contentTags","response.space.getTopicsResult.items.[].tags","response.space.getTopicsResult.items.[].sharedItems.[].containerName","response.space.getTopicsResult.items.[].sharedItems.[].topicSubject"])},this.getSpaceTopicWithReplies=function(e,n,i,r,o,a){a=a||u,d.debug("[ClientApiHandler]: getSpaceTopicWithReplies...");var s={type:t.SpaceActionType.GET_TOPIC_WITH_REPLIES,getTopicWithReplies:{topicId:e,timestamp:n||void 0,minResults:i||void 0,maxResults:r||void 0,matchingItemIds:o||void 0}};A(t.ContentType.SPACE,s,(function(e,t){f(e,t,a)&&a(null,t.space.getTopicWithRepliesResult)}),null,["response.space.getTopicWithRepliesResult.topic.topic.subject","response.space.getTopicWithRepliesResult.topic.content","response.space.getTopicWithRepliesResult.topic.contentTags","response.space.getTopicWithRepliesResult.topic.tags","response.space.getTopicWithRepliesResult.topic.poll.subject","response.space.getTopicWithRepliesResult.topic.poll.options.[].text","response.space.getTopicWithRepliesResult.topic.question.subject","response.space.getTopicWithRepliesResult.replies.[].content","response.space.getTopicWithRepliesResult.replies.[].attachments","response.space.getTopicWithRepliesResult.replies.[].contentTags","response.space.getTopicWithRepliesResult.replies.[].sharedItems.[].containerName","response.space.getTopicWithRepliesResult.replies.[].sharedItems.[].topicSubject","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.content","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.attachments","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.contentTags","response.space.getTopicWithRepliesResult.additionalReplies.[].sharedItems.[].containerName","response.space.getTopicWithRepliesResult.additionalReplies.[].sharedItems.[].topicSubject"])},this.getOpenSpacePolls=function(e,n,i,r){if(r=r||u,d.debug("[ClientApiHandler]: getOpenSpacePolls..."),G("getOpenSpacePolls",r)){var o={type:t.SpaceActionType.GET_OPEN_POLLS,getOpenPolls:{spaceId:e,searchPointer:n||void 0,numberOfResults:i||void 0}};A(t.ContentType.SPACE,o,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?r(null,{openPolls:[],hasMore:!1}):f(e,n,r)&&r(null,n.space.getOpenPollsResult)}),null,["response.space.getOpenPollsResult.openPolls.[].subject"])}},this.getOpenSpaceQuestions=function(e,n,i,r){if(r=r||u,d.debug("[ClientApiHandler]: getOpenSpaceQuestions..."),H("getOpenSpaceQuestions",r)){var o={type:t.SpaceActionType.GET_OPEN_QUESTIONS,getOpenQuestions:{spaceId:e,searchPointer:n||void 0,numberOfResults:i||void 0}};A(t.ContentType.SPACE,o,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?r(null,{openQuestions:[],hasMore:!1}):f(e,n,r)&&r(null,n.space.getOpenQuestionsResult)}),null,["response.space.getOpenQuestionsResult.openQuestions.[].subject"])}},this.getSpaceReplies=function(e,n,i,r,o){o=o||u,d.debug("[ClientApiHandler]: getSpaceReplies...");var a={type:t.SpaceActionType.GET_REPLIES,getReplies:{topicId:e,timestamp:n||void 0,numberOfResults:i||void 0,direction:r||void 0}};A(t.ContentType.SPACE,a,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?o(null,{items:[],hasMore:!1}):f(e,n,o)&&o(null,n.space.getRepliesResult)}),null,["response.space.getRepliesResult.items.[].content","response.space.getRepliesResult.items.[].attachments","response.space.getRepliesResult.items.[].contentTags","response.space.getRepliesResult.items.[].tags","response.space.getRepliesResult.items.[].sharedItems.[].containerName","response.space.getRepliesResult.items.[].sharedItems.[].topicSubject"])},this.getSpaceMatchingReplies=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getSpaceMatchingReplies...");var r={type:t.SpaceActionType.GET_MATCHING_REPLIES,getMatchingReplies:{topic:e,itemIds:n}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i,!0)&&i(null,t.space.getMatchingRepliesResult.linkedReplies||[])}),null,["response.space.getMatchingRepliesResult.linkedReplies.[].reply.content","response.space.getMatchingRepliesResult.linkedReplies.[].reply.attachments","response.space.getMatchingRepliesResult.linkedReplies.[].reply.contentTags","response.space.getMatchingRepliesResult.linkedReplies.[].sharedItems.[].containerName","response.space.getMatchingRepliesResult.linkedReplies.[].sharedItems.[].topicSubject"])},this.getSpaceItemsByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSpaceItemsByIds...");var i={type:t.SpaceActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n,!0)&&n(null,t.space.getItemsByIdsResult.items)}),null,["response.space.getItemsByIdsResult.items.[].topic.subject","response.space.getItemsByIdsResult.items.[].poll.subject","response.space.getItemsByIdsResult.items.[].poll.options.[].text","response.space.getItemsByIdsResult.items.[].question.subject","response.space.getItemsByIdsResult.items.[].content","response.space.getItemsByIdsResult.items.[].attachments","response.space.getItemsByIdsResult.items.[].contentTags","response.space.getItemsByIdsResult.items.[].tags","response.space.getItemsByIdsResult.items.[].sharedItems.[].containerName","response.space.getItemsByIdsResult.items.[].sharedItems.[].topicSubject"])},this.createSpaceTopic=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createSpaceTopic...");var i={type:t.SpaceActionType.CREATE_TOPIC,createTopic:{spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.createTopicResult.item.sanitized=S,n(null,t.space.createTopicResult.item))}),["request.space.createTopic.subject","request.space.createTopic.content","request.space.createTopic.attachments.[].fileName","request.space.createTopic.contentTags","request.space.createTopic.tags"],["response.space.createTopicResult.item.topic.subject","response.space.createTopicResult.item.content","response.space.createTopicResult.item.attachments","response.space.createTopicResult.item.contentTags","response.space.createTopicResult.item.tags"])},this.createSpacePoll=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: createSpacePoll..."),G("createSpacePoll",n)){var i={type:t.SpaceActionType.CREATE_POLL,createPoll:{spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,options:e.options||void 0,voteMultipleOptions:v(e.voteMultipleOptions),hideVoterIdentity:v(e.hideVoterIdentity),hideOpenVoteResults:v(e.hideOpenVoteResults),duration:e.duration||void 0,status:e.status}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.createPollResult.item.sanitized=S,n(null,t.space.createPollResult.item))}),["request.space.createPoll.subject","request.space.createPoll.content","request.space.createPoll.attachments.[].fileName","request.space.createPoll.contentTags","request.space.createPoll.tags","request.space.createPoll.options"],["response.space.createPollResult.item.subject","response.space.createPollResult.item.content","response.space.createPollResult.item.attachments","response.space.createPollResult.item.contentTags","response.space.createPollResult.item.tags","response.space.createPollResult.item.poll.options.[].text"])}},this.createSpaceQuestion=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: createSpaceQuestion..."),H("createSpaceQuestion",n)){var i={type:t.SpaceActionType.CREATE_QUESTION,createQuestion:{spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.createQuestionResult.item.sanitized=S,n(null,t.space.createQuestionResult.item))}),["request.space.createQuestion.subject","request.space.createQuestion.content","request.space.createQuestion.attachments.[].fileName","request.space.createQuestion.contentTags","request.space.createQuestion.tags"],["response.space.createQuestionResult.item.question.subject","response.space.createQuestionResult.item.content","response.space.createQuestionResult.item.attachments","response.space.createQuestionResult.item.contentTags","response.space.createQuestionResult.item.tags"])}},this.createSpaceReply=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createSpaceReply...");var i={type:t.SpaceActionType.CREATE_REPLY,createReply:{topicId:e.topicId,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,sharedItems:e.sharedItems||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.createReplyResult.item.sanitized=S,n(null,t.space.createReplyResult.item))}),["request.space.createReply.content","request.space.createReply.attachments.[].fileName","request.space.createReply.contentTags"],["response.space.createReplyResult.item.content","response.space.createReplyResult.item.attachments","response.space.createReplyResult.item.contentTags","response.space.createReplyResult.item.sharedItems.[].containerName","response.space.createReplyResult.item.sharedItems.[].topicSubject"])},this.updateSpaceTopic=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateSpaceTopic...");var i={type:t.SpaceActionType.UPDATE_TOPIC,updateTopic:{topicId:e.topicId,subject:e.subject,content:e.content,mentionedUsers:e.mentionedUsers,attachments:e.attachments,externalAttachments:e.externalAttachments,formMetaData:e.formMetaData,preview:e.preview,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.updateTopicResult.item.sanitized=S,n(null,t.space.updateTopicResult.item))}),["request.space.updateTopic.subject","request.space.updateTopic.content","request.space.updateTopic.attachments.[].fileName","request.space.updateTopic.contentTags","request.space.updateTopic.tags"],["response.space.updateTopicResult.item.topic.subject","response.space.updateTopicResult.item.content","response.space.updateTopicResult.item.attachments","response.space.updateTopicResult.item.contentTags","response.space.updateTopicResult.item.tags"])},this.updateSpacePoll=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: updateSpacePoll..."),G("updateSpacePoll",n)){var i={type:t.SpaceActionType.UPDATE_POLL,updatePoll:{itemId:e.itemId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,options:e.options||void 0,voteMultipleOptions:v(e.voteMultipleOptions),hideVoterIdentity:v(e.hideVoterIdentity),hideOpenVoteResults:v(e.hideOpenVoteResults),duration:e.duration||void 0,status:e.status}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.updatePollResult.item.sanitized=S,n(null,t.space.updatePollResult.item))}),["request.space.updatePoll.subject","request.space.updatePoll.content","request.space.updatePoll.attachments.[].fileName","request.space.updatePoll.contentTags","request.space.updatePoll.tags","request.space.updatePoll.options.[].text"],["response.space.updatePollResult.item.subject","response.space.updatePollResult.item.content","response.space.updatePollResult.item.attachments","response.space.updatePollResult.item.contentTags","response.space.updatePollResult.item.tags","response.space.updatePollResult.item.poll.subject","response.space.updatePollResult.item.poll.options.[].text"])}},this.updateSpaceQuestion=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: updateSpaceQuestion..."),H("updateSpaceQuestion",n)){var i={type:t.SpaceActionType.UPDATE_QUESTION,updateQuestion:{itemId:e.itemId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.updateQuestionResult.item.sanitized=S,n(null,t.space.updateQuestionResult.item))}),["request.space.updateQuestion.subject","request.space.updateQuestion.content","request.space.updateQuestion.attachments.[].fileName","request.space.updateQuestion.contentTags","request.space.updateQuestion.tags","request.space.updateQuestion.options.[].text"],["response.space.updateQuestionResult.item.subject","response.space.updateQuestionResult.item.content","response.space.updateQuestionResult.item.attachments","response.space.updateQuestionResult.item.contentTags","response.space.updateQuestionResult.item.tags","response.space.updateQuestionResult.item.question.subject"])}},this.updateSpaceReply=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateSpaceReply...");var i={type:t.SpaceActionType.UPDATE_REPLY,updateReply:{replyId:e.replyId,content:e.content,mentionedUsers:e.mentionedUsers,attachments:e.attachments,externalAttachments:e.externalAttachments,formMetaData:e.formMetaData,preview:e.preview,complex:v(e.complex),contentTags:e.contentTags||void 0,sharedItems:e.sharedItems||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.updateReplyResult.item.sanitized=S,n(null,t.space.updateReplyResult.item))}),["request.space.updateReply.content","request.space.updateReply.attachments.[].fileName","request.space.updateReply.contentTags"],["response.space.updateReplyResult.item.content","response.space.updateReplyResult.item.attachments","response.space.updateReplyResult.item.contentTags","response.space.updateReplyResult.item.sharedItems.[].containerName","response.space.updateReplyResult.item.sharedItems.[].topicSubject"])},this.deleteSpaceItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteSpaceItem...");var i={type:t.SpaceActionType.DELETE_ITEM,deleteItem:{itemId:e}};A(t.ContentType.SPACE,i,B(n))},this.closeSpacePoll=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: closeSpacePoll..."),G("closeSpacePoll",n)){var i={type:t.SpaceActionType.CLOSE_POLL,closePoll:{itemId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.closePollResult.item.sanitized=S,n(null,t.space.closePollResult.item))}),null,["response.space.closePollResult.item.content","response.space.closePollResult.item.attachments","response.space.closePollResult.item.contentTags","response.space.closePollResult.item.sharedItems.[].containerName","response.space.closePollResult.item.sharedItems.[].topicSubject","response.space.closePollResult.item.poll.options.[].text","response.space.closePollResult.item.poll.subject"])}},this.voteSpacePoll=function(e,n,i){if(i=i||u,d.debug("[ClientApiHandler]: voteSpacePoll..."),G("voteSpacePoll",i)){var r={type:t.SpaceActionType.VOTE_POLL_OPTIONS,votePollOptions:{itemId:e,optionIds:n}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i)&&(t.space.votePollOptionsResult.item.sanitized=S,i(null,t.space.votePollOptionsResult.item))}),null,["response.space.votePollOptionsResult.item.content","response.space.votePollOptionsResult.item.attachments","response.space.votePollOptionsResult.item.contentTags","response.space.votePollOptionsResult.item.sharedItems.[].containerName","response.space.votePollOptionsResult.item.sharedItems.[].topicSubject","response.space.votePollOptionsResult.item.poll.options.[].text","response.space.votePollOptionsResult.item.poll.subject"])}},this.getSpacePollOptionVoters=function(e,n,i,r){if(r=r||u,d.debug("[ClientApiHandler]: getSpacePollOptionVoters..."),G("getSpacePollOptionVoters",r)){var o={type:t.SpaceActionType.GET_POLL_OPTION_VOTERS,getPollOptionVoters:{itemId:e,optionId:n,searchPointer:i&&i.searchPointer||void 0,numberOfResults:i&&i.numberOfResults||void 0}};A(t.ContentType.SPACE,o,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?r(null,{participants:[],hasMore:!1}):f(e,n,r)&&r(null,n.space.getPollOptionVotersResult)}))}},this.getSpaceLikes=function(e,n,i,r){r=r||u,d.debug("[ClientApiHandler]: getSpaceLikes...");var o={type:t.SpaceActionType.GET_LIKES,getLikes:{itemId:e,searchPointer:n||void 0,numberOfResults:i||void 0}};A(t.ContentType.SPACE,o,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?r(null,{participants:[],hasMore:!1}):f(e,n,r)&&r(null,n.space.getLikesResult)}))},this.likeSpaceItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: likeSpaceItem...");var i={type:t.SpaceActionType.LIKE,like:{itemId:e}};A(t.ContentType.SPACE,i,B(n))},this.unlikeSpaceItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unlikeSpaceItem...");var i={type:t.SpaceActionType.UNLIKE,unlike:{itemId:e}};A(t.ContentType.SPACE,i,B(n))},this.markBestSpaceAnswer=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: markBestSpaceAnswer..."),H("markBestSpaceAnswer",n)){var i={type:t.SpaceActionType.MARK_BEST_ANSWER,markBestAnswer:{itemId:e}};A(t.ContentType.SPACE,i,B(n))}},this.unmarkBestSpaceAnswer=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: unmarkBestSpaceAnswer..."),H("unmarkBestSpaceAnswer",n)){var i={type:t.SpaceActionType.UNMARK_BEST_ANSWER,unmarkBestAnswer:{itemId:e}};A(t.ContentType.SPACE,i,B(n))}},this.getFlaggedSpaceItemsCount=function(e){e=e||u,d.debug("[ClientApiHandler]: getFlaggedSpaceItemsCount...");var n={type:t.SpaceActionType.GET_FLAGGED_ITEMS_COUNT};A(t.ContentType.SPACE,n,(function(t,n){f(t,n,e)&&e(null,n.space.getFlaggedItemsCountResult.flaggedItemsCount)}))},this.getFlaggedSpaceItems=function(e,n,i,r,o){o=o||u,d.debug("[ClientApiHandler]: getFlaggedSpaceItems...");var a={type:t.SpaceActionType.GET_FLAGGED_ITEMS,getFlaggedItems:{timestamp:e||void 0,direction:n||void 0,searchPointer:i||void 0,numberOfResults:r||void 0}};A(t.ContentType.SPACE,a,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?o(null,{items:[],hasMore:!1}):f(e,n,o)&&o(null,n.space.getFlaggedItemsResult)}),null,["response.space.getFlaggedItemsResult.items.[].space.name","response.space.getFlaggedItemsResult.items.[].space.description","response.space.getFlaggedItemsResult.items.[].space.tags","response.space.getFlaggedItemsResult.items.[].parentTopic.topic.subject","response.space.getFlaggedItemsResult.items.[].parentTopic.content","response.space.getFlaggedItemsResult.items.[].parentTopic.poll.subject","response.space.getFlaggedItemsResult.items.[].parentTopic.question.subject","response.space.getFlaggedItemsResult.items.[].item.poll.subject","response.space.getFlaggedItemsResult.items.[].item.question.subject","response.space.getFlaggedItemsResult.items.[].item.topic.subject","response.space.getFlaggedItemsResult.items.[].item.topic.content","response.space.getFlaggedItemsResult.items.[].item.content","response.space.getFlaggedItemsResult.items.[].item.attachments","response.space.getFlaggedItemsResult.items.[].item.contentTags","response.space.getFlaggedItemsResult.items.[].item.tags","response.space.getFlaggedItemsResult.items.[].item.sharedItems.[].containerName","response.space.getFlaggedItemsResult.items.[].item.sharedItems.[].topicSubject"])},this.getFlaggedSpaceItemsByIds=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getFlaggedSpaceItemsByIds...");var i={type:t.SpaceActionType.GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID,getSpaceItemsByIdsWithTopicAndSpaceId:{itemIds:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n,!0)&&n(null,t.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult)}),null,["response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.name","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.description","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.tags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.topic.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.poll.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.question.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.poll.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.question.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.topic.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.topic.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.attachments","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.contentTags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.tags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.sharedItems.[].containerName","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.sharedItems.[].topicSubject"])},this.flagSpaceItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: flagSpaceItem...");var i={type:t.SpaceActionType.FLAG,flag:{itemId:e}};A(t.ContentType.SPACE,i,B(n))},this.unflagSpaceItem=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unflagSpaceItem...");var i={type:t.SpaceActionType.UNFLAG,unflag:{itemId:e}};A(t.ContentType.SPACE,i,B(n))},this.pinSpaceTopic=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: pinSpaceTopic...");var r={type:t.SpaceActionType.PIN_TOPIC,pinTopic:{topicId:e,position:n}};A(t.ContentType.SPACE,r,B(i))},this.unpinSpaceTopic=function(e,n){n=n||u,d.debug("[ClientApiHandler]: unpinSpaceTopic...");var i={type:t.SpaceActionType.UNPIN_TOPIC,unpinTopic:{topicId:e}};A(t.ContentType.SPACE,i,B(n))},this.getPinnedSpaceTopics=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getPinnedSpaceTopics...");var i={type:t.SpaceActionType.GET_PINNED_TOPICS,getPinnedTopics:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,i){i&&i.code===t.ReturnCode.NO_RESULT?n(null,{topics:[],maxPinnedTopics:0}):f(e,i,n)&&n(null,i.space.getPinnedTopicsResult)}),null,["response.space.getPinnedTopicsResult.topics.[].subject"])},this.setSpaceWelcomeBox=function(e,n){n=n||u,d.debug("[ClientApiHandler]: setSpaceWelcomeBox...");var i={type:t.SpaceActionType.SET_WELCOME_BOX,setWelcomeBox:{spaceId:e.spaceId,content:e.content||void 0,attachments:e.attachments||void 0,formMetaData:e.formMetaData||void 0,complex:v(e.complex),displayWelcomeBox:v(e.displayWelcomeBox)}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.setWelcomeBoxResult.item)}),["request.space.setWelcomeBox.content","request.space.setWelcomeBox.attachments.[].fileName"],["response.space.setWelcomeBoxResult.item.content","response.space.setWelcomeBoxResult.item.attachments"])},this.getSpaceWelcomeBox=function(e,n){n=n||u,d.debug("[ClientApiHandler]: getSpaceWelcomeBox...");var i={type:t.SpaceActionType.GET_WELCOME_BOX,getWelcomeBox:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.getWelcomeBoxResult.item)}),null,["response.space.getWelcomeBoxResult.item.content","response.space.getWelcomeBoxResult.item.attachments"])},this.deleteSpaceWelcomeBox=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteSpaceWelcomeBox...");var i={type:t.SpaceActionType.DELETE_WELCOME_BOX,deleteWelcomeBox:{spaceId:e}};A(t.ContentType.SPACE,i,B(n))},this.getSpaceFiles=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: getSpaceFiles...");var r={type:t.SpaceActionType.GET_SPACE_FILES,getSpaceFiles:{spaceId:e,sortedBy:n.sortBy,sortOrder:n.sortOrder,query:n.query||void 0,pagePointer:n.searchPointer||void 0,numberOfResults:n.numberOfResults||void 0}};A(t.ContentType.SPACE,r,(function(e,n){n&&n.code===t.ReturnCode.NO_RESULT?i(null,{documents:[],hasMore:!1}):f(e,n,i)&&i(null,n.space.getSpaceFilesResult)}))},this.updateSpaceTopicTags=function(e,n,i){i=i||u,d.debug("[ClientApiHandler]: updateSpaceTopicTags...");var r={type:t.SpaceActionType.UPDATE_TOPIC_TAGS,updateTopicTags:{topicId:e,tags:n||void 0}};A(t.ContentType.SPACE,r,(function(e,t){f(e,t,i)&&i(null,t.space.updateTopicTagsResult.item)}),["request.space.updateTopicTags.tags"],["response.space.updateTopicTagsResult.item.topic.subject","response.space.updateTopicTagsResult.item.poll.subject","response.space.updateTopicTagsResult.item.poll.options.[].text","response.space.updateTopicTagsResult.item.question.subject","response.space.updateTopicTagsResult.item.content","response.space.updateTopicTagsResult.item.attachments","response.space.updateTopicTagsResult.item.contentTags","response.space.updateTopicTagsResult.item.tags"])},this.startBasicSpaceSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: startBasicSpaceSearch...");var i={type:t.SpaceActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e.searchTerms,prioritySpaces:e.prioritySpaces||void 0,resultSetLimit:e.resultSetLimit||0,searchId:e.searchId||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.startBasicSearchResult.searchId)}))},this.startDetailSpaceSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: startDetailSpaceSearch...");var i={type:t.SpaceActionType.START_DETAILED_SEARCH,startDetailedSearch:{searchTerm:e.searchTerm,spaceId:e.spaceId,resultSetLimit:e.resultSetLimit||0,searchId:e.searchId||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.startDetailedSearchResult.searchId)}))},this.cancelSpaceSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: cancelSpaceSearch...");var i={type:t.SpaceActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};A(t.ContentType.SPACE,i,B(n))},this.addRecentSpaceSearch=function(e,n){n=n||u,d.debug("[ClientApiHandler]: addRecentSpaceSearch...");var i={type:t.SpaceActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};A(t.ContentType.SPACE,i,B(n))},this.createSpaceWiki=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: create SpaceWiki..."),V("createSpaceWiki",n)){var i={type:t.SpaceActionType.CREATE_WIKI,createWiki:{spaceId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.createWikiResult.rootPage)}))}},this.getSpaceWikiPage=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getSpaceWikiPage..."),V("getSpaceWikiPage",n)){var i={type:t.SpaceActionType.GET_WIKI_PAGE,getWikiPage:{pageId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.getWikiPageResult.page)}),null,["response.space.getWikiPageResult.page.title","response.space.getWikiPageResult.page.subPageList.[].title"])}},this.getSpaceWikiPageContent=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getSpaceWikiPageContent..."),V("getSpaceWikiPageContent",n)){var i={type:t.SpaceActionType.GET_WIKI_PAGE_WITH_CONTENT,getWikiPageWithContent:{pageId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.getWikiPageWithContentResult.item.sanitized=S,n(null,t.space.getWikiPageWithContentResult))}),null,["response.space.getWikiPageWithContentResult.page.title","response.space.getWikiPageWithContentResult.page.subPageList.[].title","response.space.getWikiPageWithContentResult.item.wikiPageContent.subject","response.space.getWikiPageWithContentResult.item.content","response.space.getWikiPageWithContentResult.item.attachments","response.space.getWikiPageWithContentResult.item.contentTags","response.space.getWikiPageWithContentResult.item.tags","response.space.getWikiPageWithContentResult.item.sharedItems.[].containerName","response.space.getWikiPageWithContentResult.item.sharedItems.[].topicSubject"])}},this.createSpaceWikiPage=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: createSpaceWikiPage..."),V("createSpaceWikiPage",n)){var i={type:t.SpaceActionType.CREATE_WIKI_PAGE,createWikiPage:{parentPageId:e.parentPageId,spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,sharedItems:e.sharedItems||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.createWikiPageResult.item.sanitized=S,n(null,t.space.createWikiPageResult))}),["request.space.createWikiPage.subject","request.space.createWikiPage.content","request.space.createWikiPage.attachments.[].fileName","request.space.createWikiPage.contentTags","request.space.createWikiPage.tags","request.space.createWikiPage.sharedItems"],["response.space.createWikiPageResult.page.title","response.space.createWikiPageResult.item.wikiPageContent.subject","response.space.createWikiPageResult.item.content","response.space.createWikiPageResult.item.attachments","response.space.createWikiPageResult.item.contentTags","response.space.createWikiPageResult.item.tags","response.space.createWikiPageResult.item.sharedItems.[].containerName","response.space.createWikiPageResult.item.sharedItems.[].topicSubject"])}},this.lockSpaceWikiPage=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: lock SpaceWiki Page ..."),V("lockSpaceWikiPage",n)){var i={type:t.SpaceActionType.LOCK_WIKI_PAGE_CONTENT,lockWikiPageContent:{itemId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.lockWikiPageContentResult.item)}),null,["response.space.lockWikiPageContentResult.item.wikiPageContent.subject","response.space.lockWikiPageContentResult.item.content","response.space.lockWikiPageContentResult.item.attachments","response.space.lockWikiPageContentResult.item.contentTags","response.space.lockWikiPageContentResult.item.tags","response.space.lockWikiPageContentResult.item.sharedItems.[].containerName","response.space.lockWikiPageContentResult.item.sharedItems.[].topicSubject"])}},this.unlockSpaceWikiPage=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: unlock SpaceWiki Page ..."),V("unlockSpaceWikiPage",n)){var i={type:t.SpaceActionType.UNLOCK_WIKI_PAGE_CONTENT,unlockWikiPageContent:{itemId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.unlockWikiPageContentResult.item)}),null,["response.space.unlockWikiPageContentResult.item.wikiPageContent.subject","response.space.unlockWikiPageContentResult.item.content","response.space.unlockWikiPageContentResult.item.attachments","response.space.unlockWikiPageContentResult.item.contentTags","response.space.unlockWikiPageContentResult.item.tags","response.space.unlockWikiPageContentResult.item.sharedItems.[].containerName","response.space.unlockWikiPageContentResult.item.sharedItems.[].topicSubject"])}},this.updateSpaceWikiPageContent=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: updateSpaceWikiPageContent..."),V("updateSpaceWikiPageContent",n)){var i={type:t.SpaceActionType.UPDATE_WIKI_PAGE_CONTENT,updateWikiPageContent:{itemId:e.itemId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:v(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,sharedItems:e.sharedItems||void 0}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&(t.space.updateWikiPageContentResult.item.sanitized=S,n(null,t.space.updateWikiPageContentResult))}),["request.space.updateWikiPageContent.subject","request.space.updateWikiPageContent.content","request.space.updateWikiPageContent.attachments.[].fileName","request.space.updateWikiPageContent.contentTags","request.space.updateWikiPageContent.tags","request.space.updateWikiPageContent.sharedItems"],["response.space.updateWikiPageContentResult.page.title","response.space.updateWikiPageContentResult.page.subPageList.[].title","response.space.updateWikiPageContentResult.item.wikiPageContent.subject","response.space.updateWikiPageContentResult.item.content","response.space.updateWikiPageContentResult.item.attachments","response.space.updateWikiPageContentResult.item.contentTags","response.space.updateWikiPageContentResult.item.tags","response.space.updateWikiPageContentResult.item.sharedItems.[].containerName","response.space.updateWikiPageContentResult.item.sharedItems.[].topicSubject"])}},this.moveSpaceWikiPage=function(e,n,i,r){if(r=r||u,d.debug("[ClientApiHandler]: moveSpaceWikiPage..."),V("moveSpaceWikiPage",r)){var o={type:t.SpaceActionType.MOVE_WIKI_PAGE,moveWikiPage:{pageId:e,parentPageId:n,position:i}};A(t.ContentType.SPACE,o,(function(e,t){f(e,t,r)&&r(null,t.space.moveWikiPageResult.page)}),null,["response.space.moveWikiPageResult.page.title","response.space.moveWikiPageResult.page.subPageList.[].title"])}},this.getSpaceWikiPageStructure=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getSpaceWikiPageStructure..."),V("getSpaceWikiPageStructure",n)){var i={type:t.SpaceActionType.GET_WIKI_PAGE_STRUCTURE,getWikiPageStructure:{pageId:e}};A(t.ContentType.SPACE,i,(function(e,t){f(e,t,n)&&n(null,t.space.getWikiPageStructureResult.path)}),null,["response.space.getWikiPageStructureResult.path.[].title","response.space.getWikiPageStructureResult.path.[].subPageList.[].title"])}},this.deleteSpaceWikiPage=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: delete SpaceWikiPage..."),V("deleteSpaceWikiPage",n)){var i={type:t.SpaceActionType.DELETE_WIKI_PAGE,deleteWikiPage:{pageId:e}};A(t.ContentType.SPACE,i,B(n))}},this.createTeam=function(e,n){n=n||u,d.debug("[ClientApiHandler]: createTeam...");var i={type:t.TeamActionType.CREATE_TEAM,create:{teamName:e.teamName,notificationTimerSeconds:e.notificationTimerSeconds}};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.createResult.team)}),["request.team.create.teamName"],["response.team.createResult.team.teamName"])},this.updateTeam=function(e,n){n=n||u,d.debug("[ClientApiHandler]: updateTeam...");var i={type:t.TeamActionType.UPDATE_TEAM,update:{teamId:e.teamId,teamName:e.teamName||void 0,notificationTimerSeconds:e.notificationTimerSeconds}};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.updateResult.team)}),["request.team.update.teamName"],["response.team.updateResult.team.teamName"])},this.deleteTeam=function(e,n){n=n||u,d.debug("[ClientApiHandler]: deleteTeam...");var i={type:t.TeamActionType.DELETE_TEAM,delete:{teamId:e}};A(t.ContentType.TEAM,i,B(n))},this.inviteMember=function(e,n){n=n||u,d.debug("[ClientApiHandler]: inviteMember...");var i=g(e.userIds);if(!i)return d.warn("[ClientApiHandler]: No userIds were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.TeamActionType.INVITE_MEMBER,inviteMember:{teamId:e.teamId,userId:i}};A(t.ContentType.TEAM,r,(function(e,t){f(e,t,n)&&n(null,t.team.inviteMemberResult)}),null,["response.team.inviteMemberResult.team.teamName"])},this.removeMember=function(e,n){n=n||u,d.debug("[ClientApiHandler]: removeMember...");var i=g(e.userIds);if(!i)return d.warn("[ClientApiHandler]: No userIds were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var r={type:t.TeamActionType.REMOVE_MEMBER,removeMember:{teamId:e.teamId,userId:i}};A(t.ContentType.TEAM,r,(function(e,t){f(e,t,n)&&n(null,t.team.removeMemberResult)}),null,["response.team.removeMemberResult.team.teamName"])},this.acceptInvitation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: acceptInvitation...");var i={type:t.TeamActionType.ACCEPT_INVITATION,acceptInvitation:{teamId:e}};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.acceptInvitationResult)}),null,["response.team.acceptInvitationResult.team.teamName"])},this.declineInvitation=function(e,n){n=n||u,d.debug("[ClientApiHandler]: declineInvitation...");var i={type:t.TeamActionType.DECLINE_INVITATION,declineInvitation:{teamId:e}};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.declineInvitationResult)}),null,["response.team.declineInvitationResult.team.teamName"])},this.leaveTeam=function(e,n){n=n||u,d.debug("[ClientApiHandler]: leaveTeam...");var i={type:t.TeamActionType.LEAVE_TEAM,leaveTeam:{teamId:e}};A(t.ContentType.TEAM,i,B(n))},this.changeMemberRole=function(e,n){n=n||u,d.debug("[ClientApiHandler]: changeMemberRole...");var i={type:t.TeamActionType.CHANGE_MEMBER_ROLE,changeMemberRole:e};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.changeMemberRoleResult)}),null,["response.team.changeMemberRoleResult.team.teamName"])},this.getTeams=function(e){e=e||u,d.debug("[ClientApiHandler]: getTeams...");var n={type:t.TeamActionType.GET_TEAMS};A(t.ContentType.TEAM,n,(function(t,n){f(t,n,e)&&e(null,n.team.getTeamsResult)}),null,["response.team.getTeamsResult.team.[].teamName"])},this.getTeamsByIds=function(e,n){if(n=n||u,d.debug("[ClientApiHandler]: getTeamsByIds..."),!(e=g(e)))return d.warn("[ClientApiHandler]: No teamsIds were provided"),void _(n,t.ReturnCode.INVALID_MESSAGE);var i={type:t.TeamActionType.GET_TEAMS_BY_IDS,getTeamsByIds:{teamId:e}};A(t.ContentType.TEAM,i,(function(e,t){f(e,t,n)&&n(null,t.team.getTeamsByIdsResult)}),null,["response.team.getTeamsByIdsResult.team.[].teamName"])}}return o.prototype.constructor=o,o.prototype.name="ClientApiHandler",e.ClientApiHandler=o,e}((Circuit=function(e){"use strict";var t=e.BaseEventTarget,n=e.Enums.ConnectionState,i=e.Constants,r=e.Proto,o=e.Utils;function a(t){var s=e.logger;t=t||{},a.parent.constructor.call(this,s);var c=this,l={},d={},u=[],E="/api",C=window.location.host,T=null,p=null,S=null,I=Object.keys(i.DeviceType),A={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0,client_id:!0},R=0,f=t.disablePing||o.isMobile()?-1:3e5,_=null,v=!1,g=new e.ConnectionController(t);function N(e){var t={};return p&&(t.accessToken=p),S?Object.assign(t,S):"undefined"!=typeof __clientVersion&&(t.clientVersion=__clientVersion),e&&!T?null:"wss://"+(e?T:C)+E+(Object.keys(t).length?"?"+o.toQS(t):"")}function m(e){s.debug("[ConnectionHandler]: Raising event",e.name),e.cbList.forEach((function(t){try{t(e.data)}catch(e){s.error("[ConnectionHandler]: Error raising event. ",e)}}))}function h(){u.length>0&&(s.debug("[ConnectionHandler]: Raise all delayed events"),u.forEach((function(e){window.clearTimeout(e.timeoutId),m(e)})),u=[])}function O(e){!R&&e.apiVersion&&(R=o.convertVersionToNumber(e.apiVersion));var t=function(e){var t;switch(e.msgType){case i.WSMessageType.RESPONSE:if(!e.response||!e.response.code)return null;var n;if(e.response.user)"GET_STUFF"===e.response.user.type?n=e.response.user.getStuff.user:"GET_LOGGED_ON"===e.response.user.type&&(n=e.response.user.getLoggedOn.user),n&&(n.clientId=e.clientId,n.apiVersion=e.apiVersion);if(d[e.response.requestId])return t=d[e.response.requestId],delete d[e.response.requestId],t.timer&&window.clearTimeout(t.timer),t.keysToOmitFromResponse&&(e.keysToOmitFromLogging=t.keysToOmitFromResponse),{type:"ack",cb:t.cb,data:e.response};s.debug("[ConnectionHandler]: No callback for response with requestId=",e.response.requestId);break;case i.WSMessageType.EVENT:var o=r.ParseEvent(e.event,e.apiVersion);if(o&&o.name){if(l[o.name])return t=l[o.name],s.debug("[ConnectionHandler]: Parsed event: ",o.name),c.ommitKeysFromLog&&t.keysToOmitFromEvent&&(e.keysToOmitFromLogging=t.keysToOmitFromEvent),{type:"evt",cbList:t.cbList,name:o.name,data:o.data,suppressLog:t.suppressLog};s.debug("[ConnectionHandler]: No registered callback for event ",o.name)}else s.error("[ConnectionHandler]: Failed to parse event: ",e.event);break;default:s.error("[ConnectionHandler]: Unexpected message type: ",e.msgType)}return null}(e);if(t)if(t.suppressLog||s.msgRcvd("[ConnectionHandler]: ",e),"evt"===t.type)Object.keys(d).length>0&&/^(?:User|Conversation|Search|Space)\./.test(t.name)?(s.debug("[ConnectionHandler]: Delay event:",t.name),t.timeoutId=window.setTimeout((function(){m(t);var e=u.indexOf(t);-1!==e&&u.splice(e,1)}),500),u.push(t)):m(t);else{var n=Object.keys(d).length;s.debug("[ConnectionHandler]: Remaining callbacks pending: ",n),t.cb(null,t.data),0===n&&h()}}g.onStateChange=function(e){if(s.debug("[ConnectionHandler]: WebSocket connection state changed to ",e.newState),s.debug("[ConnectionHandler]: Raising connectionStateChange event"),e.newState===n.Connected)R=0,!_&&f>0&&(_=window.setInterval((function(){c.pingServer()}),f));else if(_&&(window.clearInterval(_),_=null),Object.keys(d).length){var t=d;d={},window.setTimeout((function(){Object.keys(t).forEach((function(e){var n=t[e];n.timer&&window.clearTimeout(n.timer),n.cb(i.ReturnCode.DISCONNECTED)})),h()}),0)}var r=c.createEvent("connectionStateChange");r.newState=e.newState,r.oldState=e.oldState,c.dispatch(r)},g.onReconnectFailed=function(){s.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var e=c.createEvent("reconnectFailed");c.dispatch(e)},g.onMessage=O,this.ommitKeysFromLog=!0,this.onMessage=O,this.setRelativeUrl=function(e){E=e,s.debug("[ConnectionHandler]: Set relative URL to ",E)},this.setTarget=function(e){C=e||window.location.host,s.info("[ConnectionHandler]: Set target to ",C),C===T&&(T=null,s.info("[ConnectionHandler]: Set reverse proxy target to null"))},this.setProxyTarget=function(e){T=e===C?null:e||null,s.info("[ConnectionHandler]: Set reverse proxy target to ",T||"null")},this.setClientInfo=function(e){if(e){if(!e.deviceSubtype||-1===I.indexOf(e.deviceType))return void s.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",e);S={},Object.keys(e).forEach((function(t){A[t]&&(S[t]=e[t])})),s.debug("[ConnectionHandler]: Set clientInfo to ",S)}else s.debug("[ConnectionHandler]: Clear clientInfo"),S=null},this.setToken=function(e){p=e},this.getUrl=N,this.getState=function(){return g.getState()},this.connect=function(e,t){s.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),g.connect(N(!1),N(!0),e,t)},this.disconnect=function(){s.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),g.disconnect()},this.reconnect=function(e){s.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),g.reconnect(N(!1),N(!0),e)},this.sendMessage=function(e,t,n,r){return e&&e.request&&e.request.requestId?(s.debug("[ConnectionHandler]: Sending "+e.request.type+" request"),g.sendMessage(e)?(t&&function(e,t,n,r){if(t){var o=window.setTimeout((function(e){if(s.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",e),d[e]){delete d[e],t(i.ReturnCode.REQUEST_TIMEOUT);var n=Object.keys(d).length;s.debug("[ConnectionHandler]: Remaining callbacks pending: ",n),0===n&&h(),c.pingServer()}}),r,e);Array.isArray(n)||(n=null),d[e]={cb:t,timer:o,keysToOmitFromResponse:n}}}(e.request.requestId,t,n,r||6e4),!0):(s.error("[ConnectionHandler]: Failed to send message"),t&&window.setTimeout((function(){t(i.ReturnCode.FAILED_TO_SEND)}),0),!1)):(s.error("[ConnectionHandler]: Cannot send message. Invalid message: ",e),t&&window.setTimeout((function(){t(i.ReturnCode.INVALID_MESSAGE)}),0),!1)},this.pingServer=function(){if(g.isConnected()&&!v){var e,t="PING";if(o.isMobile()||(r.requestNr++,t+="|"+(e=r.requestNr)),g.sendMessage(t),e){v=!0;var n=window.setTimeout((function(){v=!1,s.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",e),delete d[e],g.reconnect(N(!1),N(!0))}),1e4);d[e]={cb:function(){v=!1},timer:n}}}},this.setPingInterval=function(e){"number"==typeof e&&(e=e<0?-1:Math.max(Math.floor(e),3e4),f!==e&&(f=e,_&&(window.clearInterval(_),_=null),f<0?s.info("[ConnectionHandler]: Disable ping"):(s.info("[ConnectionHandler]: Set ping interval time to ",f),g.isConnected()&&(s.info("[ConnectionHandler]: Restart ping interval"),_=window.setInterval((function(){c.pingServer()}),f)))))},this.on=function(e,t,n){if(e&&t){var i=l[e]||{cbList:[]};i.cbList.push(t),n&&(Array.isArray(n)?i.keysToOmitFromEvent=n:"*"===n&&(i.suppressLog=!0)),l[e]=i}},this.unsubscribeAll=function(){l={},d={},u=[],c.removeAllListeners()},this.injectHasActiveCall=g.injectHasActiveCall.bind(g)}return o.inherit(a,t),a.prototype.name="ConnectionHandler",e.ConnectionHandler=a,e}((Circuit=function(e){"use strict";function t(e){var t={};this.dispatch=function(n){var i=n&&n.type;i?t[i]?t[i].forEach((function(t){try{t(n)}catch(t){e&&e.error(t)}})):e&&e.debug("[BaseEventTarget]: There is no listener for "+i):e&&e.error("[BaseEventTarget]: Attempted to dispatch a bad event")},this.addEventListener=function(n,i){n&&"function"==typeof i?(t[n]||(t[n]=[]),t[n].indexOf(i)>=0?e&&e.warning("[BaseEventTarget]: Attempted to add duplicate event listener"):(t[n].push(i),e&&e.debug("[BaseEventTarget]: Added event listener for "+this.name+", type = "+n+", count = "+t[n].length))):e&&e.error("[BaseEventTarget]: addEventListener invoked with invalid arguments")},this.removeEventListener=function(n,i){if(t[n]){var r=t[n].indexOf(i);r>=0&&t[n].splice(r,1),e&&e.debug("[BaseEventTarget]: Removed event listener for "+this.name+", type = "+n+", count = "+t[n].length)}},this.hasEventListener=function(e){return!!t[e]&&t[e].length>0},this.removeAllListeners=function(){t={}}}return t.prototype.constructor=t,t.prototype.createEvent=function(e){return{type:e}},t.prototype.dispatchEvent=function(e){var t=this.createEvent(e);this.dispatch(t)},e.BaseEventTarget=t,e}((Circuit=function(e){"use strict";var t,n=e.Utils;function i(e,t,n,i,r,o,a,s,c){var l=document.createElement("canvas"),d=l.getContext("2d");return l.width=s,l.height=c,d.fillStyle="#f0f0f0",d.fillRect(0,0,l.width,l.height),d.drawImage(e,t,n,i,r,o,a,s,c),l.toDataURL("image/jpeg")}function r(e,t){for(var n=atob(e.split(",")[1]),i=[],r=0;r<n.length;r++)i.push(n.charCodeAt(r));return new Blob([new Uint8Array(i)],{type:t||"image/jpeg"})}function o(e,n){return n=n||{},new t((function(t){var o=new FileReader;o.onload=function(o){var a=new Image;a.onload=function(){var o=r(function(e,t,n){var r,o;return t=t||484,n=n||312,(o=e.height)/(r=e.width)>n/t?e.height>n&&(r=r*n/o,o=n):r>t&&(o=o*t/r,r=t),i(e,0,0,e.width,e.height,0,0,r,o)}(this,n.width,n.height));o.name=(n.prefix||"")+(e.modifiedName||e.name),o.lastModified=Math.round(Date.now()/1e3),t(o)},a.src=o.target.result},o.readAsDataURL(e)}))}function a(e){var i=e?e.domain:null,r=1,a={};function s(e,n,i,r,o){var s=function(){a[e]&&(a[e].xhr=null)};return new t((function(t,c){var l=n.modifiedName||n.name,d=new XMLHttpRequest;d.withCredentials=!0,d.open("POST",i,!0),d.setRequestHeader("Content-Type",n.type),d.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(l)+'"'),o&&(o.convId&&d.setRequestHeader("x-conversation",o.convId),o.rtcSessionId&&d.setRequestHeader("x-rtcsession",o.rtcSessionId),o.token&&d.setRequestHeader("authorization","SecToken "+o.token)),"function"==typeof r&&(d.upload.onprogress=function(e){e.total>0&&r(e.loaded,e.total,l)}),d.onload=function(){s(),200===d.status?t(d.response):c({filename:l,status:d.status,statusText:d.statusText,response:d.response,responseText:d.responseText})},d.onerror=function(){s(),c({filename:l,status:500,statusText:"Connection Failed"})},d.onabort=function(){s(),c({filename:l,status:0,statusText:"abort"})},a[e].xhr=d,d.send(n)}))}function c(e,n,o){if(o=o||null,!t)throw new Error("Promise support is required to use FileUpload");var c=(i?"https://"+i:"")+"/fileapi",l=r;r++,a[l]={xhr:null,deleteUrls:[]};var d=s(l,e,c,o,n).then((function(n){var i=JSON.parse(n)[0],r=i.fileId||i.id,o=c+"?fileid="+r,s={fileId:r,fileName:e.modifiedName||e.name,mimeType:i.mimeType||e.type,size:e.size,url:o,deleteUrl:o};return delete a[l],t.resolve(s)})).catch((function(e){return delete a[l],t.reject(e)}));return d.__uploadId=l,d}this.uploadFiles=function(e,c,l,d,u){if(!t)throw new Error("Promise support is required to use FileUpload");if(e.length>10)return t.reject("Exceeded maximum of 10 files per message");var E=(c=c||i)?"https://"+c:"",C=[],T=r;r++,a[T]={xhr:null,deleteUrls:[]};var p=[];!u&&e.forEach((function(e){n.isSupportedImage&&n.isSupportedImage(e.type)&&p.push(o(e,{prefix:"tHuMbNaIl___"}))}));var S=t.all(p).then((function(n){return Array.prototype.push.apply(e,n),l=l||null,e.reduce((function(e,t){return e.then((function(){return s(T,t,E+"/fileapi?itemid="+(l||"NULL"),d).then((function(e){var n=JSON.parse(e)[0];l=l||n.id;var i=n.fileid[n.fileid.length-1],r={fileId:i,fileName:t.modifiedName||t.name,itemId:l,mimeType:n.mimeType||t.type,size:t.size,url:E+"/fileapi?fileid="+i+"&itemid="+l,deleteUrl:E+"/fileapi?fileid="+i+"&itemid="+l};return C.push(r),a[T].deleteUrls.push(r.deleteUrl),C}))}))}),t.resolve())})).then((function(e){return delete a[T],t.resolve(e)})).catch((function(e){return delete a[T],t.reject(e)}));return S.__uploadId=T,S},this.uploadWhiteboardFile=function(e,t,n){return c(e,{rtcSessionId:t,token:n})},this.uploadCMRLogs=function(e){return c(e)},this.uploadMassImportFile=function(e,t){return c(e,null,t)},this.abort=function(e){if(e&&e.__uploadId&&a[e.__uploadId]){var t=a[e.__uploadId];delete a[e.__uploadId],t.xhr&&t.xhr.abort(),(n=t.deleteUrls)&&n.forEach((function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.open("DELETE",e),t.send()}))}var n}}return void 0!==Promise&&(t=Promise),a.COMPRESSED_IMG_PREFIX="tHuMbNaIl___",a.dataURItoBlob=r,a.drawCanvasImage=i,a.overridePromise=function(e){t=e},e.FileUpload=a,e}((Circuit=function(e){"use strict";var t=e.AtcCallInfo,n=e.BaseCall,i=e.Enums.CallState,r=e.Enums.CstaCallState,o=e.logger;function a(e){if(!e||!e.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");a.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==r.Ringing},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return this.checkState(i.ActiveRemote)&&this.checkCstaState(r.Active)},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new t,e=null,o.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}return e.Utils.inherit(a,n),a.prototype.isPresent=function(){return!this.checkState([i.Idle,i.Terminated])||!this.checkCstaState([r.Idle,r.Failed,r.TransferFailed,r.Terminated])},e.AtcRemoteCall=a,e}((Circuit=function(e){"use strict";var t,n=e.Constants,i=e.IceCandidate,r=e.logger,o=e.ScreenSharingController,a=e.sdpParser,s=e.Utils,c=e.Enums.VideoCodecs,l=e.Enums.VideoResolutionLevel;void 0!==window.Promise&&(t=window.Promise);var d=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"}),u=["PermissionDeniedError","SecurityError","NotAllowedError"],E=c.VP8,C=Object.freeze({BALANCED:"balanced",MAINTAIN_RESOLUTION:"maintain-resolution",MAINTAIN_FRAMERATE:"maintain-framerate"}),T=Object.freeze({audio:{maxplaybackrate:24e3,"sprop-maxcapturerate":24e3,maxaveragebitrate:16e3,usedtx:1},lowVideo:{"1080p":{scaleFactor:6},"720p":{scaleFactor:4},"480p":{scaleFactor:2.66875},maxBw:100,scaleFactor:2},video:{maxBw:512},hdVideo:{"1080p":{maxBw:2e3},"720p":{maxBw:1500},"480p":{maxBw:512},maxBw:2e3},screenShare:{maxBw:600,minFrameRate:3,maxFrameRate:5},hdScreenShare:{maxBw:2e3,minFrameRate:3,maxFrameRate:7},rcScreenShare:{maxBw:300,minFrameRate:5,maxFrameRate:15},receiveVideo:{maxBwMobile:512,maxBw:2e3},rtcpMuxPolicy:"require",preferredVideoCodec:E}),p=Object.freeze({video:{minBitRate:60},hdVideo:{"1080p":{minBitRate:1200,maxBitRate:2e3},"720p":{minBitRate:750,maxBitRate:1500},"480p":{minBitRate:500,maxBitRate:512},startBitRate:500,minBitRate:1e3,maxBitRate:2e3,maxQuantization:56},screenShare:{startBitRate:300,minBitRate:300,maxBitRate:600,maxQuantization:50},hdScreenShare:{startBitRate:1e3,minBitRate:1e3,maxBitRate:2e3,maxQuantization:40}}),S=Object.freeze({AUDIO_VIDEO:0,DESKTOP:1}),I=Object.values(l);function A(e){return!(e={audio:!!(e=e||{}).audio,video:!!e.video,hdVideo:!!e.hdVideo,videoResolution:e.videoResolution||null,desktop:!!e.desktop,hdDesktop:!!e.hdDesktop,screenControl:!!e.screenControl,minFrameRate:e.minFrameRate||null,remoteControlEnabled:!1}).videoResolution||e.hdVideo&&I.includes(e.videoResolution)||(e.videoResolution=null),e}function R(){var e={};return{add:function(t,n){e[t]=n},get:function(t){return e[t]},remove:function(t){delete e[t]},getAll:function(){return e},removeAll:function(){e={}}}}function f(c){var l=e.WebRTCAdapter;c=c||{};var C=1,T=s.isMobile()?2e3:1e4,p=this,S=c.callId||"",_=!!c.isDirectCall,v=!!c.isTelephonyCall,g=!!c.midMappingEnabled,N=s.isMobile(),m=0,h=[null,null],O=null,D=null,P=null,y=[O,P],b={main:{sdpStatus:d.None,trickleIceForOffer:!v&&!f.disableTrickleIce&&!c.disableTrickleIce,trickleIceForAnswer:!1,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[],disabledRemoteOfferMLines:new R,nextPcLocalSdpSetAt:0},screenControl:{trickleIceForOffer:!f.disableTrickleIce&&!c.disableTrickleIce,trickleIceForAnswer:!1,sdpStatus:d.None,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[]}},U=null,L=[],M={},w=!1,G=!1,k=!1,H=null,V=null,B=null,F=null,x=null,W=null,K=[],Y=null,q={audio:!1,video:!1},j=null,Q=!1,z=!1,X=!1,J=!1,$=!1,Z=A(),ee=null,te=null,ne=!1,ie=null,re=!1,oe=!1,ae=!1,se=[],ce=!1,le=!1,de=null,ue=!!c.isLargeConference,Ee=!!c.isSessionGuest,Ce=!!c.isAtcPullCall,Te=null,pe=null,Se=!1,Ie=null,Ae=!1,Re=!!c.candidatesCollectionTest,fe=s.getBrowserInfo(),_e={},ve=!1,ge=!1,Ne="",me=!1,he={},Oe=!!c.supportsVideoReceiverConfiguration;function De(e,t){if(!re){var n=t?null:function(){var t=e===h[1];r.warn("[RtcSessionController]: Local "+(t?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),function(e){r.debug("[RtcSessionController]: send LocalStreamEnded event"),qe(p.onLocalStreamEnded,{isDesktop:e})}(t)};e.getTracks().forEach((function(e){e.onended=n}))}}function Pe(e,t){var n=we(),i=function(){Nt(e,1),t()};e.getVideoTracks()[0].applyConstraints(n).then(i).catch(i)}function ye(e,t,n){if((n=n||{}).mediaStream){var i=n.mediaStream;De(i),Pe(i,e)}else n.streamId||n.screenType?Le(e,t,n):(n.isScreenControlSupported=Z.screenControl,Ie=o.getScreen((function(i){if(i)if(i.streamId)n.streamId=i.streamId;else if(i.mediaStream)return void Pe(i.mediaStream,e);Le(e,t,n)}),t,n))}function be(e,t,n){r.debug("[RtcSessionController]: Get User Media for ",Z),n=n||{},Z.audio||Z.video?Ue((function(){Z.desktop&&!f.disableDesktopPc?h[1]?(n.mediaStream=h[1],ye(e,t,n)):w&&ee.desktop&&!k?(Nt(V[1],1),e()):(ye(e,t,n),k=!1):(Nt(null,1),e())}),t):Z.desktop?(w&&ee.desktop&&!k&&(n.mediaStream=V[1]),ye(e,t,n)):window.setTimeout(e,0)}function Ue(e,t,n){r.debug("[RtcSessionController]: getUserMediaAudioVideo()");var i=null;try{var o,a=function(){if(n&&h[0])return p.setLocalStream(0,null),null;if(h[0]){var e=h[0];return De(e),h[0]=null,e}var t=!G||fe.msie||fe.firefox&&!Z.desktop&&ee.desktop;return w&&t&&"android"!==l.browser&&Z.audio===ee.audio&&Z.video===ee.video&&Z.hdVideo===ee.hdVideo&&Z.videoResolution===ee.videoResolution?V[0]:null}();if(a)return r.debug("[RtcSessionController]: getUserMediaAudioVideo(): Reusing audio/video stream ID: ",l.getStreamId(a)),Nt(a,0),void e();var c={audio:!1,video:!1};l.getMediaSources((function(a,d){var E,C;if(r.debug("[RtcSessionController]: Retrieved media sources"),Z.audio){var T={newInputDevice:n&&n.audio};!(E=function(e,t){var n=s.selectMediaDevice(e,f.recordingDevices),i={enableAudioAGC:f.enableAudioAGC,sourceId:t.newInputDevice||n&&n.id};if(!ge&&w&&(fe.firefox||fe.chrome)&&Z.audio===ee.audio&&_e.enableAudioAGC===i.enableAudioAGC&&_e.sourceId===i.sourceId){var o=V[0],a=o&&o.getAudioTracks()[0];if(a&&"ended"!==a.readyState)return t.oldAudioTrack=a,null}return r.debug("[RtcSessionController]: Input device selected: ",n),i}(a,T))&&T.oldAudioTrack?(r.debug("[RtcSessionController]: Reusing audio track"),o=T.oldAudioTrack.clone()):c.audio=l.getAudioOptions(E)}var S={},A=[];if(Z.video){if(Z.hdVideo){var R=Z.videoResolution?I.indexOf(Z.videoResolution):0;A=I.slice(R),S.videoResolution=A.shift(),Me(S.videoResolution)}S.minFrameRate=Z.minFrameRate,C=s.selectMediaDevice(d,f.videoDevices),S.sourceId=C&&C.id,c.video=l.getVideoOptions(S)}if(w&&Z.video&&ee.video&&(Z.hdVideo!==ee.hdVideo||Z.videoResolution!==ee.videoResolution)&&l.stopLocalVideoTrack(V[0]),o&&!c.audio&&!c.video){var _=new l.MediaStream([o]);return De(_),Nt(_,0),void e()}i=window.setTimeout((function(){i=null,r.warn("[RtcSessionController]: Failed to access local media: device unresponsive"),t("res_MediaInputDevicesUnresponsive")}),12e4);var v=function(){r.info("[RtcSessionController]: Calling getUserMedia - constraints = ",c),l.getUserMedia(c,(function(n,a){if(E&&(_e=E),r.info("[RtcSessionController]: User has granted access to local media"),r.debug("[RtcSessionController]: Local MediaStream: ",l.getStreamId(n)),!i)return r.info("[RtcSessionController]: GUM time out already fired"),void _t(n);if(window.clearTimeout(i),i=null,Se)return r.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",l.getStreamId(n)),void _t(n);if(Z.video&&!n.getVideoTracks().length){if(w&&!ee.video)return void t("res_CameraAccessRestricted");Z.video=!1,r.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),s="res_AddVideoFailed","function"==typeof p.onRtcWarning&&window.setTimeout((function(){!function(e){r.debug("[RtcSessionController]: send Warning event"),qe(p.onRtcWarning,{warning:e})}(s)}),0),r.info("[RtcSessionController]: New getUserMedia - constraints = ",Z)}var s;o&&n.addTrack(o),Nt(n,0),De(n),e(),a&&(r.warn("[RtcSessionController]: Get user media succeeded. But we had an exception: ",a.name||"<unknown>"),qe(p.onGetUserMediaException,{info:a}))}),(function(e){var n,o=e&&e.name||"Unspecified";if(S.videoResolution&&("ConstraintNotSatisfiedError"===o||"OverconstrainedError"===o))return r.warn("[RtcSessionController]: Failed to access local media with HD constraints: ",c.video),S.videoResolution=A.shift(),Me(S.videoResolution),c.video=l.getVideoOptions(S),void v();r.warn("[RtcSessionController]: Failed to access local media: ",o),i&&(window.clearTimeout(i),i=null),n=u.includes(o)?Z.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":"TrackStartError"===o||"NotReadableError"===o?Z.video?"res_AccessToMediaInputDevicesFailedInUse":"res_AccessToAudioInputDeviceFailedInUse":Z.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",t(n)}))};v(),r.debug("[RtcSessionController]: Requested access to Local Media")}))}catch(e){r.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),i&&(window.clearTimeout(i),i=null),t(Z.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}function Le(e,t,i){r.debug("[RtcSessionController]: getUserMediaDesktop()");try{var o={audio:!1},a=we();o.video=l.getDesktopOptions(i.streamId||i.screenType,a),r.info("[RtcSessionController]: Calling getUserMedia - constraints = ",o),l.getUserMedia(o,(function(t){if(r.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",l.getStreamId(t)),Se)return r.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",l.getStreamId(t)),void _t(t);var n;i&&(ce=i.isScreenControlled,le=ce,n=i.pointer,r.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),qe(p.onScreenSharePointerStatus,{isSupported:!(!n||!n.isSupported),isEnabled:!(!n||!n.isEnabled)}),de=i),De(t),Nt(t,1),e()}),(function(e){var i=e&&e.name||"Unspecified";r.warn("[RtcSessionController]: Failed to access local media: ",i),u.includes(i)?t(n.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED):t("res_AccessToDesktopFailed")})),r.debug("[RtcSessionController]: Requested access for screen capture")}catch(e){r.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),t("res_AccessToDesktopFailed")}}function Me(e){e||(Z.hdVideo=!1),Z.videoResolution=e}function we(){var e=Z.hdDesktop?"hdScreenShare":"screenShare",t={frameRate:{min:f.sdpParameters[e].minFrameRate,max:f.sdpParameters[e].maxFrameRate}};return Z.remoteControlEnabled&&(t.frameRate.min=Math.max(t.frameRate.min,f.sdpParameters.rcScreenShare.minFrameRate),t.frameRate.max=Math.max(t.frameRate.max,f.sdpParameters.rcScreenShare.maxFrameRate)),t}function Ge(t){if(t){if(D)return!0}else if(O)return!0;var n={};v&&(n.rtcpMuxPolicy=f.sdpParameters.rtcpMuxPolicy),L.length&&!Ce?(n.iceServers=[{urls:L,credential:M.password,username:M.username}],f.allowOnlyRelayCandidates&&(n.iceTransportPolicy="relay")):(Ce||r.warn("[RtcSessionController]: No TURN server(s) provided."),n.iceServers=[]);var i=!!Ce;Ce=!1,f.webRTCIPHandlingPolicy&&r.info("[RtcSessionController]: webRTCIPHandlingPolicy is set to ",f.webRTCIPHandlingPolicy),r.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",n);var o={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};r.debug("[RtcSessionController]: Creating peer connections. constraints:",o),_?(r.debug("[RtcSessionController]: Set number of extra video channels for direct calls to 0"),m=0):N?(r.debug("[RtcSessionController]: Set number of extra video channels for mobile clients to 0"),m=0):ue&&Ee?(r.debug("[RtcSessionController]: Set number of extra video channels for guests in large conference to 0."),m=0):Oe||!oe&&!ae?("number"==typeof f.maxVideoExtraChannels?(m=Math.max(f.maxVideoExtraChannels,0),m=Math.min(m,3)):m=3,r.info("[RtcSessionController]: Set number of extra video channels to ",m)):(r.debug("[RtcSessionController]: Remote video is disabled. Set number of extra video channels to 0."),m=0);var a=m;Z.video&&ae&&l.unifiedPlanEnabled&&!Oe&&(r.debug("[RtcSessionController]: Local video is enabled and we only allow remote screenshare. We need to setup an extra sendonly video channel."),a=1);var s,c={extraVideoChannels:a,createDesktopPc:!f.disableDesktopPc&&!_&&(!oe||Z.desktop||ae),onlyRemoteScreenShare:ae};r.debug("[RtcSessionController]: Creating peer connections. options:",c);try{t||(se=[]),(s=l.unifiedPlanEnabled?new e.RtcPeerConnectionsUnified(n,c):new e.RtcPeerConnections(n,o,c)).connectionBypassed=i,r.debug("[RtcSessionController]: Created audio/video peer connections. Connection bypassed: ",i)}catch(e){return r.error("[RtcSessionController]: Failed to create peer connections.",e),!1}return t?D=s:(y=[O=s,P],U=Ve([O]),ke(O,U)),!0}function ke(e,t){e&&(e.onicecandidate=Fe.bind(null,e),e.oniceconnectionstatechange=xe.bind(null,e),e.onaddstream=We.bind(null,e),e.onremovestream=Ke.bind(null,e)),t&&(t.onThresholdExceeded=function(e){qe(p.onStatsThresholdExceeded,{cleared:e})},t.onNoOutgoingPackets=function(){qe(p.onStatsNoOutgoingPackets,{})},t.onNetworkQuality=function(e){qe(p.onNetworkQuality,{quality:e})})}function He(e,t){e&&(e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onaddstream=null,e.onremovestream=null),t&&(t.onThresholdExceeded=null,t.onNoOutgoingPackets=null,t.onNetworkQuality=null)}function Ve(t){return l.unifiedPlanEnabled&&e.CallStatsHandlerUnified?new e.CallStatsHandlerUnified(t,_):new e.CallStatsHandler(t)}function Be(e){return e===O?"audio/video":"screen control"}function Fe(e,t){if(e&&y.includes(e)){var n,o=rt(e,"sdpStatus");if(t.candidate){if(!t.candidate.candidate)return void ct("Ignore empty candidate for mid "+t.candidate.sdpMid);var a=new i(t.candidate.candidate);if("udp"!==a.transport)return void ct("Ignore non UDP candidate");if(e===O&&"relay"===a.typ&&(e.hasRelayCandidates=!0),ct("New ICE candidate: ",t.candidate),ut(e)){if(!ut(e,(n=e.localDescription).type))return;var s={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};(function(e,t){var n=nt(e=e||O);if(!n)return!1;if(f.allowAllIceCandidatesScreenShare||t.sdpMid!==O.getScreenShareMediaId()||n.hasRelayRtpCandidate||n.sendAllCandidates)return!0;var o=new i(t.candidate);if(o.isTcpTlsRelay())return o.isRtp()&&(r.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),n.hasRelayRtpCandidate=!0,delete n.queuedCandidates,n.relayRtpCandidateTimeout&&(window.clearTimeout(n.relayRtpCandidateTimeout),delete n.relayRtpCandidateTimeout)),!0;"udp"===o.transport&&(n.queuedCandidates||(n.queuedCandidates=[],r.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),n.relayRtpCandidateTimeout=window.setTimeout((function(){r.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete n.relayRtpCandidateTimeout,n.queuedCandidates&&(je(n.queuedCandidates,e),delete n.queuedCandidates),n.sendAllCandidates=!0}),5e3)),n.queuedCandidates.push(t),r.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate"));return!1})(e,s)&&(o!==d.None&&o!==d.OfferPending&&o!==d.AnswerPending?function(e,t){var n=nt(t);if(!n)return;n.pendingCandidates||(n.pendingCandidates=[],r.debug("[RtcSessionController]: Start timer to collect candidates before send."),n.collectCandidatesTimeout=window.setTimeout((function(){r.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete n.collectCandidatesTimeout,n.pendingCandidates&&(je(n.pendingCandidates,t),delete n.pendingCandidates)}),200));n.pendingCandidates.push(e)}(s,e):ct("Ignore ICE candidate in state ",o))}}else if(ct("End of candidates. PC: ",Be(e)),e.endOfCandidates=!0,e!==P&&Tt()){if(!(n=e.localDescription))return void dt("End of candidates, but cannot access pc.localDescription");ut(e,n.type)&&o!==d.None&&o!==d.OfferPending&&o!==d.AnswerPending?function(e){var t=nt(e);if(!t)return;var n=[];t.pendingCandidates&&(r.info("[RtcSessionController]: Send all pending candidates."),n=t.pendingCandidates);t.queuedCandidates&&(r.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(n,t.queuedCandidates));n.push({candidate:"a=end-of-candidates\r\n"}),st(e),je(n,e)}(e):ze(e,n)}rt(e,"candidatesTimer")&&ut(e)&&(o===d.OfferPending||o===d.AnswerPending)&&ze(e,n=e.localDescription)}else lt("Received icecandidate event for old PC")}function xe(e){if(e&&y.includes(e)){var t=Be(e);switch(ct("Connection state change ("+t+"): ",e.iceConnectionState),!L.length||e!==O||e.connectionBypassed||"completed"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||e.hasRelayCandidates||lt("[RtcSessionController]: No relay candidates were collected, please check connectivity to the TURN servers"),rt(e,"sdpStatus")){case d.Connected:switch(e.iceConnectionState){case"connected":case"completed":Qe(e,t);break;case"disconnected":e.connectionBypassed||function(e,t){if(e.iceDisconnectTimeout)return;e.iceDisconnectTimeout=window.setTimeout((function(){delete e.iceDisconnectTimeout,"disconnected"===e.iceConnectionState&&(r.debug("[RtcSessionController]: send IceDisconnected event pcType:",t),qe(p.onIceDisconnected,{pcType:t}))}),1e3)}(e,t);break;case"failed":e.connectionBypassed||(wt(d.Disconnected,e),dt("[RtcSessionController]: ICE connection has failed"),e!==P&&Lt("res_CallMediaDisconnected"))}break;case d.AnswerReceived:case d.PrAnswerReceived:case d.AnswerApplied:case d.AnswerSent:switch(e.iceConnectionState){case"connected":case"completed":e.connected=!0,Ct(e)&&(at(e),wt(d.Connected,e),Qe(e,t));break;case"failed":at(e),Ut(e)}}}else lt("Received iceconnectionstatechange event for old PC")}function We(e,t){ct("Added Remote Stream"),w?ct("Renegotiation is in progress. Ignore AddStream event."):(ht([t.stream]),Je())}function Ke(e,t){lt("Removed Remote Stream"),function(e){if(!e)return;var t=!1,n=g?l.getVideoTrackId(e):l.getVideoStreamTrackId(e);n&&K.some((function(e,i){return e.streamId===n&&(K.splice(i,1),t=!0,!0)}));var i=g?l.getAudioTrackId(e):l.getAudioStreamTrackId(e);Y&&Y.streamId===i&&(Y=null,t=!0);t&&tt()}(t.stream),Je()}function Ye(e,t){var n;ct("RTCDTMFSender - ontonechange",t.tone?"":": finished"),n=t.tone,r.debug("[RtcSessionController]: send DTMFToneChanged event"),qe(p.onDTMFToneChange,{tone:n})}function qe(e,t){if("function"==typeof e)try{e(t||{})}catch(e){r.error(e)}}function je(e,t){var n=nt(t);if(n&&e){var o=n.sentIceCandidates,a=!1;if((e=e.filter((function(e){if(e.candidate.startsWith("a=end-of-candidates"))return a=!0,!0;var t=e.candidate,n=o.some((function(e){return e.equals(t)}));return n?lt("Ignore duplicate ICE candidate: ",e.candidate):o.push(new i(t)),!n}))).length>0){r.debug("[RtcSessionController]: Send IceCandidate event");var s={origin:pt(t),candidates:e,endOfCandidates:a,isAudioVideo:"audio/video"===Be(t)};qe(p.onIceCandidate,s),St(t)}}}function Qe(e,t){e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),r.debug("[RtcSessionController]: send IceConnected event pcType:",t),qe(p.onIceConnected,{pcType:t})}function ze(e,t){if(e){ot(e);var n=rt(e,"sdpStatus");"offer"===t.type?n===d.OfferPending&&Xe(e,d.OfferSent):n===d.AnswerPending&&Xe(e,d.AnswerSent)}else lt("Cannot send local description for non existing pc.")}function Xe(e,t){if(e){r.info("[RtcSessionController]: sendSessionDescription - PC: ",Be(e));var n=function(e){var t;if(e===P){var n=P.localDescription;t={type:n.type,parsedSdp:a.parse(n.sdp)}}else{var i=e.localDescription,o=a.parse(i.sdp);if("answer"===i.type){r.info("[RtcSessionController]: combineLocalSdp - Processing answer SDP");var s=rt(O,"disabledRemoteOfferMLines");!O.desktopPeerConnection&&s.get(C)&&(o.m.splice(C,0,s.get(C)),s.remove(C))}if(e.desktopPeerConnection){r.info("[RtcSessionController]: combineLocalSdp - Adjust screenshare m-line");var c=a.findMediaLineIndex(o,e.getScreenShareMediaId());if(c>=0){var l=o.m[c];if(l){l={m:[l]};var d=!_&&!f.allowAllIceCandidatesScreenShare;r.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",d);var u=ut(O,i.type)&&!O.endOfCandidates;a.validateIceCandidates(l,d,u)}}else r.warn("[RtcSessionController]: Could not find screenshare m-line: no ICE validation was made.")}t={type:i.type,parsedSdp:o}}return t}(e),i=ut(e,n.type),o=n.parsedSdp;o=a.removeAudioLevelAttr(o),o=a.fixTrickleIceOption(o,i),i?Tt()&&(o=a.addEndOfCandidatesLine(o)):o=a.removeEndOfCandidatesLine(o),O.restoreAudioConnectionMode&&a.setConnectionMode(o,"audio",O.restoreAudioConnectionMode);var s=!N||c.canReceiveHdVideo?"maxBw":"maxBwMobile";(s=f.sdpParameters.receiveVideo[s])&&a.setVideoBandwidth(o,s,!0);var d=Ae||Re;if(0!==a.iceTotalCandidatesCount(o)||d)if(a.validateIceCandidates(o,!1,me)||i&&!Tt()||Ae){if(i&&!Tt()){var u=nt(e);u&&(u.sentIceCandidates=a.getIceCandidates(o))}var E={type:n.type,sdp:a.stringify(o)};if(e===O&&e.desktopPeerConnection&&(E.screen=O.getScreenShareMediaId(),h[0])){var T=function(e){var t,n=h[e];n&&n.getVideoTracks().length&&(t=l.getVideoStreamTrackId(n));return t}(0);r.info("[RtcSessionController]: Video streamId is ",T);var S=null;g&&T&&(S=l.unifiedPlanEnabled?function(e){var t,n=h[e];if(n){var i=n.getVideoTracks()[0];i&&(t=O&&O.getMediaId(i))}return t}(0):a.getMediaIds(o)[T]),E.video=S||T,an()&&(E.videoSenderConfiguration=O.getAvailableVideoSenders(he))}r.debug("[RtcSessionController]: send SessionDescription event"),Ae=!1,qe(p.onSessionDescription,{sdp:E}),wt(t,e)}else r.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),Lt();else if(i){var I=Vt();r.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+I+" more milliseconds.");var A=window.setTimeout((function(){it(e,"candidatesTimer",null),Lt("res_RestartBrowser")}),I);it(e,"candidatesTimer",A)}else Lt("res_RestartBrowser")}else lt("Cannot send Session Description for non existing pc.")}function Je(){r.debug("[RtcSessionController]: send RemoteStreamUpdated event"),qe(p.onRemoteStreamUpdated,{})}function $e(e){r.debug("[RtcSessionController]: send Error event"),qe(p.onRtcError,{error:e})}function Ze(e){"function"==typeof p.onRtcError&&window.setTimeout((function(){$e(e)}),0)}function et(){r.debug("[RtcSessionController]: send MediaUpdate event"),qe(p.onMediaUpdate,{})}function tt(){r.debug("[RtcSessionController]: send RemoteStreams event"),qe(p.onRemoteStreams,{audio:Y,video:K})}function nt(e){return e?e===O?b.main:e===P?b.screenControl:null:null}function it(e,t,n){e&&(e===O?b.main[t]=n:b.screenControl[t]=n)}function rt(e,t){return e?e===O?b.main[t]:b.screenControl[t]:null}function ot(e){var t=rt(e,"candidatesTimer");t&&(window.clearTimeout(t),it(e,"candidatesTimer",null))}function at(e){var t=rt(e,"connectedTimer");t&&(window.clearTimeout(t),it(e,"connectedTimer",null))}function st(e){var t=nt(e);t&&(t.collectCandidatesTimeout&&(window.clearTimeout(t.collectCandidatesTimeout),delete t.collectCandidatesTimeout),t.relayRtpCandidateTimeout&&(window.clearTimeout(t.relayRtpCandidateTimeout),delete t.relayRtpCandidateTimeout),t.sentIceCandidates=[],t.pendingCandidates&&delete t.pendingCandidates,t.queuedCandidates&&delete t.queuedCandidates,t.hasRelayRtpCandidate=!1,t.sendAllCandidates=!1)}function ct(e,t){r.debug("[RtcSessionController]["+S+"]: "+e,t)}function lt(e,t){r.warn("[RtcSessionController]["+S+"]: "+e,t)}function dt(e,t){r.error("[RtcSessionController]["+S+"]: "+e,t)}function ut(e,t){return!!e&&(t?"offer"===t&&rt(e,"trickleIceForOffer")||"answer"===t&&rt(e,"trickleIceForAnswer"):rt(e,"trickleIceForOffer")||rt(e,"trickleIceForAnswer"))}function Et(e,t){var n=t&&a.isTrickleIceOption(t);return n&&r.debug("[RtcSessionController]: SDP "+e+" indicates support for Trickle-ICE."),!!n}function Ct(e){return e&&e===P?P.connected:!O||O.connected}function Tt(){return(!O||O.endOfCandidates)&&(!P||P.endOfCandidates)}function pt(e){if(!e)return"";var t=rt(e,"localOrigin");if(!t){var n=e.localDescription;n&&it(e,"localOrigin",t=a.getOrigin(n.sdp))}return t}function St(e){if(e=e||O)if(at(e),Ct(e))wt(d.Connected,e);else{var t=re?1e3:15e3;r.debug("[RtcSessionController]: Starting ICE CONNECTED timer");var n=window.setTimeout((function(){it(e,"connectedTimer",null);var t=rt(e,"sdpStatus");if("connected"===e.iceConnectionState||"completed"===e.iceConnectionState)return r.debug("[RtcSessionController]: Missed iceConnectionState=connected event but media is connected"),e.connected=!0,wt(d.Connected,e),void Qe(e,Be(e));t!==d.AnswerSent&&t!==d.AnswerReceived&&t!==d.AnswerApplied||Ct(e)||(re?wt(d.Connected,e):(r.warn("[RtcSessionController]: Timed out waiting for connected state."),Ut(e)))}),t);it(e,"connectedTimer",n)}else lt("Terminating waitConnectedState for non existing pc.")}function It(){D&&(r.debug("[RtcSessionController]: Closing the pre-allocated peer connection"),it(O,"nextPcLocalSdpSetAt",0),At(D),D=null)}function At(e,t){He(e,t),e&&(e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),l.closePc(e))}function Rt(e){if(!e)return!1;var t=e.getLocalStreams();if(!s.isEmptyArray(t))return!0;r.debug("[RtcSessionController]: Add local streams to "+(e===O?"existing":"next")+" peer connection");try{h[0]&&e.addStream(h[0],Wt(),he),r.debug("[RtcSessionController]: Added local audio/video stream"),h[1]&&(h[1].isScreen=!0,e.addStream(h[1],Wt(),he),r.debug("[RtcSessionController]: Added local screenshare stream"))}catch(e){return r.error("[RtcSessionController]: Failed to add Local Streams ",e),!1}return!0}function ft(){r.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{[O].forEach((function(e){e&&e.getLocalStreams().forEach((function(t,n){t&&(e.removeStream(t),r.debug("[RtcSessionController]: Removed PeerConnection Stream  #",n))}))}))}catch(e){return r.error("[RtcSessionController]: Failed to remove Local Streams ",e),!1}return!0}function _t(e){e&&(De(e,!0),e.getVideoTracks().length>0&&e.getVideoTracks().forEach((function(e){var t=l.getTrackId(e);t&&delete he[t]})),l.stopMediaStream(e))}function vt(e){var t=e===V?h:V;e&&e.forEach((function(e){t&&-1!==t.indexOf(e)||_t(e)}))}function gt(e){var t=[null,null];e&&e.forEach((function(e,n){e&&e.getVideoTracks().length>0&&(t[n]=e)})),x===t[0]&&W===t[1]||(x=t[0],r.debug("[RtcSessionController]: Set local video stream to ",l.getStreamId(x)||"<null>"),W=t[1],r.debug("[RtcSessionController]: Set local desktop stream to ",l.getStreamId(W)||"<null>"),r.debug("[RtcSessionController]: send LocalVideoStream event"),qe(p.onLocalVideoStream,{stream:W||x,videoStream:x,desktopStream:W}),et())}function Nt(e,t){if(0===t||1===t){if(h[t]!==e){var i,o,a;if(h[t]&&_t(h[t]),h[t]=e,0===t&&Z.video){if(Z.hdVideo){if(Z.videoResolution){var s=f.sdpParameters.hdVideo[Z.videoResolution];i=s&&s.maxBw}o="hdVideo",a=n.VideoQuality.HIGH}else o="video",a=n.VideoQuality.NORMAL;i||(i=f.sdpParameters[o].maxBw)}else 1===t&&Z.desktop&&(o=Z.hdDesktop?"hdScreenShare":"screenShare",i=f.sdpParameters[o].maxBw,Z.remoteControlEnabled&&(i=Math.max(i,f.sdpParameters.rcScreenShare.maxBw)));if(e&&e.getVideoTracks().length>0){var c=e.getVideoTracks()[0];if(c){var d={};if(i&&(d.maxBitrate=1e3*i),0===t&&(a&&(d.quality=a),!Z.hdVideo||f.isCMR||N||(d.degradationPreference=f.degradationPreference),an()&&e.getVideoTracks().length<2)){var u=function(e,t){var n,i=f.sdpParameters.lowVideo;return n=e&&t?i[t].scaleFactor:i.scaleFactor,r.debug("[RtcSessionController]: scaleFactor is "+n+" (hdVideo="+e+", resolution="+t+")"),n}(Z.hdVideo,Z.videoResolution),E=c.clone(),C={quality:n.VideoQuality.LOW,maxBitrate:1e3*f.sdpParameters.lowVideo.maxBw,scaleResolutionDownBy:u,direction:N?"sendonly":"sendrecv"};he[l.getTrackId(E)]=C,e.addTrack(E)}he[l.getTrackId(c)]=d}}gt(h)}}else r.error("[RtcSessionController]: setLocalStream invoked with invalid index:",t)}function mt(e){return!!e&&(l.unifiedPlanEnabled?function(e){var t=!1;return e.getVideoTracks().length?K.some((function(n){return n.streamId===e.mid&&(r.debug("[RtcSessionController]: Updated remote video streamId="+e.mid),n.stream=e,t=!0,!0)}))||(r.debug("[RtcSessionController]: New remote video streamId="+e.mid),K.push({streamId:e.mid,stream:e}),t=!0):e.getAudioTracks().length&&((Y&&Y.streamId)===e.mid?Y.stream!==e&&(Y.stream=e,t=!0):(Y={streamId:e.mid,stream:e},t=!0)),t}(e):function(e){var t=!1;if(e.getVideoTracks().length>0){var n=g?l.getVideoTrackId(e):l.getVideoStreamTrackId(e);r.debug("[RtcSessionController]: Remote video trackId="+n),K.some((function(i){return i.streamId===n&&(i.stream!==e&&(i.stream=e,t=!0),!0)}))||(K.push({streamId:n,stream:e}),t=!0),t&&r.debug("[RtcSessionController]: Updated Remote Video streams:",K)}if(e.getAudioTracks().length>0){var i=g?l.getAudioTrackId(e):l.getAudioStreamTrackId(e);r.debug("[RtcSessionController]: Remote audio trackId="+i),Y&&Y.streamId===i?Y.stream!==e&&(Y.stream=e,t=!0):(Y={streamId:i,stream:e},t=!0),t&&r.debug("[RtcSessionController]: Updated Remote Audio stream:",Y.streamId)}return t}(e))}function ht(e,t){if(e){e instanceof Array||(e=[e]);var n=!1;t&&(Y||K.length)&&(n=!0,Y=null,K=[]),e.forEach((function(e){se.push(e),mt(e)&&(n=!0)})),n&&tt()}}function Ot(e){var t=!1;return h[0]&&(t=l.toggleAudio(h[0],e)),$=!t||!e,V&&V[0]&&l.toggleAudio(V[0],e),t}function Dt(e,t){if(w){var n=b.main.sdpStatus;r.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",n),n===d.AnswerReceived||n===d.AnswerApplied||n===d.AnswerSent?yt():bt("Renegotiation already in progress")}O&&O.iceDisconnectTimeout&&(r.info("[RtcSessionController]: Ignore previous ICE disconnection"),window.clearTimeout(O.iceDisconnectTimeout),delete O.iceDisconnectTimeout),w=!0,G=!!e,H=t||null,F=U,st(B=O),He(B,F),D?e&&O.localDescription?(r.debug("[RtcSessionController]: Using pre-allocated peer connection"),se=[],O=D,D=null,y=[O,P],U=Ve([O]),ke(O,U)):(It(),O=null):O=null,V=h,h=[null,null],ee=s.shallowCopy(Z),j=s.shallowCopy(q),Te=null,pe=null,b.main.sdpStatus=d.None,b.main.localOrigin=null}function Pt(e){if(H){try{!e||e===n.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED||"string"==typeof e&&e.startsWith("res_")||(e="res_ChangeMediaFailed"),H(e)}catch(e){r.error(e)}H=null}}function yt(){r.info("[RtcSessionController]: The media renegotiation was successful");var e=F;F=null;var t=B;B=null,on(e,!0,!t.connectionBypassed).catch((function(){r.warn("[RtcSessionController]: Failed to stop stats for old RTCPeerConnection")})).then((function(){r.info("[RtcSessionController]: Closing the old RTCPeerConnection"),At(t,e)})),fe.msie&&(At(t),t=null),r.info("[RtcSessionController]: Stopping the old MediaStream"),X?z=!0:J&&(z=!1),l.unifiedPlanEnabled||z||Q||Rt(O),vt(V),V=null,ee=null,j=null,gt(h),ht(O.getRemoteStreams(),!0),Ot(!$),X=!1,J=!1,w=!1,ve=!1,te=null,et(),qe(p.onNetworkQuality,{quality:null}),Pt()}function bt(e){r.info("[RtcSessionController]: The media renegotiation has failed: ",e),st(O),At(O,U),b.main.sdpStatus=d.Connected,O=B,U=F,ke(B),B=null,F=null,vt(h),h=V,V=null,gt(h),Z=s.shallowCopy(ee),q=s.shallowCopy(j),ee=null,j=null,X?z=!1:J&&(z=!0),X=!1,J=!1,w=!1,ve&&(_=!0,ve=!1),et(),Pt(e||"res_ChangeMediaFailed")}function Ut(e){Lt(e&&e===P?"res_RemoteControlSessionStopped":"res_CallMediaFailed")}function Lt(e,t){e===n.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?r.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===e?r.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(e=e||"res_RTCError",r.warn("[RtcSessionController]: There was an internal failure. Send error event: ",e)),w?bt(e):t?t(e):$e(e)}function Mt(){pe?(r.info("[RtcSessionController]: Process the pending changeMedia"),Qt(pe.mediaType,pe.cb,pe.options),pe=null):Te&&(r.info("[RtcSessionController]: Process the pending remote description"),p.setRemoteDescription(Te.sdp,Te.cb),Te=null)}function wt(e,t){if(t=t||O){var n=rt(t,"sdpStatus");if(n!==d.PrAnswerReceived||e!==d.Connected){if(n!==e){if(r.debug("[RtcSessionController]: Changed SDP status from "+n+" to "+e),it(t,"sdpStatus",e),t===O)switch(e){case d.AnswerApplied:Mt();break;case d.Connected:t.setMaxBitrate(he),w&&yt(),r.debug("[RtcSessionController]: send SdpConnected event"),qe(p.onSdpConnected,{sdpOrigin:pt(O)}),Mt(),U.start();break;case d.AnswerSent:St(t)}xe(t)}}else r.debug("[RtcSessionController]: Cannot change SDP status to "+e+" without final SDP answer.")}else lt("Could not set SDP status for non existing pc.")}function Gt(e,t){if(!e)return lt("Cannot update local description for non existing pc."),null;r.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",Z);var n=!1,i=a.parse(t.sdp);if(me?r.debug("[RtcSessionController]: Media multiplex enabled!"):a.disableMultiplex(i),v&&(a.removeAudioMediaProtocols(i,["UDP","TLS"]),(e.connectionBypassed||Ae)&&N&&(e.restoreAudioConnectionMode=a.getConnectionMode(i,{mediaType:"audio"}),a.setConnectionMode(i,"audio","inactive")),"offer"===t.type)){var o=i.m[0];o&&"audio"===o.media&&o.a.some((function(e){return"mid"===e.field&&(Ne=e.value,!0)}))}if(z?l.unifiedPlanEnabled||(a.setConnectionMode(i,"both","inactive"),r.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):Z.video||Z.desktop?n=a.hasVideo(i):"answer"===t.type&&(n=a.hasVideo(i))&&oe&&(a.removeVideo(i),n=!1),n){if(Z.video){var s=kt(Z.hdVideo?"hdVideo":"video",Z.videoResolution);a.setXGoogle(i,s),U.setTransmitVideoParams({mediaConstraints:Z,trackConstraints:he,bitRates:s})}Z.desktop&&a.setXGoogle(i,kt(Z.hdDesktop?"hdScreenShare":"screenShare"),i.m.length-1)}a.setOpusParameters(i,f.sdpParameters.audio),f.sdpParameters.preferredVideoCodec!==E&&"offer"===t.type&&a.setPreferredVideoCodec(i,f.sdpParameters.preferredVideoCodec),"offer"===t.type&&a.removeVideoCodecs(i,["H264"]),"answer"!==t.type&&(q={audio:!0,video:n});var c=new l.SessionDescription({type:t.type,sdp:a.stringify(i)});return r.debug("[RtcSessionController]: Finished modifying local SDP"),c}function kt(e,t){var n=s.shallowCopy(f.xGoogle[e]);if(n&&"hdVideo"===e&&t){var i=f.xGoogle.hdVideo[t];i&&Object.assign(n,i)}return n}function Ht(e,t,n,i){if(!e)return lt("Cannot update remote description for non existing pc."),null;r.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",Z),function(e,t,n,i){if("offer"===n&&e===O){var o=rt(e,"disabledRemoteOfferMLines");if(o.removeAll(),_&&!e.desktopPeerConnection&&i){var s=t.m[C];s.port=0,a.setConnectionMode({m:[s]},"video","inactive"),o.add(C,s),t.m[C]=i.sdp,r.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")}}}(e,t,n,i);var o=!1,s=a.hasVideo(t);if(s){var c=a.getVideoConnectionModes(t);r.info("[RtcSessionController]: Remote description has video modes set to ",c),s=!(o=c.every((function(e){return"recvonly"===e}))),function(e,t,n){var i,o;if(Z.desktop&&!e.desktopPeerConnection)o=Z.hdDesktop?"hdScreenShare":"screenShare";else if(Z.hdVideo){if(Z.videoResolution){var s=f.sdpParameters.hdVideo[Z.videoResolution];i=s&&s.maxBw}o="hdVideo"}else o="video";var c=l.unifiedPlanEnabled&&(fe.chrome||N);c?i=T:i||(i=f.sdpParameters[o].maxBw),a.setVideoBandwidth(t,i,!0);var d,u,E=kt(o,Z.videoResolution);if(O.desktopPeerConnection){var C=Z.hdDesktop?"hdScreenShare":"screenShare";i=c?T:f.sdpParameters[C].maxBw,u=f.xGoogle[C],d=n&&n.index,a.setVideoBandwidth(t,i,!0,d),l.unifiedPlanEnabled&&(u.minBitRate||0)>(E.minBitRate||0)&&(E=u,r.debug("[RtcSessionController]: Using X-Google parameters from screenshare: ",E))}a.setXGoogle(t,E),d&&u&&!l.unifiedPlanEnabled&&a.setXGoogle(t,u,d)}(e,t,i)}if(a.setOpusParameters(t,f.sdpParameters.audio),Q!==(Q=!!a.isHold(t)&&("offer"===n||!z&&Z.audio))&&(Q?r.info("[RtcSessionController]: The client has been held"):r.info("[RtcSessionController]: The client has been retrieved")),v){var u=t.m[0];if(u&&"audio"===u.media)u.a.some((function(e){return"mid"===e.field}))||(Ne=Ne||"audio",r.debug("[RtcSessionController]: Adding a=mid:"+Ne+" to SBC's answer SDP"),u.a.push({field:"mid",value:Ne}))}var E=rt(e,"sdpStatus");return"offer"!==n||E!==d.Connected||z||Q||(K.length&&!s?(r.debug("[RtcSessionController]: send RemoteVideoRemoved event"),qe(p.onRemoteVideoRemoved,{})):!K.length&&s&&(r.debug("[RtcSessionController]: send RemoteVideoAdded event"),qe(p.onRemoteVideoAdded,{}))),z||"answer"===n&&o||(q={audio:!0,video:s}),me=_&&"offer"===n&&a.isMultiplexEnabled(t),t}function Vt(){var e=f.candidatesTimeout||2e3;return m>0&&(e+=e*(l.iceTimeoutSafetyFactor||0)),r.debug("[RtcSessionController]: getCandidatesTimeout:",e),e}function Bt(e,t){if(e){var n,i,o,a,s=Be(e);if(r.debug("[RtcSessionController]: Local SDP set for the "+s+" connection."),"offer"===t?(i=rt(e,"trickleIceForOffer"),o=d.OfferPending,a=d.OfferSent):(i=rt(e,"trickleIceForAnswer"),o=d.AnswerPending,a=d.AnswerSent),wt(o,e),i)(n=function(){var e=f.trickleIceTimeout||200;return r.debug("[RtcSessionController]: getTrickleIceTimeout:",e),e}())>0?(r.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending the "+s+" SDP Offer ("+n+"ms)."),window.setTimeout((function(){rt(e,"sdpStatus")===o&&(r.debug("[RtcSessionController]: Trickle ICE timer expired. Send the "+s+" SDP Offer."),Xe(e,a))}),n)):(r.debug("[RtcSessionController]: Trickle ICE is enabled. Send the "+s+" SDP Offer."),Xe(e,a));else{n=Vt();var c=rt(O,"nextPcLocalSdpSetAt");if(c){var l=Date.now()-c;l<n?n-=l:n=0,it(O,"nextPcLocalSdpSetAt",0)}r.debug("[RtcSessionController]: Waiting for "+s+" ICE candidates ("+n+"ms).");var u=window.setTimeout((function(){r.debug("[RtcSessionController]: Timed out waiting for "+s+" candidates."),it(e,"candidatesTimer",null),y.includes(e)?rt(e,"sdpStatus")===o&&(r.debug("[RtcSessionController]: Send the "+s+" session description."),Xe(e,a)):r.warn("[RtcSessionController]: RTCPeerConnection instance for "+s+" connection no longer exists.")}),n);it(e,"candidatesTimer",u)}}else lt("Terminating localSdpSetAndSend for non existing pc.")}function Ft(e,t){r.debug("[RtcSessionController]: Successfully created local audio/video description:",e),t&&r.debug("[RtcSessionController]: Successfully created local screenshare description:",t),!l.unifiedPlanEnabled&&w&&ft(),ot(O);var n=function(n,i){if(i?(r.error("[RtcSessionController]: Failed to apply Local "+n+" description:",i.message||i),Lt()):r.debug("[RtcSessionController]: Local description was successfully applied. PC=",n),O&&Ae)return Xe(O,d.Connected),void(O&&(O.connectionBypassed=!0,He(O,U)));w||et();var o=e&&e.type||t&&t.type;Bt(O,o)};try{if(O&&e){var i=n.bind(null,"audio/video");e=Gt(O,e),O.setLocalDescription(e,i,i),O.startTime=Date.now()}}catch(e){n("unknown",e||"error")}}function xt(){X||z&&!J?(O.oniceconnectionstatechange=null,r.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),wt(d.Connected,O)):rt(O,"sdpStatus")===d.AnswerReceived&&wt(d.AnswerApplied,O)}function Wt(){return!oe&&!v}function Kt(e,t,n){if(e)switch(t){case"offer":var i=!f.disableTrickleIce&&Et(t,n);it(e,"trickleIceForAnswer",i),i?r.info("[RtcSessionController]: Enabled Trickle-ICE for answer."):r.info("[RtcSessionController]: Disabled Trickle-ICE for answer.");break;case"pranswer":case"answer":wt("pranswer"===t?d.PrAnswerReceived:d.AnswerReceived,e),rt(e,"trickleIceForOffer")&&(Et(t,n)||(it(e,"trickleIceForOffer",!1),r.warn("[RtcSessionController]: Disabled Trickle-ICE for offer.")))}else lt("Terminating updateTrickleIceAndStatus for non existing pc.")}function Yt(e){r.debug("[RtcSessionController]: setRemoteDescription()");try{if(!Ge())return void Lt();var t,n,i=O.getLocalStreams(),o=a.parse(e.sdp);if(e.screen){var s=a.findMediaLineIndex(o,e.screen);-1!==s&&(t={sdp:o.m[s],index:s,mid:e.screen},n=a.getSsrcList(t.sdp))}Kt(O,e.type,o);if(O){o=Ht(O,o,e.type,t);var c=new l.SessionDescription({type:e.type,sdp:a.stringify(o)});c.screen=t&&t.sdp,r.debug("[RtcSessionController]: Modified remote audio/video SDP:",c);var d=function(t,n){switch(n?(r.error("[RtcSessionController]: Failed to apply Remote "+t+" description:",n.message||n),Lt()):r.debug("[RtcSessionController]: Remote description was successfully applied. PC=",t),r.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),w||et(),e.type){case"offer":z||Q?i.length>0?(ft(),r.debug("[RtcSessionController]: Removed Local Stream (hold)")):r.debug("[RtcSessionController]: Local Stream has not been set (hold)"):Rt(O),r.debug("[RtcSessionController]: Creating Local Description Answer...");var o={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Wt()}};O.createAnswer((function(e){Ft(e)}),(function(e){e=e||"Unspecified",r.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Lt()}),o,{audioInactive:z});break;case"pranswer":r.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),xt(),St(O);break;case"answer":xt(),St(O);break;default:r.error("[RtcSessionController]: Invalid SDP Type = ",e.type),Lt()}}.bind(null,"audio/video");O.setRemoteDescription(c,d,d),O.desktopRemoteSsrc=n,O.remoteOrigin=a.getOrigin(o).trim(),O.startTime=Date.now()}}catch(e){r.error(e),Lt()}}function qt(){it(O,"nextPcLocalSdpSetAt",0),At(O),O=null}function jt(){if(r.debug("[RtcSessionController]: renegotiateMedia()"),Ge()){z?r.debug("[RtcSessionController]: Local Stream has not been set (holding)"):Rt(O),r.debug("[RtcSessionController]: Creating Local Descriptions...");var e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Wt()}};try{me=!1;var t=O.localDescription;if(t)if(z){if(l.unifiedPlanEnabled)return qt(),void jt();t=Gt(O,t),O.setLocalDescription(t,(function(){it(O,"nextPcLocalSdpSetAt",Date.now()),r.debug("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Local description was successfully re-applied"),Bt(O,t.type)}),(function(e){r.warn("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Error re-setting local description. Creating new peer connection: ",e),qt(),jt()}))}else Bt(O,t.type);else O.createOffer((function(e){Ft(e)}),(function(e){e=e||"Unspecified",r.error("[RtcSessionController]: Failed to create audio/video Local Description: ",e.message||e),Lt()}),e,{audioInactive:z})}catch(e){r.error(e),Lt()}}else Lt()}function Qt(e,t,n){if(O&&rt(O,"sdpStatus")===d.AnswerReceived)return r.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(pe={mediaType:e,cb:t,options:n});if(Zt()){k=!!(n=n||{}).changeDesktopMedia,n.isDirectUpgradingToConf&&(_=!1,ve=!0);var i,o,a=s.shallowCopy(Z);"boolean"==typeof e.audio&&(a.audio=e.audio),"boolean"==typeof e.video&&(a.video=e.video),"boolean"==typeof e.hdVideo&&(a.hdVideo=e.hdVideo),e.videoResolution&&(a.videoResolution=e.videoResolution),"boolean"==typeof e.desktop&&(a.desktop=e.desktop),"boolean"==typeof e.hdDesktop&&(a.hdDesktop=e.hdDesktop),"boolean"==typeof e.screenControl&&(a.screenControl=e.screenControl),e.minFrameRate&&(a.minFrameRate=e.minFrameRate),a=A(a),!D||!ge&&(o=a,(i=Z)&&o&&Object.keys(i).every((function(e){return i[e]===o[e]})))||(r.info("[RtcSessionController]: Media constraints are changing. Discard pre-allocated connection."),It()),Dt(!0,t),Z=a,O?(h=V,jt()):(n.videoOptions&&n.videoOptions.mediaStream&&function(e,t){if(V[0]){if(t.audio)if(!e.getAudioTracks().length){var n=V[0].getAudioTracks()[0];n&&e.addTrack(n.clone())}p.setLocalStream(0,e)}}(n.videoOptions.mediaStream,a),be(jt,Lt,n.screenShareOptions))}else en(t,"Connection not stable")}function zt(){B&&(r.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),At(B,F),B=null),O&&(r.debug("[RtcSessionController]: Closing the RTCPeerConnection"),At(O,U),O=null),P&&(r.debug("[RtcSessionController]: Closing the screen control peer connection"),At(P),P=null),It()}function Xt(){r.debug("[RtcSessionController]: Closing the RTC session controller"),q={audio:!1,video:!1},Ie&&o.unregEvtHandlers(Ie),y.forEach((function(e){wt(d.None,e),ot(e),at(e),st(e)}));var e,t=F||U;if(t){var n=B||O;on(t,!1,!!n&&!n.connectionBypassed).catch((function(){r.warn("[RtcSessionController]: Failed to stop stats collection")})).then((function(){r.info("[RtcSessionController]: Closing all RTCPeerConnection instances"),zt()}))}else zt();V&&(r.debug("[RtcSessionController]: Stopping the old MediaStream"),vt(V),V=null),b.main.localOrigin=null,b.screenControl.localOrigin=null,w=!1,X=!1,J=!1,z=!1,Q=!1,$=!1,te=null,ce=!1,le=!1,de=null,Nt(null,0),Nt(null,1),(Y||K.length)&&(Y=null,K=[],tt()),r.debug("[RtcSessionController]: send Closed event"),qe(p.onClosed,{}),Se=!0,e=(e=["onQosAvailable"])||[],sn.forEach((function(t){e.includes(t)||(p[t]=null)}))}function Jt(){if(!O)return r.error("[RtcSessionController]: PeerConnection not setup"),!1;if(te)return r.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var e=O.getLocalStreams();if(!(e.length>0))return r.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var t=e[0].getAudioTracks();return t.length>0?!!(te=O.createDTMFSender(t[0]))&&(te.ontonechange=Ye.bind(null,O),r.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+t[0].label),!0):(r.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function $t(e){if(r.debug("[RtcSessionController]: startConn()"),e)Yt(e);else{Rt(O),r.debug("[RtcSessionController]: Creating Local Description...");var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Wt()}};me=!1,O.createOffer((function(e){Ft(e)}),(function(e){e=e||"Unspecified",r.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Lt()}),t,{audioInactive:z})}}function Zt(e){if(!(e=e||O))return r.debug("[RtcSessionController]: isConnStable: There is no connection"),!1;var t=rt(e,"sdpStatus");return t===d.AnswerReceived||t===d.AnswerApplied?(r.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):t===d.AnswerSent?(r.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):w?(r.warn("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==e.signalingState&&!e.connectionBypassed&&(r.warn("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",e.signalingState),!re))}function en(e,t){"function"==typeof e&&window.setTimeout((function(){e(t)}),0)}function tn(){P&&(r.debug("[RtcSessionController]: Closing the old screen control peer connection"),At(P),P=null,b.screenControl.localOrigin=null);var e={};L.length&&(e.iceServers=[{urls:L,credential:M.password,username:M.username}]),r.debug("[RtcSessionController]: Creating RtcPeerConnection for the screen control session. config: ",e);var t={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};r.debug("[RtcSessionController]: Creating peer connection for the screen control session. constraints:",t);var n={offerToReceiveAudio:0,offerToReceiveVideo:0,isScreenControlled:ce,isScreenOwner:le,screenControlChannelName:"SCREEN_CONTROL"};r.debug("[RtcSessionController]: Creating peer connection for the screen control session. options:",n);try{P=new l.PeerConnection(e,t,n),y=[O,P],b.screenControl.sdpStatus=d.None,r.debug("[RtcSessionController]: Created a peer connection for the screen control session.")}catch(e){return P=null,r.error("[RtcSessionController]: Failed to create a peer connection for the screen control session.",e),!1}return ke(P),!0}function nn(e,t){r.debug("[RtcSessionController]: Successfully created local screen control description: ",e);try{if(P&&e){var n=function(t,n){if(n)r.error("[RtcSessionController]: Failed to apply Local "+t+" description: ",n.message||n);else{r.debug("[RtcSessionController]: Local description for the screen control session was successfully applied. PC=",t);var i=e&&e.type;Bt(P,i)}}.bind(null,"screen control");P.setLocalDescription(e,n,n),P.startTime=Date.now()}}catch(e){t&&t(e)}}function rn(e,t){var n=a.parse(e.sdp);Kt(P,e.type,n);if(P){var i=function(n,i){switch(i?r.error("[RtcSessionController]: Failed to apply Remote "+n+" description:",i.message||i):r.debug("[RtcSessionController]: Remote description was successfully applied. PC=",n),e.type){case"offer":r.debug("[RtcSessionController]: Creating Local Description Answer...");P.createAnswer((function(e){nn(e,t)}),(function(e){e=e||"Unspecified",r.error("[RtcSessionController]: Failed to create a Local Description for the screen control peer connection: ",e.message||e)}),{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},{audioInactive:z});break;case"pranswer":r.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),b.screenControl.sdpStatus===d.AnswerReceived&&wt(d.AnswerApplied,P),St(P);break;case"answer":r.debug("[RtcSessionController]: Received answer, applying media SDP"),b.screenControl.sdpStatus===d.AnswerReceived&&wt(d.AnswerApplied,P),St(P);break;default:r.error("[RtcSessionController]: Invalid SDP Type = ",e.type)}}.bind(null,"screen control");P.setRemoteDescription(e,i,i),P.remoteOrigin=a.getOrigin(n).trim(),P.startTime=Date.now()}}function on(e,n,i){if(e){var o=function(e){var t=B||O,n=rt(t,"sdpStatus");return e||!!t&&(n===d.AnswerReceived||n===d.PrAnswerReceived||n===d.AnswerApplied||n===d.AnswerSent||n===d.Connected||n===d.None)}(n);return e.stop().then((function(t){i&&o&&t&&function(e,t,n,i){r.debug("[RtcSessionController]: send QosAvailable event"),qe(p.onQosAvailable,{qos:e,renegotiationInProgress:t,lastSavedStats:n,streamQualityData:i})}(t,n,e.getLastSavedStats(),e.getStreamQualityData()),n||(p.onQosAvailable=null)}))}return n||(p.onQosAvailable=null),t.resolve()}function an(){return!_&&!ue&&f.addAdditionalLowVideoStream&&l.unifiedPlanEnabled}var sn=["onIceCandidate","onSessionDescription","onSdpConnected","onIceConnected","onIceDisconnected","onRemoteVideoAdded","onRemoteVideoRemoved","onRemoteStreamUpdated","onDTMFToneChange","onClosed","onRtcError","onRtcWarning","onLocalStreamEnded","onScreenSharePointerStatus","onMediaUpdate","onLocalVideoStream","onRemoteStreams","onGetUserMediaException","onQosAvailable","onStatsNoOutgoingPackets","onStatsThresholdExceeded","onNetworkQuality"];sn.forEach((function(e){p[e]=null})),Object.defineProperty(this,"dontReuseAudioStream",{get:function(){return ge},set:function(e){r.debug("[RtcSessionController]: Setting dontReuseAudioStream to:",!!e),ge=!!e},enumerable:!0,configurable:!1}),this.setTurnCredentials=function(e){M=e||{}},this.setTurnUris=function(e){e&&e.length&&(f.customTurnServers.length?(r.debug("[RtcSessionController]: Adding custom TURN servers to this session:",f.customTurnServers),L=f.customTurnServers.concat(e)):L=e,fe.firefox&&(L=L.filter((function(e){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(e)}))))},this.getLocalVideoStream=function(){return W||x},this.getLocalDesktopStream=function(){return W},this.getRemoteAudioStream=function(){return Y},this.getRemoteVideoStreams=function(){return K},this.getSdpStatus=function(){return b.main.sdpStatus},this.getWarmedUpSdp=function(){return ie},this.isHolding=function(){return z&&!X||J},this.isHoldInProgress=function(){return X},this.isRetrieveInProgress=function(){return J},this.isHeld=function(){return Q},this.getActiveMediaType=function(){return s.shallowCopy(q)},this.getMediaConstraints=function(){return s.shallowCopy(Z)},this.getLocalMediaType=function(){return{audio:Z.audio&&q.audio,video:Z.video&&q.video,desktop:Z.desktop&&q.video}},this.hasScreenShare=function(){return!!W},this.isScreenControlled=function(){return!!ce},this.warmup=function(e,t,n,i,o){return n=n||function(){},i=i||function(){},Se?(r.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void en(i,"res_UnexpectedError")):(a.isNoOfferSdp(t)&&(t=null),e=A(e),r.info("[RtcSessionController]: Warming up the connection - mediaType = ",e),l.enabled?O&&b.main.sdpStatus!==d.None?(r.error("[RtcSessionController]: The connection has already been started"),void en(i,"res_UnexpectedError")):((Z=e).audio||($=!0),void be((function(){t&&(ie=t),ne=!0,Ge(),n()}),(function(e){Lt(e,i)}),o)):(r.warn("[RtcSessionController]: WebRTC not supported by browser"),void en(i,"res_NoWebRTC")))},this.start=function(e,t){if(Se)return r.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(e=A(e),r.info("[RtcSessionController]: Start Connection - mediaType =",e),!l.enabled)return r.warn("[RtcSessionController]: WebRTC not supported by browser"),Ze("res_NoWebRTC"),!1;if(O&&b.main.sdpStatus!==d.None)return r.error("[RtcSessionController]: The connection has already been started"),Ze("res_UnexpectedError"),!1;if(r.debug("[RtcSessionController]: Creating Peer Connection..."),ne){if(t=ie,ie=null,$=!e.audio,!Ge())return Ze("res_RTCError"),!1;if(e.audio===Z.audio&&e.video===Z.video&&e.hdVideo===Z.hdVideo&&e.desktop===Z.desktop)return $t(t),!0;Nt(null,0)}return Ge()?(Z=e,be((function(){$t(t)}),Lt),!0):(Ze("res_RTCError"),!1)},this.addIceCandidates=function(e,t){r.info("[RtcSessionController]: Add remote ICE candidates");var n=e?null:O;n?e!==n.remoteOrigin?n=null:(r.warn("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),r.debug("[RtcSessionController]: ICE candidate origin: ",e),r.debug("[RtcSessionController]: SDP origin: ",n.remoteOrigin)):y.forEach((function(t){t&&e===t.remoteOrigin&&(n=t)})),n?(t.forEach((function(e){(e=JSON.parse(e)).candidate&&(e.candidate=e.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),r.debug("[RtcSessionController]: Remote ICE candidate",e),e.candidate&&"end-of-candidates"!==e.candidate?n.addIceCandidate(e):r.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")})),St(n)):r.warn("[RtcSessionController]: Ignoring remote ICE candidate - no valid peer connection found.")},this.setRemoteDescription=function(e,t){if(r.info("[RtcSessionController]: Set Remote Description - type: ",e.type),ie=null,O&&b.main.sdpStatus===d.AnswerReceived)return r.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void(Te={sdp:e,cb:t});if(O&&b.main.sdpStatus===d.PrAnswerReceived)return"answer"===e.type&&(wt(d.AnswerReceived,O),St(O)),r.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void en(t);if("offer"===e.type){if(!Zt())return void en(t,"Connection not stable");Dt(!1,t),be((function(){Yt(e)}),Lt)}else"sdp"===e.sdp?(wt(d.AnswerReceived,O),w&&yt(),St(O)):Yt(e),en(t)},this.renegotiateMedia=function(e){r.info("[RtcSessionController]: Start Media Renegotiation from client"),Zt()||en(e,"Connection not stable"),Dt(!0,e),be(jt,Lt)},this.enableRemoteVideo=function(){oe&&(r.info("[RtcSessionController]: Enable receiving remote video"),oe=!1)},this.disableRemoteVideo=function(){oe||(r.info("[RtcSessionController]: Disable receiving remote video"),oe=!0)},this.enableRemoteVideoScreenOnly=function(){ae||(r.info("[RtcSessionController]: Allow receiving only remote screen share"),ae=!0)},this.disableRemoteVideoScreenOnly=function(){ae&&(r.info("[RtcSessionController]: Disable receiving only remote screen share"),ae=!1)},this.addAudio=function(e){r.info("[RtcSessionController]: Add Audio"),Qt({audio:!0},e)},this.removeAudio=function(e){r.info("[RtcSessionController]: Remove Audio"),Qt({audio:!1},e)},this.addVideo=function(e){r.info("[RtcSessionController]: Add Video"),Qt({video:!0},e)},this.removeVideo=function(e){r.info("[RtcSessionController]: Remove Video"),Qt({video:!1},e)},this.addDesktop=function(e){r.info("[RtcSessionController]: Add Desktop (screen sharing)"),Qt({desktop:!0},e)},this.removeDesktop=function(e){r.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Qt({desktop:!1},e)},this.changeMediaType=function(e,t,n){if(r.info("[RtcSessionController]: Change media type: ",e),t&&r.info("[RtcSessionController]: Change media options: ",t),!e)return r.warn("[RtcSessionController]: Invalid media type"),void en(n,"Invalid media type");Qt(e,n,t)},this.holdCall=function(e){if(r.info("[RtcSessionController]: Hold Call"),Zt()){if(z)return r.warn("[RtcSessionController]: The call is already held"),void en(e);z=!0,X=!0,Dt(!0,e),be(jt,Lt)}else en(e,"Connection not stable")},this.retrieveCall=function(e){if(r.info("[RtcSessionController]: Retrieve Call"),Zt()){if(!z)return r.warn("[RtcSessionController]: The call is not held"),void en(e);z=!1,J=!0,Dt(!0,e),be(jt,Lt)}else en(e,"Connection not stable")},this.getScreenControlData=function(){return{isScreenControlled:ce,isScreenOwner:le,hasScreenControlPc:!!P}},this.updateScreenControlData=function(e,t){ce=!!e,le=!!t,t&&o.setControllingScreen()},this.offerScreenControl=function(e){if(ce){if(tn()){ot(P);try{P.createOffer((function(t){nn(t,e)}),(function(t){t=t||"Unspecified",r.error("[RtcSessionController]: Failed to create the Local Description for the screen control peer connection: ",t.message||t),e&&e(t)}),{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}catch(t){r.error(t),e&&e(t)}}}else r.error("Local variables are out of date. The screen control session cannot be initiated.")},this.establishScreenControl=function(e,t){"offer"===e.type?tn()&&rn(e,t):(rn(e,t),en(t))},this.stopScreenControl=function(e){if(e=e||function(){},ce=!1,le=!1,P)try{r.debug("[RtcSessionController]: Closing the screen control peer connection."),b.screenControl.localOrigin=null,At(P),P=null,e()}catch(t){r.error(t),e(t)}else r.warn("[RtcSessionController]: There is no active screen control peer connection to close."),e()},this.renegotiationFailed=function(e){w&&(H||$e("res_RTCError"),bt(e))},this.mute=function(e){r.info("[RtcSessionController]: Mute Call"),Ot(!1),en(e)},this.unmute=function(e){var t;r.info("[RtcSessionController]: Unmute Call"),Ot(!0)||(t="res_UnmuteFailedNoMic"),en(e,t)},this.isMuted=function(){return $},this.isLocalMuteAllowed=function(){return $||h[0]&&h[0].getAudioTracks().length},this.setCallStatsOptions=function(e){U&&e&&(r.debug("[RtcSessionController]: Setting call stats options: ",e),U.setOptions(e))},this.terminate=function(){r.info("[RtcSessionController]: Terminate the RTC session controller"),Xt()},this.canSendDTMFDigits=function(){return!(!te&&!Jt())&&(te&&te.canInsertDTMF)},this.sendDTMFDigits=function(e){if(r.info("[RtcSessionController]: Send DTMF Digits - num of digits: ",e&&e.length),!Zt())return!1;if(!te&&!Jt())return!1;if(!te.canInsertDTMF)return r.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits"),!1;try{te.insertDTMF(e,200,50)}catch(e){return r.error("[RtcSessionController]: Send DTMF Digits exception:",e.message),!1}return!0},this.sendDataMessage=function(e){var t=!1;return P&&P.sendDataMessage&&(t=P.sendDataMessage(e)),t},this.setMockedCall=function(){re=!0},this.getCurrentPeerConnection=function(){return O&&O.mainPeerConnection},this.getNumberOfExtraVideoChannels=function(){return m},this.isConnStable=function(){return Zt()},this.isConnected=function(){return b.main.sdpStatus===d.Connected||w},this.disableIncomingVideo=function(){se.forEach((function(e){e.getVideoTracks().length>0&&(e.getVideoTracks()[0].enabled=!1)}))},this.enableIncomingVideo=function(){se.forEach((function(e){e.getVideoTracks().length>0&&(e.getVideoTracks()[0].enabled=!0)}))},this.getLocalStream=function(e){return h[e]},this.setLocalStream=function(e,t){h[e]=t},this.replaceLocalStream=function(e,t){h[e]&&h[e]!==t&&_t(h[e]),h[e]=t},this.getRemoteStreams=function(){return se},this.setIgnoreTurnOnNextPC=function(){r.debug("[RtcSessionController]: setIgnoreTurnOnNextPC..."),Ce=!0},this.setIgnoreNextConnection=function(){r.debug("[RtcSessionController]: setIgnoreNextConnection..."),Ae=!0},this.getLastSavedStats=function(){var e=F||U;return e?e.getLastSavedStats():null},this.prepareForRenegotiation=function(){_&&!ut(O,"offer")&&function(){if(!D)if(r.debug("[RtcSessionController]: Pre-allocate the next peer connection"),Ge(!0)){var e=D;if(e.onicecandidate=function(e){r.debug("[RtcSessionController]:[Pre-allocated PC]: New ICE candidate: ",e.candidate)},Rt(e)){var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:Wt()}};e.createOffer((function(t){r.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully created"),t=Gt(e,t),e.setLocalDescription(t,(function(){it(O,"nextPcLocalSdpSetAt",Date.now()),r.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully applied")}),(function(e){r.warn("[RtcSessionController]:[Pre-allocated PC]: Error setting local description: ",e),It()})),r.debug("[RtcSessionController]:[Pre-allocated PC]: Created local offer")}),(function(e){r.warn("[RtcSessionController]:[Pre-allocated PC]: Error creating local offer: ",e),It()}),t),window.setTimeout((function(){e===D&&It()}),3e4)}else r.warn("[RtcSessionController]:[Pre-allocated PC]: Local streams could not be added. Closing peer connection."),It()}else r.warn("[RtcSessionController]:[Pre-allocated PC]: Peer connection could not be created.")}()},this.changeInputDevices=function(e){return r.info("[RtcSessionController]: Change input devices to ",e),e&&(e.audio||e.video)?new t((function(t,n){var i=function(e){r.error("[RtcSessionController]: Could not change input devices: ",e),n(e)},o=function(){r.info("[RtcSessionController]: Successfully changed input devices"),t()};if(l.unifiedPlanEnabled&&!e.video){fe.firefox&&p.replaceLocalStream(0,null),r.debug("[RtcSessionController]: Attempting to change input devices: ",e);var a=h[0];Ue((function(){var e=h[0];O.replaceTrack(a.getAudioTracks()[0],e.getAudioTracks()[0]).then(o).catch(i)}),i,e)}else p.changeMediaType(Z,(function(e){e?i(e):o()}))})):t.reject("No new input devices specified")},this.adaptScreenShareForRemoteControl=function(e){var t;if(Z.desktop&&de&&(e=!!e,Z.remoteControlEnabled!==e)){var n=h[1];n&&n.getVideoTracks().length>0?(r.debug("[RtcSessionController]: Calling adaptScreenShareForRemoteControl with remoteControlEnabled = ",e),t=n.getVideoTracks()[0],Z.remoteControlEnabled=e,_t(n),Le((function(){var e=p.getLocalStream(1);e&&e.getVideoTracks().length>0?O.replaceTrack(t,e.getVideoTracks()[0]):i("Missing new stream")}),i,de)):r.warn("[RtcSessionController]: Cannot adapt screen share for remote control as there is no screen share stream")}function i(t){r.warn("[RtcSessionController]: Could not fetch new desktop stream with remoteControlEnabled="+e+". ",t),e&&p.adaptScreenShareForRemoteControl(!1)}},this.getAvailableVideoReceivers=function(e){return O&&O.getAvailableVideoReceivers(e)||[]},r.debug("[RtcSessionController]: Created new RtcSessionController instance")}return f.DEFAULT_CANDIDATES_TIMEOUT=2e3,f.DEFAULT_TRICKLE_ICE_TIMEOUT=200,f.DEFAULT_ENABLE_AUDIO_AGC=!0,f.DEFAULT_UPSCALE_FACTOR=1.5,f.LOCAL_STREAMS=S,f.DEGRADATION_MODE=C,f.candidatesTimeout=2e3,f.trickleIceTimeout=200,f.enableAudioAGC=!0,f.screenshareUpscaleFactor=1.5,f.cmrScreenshareUpscaleFactor=1.5,f.allowAllIceCandidatesScreenShare=!0,f.disableTrickleIce=!1,f.allowOnlyRelayCandidates=!1,f.mediaNode=null,f.playbackDevices=[],f.recordingDevices=[],f.ringingDevices=[],f.videoDevices=[],f.sdpParameters=JSON.parse(JSON.stringify(T)),f.xGoogle=JSON.parse(JSON.stringify(p)),f.customTurnServers=[],f.maxVideoExtraChannels=null,f.degradationPreference=C.MAINTAIN_RESOLUTION,f.addAdditionalLowVideoStream=!s.isMobile(),f.disableDesktopPc=!1,f.webRTCIPHandlingPolicy=null,f.isCMR=!1,f.processClientSettings=function(t){try{t=t||{},f.allowAllIceCandidatesScreenShare=void 0===t.allowAllIceCandidatesScreenShare||!!t.allowAllIceCandidatesScreenShare,f.disableTrickleIce=void 0!==t.disableTrickleIce&&!!t.disableTrickleIce,f.screenshareUpscaleFactor=parseFloat(t.screenshareUpscaleFactor,10)||f.DEFAULT_UPSCALE_FACTOR,f.cmrScreenshareUpscaleFactor=parseFloat(t.cmrScreenshareUpscaleFactor,10)||f.DEFAULT_UPSCALE_FACTOR;var n=t.xGoogle||{};Object.keys(p).forEach((function(e){f.xGoogle[e]=void 0!==n[e]?n[e]:JSON.parse(JSON.stringify(p[e]))}));var i=t.sdpParameters||{};Object.keys(T).forEach((function(e){f.sdpParameters[e]=void 0!==i[e]?i[e]:JSON.parse(JSON.stringify(T[e]))})),f.degradationPreference=void 0!==t.degradationPreference?t.degradationPreference:C.MAINTAIN_RESOLUTION,f.addAdditionalLowVideoStream=void 0!==t.addAdditionalLowVideoStream?t.addAdditionalLowVideoStream:!s.isMobile(),e.WebRTCAdapter.useReducedAudioConstraints=void 0===t.useReducedAudioConstraints||!!t.useReducedAudioConstraints,r.info("[RtcSessionController]: Updated RtcSessionController values: ",{allowAllIceCandidatesScreenShare:f.allowAllIceCandidatesScreenShare,disableTrickleIce:f.disableTrickleIce,screenshareUpscaleFactor:f.screenshareUpscaleFactor,cmrScreenshareUpscaleFactor:f.cmrScreenshareUpscaleFactor,xGoogle:f.xGoogle,sdpParameters:f.sdpParameters,useReducedAudioConstraints:e.WebRTCAdapter.useReducedAudioConstraints})}catch(e){r.error("[RtcSessionController]: Error processing client settings. ",e)}},f.overridePromise=function(e){void 0===t&&(t=e)},e.RtcSessionController=f,e.Enums=e.Enums||{},e.Enums.SdpStatus=d,e}((Circuit=function(e){"use strict";var t,n=e.CallStats,i=e.logger,r=e.Enums.RtpQualityLevel,o=e.RtpStatsConfig,a=e.Utils,s=a.isMobile(),c=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:s?2:3,reportIssues:!0},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:s?2:3,reportIssues:!0},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:s?2:3,reportIssues:!0},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:s?0:3,reportIssues:!0},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:s?2:3,reportIssues:!0},ECHO_LIKELIHOOD:{StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:.5,RecurrenceThreshold:s?2:3,reportIssues:!1}}),l=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:s?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:s?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:s?0:3}});void 0!==window.Promise&&(t=window.Promise);var d=a.getBrowserInfo();function u(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function E(t,n,i){var r;return t.a.some((function(t){if("candidate"===t.field&&t.value){var o=new e.IceCandidate(t.value);if(o.typ===i&&o["network-id"]===n["network-id"])return r=o.address,!0}return!1})),r}function C(e){var t=a.parseIpWithPort(e.stat("googLocalAddress"))||{},n=a.parseIpWithPort(e.stat("googRemoteAddress"))||{};return{ipl:t.ipAddress,ptl:t.port,ipr:n.ipAddress,ptr:n.port,lct:u(e.stat("googLocalCandidateType")),rct:u(e.stat("googRemoteCandidateType")),tt:e.stat("googTransportType")}}function T(t,i,r,o,a){if(!i||!r)return null;var s={startTime:t,pcType:o,audio:{},video:{}},c={audio:{},video:{}},l={},T=i.result?i.result():i;if(!Array.isArray(T))return null;if(T.forEach((function(e){if(e){var t=null;switch(e.type){case"googCandidatePair":"true"===e.stat("googActiveConnection")&&function(e,t,n,i){"Channel-audio-1"===e.stat("googChannelId")?(t.audio.rtt=parseInt(e.stat("googRtt"),10),i&&(n.audio.local=e.stat("localCandidateId"),d.firefox?n.audio.remote=e.stat("remoteCandidateId"):t.audio.channelInfo=C(e))):(t.video.rtt=parseInt(e.stat("googRtt"),10),i&&(n.video.local=e.stat("localCandidateId"),d.firefox?n.video.remote=e.stat("remoteCandidateId"):t.video.channelInfo=C(e)))}(e,s,c,a);break;case"ssrc":t=function(e,t){var n=null,i={id:e.id,ssrc:e.stat("ssrc"),timestamp:e.timestamp};return e.stat("audioInputLevel")?(t.audio.transmit||(t.audio.transmit=i),n=t.audio.transmit):e.stat("audioOutputLevel")?(t.audio.receive||(t.audio.receive=i),n=t.audio.receive):e.stat("googFrameHeightSent")?(t.video.transmit||(t.video.transmit=i),n=t.video.transmit):e.stat("googFrameHeightReceived")&&(t.video.receive||(t.video.receive=i),n=t.video.receive),n}(e,s);break;case"VideoBwe":s.video.bw||(s.video.bw={id:e.id}),t=s.video.bw;break;case"localcandidate":case"remotecandidate":l[e.id]=e}if(e.names&&t)(e.names()||[]).forEach((function(i){n[i]&&(t[n[i]]=parseFloat(e.stat(i)))})),t.en=e.stat("googCodecName")}})),a){var p;["audio","video"].forEach((function(t){var n=s[t]||{},i=l[c[t].local];if(i){if(!n.channelInfo){var o=l[c[t].remote];n.channelInfo=function(e,t){return{ipl:e&&e.stat("ipAddress"),ptl:e&&e.stat("portNumber"),ipr:t&&t.stat("ipAddress"),ptr:t&&t.stat("portNumber"),lct:e&&u(e.stat("candidateType")),rct:t&&u(t.stat("candidateType")),tt:e&&e.stat("transport")}}(i,o)}n.channelInfo.ni=i.stat("networkType"),p=p||e.sdpParser.parse(r.localDescription&&r.localDescription.sdp),n.channelInfo.candidate=function(t,n,i){var r,o,a={};if(!t||!n||!i)return a;var s=u(t.stat("candidateType"));return"prflx"===s?o=t.stat("ipAddress"):r=String(t.stat("portNumber")),("string"==typeof n?e.sdpParser.parse(n):n).m.some((function(n){return n.media===i&&(n.a.some((function(i){if("candidate"!==i.field)return!1;if(i.value){var c;if(r&&i.value.indexOf(r)>=0&&(c=new e.IceCandidate(i.value),String(c.port)===r&&s===c.typ))return a.value=i.value,"host"===s?(a.hAddr=t.stat("ipAddress"),a.sAddr=E(n,c,"srflx")):(a.sAddr="srflx"===s?c.address:c.raddr,a.hAddr=E(n,c,"host"),"relay"===s&&(a.tt=c.getRelayClientTransportType())),!0;if(o&&i.value.indexOf("srflx")>=0&&"srflx"===(c=c||new e.IceCandidate(i.value)).typ&&String(c.address)===o)return a.sAddr=o,a.hAddr=E(n,c,"host"),!0}return!1})),!0)})),a}(i,p,t)}}))}return s}function p(e,n,r,o){return e.getStats?e.getStats().catch((function(e){i.warn("[CallStatsHandler]: getStats["+n+"] failed with err = ",e)})).then((function(t){return t?t=T(r,t,e,n,o):i.warn("[CallStatsHandler]: getStats["+n+"] did not return a response"),t})):t.resolve()}function S(n){if(!Array.isArray(n))throw new Error("peerConnections must be an array");var a=n.filter((function(e){return e}));if(!n.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var s,d,u,E,C,T,S={},I=null,A=null,R=0,f=[],_=[],v=[],g=[],N=[],m=this;function h(e){var n=[],r=!T;return T=T||r,a.forEach((function(t){t&&(e||"completed"===t.iceConnectionState||"connected"===t.iceConnectionState?(t.mainPeerConnection&&(n.push(p(t.mainPeerConnection,"AUDIO/VIDEO",t.startTime,r)),t.groupPeerConnections.forEach((function(e){n.push(p(e,"AUX_VIDEO",t.startTime,r))}))),t.desktopPeerConnection&&n.push(p(t.desktopPeerConnection,"SCREEN_SHARE",t.startTime,r))):i.warn("[CallStatsHandler]: Do not collect stats. pc.iceConnectionState = ",t.iceConnectionState))})),new t((function(e){t.all(n).then((function(t){(t=t&&t.filter((function(e,t){return e&&(e.audio&&!e.audio.channelInfo&&_[t]&&(e.audio.channelInfo=_[t]),e.video&&!e.video.channelInfo&&v[t]&&(e.video.channelInfo=v[t])),e})))&&t.length?e(t):e()}))}))}function O(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.ps||0),(e.pl-n)/(e.ps-i||-1)}function D(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.pr||0),(e.pl-n)/(e.pr-i+e.pl-n||-1)}function P(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function y(e,t,n,r,o,a){var s;t.reportIssues?s=e[t.StatText]||{}:s={counter:(e[t.StatText]||{}).counter};var c=t.StatText+"LastViStart",l=t.StatText+"Violations",d=t.StatText+"ViCounter";if(o[c]=a&&a[c],o[l]=a&&a[l],o[d]=a&&a[d]||0,-1===n){if(o[c]){var u=o[l];u=u?u+",":"",o[l]=u+"("+o[c]+","+parseInt((Date.now()-r)/1e3,10)+")",o[d]++,delete o[c]}s.reported?s.counter++:s.counter&&(delete e[t.StatText],i.debug("[CallStatsHandler]: issueCounter cleared=",t.StatText))}else s.reported?(s.counter=0,s.value=n):s.counter?(s.counter++,s.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},o[d]<20&&(o[c]=parseInt((Date.now()-r)/1e3,10)))}function b(e){if(e&&e.length){var t=!1;e.forEach((function(e,n){var r,a=e.audio&&e.audio.transmit,s=e.audio&&e.audio.receive,d=g[n]||{},u=N[n]||{},E=f[n]||{};s&&E.audio&&E.audio.receive&&!S.sendOnlyStream&&y(d,c.NO_PACKETS_RECV,!(s.pr>E.audio.receive.pr)||-1,e.startTime,e.audio,E.audio);var T,p=c.GOOG_JITTER_RECEIVED;s&&(P(s,E.audio&&E.audio.receive,c.GOOG_JITTER_RECEIVED.StatName),y(d,p,(T=s[p.StatName])&&T>=p.Threshold?T:-1,e.startTime,e.audio,E.audio)),p=c.PACKET_LOSS_SEND,a&&a.pl&&a.ps&&y(d,p,(r=O(a,E.audio&&E.audio.transmit))>=p.Threshold?r:-1,e.startTime,e.audio,E.audio),p=c.PACKET_LOSS_RECV,s&&s.pl&&s.pr&&y(d,p,(r=D(s,E.audio&&E.audio.receive))>=p.Threshold?r:-1,e.startTime,e.audio,E.audio),e.audio&&R>o.DELAY_RTT_PROCESSING&&(P(e.audio,E.audio,c.GOOG_RTT.StatName),y(d,p=c.GOOG_RTT,e.audio.rtt>=p.Threshold?e.audio.rtt:-1,e.startTime,e.audio,E.audio)),p=c.ECHO_LIKELIHOOD,a&&(P(a,E.audio&&E.audio.transmit,c.ECHO_LIKELIHOOD.StatName),y(d,p,(T=a[p.StatName])&&T>=p.Threshold?T:-1,e.startTime,e.audio,E.audio)),a=e.video&&e.video.transmit,s=e.video&&e.video.receive,p=l.PACKET_LOSS_SEND,a&&a.pl&&a.ps&&y(u,p,(r=O(a,E.video&&E.video.transmit))>=p.Threshold?r:-1,e.startTime,e.video,E.video),p=l.PACKET_LOSS_RECV,s&&s.pl&&s.pr&&y(u,p,(r=D(s,E.video&&E.video.receive))>=p.Threshold?r:-1,e.startTime,e.video,E.video),(a||s)&&R>o.DELAY_RTT_PROCESSING&&(P(e.video,E.video,l.GOOG_RTT.StatName),y(u,p=l.GOOG_RTT,e.video&&e.video.rtt>=p.Threshold?e.video.rtt:-1,e.startTime,e.video,E.video)),e.audio&&e.audio.channelInfo&&(_[n]=e.audio.channelInfo),e.video&&e.video.channelInfo&&(v[n]=e.video.channelInfo),f[n]=e,g[n]=d,N[n]=u;var I=L(d),A=L(u);(I||A)&&(t=!0,C||(A=A||"none",C=!0,(I=I||"none").noPacketsReceived?i.warn("[CallStatsHandler]: processRTPStats - No packets received from remote peer"):(i.warn("[CallStatsHandler]: processRTPStats - Quality issues detected",[{audio:I},{video:A}]),m.onThresholdExceeded&&m.onThresholdExceeded())))})),!t&&C&&(i.debug("[CallStatsHandler]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),C=!1,m.onThresholdExceeded&&m.onThresholdExceeded(!0)),(C||R%6==0)&&f.forEach((function(e,t){!function(e,t){var n,r,o;function a(e){return void 0===e||e<0?"n/a":e}e&&(e.audio||e.video)&&(n="[CallStatsHandler]: statsReport: audioRtt="+(e.audio&&e.audio.rtt||"n/a")+" videoRtt="+((e.video.receive||e.video.transmit)&&e.video&&e.video.rtt||"n/a"),e.audio&&((r=e.audio.receive)&&r.id&&(n+="\n audioReceive:  id="+r.id+" pl="+a(r.pl)+" pr="+a(r.pr)+" or="+a(r.or)+" jr="+a(r.jr)),(r=e.audio.transmit)&&r.id&&(n+="\n audioTransmit: id="+r.id+" pl="+a(r.pl)+" ps="+a(r.ps)+" os="+a(r.os))),e.video&&((r=e.video.receive)&&r.id&&(n+="\n videoReceive:  id="+r.id+" pl="+a(r.pl)+" pr="+a(r.pr)+" or="+a(r.or)+" fwr="+r.fwr+" fhr="+r.fhr+" frd="+r.frd+" frr="+r.frr),(r=e.video.transmit)&&r.id&&(n+="\n videoTransmit: id="+r.id+" pl="+a(r.pl)+" ps="+a(r.ps)+" os="+a(r.os)+" fws="+r.fws+" fhs="+r.fhs+" frs="+r.frs+" abw="+r.abw)),i.debug(n)),t&&t.length&&(n="[CallStatsHandler]: statsReport:\n",t.forEach((function(e,t){n+=0===t?" Audio issues=":"\n Video issues=";var i=Object.keys(e);i.length?(o=!0,i.forEach((function(t){n+=" "+t+"="+e[t].value+" count="+e[t].counter}))):n+=" none"})),o&&i.info(n))}(e,[g[t],N[t]])})),R++}}function U(){e.isElectron&&i.debug("[CallStatsHandler]: Get RTP stats for local call(s)"),h().then((function(t){t?(e.isElectron&&i.debug("[CallStatsHandler]: Process RTP stats for local call(s)"),b(t),function(e){if(!e||!e.length)return void i.debug("[CallStatsHandler]: processNetworkIndication - No stats for network indication.");u||(u=[],d=r.RTP_QUALITY_HIGH,s={noPacketsSeq:0,qualityLevelSeq:0},E=!1);e.forEach((function(e,t){var n=0,o=0,a=e.audio&&e.audio.transmit,c=e.audio&&e.audio.receive,l=!0,C=!0,T=u[t]||{};!a||isNaN(a.pl)||isNaN(a.ps)||(n=O(a,T.audio&&T.audio.transmit)||0,T.audio&&T.audio.transmit&&T.audio.transmit.ps&&(l=a.ps!==T.audio.transmit.ps),l||i.warn("[CallStatsHandler]: processNetworkIndication - No packets sent to remote peer")),!c||isNaN(c.pl)||isNaN(c.pr)||(o=D(c,T.audio&&T.audio.receive)||0,T.audio&&T.audio.receive&&T.audio.receive.pr&&(C=c.pr!==T.audio.receive.pr),C||S.sendOnlyStream||i.warn("[CallStatsHandler]: processNetworkIndication - No packets received from remote peer"));var p={currentPlSend:n,currentPlReceive:o};l?(s.noPacketsSeq=0,p.qualityLevel=r.getLevel(Math.max(n,o))):(s.noPacketsSeq++,s.noPacketsSeq>1?(p.qualityLevel=r.RTP_QUALITY_LOW,m.onNoOutgoingPackets&&m.onNoOutgoingPackets()):p.qualityLevel=r.RTP_QUALITY_HIGH),function(e){var t=s;t.qualityLevel=e.qualityLevel,t.currentPlSend=e.currentPlSend,t.currentPlReceive=e.currentPlReceive;var n=d;n!==t.qualityLevel.value&&i.debug("[CallStatsHandler]: setQualityEstimation - estimation="+t.qualityLevel.value+" seq="+t.qualityLevelSeq+" current="+n);n<t.qualityLevel.value?(t.qualityLevelSeq++,t.qualityLevelSeq>1&&(d=t.qualityLevel.value,t.qualityLevelSeq=0)):(d=t.qualityLevel.value,t.qualityLevelSeq=0);if(n!==d){var r=1===n&&!E;r&&(t.firstTimeLowQuality=r,E=r),m.onNetworkQuality&&m.onNetworkQuality(t)}}(p),u[t]=e}))}(t)):e.isElectron&&i.debug("[CallStatsHandler]: No RTP stats collected")}))}function L(e){var t=null;return Object.keys(e).forEach((function(n){var r=e[n];r.counter>=r.statObj.RecurrenceThreshold?r.reported?(delete e[n],i.debug("[CallStatsHandler]: issueCounter cleared=",n)):(r.reported=!0,r.counter=0,(t=t||{})[n]=!0):r.reported&&((t=t||{})[n]=!0)})),t}this.start=function(){I||A?(i.debug("[CallStatsHandler]: Restart collecting RTPStats"),s=null,d=null,u=null,E=!1):(i.debug("[CallStatsHandler]: Waiting to start collecting RTPstats"),I=window.setTimeout((function(){i.info("[CallStatsHandler]: Start collecting RTPStats"),I=null,R=0,U(),A=window.setInterval((function(){U()}),o.COLLECTION_INTERVAL)}),o.DELAY_UPON_ANSWER))},this.stop=function(){return new t((function(e){h(!0).then((function(t){e(t)})),I?(i.debug("[CallStatsHandler]: cancel collecting RTPStats "),window.clearTimeout(I),I=null):A&&(i.debug("[CallStatsHandler]: stop collecting RTPStats"),window.clearInterval(A),A=null,s=null,d=null,u=null,E=!1,f&&i.debug("[CallStatsHandler]: savedRTPStats =",f),m.onThresholdExceeded&&m.onThresholdExceeded(!0),C=!1)}))},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(S=e)},this.getLastSavedStats=function(){return f},this.getStreamQualityData=function(){return null},this.setTransmitVideoParams=function(){}}return S.overridePromise=function(e){void 0===t&&(t=e)},e.CallStatsHandler=S,e}((Circuit=function(e){"use strict";var t,n=e.Constants,i=e.logger,r=e.Enums.RtpQualityLevel,o=e.RtpStatsConfig,a=e.Utils,s=e.Enums.VideoResolutionLevel,c=a.isMobile()?2:3,l=Object.freeze({MAX:"MAX",MIN:"MIN"}),d=Object.freeze({GOOG_JITTER_RECEIVED:{id:n.AudioQualityParam.JITTER,StatName:"jr",StatText:"googJitterReceived",Threshold:[50,300,500],ThresholdType:l.MAX},GOOG_RTT:{id:n.AudioQualityParam.RTT,StatName:"rtt",StatText:"googRtt",Threshold:[300,600,800],ThresholdType:l.MAX},PACKET_LOSS_RECV:{id:n.AudioQualityParam.PL_RECV,StatName:"plr",StatText:"packetLossRecv",Threshold:[.05,.2,.3],ThresholdType:l.MAX},PACKET_LOSS_SEND:{id:n.AudioQualityParam.PL_SEND,StatName:"pll",StatText:"packetLossSend",Threshold:[.05,.2,.3],ThresholdType:l.MAX},NO_PACKETS_RECV:{id:n.AudioQualityParam.NO_PACKETS_RECV,StatName:"npr",StatText:"noPacketsReceived",Threshold:[0],reportIssues:!0},NO_PACKETS_SEND:{id:n.AudioQualityParam.NO_PACKETS_SENT,StatName:"nps",StatText:"noPacketsSent",Threshold:[0],reportIssues:!0},ECHO_LIKELIHOOD:{id:n.AudioQualityParam.ECHO,StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:[.5],ThresholdType:l.MAX}}),u=Object.freeze({GOOG_RTT:{id:n.VideoQualityParam.RTT,StatName:"rtt",StatText:"googRtt",Threshold:[300,600,800],ThresholdType:l.MAX},PACKET_LOSS_RECV:{id:n.VideoQualityParam.PL_RECV,StatName:"plr",StatText:"packetLossRecv",Threshold:[.05,.2,.3],ThresholdType:l.MAX,StreamQualityThreshold:.1},PACKET_LOSS_SEND:{id:n.VideoQualityParam.PL_SEND,StatName:"pll",StatText:"packetLossSend",Threshold:[.05,.2,.3],ThresholdType:l.MAX}}),E=JSON.stringify({FRAME_HEIGHT_SENT:{id:n.VideoQualityParam.FRAME_HEIGHT_SENT,StatName:"fhs",StatText:"googFrameHeightSent",Threshold:[],ThresholdType:l.MIN},FRAME_WIDTH_SENT:{id:n.VideoQualityParam.FRAME_WIDTH_SENT,StatName:"fws",StatText:"googFrameWidthSent",Threshold:[],ThresholdType:l.MIN},FRAME_RATE_SENT:{id:n.VideoQualityParam.FRAME_RATE_SENT,StatName:"frs",StatText:"googFrameRateSent",Threshold:[],ThresholdType:l.MIN},AVAIL_SEND_BW:{id:n.VideoQualityParam.BW_SEND,StatName:"abw",StatText:"googAvailableSendBandwidth",Threshold:[],ThresholdType:l.MIN},TRANSMIT_BIT_RATE:{id:n.VideoQualityParam.TRX_BITRATE,StatName:"tbr",StatText:"googTransmitBitrate",Threshold:[],ThresholdType:l.MIN}}),C=Object.freeze({AUDIO:"audio",VIDEO:"video",SCREEN:"screen"}),T=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googFrameRateReceived:"frr",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});void 0!==window.Promise&&(t=window.Promise);var p=a.getBrowserInfo();function S(S,I){if(!Array.isArray(S))throw new Error("peerConnections must be an array");var A=S.filter((function(e){return e}));if(!S.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var R,f=e.WebRTCAdapter.getNetmaskMap(),_=!!I,v={},g=null,N=null,m=0,h={},O={},D={},P={},y={},b=0,U=0,L={},M=null,w={audio:null},G=[d.GOOG_JITTER_RECEIVED,d.PACKET_LOSS_RECV,d.GOOG_RTT],k=JSON.parse(E),H=this;function V(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function B(t,n,i){var r;return t.a.some((function(t){if("candidate"===t.field&&t.value){var o=new e.IceCandidate(t.value);if(o.typ===i&&o["network-id"]===n["network-id"])return r=o.address,!0}return!1})),r}function F(e,t,n,i){var r=e.stat("googChannelId"),o={channelId:r},s=parseInt(e.stat("googRtt"),10);o.rtt=isNaN(s)?-1:s,i&&(o.candidates={local:e.stat("localCandidateId"),remote:e.stat("remoteCandidateId")},p.firefox||p.safari?n.remote=e.stat("remoteCandidateId"):function(e,t){var n=a.parseIpWithPort(t.stat("googLocalAddress"))||{},i=a.parseIpWithPort(t.stat("googRemoteAddress"))||{};e.ipl=n.ipAddress,e.ptl=n.port,e.ipr=i.ipAddress,e.ptr=i.port,e.lct=V(t.stat("googLocalCandidateType")),e.rct=V(t.stat("googRemoteCandidateType")),e.tt=t.stat("googTransportType")}(o,e)),t.channelInfo[r]=o}function x(t,n,i,r,o){if(!n||!i)return null;var a,s={startTime:t,pcType:r,audio:{transmit:{},receive:{}},video:{transmit:{},receive:{}},channelInfo:{},quality:{audio:{},video:{}}},c={audio:{},video:{}},l={},d=n.result?n.result():n;if(!Array.isArray(d))return null;(d.forEach((function(e){if(e){var t=null;switch(e.type){case"ssrc":t=function(e,t,n){var i=null,r=e.stat("ssrc"),o={id:e.id,ssrc:r,content:e.stat("googContentType"),channelId:e.stat("transportId"),trackId:e.stat("googTrackId")};return e.stat("audioInputLevel")?(t.audio.transmit[r]||(t.audio.transmit[r]=o),(i=t.audio.transmit[r]).content=C.AUDIO):e.stat("audioOutputLevel")?(t.audio.receive[r]||(t.audio.receive[r]=o),(i=t.audio.receive[r]).content=C.AUDIO):e.stat("googFrameHeightSent")?(t.video.transmit[r]||(t.video.transmit[r]=o),p.firefox?o.content=e.stat("mid")===n.getScreenShareMediaId()?C.SCREEN:C.VIDEO:o.content!==C.SCREEN&&(o.content=C.VIDEO),i=t.video.transmit[r]):e.stat("googFrameHeightReceived")&&(t.video.receive[r]||(t.video.receive[r]=o),o.content=n.desktopRemoteSsrc.includes(o.ssrc)?C.SCREEN:C.VIDEO,i=t.video.receive[r]),i}(e,s,i);break;case"VideoBwe":s.video.bw||(s.video.bw={id:e.id}),t=s.video.bw;break;case"localcandidate":case"remotecandidate":l[e.id]=e}if(e.names&&t)(e.names()||[]).forEach((function(n){T[n]&&(t[T[n]]=parseFloat(e.stat(n)))})),t.en=e.stat("googCodecName")}})),d.forEach((function(e){e&&"googCandidatePair"===e.type&&"true"===e.stat("googActiveConnection")&&F(e,s,c,o)})),o)&&Object.keys(s.channelInfo).forEach((function(t){var n=s.channelInfo[t];if(n){var r=l[n.candidates.local];if(r){if(p.firefox||p.safari)!function(e,t,n){e.ipl=t&&t.stat("ipAddress"),e.ptl=t&&t.stat("portNumber"),e.ipr=n&&n.stat("ipAddress"),e.ptr=n&&n.stat("portNumber"),e.lct=t&&V(t.stat("candidateType")),e.rct=n&&V(n.stat("candidateType")),e.tt=t&&t.stat("protocol")}(n,r,l[n.candidates.remote]);n.ni=r.stat("networkType"),a=a||e.sdpParser.parse(i.localDescription&&i.localDescription.sdp),n.candidate=function(t,n){var i,r,o={};if(!t||!n)return o;var a=V(t.stat("candidateType"));return"prflx"===a?r=t.stat("ipAddress"):i=String(t.stat("portNumber")),("string"==typeof n?e.sdpParser.parse(n):n).m.some((function(n){return n.a.some((function(s){if("candidate"!==s.field)return!1;if(s.value){var c;if(i&&s.value.indexOf(i)>=0&&(c=new e.IceCandidate(s.value),String(c.port)===i&&a===c.typ))return o.value=s.value,"host"===a?(o.hAddr=t.stat("ipAddress"),o.sAddr=B(n,c,"srflx")):(o.sAddr="srflx"===a?c.address:c.raddr,o.hAddr=B(n,c,"host"),"relay"===a&&(o.tt=c.getRelayClientTransportType())),!0;if(r&&s.value.indexOf("srflx")>=0&&"srflx"===(c=c||new e.IceCandidate(s.value)).typ&&String(c.address)===r)return o.sAddr=r,o.hAddr=B(n,c,"host"),!0}return!1})),!1})),o.netmask=f[o.hAddr],o}(r,a)}}}));return s}function W(e){var n=!R;R=R||n;var r=A.find((function(t){return!!t&&(e||"completed"===t.iceConnectionState||"connected"===t.iceConnectionState?t.mainPeerConnection:(i.warn("[CallStatsHandlerUnified]: Do not collect stats. pc.iceConnectionState = ",t.iceConnectionState),!1))}));return r?function(e,n,r,o){return e.getStats?e.getStats().catch((function(e){i.warn("[CallStatsHandlerUnified]: getStats["+n+"] failed with err = ",e)})).then((function(t){return t?t=x(r,t,e,n,o):i.warn("[CallStatsHandlerUnified]: getStats["+n+"] did not return a response"),t})):t.resolve()}(r,"AUDIO/VIDEO/SCREEN",r.startTime,n).then((function(e){return e&&[C.AUDIO,C.VIDEO].forEach((function(t){var n=e[t];["transmit","receive"].forEach((function(i){var r=n[i];Object.keys(r).forEach((function(n){var o=r[n];if(o.channelInfo||(o.channelInfo=O[o.channelId]||e.channelInfo[o.channelId]),t===C.AUDIO&&"receive"===i)o.channelInfo.isAudioChannel=!0;else if(o.content===C.VIDEO)if("transmit"===i)L[n.trackId]||(o.channelInfo.isVideoSendChannel=!0);else{var a=h[n];o.channelInfo.isVideoRecvChannel=a?o.pr>a.pr:o.pr>0}}))}))})),e})):t.resolve()}function K(e,t){var n=0,i=0;t&&(n=t.pl||0,i=t.ps||0);var r=(e.pl-n)/(e.ps-i||1);return Math.round(100*r)/100}function Y(e,t){var n=0,i=0;t&&(n=t.pl||0,i=t.pr||0);var r=(e.pl-n)/(e.pr-i+e.pl-n||1);return Math.round(100*r)/100}function q(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function j(e,t,n,i,r){var o=e.StatText+"LastViStart",a=e.StatText+"Violations",s=e.StatText+"ViCounter";if(i[o]=r&&r[o],i[a]=r&&r[a],i[s]=r&&r[s]||0,-1===t){if(i[o]>=0){var c=i[a];c=c?c+",":"",i[a]=c+"("+i[o]+","+parseInt((Date.now()-n)/1e3,10)+")",i[s]++,D[e.StatText]=0,delete i[o],r&&delete r[o]}}else i[o]>=0?D[e.StatText]++:i[s]<20&&(i[o]=parseInt((Date.now()-n)/1e3,10),D[e.StatText]=1)}function Q(e,t,n){return n===l.MAX?e>=t:e<=t}function z(e,t,n,i){if(i>=0){e.quality.level=e.quality.level||r.RTP_QUALITY_HIGH;var o=t.Threshold.length>0?function(e,t){return Q(e.Threshold[0],t,e.ThresholdType)?r.RTP_QUALITY_HIGH:Q(e.Threshold[1],t,e.ThresholdType)?r.RTP_QUALITY_MEDIUM:Q(e.Threshold[2],t,e.ThresholdType)?r.RTP_QUALITY_LOW:r.RTP_QUALITY_POOR}(t,i):r.RTP_QUALITY_HIGH;e.quality[n][t.id]={qualityLevel:o,value:i},e.quality[o.value]=e.quality[o.value]||[],e.quality[o.value].push(t),o.value<e.quality.level.value&&(e.quality.level=o)}}function X(e){e&&e.audio&&(function(e){Object.keys(e.audio.transmit).forEach((function(t){var n=h[t]||{},i=e.audio.transmit[t];if(i){i.media=C.AUDIO;var r=d.PACKET_LOSS_SEND,o=K(i,n);i.pl&&i.ps&&j(r,o>=r.Threshold[0]?o:-1,e.startTime,i,n),z(e,r,C.AUDIO,o);var a=(i.ps||0)-(n.ps||0);j(d.NO_PACKETS_SEND,!(a>0)||-1,e.startTime,i,n),r=d.ECHO_LIKELIHOOD,q(i,n,d.ECHO_LIKELIHOOD.StatName);var s=i[r.StatName]||0;j(r,s&&s>=r.Threshold[0]?s:-1,e.startTime,i,n)}h[t]=i}))}(e),function(e){Object.keys(e.audio.receive).forEach((function(t){var n=h[t]||{},i=e.audio.receive[t],r=d.PACKET_LOSS_RECV;if(i){i.media=C.AUDIO;var o,a=Y(i,n);i.pl&&i.pr&&j(r,a>=r.Threshold[0]?a:-1,e.startTime,i,n),z(e,r,C.AUDIO,a),v.sendOnlyStream||j(d.NO_PACKETS_RECV,!(i.pr>n.pr)||-1,e.startTime,i,n),r=d.GOOG_JITTER_RECEIVED,q(i,n,d.GOOG_JITTER_RECEIVED.StatName),o=i[r.StatName],z(e,r,C.AUDIO,o),j(r,o&&o>=r.Threshold[0]?o:-1,e.startTime,i,n),e.quality.audio.trackId=t}h[t]=i}))}(e))}function J(e){Object.keys(e.video.transmit).forEach((function(t){var n=h[t]||{},i=P[t]||{},r=e.video.transmit[t];r.media=C.VIDEO;var o=u.PACKET_LOSS_SEND;if(r&&!L[r.trackId]){var a=K(r,n);if(r.pl&&r.ps&&j(o,a>=o.Threshold[0]?a:-1,e.startTime,r,n),r.content===C.VIDEO){z(e,o,C.VIDEO,a);var c=Math.max(r.fws,r.fhs)||r.fws,l=Math.min(r.fws,r.fhs)||r.fhs;z(e,k.FRAME_HEIGHT_SENT,C.VIDEO,l),z(e,k.FRAME_WIDTH_SENT,C.VIDEO,c),z(e,k.FRAME_RATE_SENT,C.VIDEO,r.frs),e.video.bw&&(z(e,k.TRANSMIT_BIT_RATE,C.VIDEO,e.video.bw.tbr),z(e,k.AVAIL_SEND_BW,C.VIDEO,e.video.bw.abw)),function(e,t,n){var i={};if(t>=0&&n>=0)switch(i.resolution={height:t,width:n},Math.min(t,n)){case 1080:i.hdVideo=s.VIDEO_1080;break;case 720:i.hdVideo=s.VIDEO_720;break;case 480:i.hdVideo=s.VIDEO_480}e.quality.videoInfo=i}(e,r.fhs,r.fws)}}h[t]=r,P[t]=i}))}function $(e){e&&e.video&&(h.bw=e.video.bw||{},h.bw.media=C.VIDEO,J(e),function(e){var t=-1;Object.keys(e.video.receive).forEach((function(n){var i=h[n]||{},r=P[n]||{},o=e.video.receive[n];o.media=C.VIDEO;var a=u.PACKET_LOSS_RECV;if(o&&o.pr){var s=Y(o,i);o.pl&&j(a,s>=a.Threshold[0]?s:-1,e.startTime,o,i),o.content===C.VIDEO&&(isNaN(i.pr)||o.pr-i.pr>0)&&(t=Math.max(t,s))}h[n]=o,P[n]=r})),t>=0&&z(e,u.PACKET_LOSS_RECV,C.VIDEO,t)}(e))}function Z(e){var t="[CallStatsHandlerUnified]: Network quality: overall="+e.quality.level.levelName;[C.AUDIO,C.VIDEO].forEach((function(n){var i=e.quality[n],r="";Object.keys(i).forEach((function(e){"trackId"!==e&&(r+=" "+e+"="+i[e].qualityLevel.levelName+"["+i[e].value+"]")})),r&&(t+="\n"+n+":"+r)})),i.debug(t)}function ee(e){e&&(X(e),$(e),function(e){Object.keys(e.channelInfo).forEach((function(t){var n=O[t]||{},i=e.channelInfo[t];q(i,n,u.GOOG_RTT.StatName);var r=d.GOOG_RTT,o=y[t]||{};j(r,i.rtt>=r.Threshold[0]?i.rtt:-1,e.startTime,i,n),n.isAudioChannel||i.isAudioChannel?(r=d.GOOG_RTT,z(e,r,C.AUDIO,i.rtt)):(n.isVideoSendChannel||n.isVideoRecvChannel||i.isVideoSendChannel||i.isVideoRecvChannel)&&(r=u.GOOG_RTT,z(e,r,C.VIDEO,i.rtt)),y[t]=o}))}(e),function(e){e.quality.level=r.RTP_QUALITY_HIGH;var t=0,n=-1,o=0,a=!1;Object.keys(r).some((function(i){var s=r[i],c=e.quality[s.value]||[];if(o+=c.length,s!==r.RTP_QUALITY_HIGH&&c.length>0){if(c.some((function(e){return"PL_SEND"===e.id||"PL_RECV"===e.id}))||c.length>1)return e.quality.level=s,!0;t++,n+=s.value+1,a=!0}return!1})),e.quality.level===r.RTP_QUALITY_HIGH&&(t>2?e.quality.level=r.RTP_QUALITY_LOW:t>1?e.quality.level=n>2?r.RTP_QUALITY_MEDIUM:r.RTP_QUALITY_LOW:1===t&&0===n&&(e.quality.level=r.RTP_QUALITY_MEDIUM));var s=h.quality&&h.quality.level;if(o){var c=h.quality&&h.quality.anythingLessThanHigh;if(h.quality={level:e.quality.level,audio:e.quality.audio,video:e.quality.video,anythingLessThanHigh:a},e.quality.videoInfo&&(h.quality.videoInfo=e.quality.videoInfo),!s||s!==e.quality.level)return H.onNetworkQuality&&H.onNetworkQuality(e.quality),Z(e),!0;(a||c)&&Z(e)}else i.debug("[CallStatsHandlerUnified]: calculateOverallQuality: No media stats available"),h.quality={},s&&H.onNetworkQuality&&H.onNetworkQuality(null)}(e),function(e){e.quality.level===r.RTP_QUALITY_POOR||e.quality.level===r.RTP_QUALITY_LOW?(b++,U<c&&(U=0)):b&&(b<c?(b=0,U=0):U++),b===c?H.onThresholdExceeded&&H.onThresholdExceeded():U>=c&&b>c&&(b=0,U=0,H.onThresholdExceeded&&H.onThresholdExceeded(!0)),D.noPacketsSent>=c&&(i.warn("[CallStatsHandlerUnified]: No audio packets sent to remote peer"),D.noPacketsSent===c&&H.onNoOutgoingPackets&&H.onNoOutgoingPackets()),D.noPacketsReceived>=c&&i.debug("[CallStatsHandlerUnified]: No audio packets received from remote peer")}(e),function(e){Object.keys(e.channelInfo).forEach((function(t){var n=O[t]||{};O[t]=Object.assign(n,e.channelInfo[t])}))}(e),function(e,t){if(!_)return;(M=M||{})[t]=M[t]||{qualityData:[]},M[t].trackId=e[t].trackId,w[t]&&w[t].count>=6?ne(t):function(e,t){var n=w[t];n||(n={count:0},G.forEach((function(e){n[e.StatName]=0})),w[t]=n);G.forEach((function(i){var r=e[t][i.id]&&e[t][i.id].value||0;n[i.StatName]+=r})),n.count++,0===M[t].qualityData.length&&ne(t)}(e,t)}(e.quality,C.AUDIO),++m%6==0&&function(e){var t;function n(e){return void 0===e||e<0?"n/a":e}Object.keys(e.channelInfo).forEach((function(r){var o=e.channelInfo[r];t="[CallStatsHandlerUnified]: statsReport: channelRtt="+(o.rtt>=0?o.rtt:"n/a"),Object.keys(e.audio.receive).forEach((function(i){var o=e.audio.receive[i];o.channelId===r&&(t+="\n audioReceive:  id="+o.id+" pl="+n(o.pl)+" pr="+n(o.pr)+" or="+n(o.or)+" jr="+n(o.jr))})),Object.keys(e.audio.transmit).forEach((function(i){var o=e.audio.transmit[i];o.channelId===r&&(t+="\n audioTransmit: id="+o.id+" pl="+n(o.pl)+" ps="+n(o.ps)+" os="+n(o.os))})),Object.keys(e.video.receive).forEach((function(i){var o=e.video.receive[i];o.channelId===r&&(t+="\n videoReceive:  id="+o.id+" pl="+n(o.pl)+" pr="+n(o.pr)+" or="+n(o.or)+" fwr="+o.fwr+" fhr="+o.fhr+" frd="+o.frd+" frr="+o.frr)})),Object.keys(e.video.transmit).forEach((function(i){var o=e.video.transmit[i];o.channelId===r&&(t+="\n videoTransmit: id="+o.id+" pl="+n(o.pl)+" ps="+n(o.ps)+" os="+n(o.os)+" fws="+o.fws+" fhs="+o.fhs+" frs="+o.frs+" abw="+(e.video.bw&&e.video.bw.abw||"N/A"))})),i.debug(t)}))}(e))}function te(){e.isElectron&&i.debug("[CallStatsHandlerUnified]: Get RTP stats for local call(s)"),W().then((function(t){t?(e.isElectron&&i.debug("[CallStatsHandlerUnified]: Process RTP stats for local call(s)"),ee(t)):e.isElectron&&i.debug("[CallStatsHandlerUnified]: No RTP stats collected")}))}function ne(e){var t=function(e){var t=w[e];if(w[e]=null,!t||!t.count)return null;var n=t.count;return delete t.count,G.forEach((function(e){var i=t[e.StatName];e.StatName===d.PACKET_LOSS_RECV.StatName&&(i*=100),t[e.StatName]=Math.round(i/n)})),t.timestamp=Date.now(),t}(e);t&&G.some((function(n){var r=n.StreamQualityThreshold,o=t[n.StatName]||0,a=function(e,t){var n=M[e].qualityData;return n&&n.length&&n[n.length-1][t.StatName]||0}(e,n);return(0===M[e].qualityData.length||Math.abs(a-o)>r)&&(i.debug("[CallStatsHandlerUnified]: Writing into clientStreamQualityData - ",t),M[e].qualityData.push(t),!0)}))}this.start=function(){g||N||(i.debug("[CallStatsHandlerUnified]: Waiting to start collecting RTPstats"),g=window.setTimeout((function(){i.info("[CallStatsHandlerUnified]: Start collecting RTPStats"),g=null,m=0,te(),N=window.setInterval((function(){te()}),o.COLLECTION_INTERVAL)}),o.DELAY_UPON_ANSWER))},this.stop=function(){return function(){i.debug("[CallStatsHandlerUnified]: stopCollectingRTPStats ",M);var e=W(!0);return ne(C.AUDIO),g?(i.debug("[CallStatsHandlerUnified]: Cancel collecting RTP stats "),window.clearTimeout(g),g=null):N&&(i.debug("[CallStatsHandlerUnified]: Stop collecting RTP stats"),window.clearInterval(N),N=null,h&&i.debug("[CallStatsHandlerUnified]: savedRTPStats =",h),H.onThresholdExceeded&&H.onThresholdExceeded(!0),b=0,U=0),e}()},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(v=e)},this.getLastSavedStats=function(){return h.channelInfo=O,h},this.getStreamQualityData=function(){return M},this.setTransmitVideoParams=function(e){if(e){if(e.mediaConstraints&&e.mediaConstraints.hdVideo){var t,i;switch(e.mediaConstraints.videoResolution||s.VIDEO_1080){case s.VIDEO_1080:t=1080,i=1920;break;case s.VIDEO_720:t=720,i=1280;break;default:t=480,i=853}k.FRAME_RATE_SENT.Threshold=[20,8,3],k.FRAME_HEIGHT_SENT.Threshold=[.9*t,.75*t,.5*t],k.FRAME_WIDTH_SENT.Threshold=[.9*i,.75*i,.5*i];var r=1e3*(e.bitRates.maxBitRate||0),o=1e3*(e.bitRates.minBitRate||0),a=.75*r;a<o&&(a=r),k.AVAIL_SEND_BW.Threshold=[a,o,.5*o],k.TRANSMIT_BIT_RATE.Threshold=k.AVAIL_SEND_BW.Threshold}e.trackConstraints&&Object.keys(e.trackConstraints).forEach((function(t){e.trackConstraints[t].quality===n.VideoQuality.LOW&&(L[t]=!0)}))}}}return S.overridePromise=function(e){void 0===t&&(t=e)},e.CallStatsHandlerUnified=S,e.CallStats=T,e}((Circuit=function(e){"use strict";var t=e.AppMessagingHandlerSingleton,n=e.ChromeExtension,i=e.Constants,r=e.logger,o=e.Utils,a=e.TemasysAdapter,s=e.WebRTCAdapter,c=function(){var c=t?t.getInstance():null,l={getScreen:function(e,t){t&&t("NOT_SUPPORTED")},setControllingScreen:function(e,t){t&&t("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},isFirefoxLegacy:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}},d=o.getBrowserInfo();function u(t,n){var o;o=e.isSDK&&e.electron&&e.electron.getDisplayMedia?e.electron.getDisplayMedia:navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);var a=s.getDesktopOptions();r.debug("[ScreenSharingController]: getDisplayMedia constraints: ",a),o(a).then((function(e){t({mediaStream:e})})).catch((function(e){"NotAllowedError"!==e.name||e.message&&"permission denied by system"===e.message.toLowerCase()?n(e):n(i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}))}if(e.isElectron)l.getScreen=function(e,t,n){var o=require("electron").ipcRenderer;o.once("screenshare-chooser",(function(n,o,a){"share"===o?(r.info("[ScreenSharingController]: Got screen share stream. Stream id: ",a.display.streamId),e&&e({screenIndex:a.display.screenIndex,streamId:a.display.streamId,pointer:a.pointer,screenControlSupported:a.screenControlSupported})):"cancel"===o&&(r.info("[ScreenSharingController]: User canceled screen share"),t&&t(i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))})),r.info("[ScreenSharingController]: Request screen in Electron"),o.send("screenshare-chooser","open",n)},l.isScreensharingAvailable=function(){return!0},l.setControllingScreen=function(){require("electron").ipcRenderer.send("screenshare-chooser","setControllingScreen")};else if(e.isVdiApp)l.getScreen=function(e,t){c.sendInternalMessage({method:"showwindow"}),window.setTimeout((function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,(function(n){c.sendInternalMessage({method:"minimizewindow"}),n?e&&e({streamId:n}):t&&t(i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}))}),0)},l.isScreensharingAvailable=function(){return!0};else if(d.chrome)if(navigator.mediaDevices.getDisplayMedia)l.getScreen=u,l.isScreensharingAvailable=function(){return!0};else{var E,C,T,p=function(e){e&&e===C&&E&&C&&(E.removeEventListener(n.BgTarget.SCREEN_SHARE,C),C=null)},S=function(e,t,o){var a=o.data;switch(o.suppressLog||r.info("[ScreenSharingController]: Received screenshare event from extension - ",a.type),a.type){case n.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:r.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",a.streamId),p(C),e&&e({streamId:a.streamId});break;case n.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:r.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),p(C),t(i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}},I=function(e,t){return E?(p(C),C=S.bind(null,e,t),E.addEventListener(n.BgTarget.SCREEN_SHARE,C),C):null};l.getScreen=function(e,t){var n=null;return T&&T.isExtensionRunning()?(n=I(e,t),E.getScreenShareUserMedia((function(e){e&&(r.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",e),p(n),t("res_AccessToExtensionFailed"))}))):t("res_AccessToExtensionFailed"),n},l.isScreensharingAvailable=function(){return!!T&&T.isExtensionRunning()},l.installExtension=function(){T&&(r.debug("[ScreenSharingController]: Install Chrome extension"),T.installExtension(!0).then((function(){r.info("[ScreenSharingController]: Chrome extension was successfully installed")})).catch((function(e){r.warn("[ScreenSharingController]: Failed to install Chrome extension. ",e)})))},l.injectExtensionSvc=function(e,t){T=e,E=t},l.unregEvtHandlers=p}else if(d.msie){var A;l.getScreen=function(e,t){a&&a.isScreensharingAvailable()?e&&e():t&&t("NOT_AVAILABLE")},l.isScreensharingAvailable=function(){return!!a&&a.isScreensharingAvailable()},l.installExtension=function(){A&&A.showPopup()},l.injectTemasysSvc=function(e){A=e}}else d.firefox?(navigator.mediaDevices.getDisplayMedia?l.getScreen=u:(l.getScreen=function(e){e&&e()},l.isFirefoxLegacy=function(){return!0}),l.isScreensharingAvailable=function(){return!0}):"Android"!==window.navigator.platform&&"iOS"!==window.navigator.platform||(l.getScreen=function(e){e&&e()},l.isScreensharingAvailable=function(){return!0});return l}();return e.ScreenSharingController=c,e}((Circuit=function(e){"use strict";var t=e.logger,n=e.BaseCall,i=e.Enums.CallState,r=e.Constants,o=e.Enums.CstaCallState,a=e.Constants.IncomingVideoContentType,s=e.Enums.ParticipantState,c=e.Constants.RealtimeMediaType,l=e.Utils,d=Object.freeze({SERVER_ENDED_PRFX:"SERVER_ENDED:"}),u=Object.freeze({CLIENT_ENDED_PRFX:"CLIENT_ENDED:",ANOTHER_CLIENT_ANSWERED:"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:"CALLER_LEFT_CONFERENCE",ENDED_BY_ANOTHER_USER:"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:"SET_REMOTE_SDP_FAILED",USER_ENDED:"USER_ENDED",LOST_MEDIA_STREAM:"LOST_MEDIA_STREAM",ICE_TIMED_OUT:"ICE_TIMED_OUT",USER_LOGGED_OUT:"USER_LOGGED_OUT",PAGE_UNLOADED:"PAGE_UNLOADED",DISCONNECTED:"WS_DISCONNECTED",FAILED_TO_SEND:"WS_FAILED_TO_SEND",REQUEST_TIMEOUT:"WS_REQUEST_TIMEOUT",MEDIA_RENEGOTIATION:"MEDIA_RENEGOTIATION"}),E=l.isMobile();function C(n,o){var s=e.WebRTCAdapter;o=o||{};var d=e.RtcSessionController;if(!n||!n.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");C.parent.constructor.call(this,n,!1);var u=this,T=null,p=!1,S=null,I=!1,A=!1,R=!1,f=!1,_=!1,v=!1,g=!1,N=!1,m=null,h=null,O=null,D=null,P=!1,y=[],b=[],U=[],L="",M="",w=!1,G={},k=null;function H(){T?(t.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",u.callId),u.activeMediaType=T.getActiveMediaType(),t.debug("[LocalCall]: Set active media type to ",u.activeMediaType),u.localMediaType=T.getMediaConstraints(),t.debug("[LocalCall]: Set local media type to ",u.localMediaType),u.updateMediaType(),u.updateCallState(),x(c.VIDEO),x(c.DESKTOP_SHARING)):t.debug("[LocalCall]: session controller not available - onMediaUpdate: callId =",u.callId)}function V(e){t.debug("[LocalCall]: RtcSessionController - onLocalVideoStream: callId =",u.callId),u.localVideoStream=e.stream,u.localStreams.desktop=e.desktopStream,u.localStreams.video=e.videoStream,L="",t.debug("[LocalCall]: Set local video stream to ",e.videoStream&&e.videoStream.id||"<null>"),t.debug("[LocalCall]: Set local desktop stream to ",e.desktopStream&&e.desktopStream.id||"<null>")}function B(e){t.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",e),u.pointer={isSupported:e.isSupported,isEnabled:e.isEnabled}}function F(e){t.debug("[LocalCall]: RtcSessionController - onRemoteStreams: callId =",u.callId),u.remoteAudioStream=e.audio&&e.audio.stream||null,M="",t.debug("[LocalCall]: Set remote audio stream to",u.remoteAudioStream&&u.remoteAudioStream.id||"<empty>"),u.remoteVideoStreams=e.video||[],t.debug("[LocalCall]: Set remote video streams to",e.video||"<empty>"),u.participants.forEach((function(e){u.setParticipantRemoteVideoStream(e)})),u.checkForActiveRemoteVideo()}function x(e){var n=T.getAvailableVideoReceivers(e),i=[],o=G[e]||[];n.forEach((function(e){var t=o.find((function(t){return t.id===e.id}));t||((t=e).pinnedUser=null,t.quality=r.VideoQuality.NORMAL,t.disabled=!1),i.push(t)})),G[e]=i,t.debug("[LocalCall] Updated video receiver configuration for media type "+e+" is ",i)}function W(){var e=[];return Object.keys(G).forEach((function(t){var n=G[t];n&&((R||t===c.VIDEO&&f)&&(n=JSON.parse(JSON.stringify(n))).forEach((function(e){e.disabled=!0})),Array.prototype.push.apply(e,n))})),e}Object.defineProperties(this,{sessionCtrl:{get:function(){return T},enumerable:!0,configurable:!1},isVdi:{get:function(){return!(!T||!T.isRemoteController)},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return!(!T||!T.isMuted())},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return R},enumerable:!0,configurable:!1},remoteVideoScreenOnlyAllowed:{get:function(){return f},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return _},enumerable:!0,configurable:!1},isMocked:{get:function(){return g},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return N},enumerable:!0,configurable:!1},hasActiveRemoteScreenShareOnly:{get:function(){return A},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&this.peerUsers.length>0&&this.peerUsers.length<=9)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return 9},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return w||this.state===i.Ringing},set:function(e){w=e},enumerable:!0,configurable:!1},curtain:{get:function(){return m||{}},set:function(e){var t;(t=e)&&t.curtainState&&(m&&(t.lastCurtainState=m.curtainState),(m=t).curtainClosed=t.curtainState!==r.CurtainState.OPEN)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return h},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return O},enumerable:!0,configurable:!1},videoDevice:{get:function(){return D},enumerable:!0,configurable:!1},playbackDeviceList:{get:function(){return y},enumerable:!0,configurable:!1},recordingDeviceList:{get:function(){return b},enumerable:!0,configurable:!1},videoDeviceList:{get:function(){return U},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return P},set:function(e){P=!!e},enumerable:!0,configurable:!1},savedRTPStats:{get:function(){if(this.sessionCtrl){var e=this.sessionCtrl.getLastSavedStats();if(s.unifiedPlanEnabled&&e){var t={};return Object.keys(e).forEach((function(n){var i=e[n],r=i.media;r&&(t[r]||(t[r]={}),t[r][n]=i)})),t}return e}return null},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!(!this.checkState([i.Active,i.Delivered])&&!this.isOsBizFirstCall)&&(!(this.sessionCtrl&&!this.sessionCtrl.canSendDTMFDigits())||!!this.checkState(i.Active)&&!!this.atcCallInfo)},enumerable:!0,configurable:!1},networkQuality:{get:function(){return k},set:function(e){k=e},enumerable:!0,configurable:!1}}),E&&Object.defineProperties(this,{localVideoUrl:{get:function(){return L=u.localVideoStream?L||s.createObjectURL(u.localVideoStream):""},enumerable:!0,configurable:!1},remoteAudioUrl:{get:function(){return M=u.remoteAudioStream?M||s.createObjectURL(u.remoteAudioStream):""},enumerable:!0,configurable:!1},remoteVideoUrlStreams:{get:function(){return u.remoteVideoStreams.map((function(e){return e.url||(e.url=s.createObjectURL(e.stream)),{streamId:e.streamId,url:e.url}}))},enumerable:!0,configurable:!1}}),this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=15e3,this.whiteboardEnabled=!1,this.whiteboard=null,this.screenEnabledFeature=null,this.previousScreenFeaturesState={ToggleWhiteboard:!1,ToggleScreenShare:!1,ToggleConferencePoll:!1},this.pollEnabled=!1,this.poll=null,this.pointer={isSupported:!1,isEnabled:!1},this.screenControllerId=null,this.screenOwnerId=null,this.screenOwner=null,this.screenController=null,this.preventScreenControlRequestInConf=!1,this.badQualityNotification={detected:!1,acted:!1,dismissed:!1},this.clientId=o.clientId,this.isOsBizFirstCall=!1,this.isOsBizSecondCall=!1,this.raiseHandState={},this.holdInProgress=!1,this.retrieveInProgress=!1,this.isSTC=o.isSTC,this.stcCapabilities=o.stcCapabilities,this.terminate=function(){p||(t.debug("[LocalCall]: Terminating call with callId =",this.callId),this.isOsBizSecondCall?T=null:T&&(T&&(T.onMediaUpdate=null,T.onLocalVideo=null,T.onRemoteStreams=null,T.onScreenSharePointerStatus=null),T.terminate()),L="",M="",this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],C.prototype.terminate.call(this),this.stopRingingTimer(),p=!0)},this.setMockedCall=function(){t.debug("[LocalCall]: Setting call as mocked"),g=!0,T&&T.setMockedCall(),this.participants.forEach((function(e){e.streamId=e.mediaType.video?"mock":"",e.screenStreamId=e.mediaType.desktop?"mock":""})),window.setTimeout((function(){this.state!==i.Terminated&&(t.debug("[LocalCall]: Initialize remote mocked streams"),F({audio:null,video:[{streamId:"mock",stream:"content/images/mock/trailer.mp4"}]}),T&&(T.onRemoteStreams=null))}),100)},this.startRingingTimer=function(e){"function"==typeof e&&(t.info("[LocalCall]: Starting ringing timer for callId =",u.callId),S=window.setTimeout((function(){t.info("[LocalCall]: Ringing timeout for callId =",u.callId),S=null,e()}),this.ringingTimeout))},this.stopRingingTimer=function(){S&&(t.info("[LocalCall]: Cancelling ringing timer for callId =",u.callId),window.clearTimeout(S),S=null)},this.hasRemoteVideo=function(){return I},this.checkForActiveRemoteVideo=function(){R?(I=!1,A=!1):(I=this.participants.some((function(e){return!!e.videoStream})),A=!!I&&!this.participants.some((function(e){return e.mediaType.video}))),t.debug("[LocalCall]: Set hasActiveRemoteVideo to ",I)},this.enableRemoteVideoScreenOnly=function(){return R?null:(f=!0,this.checkForActiveRemoteVideo(),this.participants.forEach((function(e){e.videoStream=null,e.streams={},u.isDirect&&(e.streamId="")})),this.sessionCtrl&&this.sessionCtrl.enableRemoteVideoScreenOnly(),t.debug("[LocalCall]: Enabled receiving remote screen share only"),W())},this.disableRemoteVideoScreenOnly=function(){return f=!1,this.sessionCtrl&&this.sessionCtrl.disableRemoteVideoScreenOnly(),t.debug("[LocalCall]: Disabled receiving remote screen share only"),W()},this.enableRemoteVideo=function(){return R||f?(R=!1,this.disableRemoteVideoScreenOnly(),this.checkForActiveRemoteVideo(),this.sessionCtrl&&this.sessionCtrl.enableRemoteVideo(),t.debug("[LocalCall]: Enabled remote video"),W()):null},this.disableRemoteVideo=function(){return R?null:(R=!0,I=!1,this.disableRemoteVideoScreenOnly(),this.participants.forEach((function(e){e.videoStream=null,e.streams={},u.isDirect&&(e.streamId="")})),this.sessionCtrl&&this.sessionCtrl.disableRemoteVideo(),t.debug("[LocalCall]: Disabled remote video"),W())},this.enableRemoteAudio=function(){_&&(_=!1,t.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){_||(_=!0,t.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(e){N=!!e,t.debug("[LocalCall]: Set Circuit Meeting Point state to ",e)},this.setHasUnmutedParticipants=function(){v=this.participants.some((function(e){return!e.muted}))},this.hasUnmutedParticipants=function(){return v},this.getUnmutedParticipantIds=function(){var e=[];return this.participants.forEach((function(t){t.muted||e.push(t.userId)})),e},this.getMediaNode=function(){return this.isTestCall?d.mediaNode:null},this.updateMediaDevices=function(){var e=function(e){return e?e.filter((function(e){return"default"!==e.id&&"communications"!==e.id&&e.label})).map((function(e){return e.label})):[]};s.getMediaSources((function(n,i,r){if(s.getMediaSourcesSupported){var o=l.selectMediaDevice(r,d.playbackDevices);h=o&&o.label,y=e(r),o=l.selectMediaDevice(n,d.recordingDevices),O=o&&o.label,b=e(n),o=l.selectMediaDevice(i,d.videoDevices),D=o&&o.label,U=e(i)}else h=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),O=Audio.getRecordingDevice&&Audio.getRecordingDevice(),D=Audio.getVideoDevice&&Audio.getVideoDevice();t.debug("[LocalCall]: Updated media devices ",{callId:u.callId,recording:O,playback:h,video:D})}))},this.setIncomingVideoStreams=function(e){var t=G[c.VIDEO],n=G[c.DESKTOP_SHARING],i=[],o=[],s=!1,l=!0;return e?e.forEach((function(e){switch(e.contentType){case a.VIDEO:var t,n=e.userId,c=n&&u.participants.find((function(e){return e.userId===n}));c&&c.streams.video&&(t=c.streams.video.mid,i.push(t)),o.push({id:t,quality:e.quality||r.VideoQuality.NORMAL,pinnedUser:n||null});break;case a.SCREEN:s=!0}})):(l=!1,s=!0),t&&(t.forEach((function(e){e.pinnedUser=null,e.quality=r.VideoQuality.NORMAL,e.disabled=l})),o.forEach((function(e){var n=e.id;t.some((function(t){var r=t.id;return!!(n&&r===n||!n&&-1===i.indexOf(r))&&(t.pinnedUser=e.pinnedUser,t.quality=e.quality,t.disabled=!1,n||i.push(r),!0)}))}))),n&&n.forEach((function(e){e.quality=r.VideoQuality.NORMAL,e.disabled=!s})),W()},this.supportsVideoReceiverConfiguration=function(){return!u.isDirect&&!(u.isLarge&&(o.isSessionGuest||u.isGuestInvite))&&s.unifiedPlanEnabled},T||(o.reuseSessionCtrl?T=o.reuseSessionCtrl:((T=new d({callId:u.callId,isDirectCall:u.isDirect,isTelephonyCall:u.isTelephonyCall,isLargeConference:u.isLarge,isAtcPullCall:o.isAtcPullCall,reuseDesktopStreamFrom:o.reuseDesktopStreamFrom,isSessionGuest:o.isSessionGuest||u.isGuestInvite,midMappingEnabled:o.midMappingEnabled,canReceiveHdVideo:o.canReceiveHdVideo,supportsVideoReceiverConfiguration:u.supportsVideoReceiverConfiguration()})).onMediaUpdate=H,T.onLocalVideoStream=V,T.onRemoteStreams=F,T.onScreenSharePointerStatus=B)),n=null,u.updateMediaDevices(),t.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function T(e,t){t.streamId="",t.screenStreamId="",t.mediaType.desktop&&(t.screenStreamId="mock"),t.mediaType.video&&(t.streamId="mock")}return l.inherit(C,n),C.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioStream&&!this.remoteVideoStreams.length)},C.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},C.prototype.addParticipant=function(e){this.isMocked&&e&&e.mediaType&&T(0,e);var t=C.parent.addParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},C.prototype.updateParticipant=function(e){this.isMocked&&e&&e.mediaType&&T(0,e);var t=C.parent.updateParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},C.prototype.removeParticipant=function(){var e=C.parent.removeParticipant.apply(this,arguments);return e&&(this.setHasUnmutedParticipants(),this.checkForActiveRemoteVideo()),e},C.prototype.setParticipantRemoteVideoStream=function(e){if(e.videoStream=null,e.streams={},this.isDirect&&(e.streamId=""),!this.remoteVideoDisabled)if(!e.mediaType||e.mediaType.video||e.mediaType.desktop){if(this.isDirect){if(this.remoteVideoStreams&&this.remoteVideoStreams.length){var n=this.remoteVideoStreams[this.remoteVideoStreams.length-1];e.streamId=n.streamId,e.videoStream=n.stream}}else{if(!e.streamId&&!e.screenStreamId)return void t.info("[LocalCall]: The participant does not have a video streamId. userId = ",e.userId);this.remoteVideoStreams&&this.remoteVideoStreams.length&&(this.remoteVideoStreams.forEach((function(t){t.streamId===e.streamId?e.streams.video=t.stream:t.streamId===e.screenStreamId&&(e.streams.desktop=t.stream)})),e.videoStream=e.streams.desktop||e.streams.video||null)}e.videoStream?(e.pcState=e.muted?s.Muted:s.Active,t.debug("[LocalCall]: Set remote video stream for participant: ",e)):t.debug("[LocalCall]: We still do not have a video stream for the participant. ",e)}else t.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video stream. userId = ",e.userId)},C.prototype.hasLocalScreenShare=function(){return this.sessionCtrl&&this.sessionCtrl.hasScreenShare()},C.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},C.prototype.mute=function(e){return this.checkState(i.Terminated)?(t.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(t.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.mute(e))},C.prototype.unmute=function(e){return this.checkState(i.Terminated)?(t.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(t.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.unmute(e))},C.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl&&this.sessionCtrl.isLocalMuteAllowed()},C.prototype.toggleMute=function(){return this.sessionCtrl&&this.sessionCtrl.isMuted()?this.unmute():this.mute()},C.prototype.setActiveSpeakers=function(e){if(!e)return!1;e instanceof Array||(e=[e]);var t=!1;return this.participants.forEach((function(n){var i=-1!==e.indexOf(n.userId);n.activeSpeaker!==i&&(n.activeSpeaker=i,t=!0)})),t},C.prototype.updateCallState=function(){var e;this.state.established&&this.sessionCtrl&&(e=!this.sessionCtrl.isConnected()||!this.isDirect&&!this.hasOtherParticipants()||this.isATCCall&&!this.getCstaState().established&&!this.checkCstaState([o.Initiated,o.Delivered])?i.Waiting:this.sessionCtrl.isHolding()||this.checkCstaState(o.Holding)?i.Holding:this.sessionCtrl.isHeld()?i.Held:i.Active,this.setState(e))},C.prototype.isHolding=function(){return this.atcCallInfo?C.parent.isHolding.apply(this,arguments):this.checkState([i.Holding,i.HoldOnHold])},C.prototype.isConsultAllowed=function(){return!this.atcCallInfo||this.atcCallInfo.isConsultAllowed()},C.prototype.isHoldInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isHoldInProgress():this.holdInProgress},C.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress(),this.holdInProgress=!0},C.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress(),this.holdInProgress=!1},C.prototype.isRetrieveInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isRetrieveInProgress():this.retrieveInProgress},C.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress(),this.retrieveInProgress=!0},C.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress(),this.retrieveInProgress=!1},C.prototype.isTransferCallAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferCallAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(r.StcCapabilities.STC_TRANSFER)&&this.checkState([i.Active,i.Delivered])},C.prototype.isTransferAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(r.StcCapabilities.STC_TRANSFER)&&this.state.established&&!this.isDirectUpgradedToConf},C.prototype.isConferenceCallAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isConferenceCallAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(r.StcCapabilities.STC_MERGE)&&this.state.established},e.LocalCall=C,e.Enums.CallServerTerminatedReason=d,e.Enums.CallClientTerminatedReason=u,e}((Circuit=function(e){"use strict";var t=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered",ForcedUnregistered:"ForcedUnregistered"});return e.Enums=e.Enums||{},e.Enums.AtcRegistrationState=t,e}((Circuit=function(e){"use strict";var t=e.BaseCall,n=e.Enums.CallState,i=e.Proto;function r(e){var t=Circuit.logger;if(!e||!e.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");r.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===n.ActiveRemote&&!this.pullBlocked},enumerable:!0,configurable:!1}}),this.activeClient=null,e=null,this.isTelephonyCall&&(this.peerUser.displayName=""),t.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}return e.Utils.inherit(r,t),r.prototype.setActiveClient=function(e){e&&(e.userId?(this.activeClient={clientId:e.clientId,clientDisplayName:e.clientDisplayName,mediaType:i.getMediaType(e.mediaTypes)},this.pullNotAllowed=!1===e.pullCall):this.activeClient=e)},e.RemoteCall=r,e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.Enums.CstaCallState,i=e.DefaultAvatars,r=e.logger,o=e.Enums.ParticipantState,a=e.RtcParticipant,s=e.UserProfile,c=e.Utils,l=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),d=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},NotStarted:{name:"NotStarted",ui:"",established:!1,css:"not-started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}}),u={ToggleWhiteboard:{name:"ToggleWhiteboard",type:"screenEnabledFeature",localize:"res_Whiteboard"},ToggleScreenShare:{name:"ToggleScreenShare",type:"screenEnabledFeature",localize:"res_Screenshare"},ToggleConferencePoll:{name:"ToggleConferencePoll",type:"screenEnabledFeature",localize:"res_Poll"},ToggleVideo:{name:"ToggleVideo",type:"screenEnabledFeature",localize:"res_Video"},SwapDisplays:{name:"SwapDisplays",type:"displays",icon:"",localize:"res_SwapDisplays"}},E=[u.ToggleScreenShare.name,u.ToggleWhiteboard.name,u.ToggleConferencePoll.name];function C(e,o){if(!e)throw new Error("Cannot create BaseCall object without a conversation");o=!!o;var a=this,u=null,E=null,C=null,T=null,p=null,S=null,I=null,A=null,R=!1,f=!1,_=!1,v=!1,g=d.Idle,N=null,m=!1;function h(e){u=e.rtcSessionId,C=e.convId,T=e.type,p=e.topic||e.participantFirstNames||null,S=e.topicEscaped||e.participantFirstNamesEscaped||null,I=e.creatorId,R=e.type===t.ConversationType.DIRECT,f=e.type===t.ConversationType.LARGE,_=!!e.isTelephony,v=!!e.testCall,R?a.peerUser=e.peerUser:delete a.peerUser,a.peerUsers=e.peerUsers,a.numConvParticipants=e.participants.length,a.defaultAvatarColor=e.defaultAvatarColor,a.avatar=e.avatar,a.isGuestInvite=!!e.isTemporary}Object.defineProperties(this,{isRemote:{value:o,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return u},enumerable:!0,configurable:!1},cstaCallId:{get:function(){return this.atcCallInfo?this.atcCallInfo.getCstaCallId():null},enumerable:!0,configurable:!1},instanceId:{get:function(){return E},enumerable:!0,configurable:!1},transactionId:{get:function(){return A},enumerable:!0,configurable:!1},state:{get:function(){return g},enumerable:!0,configurable:!1},convId:{get:function(){return C},enumerable:!0,configurable:!1},convType:{get:function(){return T},enumerable:!0,configurable:!1},convTitle:{get:function(){return p||(R?this.peerUser.displayName:"")},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return S||(R?this.peerUser.displayNameEscaped:"")},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some((function(e){return e.participantType===t.RTCParticipantType.SESSION_GUEST||e.participantType===t.RTCParticipantType.EXTERNAL}))},enumerable:!1,configurable:!1},ownerId:{get:function(){return I},enumerable:!0,configurable:!1},isDirect:{get:function(){return R&&!m||_},enumerable:!0,configurable:!1},isLarge:{get:function(){return f},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!R||m},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==d.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==d.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==d.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return _},enumerable:!0,configurable:!1},isTestCall:{get:function(){return v},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},pickupNotification:{get:function(){return this.isPickupNotification()},enumerable:!0,configurable:!0},pickedUp:{get:function(){return this.isPickedUp()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return N},set:function(e){N=e},enumerable:!0,configurable:!1},transferCallFailedCause:{get:function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},enumerable:!0,configurable:!1},isOutgoingCallCampedOn:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isOutgoingCallCampedOn()},enumerable:!0,configurable:!0},isATCCall:{get:function(){return!!this.atcCallInfo},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!1},enumerable:!0,configurable:!0},isDirectUpgradedToConf:{get:function(){return m},enumerable:!0,configurable:!1}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.lastMediaType=this.mediaType,this.direction=l.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.recording={state:t.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:t.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==t.RecordingInfoState.INITIAL},isActive:function(){return this.state===t.RecordingInfoState.STARTED||this.state===t.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===t.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==t.RecordingInfoReason.NONE&&this.reason!==t.RecordingInfoReason.STOPPED_MANUALLY&&this.reason!==t.RecordingInfoReason.STOPPED_AUTOMATICALLY&&(this.state===t.RecordingInfoState.INITIAL||this.state===t.RecordingInfoState.STOPPED)}},this.transcription={state:t.RecordingInfoState.INITIAL,wasStarted:function(){return this.state!==t.RecordingInfoState.INITIAL},isActive:function(){return this.state===t.RecordingInfoState.STARTED||this.state===t.RecordingInfoState.START_PENDING}},this.upgradeToConfSupported=!1,this.screenControlSupported=!1,this.setState=function(e,t){!o&&e!==d.Terminated&&this.checkCstaState(n.Holding)&&(e=d.Holding),this.establishedTime||!e.established||this.atcCallInfo&&!this.atcCallInfo.cstaState.established&&this.atcCallInfo.cstaState!==n.Initiated||(this.establishedTime=Date.now()),e&&e!==g&&(g!==d.Terminated?(r.debug("[BaseCall]: Changing call state from "+g.name+" to "+e.name),g=e,this.isTelephonyCall&&(this.avatar=e===d.Holding?i.TELEPHONY_HOLD:i.TELEPHONY),g!==d.Terminated||t||this.terminate()):r.error("[BaseCall]: The call has already been terminated. Cannot set state to ",e.name))},this.checkState=function(e){return Array.isArray(e)?e.includes(g):e===g},this.updateCall=function(e){return!!e&&(h(e),this.participants.forEach((function(t){t.isMeetingGuest&&!t.isSessionGuest&&(t.isMeetingGuest=e.participants.every((function(e){return e.userId!==t.userId})))})),!0)},this.setPeerUser=function(e,t,n,i){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||n&&n!==this.peerUser.userId||c.cleanPhoneNumber(e)!==c.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:n||"",firstName:null,lastName:null,displayName:t,phoneNumber:e,fqnLookedUp:i},s&&s.extend&&(this.peerUser=s.extend(this.peerUser)),S=(p=t||e||null)?c.textToHtmlEscaped(p):null)},this.setTransactionId=function(e){A=e||c.createTransactionId()},this.clearTransactionId=function(){A=null},this.setInstanceId=function(e){E=e},this.setCallIdForTelephony=function(e){a.isTelephonyCall&&e&&e!==u&&(r.debug("[BaseCall]: Changing callId from "+u+" to "+e),u=e)},this.setDirectUpgradedToConf=function(){R&&(m=!0)},this.clearDirectUpgradedToConf=function(){R&&(m=!1)},h(e),e=null}function T(e,n){var i=e.rtcSupportedFeatures||[];n.isDirect&&(i.includes(t.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE)?(r.debug("[BaseCall]: Upgrade to conference is supported by peer client"),n.upgradeToConfSupported=!0):(r.debug("[BaseCall]: Upgrade to conference is not supported by peer client"),n.upgradeToConfSupported=!1)),e.mediaType&&e.mediaType.desktop&&(i.includes(t.RtcSupportedFeatures.SCREEN_CONTROL)?(r.debug("[BaseCall]: Screen control supported by presenter"),n.screenControlSupported=!0):(r.debug("[BaseCall]: Screen control not supported by presenter"),n.screenControlSupported=!1))}return C.prototype.sameAs=function(e){return!!e&&this.callId===e.callId&&this.isRemote===e.isRemote},C.prototype.terminate=function(){r.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.lastMediaType=this.mediaType,this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(d.Terminated,!0)},C.prototype.isEstablished=function(){return this.state.established},C.prototype.isOutgoingState=function(){return this.state===d.Initiated||this.state===d.Connecting||this.state===d.Delivered||this.state===d.Busy},C.prototype.isPresent=function(){return this.state!==d.Idle&&this.state!==d.Terminated},C.prototype.isHeld=function(){return this.state===d.Held},C.prototype.hasRemoteMedia=function(){return!1},C.prototype.isCallingOut=function(){return this.state===d.Waiting&&this.participants.length>0&&this.participants.every((function(e){return e.pcState===o.Initiated}))},C.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},C.prototype.updateSecurityStatus=function(e){!0!==e&&!1!==e||(this.secureCall=e)},C.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([d.Active,d.Waiting])},C.prototype.hasRemoteVideo=function(){return!1},C.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},C.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},C.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},C.prototype.isMuted=function(){return!1},C.prototype.mute=function(){return r.warning("[BaseCall]: Mute is not implemented in base object"),!1},C.prototype.unmute=function(){return r.warning("[BaseCall]: Unmute is not implemented in base object"),!1},C.prototype.toggleMute=function(){return r.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},C.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===l.OUTGOING&&this.checkState([d.Declined,d.Busy,d.NotAnswered,d.Failed])},C.prototype.setPeerUsersAsParticipants=function(){this.direction===l.OUTGOING&&this.peerUsers&&(this.participants=this.peerUsers.map((function(e){return a.createFromUser(e,o.Initiated)})),this.participantsHashTable=this.participants.reduce((function(e,t){return e[t.userId]=t,e}),{}),r.debug("[BaseCall]: Initialized participants: ",this.participants))},C.prototype.hasParticipant=function(e){return this.participants.some((function(t){return t.userId===e}))},C.prototype.getParticipant=function(e){return this.participants.find((function(t){return t.userId===e}))||null},C.prototype.addParticipant=function(e,t,n){return e&&e.userId?(r.debug("[BaseCall]: Add participant with userId =",e.userId),this.hasParticipant(e.userId)?n?this.updateParticipant(e,t):(r.warning("[BaseCall]: addParticipant called with existing participant. userId =",e.userId),null):(t&&(e.pcState=t),this.participants.push(e),this.participantsHashTable[e.userId]=e,T(e,this),r.debug("[BaseCall]: Added participant to call: ",e.userId),e)):(r.warning("[BaseCall]: addParticipant called with invalid participant"),null)},C.prototype.updateParticipant=function(e,n){if(!e||!e.userId)return r.warning("[BaseCall]: updateParticipant called with invalid participant"),null;r.debug("[BaseCall]: Update participant with userId =",e.userId);var i=this.getParticipant(e.userId);return i?(n=n||e.pcState,i.isMeetingPointInvitee&&i.locallyMuted?(i.muted=!0,i.pcState=n!==o.Active?n:o.Muted):(i.muted=e.muted,i.pcState=n),i.mediaType.desktop&&!e.mediaType.desktop&&(this.screenControlSupported=!1),i.streamId=e.streamId,i.screenStreamId=e.screenStreamId,i.mediaType=e.mediaType,i.screenSharePointerSupported=e.screenSharePointerSupported,i.isModerator=e.isModerator,i.isMeetingGuest=e.isMeetingGuest,i.rtcSupportedFeatures=e.rtcSupportedFeatures,i.flags=e.flags,i.videoPointerTo=e.videoPointerTo,e.participantType===t.RTCParticipantType.TELEPHONY&&(i.displayName=e.displayName,i.firstName=e.firstName,i.lastName=e.lastName,i.phoneNumber=e.phoneNumber),T(i,this),r.debug("[BaseCall]: Updated participant data for ",i.userId),i):(r.warning("[BaseCall]: The given participant is not part of the call"),null)},C.prototype.removeParticipant=function(e){delete this.participantsHashTable[e];var t=this.participants;return t.find((function(n,i){return n.userId===e&&(n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},t.splice(i,1),r.debug("[BaseCall]: Removed participant from call: ",n.userId),!0)}))||null},C.prototype.setParticipantState=function(e,t){t&&this.participants.some((function(n){return n.userId===e&&(n.pcState=t,r.debug("[BaseCall]: Set participant state to "+t.name+", userId =",n.userId),!0)}))},C.prototype.hasOtherParticipants=function(){return this.participants.length>0||this.attendeeCount>0},C.prototype.updateMediaType=function(){var e={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach((function(t){t.mediaType&&(t.mediaType.audio&&(e.audio=!0),t.mediaType.video&&(e.video=!0),t.mediaType.desktop&&(e.desktop=!0))})),r.debug("[BaseCall]: Updating call media type to ",e),this.mediaType=e},C.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},C.prototype.toString=function(){return JSON.stringify(this,null,3)},C.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},C.prototype.setCstaState=function(e){this.atcCallInfo&&(r.debug("[BaseCall]: Set csta state to ",e),this.atcCallInfo.cstaState=e,this.isAtcRemote&&(this.avatar=e===n.Holding?i.TELEPHONY_HOLD:i.TELEPHONY),this.consultation=this.consultation&&!this.isHolding())},C.prototype.checkCstaState=function(e){return!!this.atcCallInfo&&(Array.isArray(e)?e.includes(this.atcCallInfo.cstaState):e===this.atcCallInfo.cstaState)},C.prototype.isHolding=function(){return this.checkCstaState([n.Holding,n.HoldOnHold,n.ConferenceHolding])},C.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},C.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},C.prototype.isReconnectAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isReconnectAllowed()},C.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},C.prototype.isMakeCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isMakeCallAllowed()},C.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},C.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},C.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},C.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},C.prototype.setPosition=function(e){this.atcCallInfo&&this.atcCallInfo.setPosition(e)},C.prototype.isAtPosition=function(e){return!!this.atcCallInfo&&this.atcCallInfo.isAtPosition(e)},C.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},C.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},C.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},C.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},C.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},C.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},C.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},C.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},C.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},C.prototype.setRedirectingUser=function(e,t,n,i,r){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(e,t,n,i,r)},C.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},C.prototype.setRedirectionType=function(e){this.atcCallInfo&&this.atcCallInfo.setRedirectionType(e)},C.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},C.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},C.prototype.isPickupNotification=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickupNotification()},C.prototype.isPickedUp=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickedUp()},C.prototype.setDisconnectCause=function(e,t){this._disconnectCause||(this.disconnectCause={cause:e,reason:t})},e.BaseCall=C,e.Enums=e.Enums||{},e.Enums.CallDirection=l,e.Enums.CallState=d,e.Enums.ScreenDisplayAction=u,e.Enums.ScreenLayoutAction={ToggleFocusLayout:{name:"ToggleFocusLayout",type:"cmrLayout",localize:"res_FocusLayout"},ToggleSplitLayout:{name:"ToggleSplitLayout",type:"cmrLayout",localize:"res_SplitLayout"},ToggleLargeLayout:{name:"ToggleLargeLayout",type:"cmrLayout",localize:"res_LargeLayout"}},e.Enums.ScreenFeaturesByPriority=E,e}((Circuit=function(e){"use strict";var t=e.logger,n=e.Utils,i={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_AlternativeNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},r=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),o=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),a=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},CircuitClient:{name:"CircuitClient",ui:"res_CircuitClient",desc:"res_CircuitClientRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),s=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),c=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),l=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),d=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"},CallPickupNotification:{name:"callPickupNotification",ui:"res_CallPickupNotification"},CallPickedUp:{name:"callPickedUp",ui:"res_CallPickedUp"},Dss:{name:"dss",ui:"res_CallPickedUp"}}),u=Object.freeze({Ready:"ready",NotReady:"notReady"}),E=Object.freeze({CallNotFound:{name:"CallNotFound",ui:"res_PickUpCallFailedCauseNotFound"},CallAlreadyPickedUp:{name:"CallAlreadyPickedUp",ui:"res_PickUpCallFailedCauseAlreadyPickedUp"}}),C=Object.freeze({Immediate:{name:"Immediate",label:"res_CallForwarding",description:"res_CallForwardingDescription",message:"res_CallForwardingEnabled"},VM:{name:"VM",label:"",description:"",message:"res_VoicemailForwarded"},NoAnswer:{name:"NoAnswer",label:"res_CallForwardingNoAnswer",description:"res_CallForwardingNoAnswerDescription",message:"res_CallForwardingNoAnswerEnabled"}});function T(e){return n.GNF_PHONE_PATTERN.test(e)}return e.AtcCallInfo=function(){var e=null;this.cstaConn=null,this.cstaState=r.Idle,this.cstaReconnectId={},this.position=i.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.outgoingCallCampedOn=!1,this.redirectingUser={},this.masterParallelHgCall=!1,this.queuedIncomingCall=!1,this.recalledCall=!1,this.osbizCallOnAlternativeNumber=!1,this.setPeerName=function(e){this.peerName=e||""},this.setPartnerDisplay=function(e){e&&(this.peerFQN=e.fqn||"",this.peerDn=e.dn||e.fqn||"",this.peerName=e.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.getPartnerDisplay=function(){return{dn:this.peerDn,fqn:this.peerFQN,name:this.peerName}},this.setOriginalPartnerDisplay=function(e){e&&(n.isEmptyObject(this.originalPartnerDisplay)||!T(this.originalPartnerDisplay.fqn)&&T(e.fqn))&&(this.originalPartnerDisplay=e)},this.setCstaConnection=function(e){this.cstaConn=e,this.isRemote&&(this.callId=e.cID)},this.getCstaConnection=function(){return this.cstaConn},this.setCstaCallId=function(e){this.cstaConn&&(this.cstaConn.cID=e)},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setCstaReconnectId=function(e){this.cstaReconnectId=e},this.getCstaReconnectId=function(){return this.cstaReconnectId},this.setOsbizCallOnAlternativeNumber=function(){this.osbizCallOnAlternativeNumber=!0},this.isOsbizCallOnAlternativeNumber=function(){return this.osbizCallOnAlternativeNumber},this.setServicesPermitted=function(e){e&&!n.isEmptyObject(e)?(e.rSP&&void 0!==e.rSP.cCSs&&(this.servicesPermitted.rSP=e.rSP),void 0!==e.eSP&&(this.servicesPermitted.eSP=e.eSP),t.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted)):t.info("[AtcCallInfo]: Empty services permitted, keeping last values")},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()&&!this.isOsbizCallOnAlternativeNumber()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===r.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===r.Parked||this.cstaState===r.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return!!this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case r.Active:case r.Conference:case r.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===r.Conference||this.cstaState===r.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case r.ConferenceHolding:case r.Holding:case r.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(e){e&&e!==this.position&&(this.position=e,t.debug("[AtcCallInfo]: Set call position to ",e.name))},this.isAtPosition=function(e){return this.position===e},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(e){e&&e!==this.missedReason&&(this.missedReason=e,t.debug("[AtcCallInfo]: Set missedReason to ",e))},this.isQueuedIncomingCall=function(){return this.queuedIncomingCall},this.setQueuedIncomingCall=function(e){this.queuedIncomingCall=e},this.isRecalledCall=function(){return this.recalledCall},this.setRecalledCall=function(e){this.recalledCall=e},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===r.Offered},this.setIgnoreCall=function(e){this.ignoreCall=e},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.isOutgoingCallCampedOn=function(){return this.outgoingCallCampedOn},this.setOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!0},this.clearOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!1},this.setTransferCallFailedCause=function(t){if(this.cstaState===r.TransferFailed)switch(t){case"busy":e=l.Busy;break;case"doNotDisturb":e=l.DND;break;default:e=l.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===r.TransferFailed?e||l.Unreachable:null},this.setRedirectingUser=function(e,t,n,i,r){r=r||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==t||(this.redirectingUser={userId:i||"",displayName:n,phoneNumber:e,fqNumber:t,redirectionType:r})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(e){this.redirectingUser.redirectionType=e},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallForward},this.isPickupNotification=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickupNotification},this.isPickedUp=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickedUp}},e.BusyHandlingOptions=o,e.RoutingOptions=a,e.Enums=e.Enums||{},e.Enums.AgentState=u,e.Enums.CallForwardingTypes=C,e.Enums.CstaCallState=r,e.Enums.Targets=i,e.Enums.JournalEntryTypes=s,e.Enums.MissedReasonTypes=c,e.Enums.RedirectionTypes=d,e.Enums.TeamPickupFailedCauses=E,e.Enums.TransferCallFailedCauses=l,e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.Utils,i={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},r={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},o={createFromUser:function(t,r){if(!t)return null;var a=Object.create(t);a.pcState=r||i.Idle,a.streamId=null,a.screenStreamId=null,a.videoStream=null,a.mediaType={audio:!1,video:!1,desktop:!1},a.muted=!1,a.activeSpeaker=!1,a.isActive=o.isActive.bind(null,a),a.actions=[],a.screenSharePointerSupported=!1,a.hasSameMediaType=o.hasSameMediaType.bind(null,a),a.hasVideoStream=o.hasVideoStream.bind(null,a),a.setActions=o.setActions.bind(null,a),a.rtcSupportedFeatures=[],a.flags=[],a.toJSON=function(){return this},a.userId=t.userId,a.firstName=t.firstName,a.lastName=t.lastName;var s=null,c="";return Object.defineProperty(a,"videoStream",{get:function(){return s},set:function(e){s=e,c=""},enumerable:!0,configurable:!1}),n.isMobile()&&Object.defineProperty(a,"videoUrl",{get:function(){return c=s?c||e.WebRTCAdapter.createObjectURL(s):""},enumerable:!0,configurable:!1}),a.streams={},a},isActive:function(e){switch(e.pcState){case i.Active:case i.Joined:case i.Muted:case i.OnStage:return!0}return!1},hasSameMediaType:function(e,t){return!!(e&&t&&e.mediaType&&t.mediaType&&e.mediaType.audio===t.mediaType.audio&&e.mediaType.video===t.mediaType.video&&e.mediaType.desktop===t.mediaType.desktop)},hasVideoStream:function(e){return!(!e.videoStream||!e.streamId&&!e.screenStreamId||!e.mediaType.video&&!e.mediaType.desktop)},setActions:function(e,n,o){if(e.actions=[],!n||!n.isTemporary)if(e.pcState.established)if(e.isMeetingPointInvitee)e.actions.push(e.mediaType.video?r.StopVideo:r.StartVideo),e.actions.push(e.muted?r.Unmute:r.Mute),e.actions.push(r.Drop);else{var a=!n||n.isModerated,s=n&&n.userIsModerator(o),c=n&&n.userIsModerator(e);e.muted||a&&c&&!s||e.actions.push(r.Mute),a&&!s||(n.type===t.ConversationType.LARGE&&!c&&s?!e.isCMP&&e.actions.push(r.RemoveFromStage):e.actions.push(r.Drop))}else e.pcState===i.Initiated&&e.actions.push(r.Drop)}};return e.RtcParticipant=o,e.Enums=e.Enums||{},e.Enums.ParticipantState=i,e.Enums.ParticipantAction=r,e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.logger,i=e.Constants.RealtimeMediaType,r=e.Utils;return e.RtcPeerConnectionsUnified=function(o,a){a=a||{};var s,c=e.WebRTCAdapter,l=this,d=r.shallowCopy(o),u=null,E=0,C={},T=[];function p(e){return!!e&&e===u}function S(e,t){n.debug("[RTCPeerConnectionsUnified]: onnegotiationneeded"),p(e)?function(e){N(l.onnegotiationneeded,e)}(t):n.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}function I(e,t){n.debug("[RTCPeerConnectionsUnified]: onicecandidate: iceGatheringState = ",e.iceGatheringState),p(e)?(t.candidate||n.debug("[RTCPeerConnectionsUnified]: End of candidates"),function(e){N(l.onicecandidate,e)}(t)):n.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}function A(e,t){n.debug("[RTCPeerConnectionsUnified]: onsignalingstatechange: signalingState = ",e.signalingState),p(e)?function(e){N(l.onsignalingstatechange,e)}(t):n.debug("[RTCPeerConnectionsUnified]:  Event is from old Peer Connection")}function R(e,t){n.debug("[RTCPeerConnectionsUnified]: oniceconnectionstatechange: iceConnectionState = ",e.iceConnectionState),p(e)?function(e){N(l.oniceconnectionstatechange,e)}(t):n.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}function f(e,t){if(n.debug("[RTCPeerConnectionsUnified]: ontrack:",t.track&&t.track.label),p(e)){if(t.track){var i=null;if(u.getTransceivers().some((function(e){return!(!e.receiver||!_(e.receiver.track,t.track))&&(i=e.mid,!0)})),i){var r=new c.MediaStream([t.track]);r.mid=i,n.debug("[RTCPeerConnectionsUnified]: ontrack: mid: ",i),function(e){N(l.onaddstream,e)}({stream:r})}else n.error("[RTCPeerConnectionsUnified]: ontrack: Could not find the mid attribute. This remote track won't be played: ",t.track.label)}}else n.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}function _(e,t){return!(!e||!t)&&c.getTrackId(e)===c.getTrackId(t)}function v(e){return!(!e||"video"!==e.kind)}function g(e,n,i){switch(e){case t.RealtimeMediaType.VIDEO:return n!==i;case t.RealtimeMediaType.DESKTOP_SHARING:return n===i;default:return!1}}function N(e,t){if("function"==typeof e)try{e(t)}catch(e){n.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(e,t,i,r){!function(e,t){if((t=t||{}).audioInactive)u.addTransceiver("audio",{direction:"inactive"});else if(e.mandatory&&e.mandatory.OfferToReceiveAudio){u.getReceivers().some((function(e){return"audio"===(e.track&&e.track.kind)}))||(n.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding 1 audio receiver"),u.addTransceiver("audio",{direction:"recvonly"}))}var i=e.mandatory&&e.mandatory.OfferToReceiveVideo||a.onlyRemoteScreenShare,r=0,o=0;if(i)if(u.getReceivers().forEach((function(e){"video"===(e.track&&e.track.kind)&&r++})),o=E-r,C.track&&o>0?(r++,o=E-r):i=!1,o>=0){n.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding "+o+" video receivers");for(var s=0;s<o;s++)u.addTransceiver("video",{direction:"recvonly"})}else n.warn("[RTCPeerConnectionsUnified]: create local SDP: Could not calculate number of video receivers: ",o);n.debug("[RTCPeerConnectionsUnified]: Total number of video receivers: ",r+o),C.track&&u.addTransceiver(C.track,{direction:i&&!a.onlyRemoteScreenShare?"sendrecv":"sendonly"})}(i,r),u.createOffer((function(t){n.debug("[RTCPeerConnectionsUnified]: createOffer succeeded"),e(t)}),t)},this.createAnswer=function(e,t,i,r){!function(e,t){t=t||{};var n=e.mandatory&&e.mandatory.OfferToReceiveVideo;n&&!t.audioInactive||u.getTransceivers().forEach((function(e){if(!e.stopped){var i=e.receiver&&e.receiver.track&&e.receiver.track.kind;n||"video"!==i?t.audioInactive&&"audio"===i&&(e.direction="inactive"):e.sender&&e.sender.track?e.direction="sendonly":e.direction="inactive"}})),C.track&&u.addTrack(C.track,C.stream)}(i,r),u.createAnswer((function(t){n.debug("[RTCPeerConnectionsUnified]: createAnswer succeeded"),e(t)}),t)},this.setMainMediaLines=function(){},this.setLocalDescription=function(e,t,n){u.setLocalDescription(e,t,n)},this.setRemoteDescription=function(e,t,n){var i;u.setRemoteDescription((i=e)&&"pranswer"===i.type?new c.SessionDescription({type:"answer",sdp:i.sdp}):i,t,n)},this.removeStream=function(e){if(e){var t=u.getSenders();e.getTracks().forEach((function(e){n.debug("[RTCPeerConnectionsUnified]: Attempting to remove local track: ",e.label),t.some((function(t){return!!_(t.track,e)&&(n.debug("[RTCPeerConnectionsUnified]: Found sender, track removed"),_(C.track,e)&&(n.debug("[RTCPeerConnectionsUnified]: Set local desktop track to null"),C={}),u.removeTrack(t),!0)}))}))}},this.addStream=function(e,t,i){e&&(u.remoteDescription&&u.remoteDescription.type?e.getTracks().forEach((function(t){e.isScreen?(C.track=t,C.stream=e):u.addTrack(t,e)})):(e.getAudioTracks().forEach((function(e){u.addTransceiver(e,{direction:"sendrecv"})})),e.getVideoTracks().forEach((function(r){var o=c.getTrackId(r),s=o&&i[o],l=s&&s.direction||"sendrecv",d=!t||a.onlyRemoteScreenShare&&!e.isScreen?"sendonly":l;e.isScreen?(C.track=r,C.stream=e):u.addTransceiver(r,{direction:d}),n.debug("[RTCPeerConnectionsUnified]: Added local "+(e.isScreen?"screen":"video")+" track="+r.label+" direction="+d)}))))},this.replaceTrack=function(e,t){return e&&t?new Promise((function(i,r){u.getSenders().some((function(o){if(e===o.track){var a=o.track.label;return o.replaceTrack(t).then((function(){n.debug("[RTCPeerConnectionsUnified]: Successfully replaced "+a+" track with ",t.label),i()})).catch((function(e){n.error("[RTCPeerConnectionsUnified]: Error replacing "+a+" track with "+t.label+". ",e),r(e)})),!0}return!1}))||(n.error("[RTCPeerConnectionsUnified]: Could not find track to be replaced"),r("Could not find track to be replaced"))})):Promise.reject("Missing parameter(s)")},this.getLocalStreams=function(){var e=[];return u.getSenders().forEach((function(t){t.track&&e.push(new c.MediaStream([t.track]))})),e},this.getRemoteStreams=function(){var e=[];return u.getTransceivers().forEach((function(t){if(t.receiver&&t.receiver.track){var n=new c.MediaStream([t.receiver.track]);n.mid=t.mid,e.push(n)}})),e},this.addIceCandidate=function(e){e?u.addIceCandidate(new c.IceCandidate(e)):u.addIceCandidate()},this.close=function(){var e;u.close(),(e=u).onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.oniceconnectionstatechange=null,e.ontrack=null},this.createDTMFSender=function(e){return u.createDTMFSender(e)},this.sendDataMessage=function(){return!1},this.getMediaId=function(e){if(e){var t=u.getTransceivers();if(t.length){var n=t.find((function(t){return t.sender&&_(t.sender.track,e)}));if(n)return n.mid}}return null},this.getScreenShareMediaId=function(){var e=u.getTransceivers();if(e.length){if(C.track){var t=e.find((function(e){return!(!e.sender||!e.sender.track)&&_(e.sender.track,C.track)}));if(t)return t.mid;n.warn("[RTCPeerConnectionsUnified]: Could not find desktop sender obj. Last video connection will be selected for screen share")}if(a.createDesktopPc)for(var i=e.length-1;i>=0;i--){var r=e[i];if(r.receiver&&r.receiver.track&&"video"===r.receiver.track.kind)return r.mid}}return null},this.getStats=function(){return u.getStats()},this.setMaxBitrate=function(e){u.getTransceivers().forEach((function(t){var n=t.sender&&t.sender.track,i=c.getTrackId(n),r=i&&e[i];r&&c.setEncodingParameters(t,r.maxBitrate,r.degradationPreference,r.scaleResolutionDownBy)}))},this.getAvailableVideoReceivers=function(e){var t=l.getScreenShareMediaId(),n=[];return u.getTransceivers().forEach((function(i){var r=i.mid,o=i.receiver;o&&v(o.track)&&g(e,r,t)&&n.push({id:r})})),n},this.getAvailableVideoSenders=function(e){var t=l.getScreenShareMediaId(),r=[];return u.getTransceivers().forEach((function(n){var o=n.sender&&n.sender.track;if(v(o)&&g(i.VIDEO,n.mid,t)){var a=c.getTrackId(o),s=a&&e[a];s&&r.push({mid:n.mid,quality:s.quality,mediaType:i.VIDEO})}})),n.info("[RTCPeerConnectionsUnified] Video senders: ",r),r},Object.defineProperties(this,{localDescription:{get:function(){return u.localDescription},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return u.remoteDescription},enumerable:!0,configurable:!1},signalingState:{get:function(){return u.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return u.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return u},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return[]},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return a.createDesktopPc},enumerable:!0,configurable:!1},desktopRemoteSsrc:{get:function(){return T},set:function(e){T=e||[]},enumerable:!0,configurable:!1}}),d.sdpSemantics="unified-plan",d.bundlePolicy="max-compat",E=a.extraVideoChannels+(a.createDesktopPc?1:0)+(a.onlyRemoteScreenShare?0:1),d.iceCandidatePoolSize=1+E,n.debug("[RTCPeerConnectionsUnified]: Create RTCPeerConnection with config: ",d),u=new c.PeerConnection(d),(s=u).onnegotiationneeded=S.bind(null,s),s.onicecandidate=I.bind(null,s),s.onsignalingstatechange=A.bind(null,s),s.oniceconnectionstatechange=R.bind(null,s),s.ontrack=f.bind(null,s)},e}((Circuit=function(e){"use strict";var t=e.logger,n=e.Constants.RealtimeMediaType,i=e.sdpParser,r=e.Utils;return e.RtcPeerConnections=function(o,a,s){var c=e.WebRTCAdapter,l=this,d=r.shallowCopy(o),u=a,E={screenControlChannelName:"SCREEN_CONTROL",isScreenControlled:!!(s=s||{}).isScreenControlled,isScreenOwner:!!s.isScreenOwner},C=null,T=null,p=s.extraVideoChannels||0,S=[],I={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},A=0,R="new";function f(e){e.onnegotiationneeded=g.bind(null,e),e.onicecandidate=N.bind(null,e),e.onsignalingstatechange=m.bind(null,e),e.onaddstream=h.bind(null,e),e.onremovestream=O.bind(null,e),e.oniceconnectionstatechange=D.bind(null,e)}function _(e){e.onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.onaddstream=null,e.onremovestream=null,e.oniceconnectionstatechange=null,e.ondatachannel=null}function v(e){return!!e&&(e===C||e===T||S.includes(e))}function g(e,n){t.debug("[RTCPeerConnections]: onnegotiationneeded"),v(e)?function(e){w(l.onnegotiationneeded,e)}(n):t.debug("[RTCPeerConnections]: Event is from old Peer Connection")}function N(e,n){if(t.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState = ",e.iceGatheringState),v(e)){if(n.candidate){if(e===T){n={candidate:new c.IceCandidate({sdpMLineIndex:U()-1,sdpMid:n.candidate.sdpMid,candidate:n.candidate.candidate})}}else if(e!==C){var i=S.indexOf(e);if(i>=0)n={candidate:new c.IceCandidate({sdpMLineIndex:n.candidate.sdpMLineIndex+i+2,sdpMid:n.candidate.sdpMid,candidate:n.candidate.candidate})}}}else{if(++A<U())return;t.debug("[RTCPeerConnections]: End of candidates - all peer connections"),A=0}!function(e){w(l.onicecandidate,e)}(n)}else t.debug("[RTCPeerConnections]: Event is from old Peer Connection")}function m(e,n){t.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState = ",e.signalingState),v(e)?function(e){w(l.onsignalingstatechange,e)}(n):t.debug("[RTCPeerConnections]: Event is from old Peer Connection")}function h(e,n){t.debug("[RTCPeerConnections]: onaddstream"),v(e)?function(e){w(l.onaddstream,e)}(n):t.debug("[RTCPeerConnections]: Event is from old Peer Connection")}function O(e,n){t.debug("[RTCPeerConnections]: onremovestream"),v(e)?function(e){w(l.onremovestream,e)}(n):t.debug("[RTCPeerConnections]: Event is from old Peer Connection")}function D(e,n){if(v(e)){var i;i=e===C?"main":e===T?"desktop":"aux"+S.indexOf(e);var r=e.iceConnectionState;t.debug("[RTCPeerConnections]: oniceconnectionstatechange - "+i+": iceConnectionState = ",r),e===C&&R!==r&&(R=r,function(e){w(l.oniceconnectionstatechange,e)}(n))}else t.debug("[RTCPeerConnections]: oniceconnectionstatechange from old Peer Connection.")}function P(e){var t=C[e];if(!t||!t.type||!t.sdp)return null;if(0===p&&!T)return t;var n=i.parse(t.sdp);if(1===n.m.length&&"audio"===n.m[0].media&&"remoteDescription"!==e&&p>0&&i.addEmptyVideoLine(n),S.every((function(t){var r=t[e];if(!r||!r.type||!r.sdp)return!1;var o=i.parse(r.sdp);return(o=i.verifyFingerprintInMLines(o)).m.some((function(e){return"video"===e.media&&(n.m.push(e),!0)}))})),T){var r=T[e];if(r&&r.type&&r.sdp){var o=i.parse(r.sdp);o.m&&o.m.length&&(o=i.verifyFingerprintInMLines(o),n.m.push(o.m[0]))}}return new c.SessionDescription({type:t.type,sdp:i.stringify(n)})}function y(){C.createdLocalSdp=null,S.forEach((function(e){e.createdLocalSdp=null}))}function b(e){return"pranswer"===e.type&&(e.type="answer"),e}function U(){return(C?1:0)+S.length+(T?1:0)}function L(e){var t;return T&&e.some((function(n,i){return n.a.some((function(r){return"mid"===r.field&&"video_screen"===r.value&&(t=n,e.splice(i,1),!0)}))})),t}function M(e){var t=[];return e.forEach((function(e){e&&e.getVideoTracks().length>0&&t.push(c.getVideoStreamTrackId(e))})),t}function w(e,n){if("function"==typeof e)try{e(n)}catch(e){t.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(e,n,r){var o=0,a=U(),l=null;function d(r,s){if(o++,t.debug("[RTCPeerConnections]: createOffer, count: ",o),r.createdLocalSdp=function(e,t,n){var r=i.parse(e.sdp),o=n===T;if(o||T||n.getLocalStreams().some((function(e){return e&&e.isScreen}))&&(o=!0),o||p){var a=o?"video_screen":"video_"+(t-1);r.m.forEach((function(e){if("video"===e.media)for(var t=0,n=e.a.length;t<n;t++)if("mid"===e.a[t].field){e.a[t].value=a;break}}))}return new c.SessionDescription({type:e.type,sdp:i.stringify(r)})}(s,o,r),o>=a){if(l)n(l);else{var d=P("createdLocalSdp");e(d)}y()}}function u(e){o++,l||(l=e),o>=a&&n(l)}r.mandatory.OfferToReceiveVideo=r.mandatory.OfferToReceiveVideo&&!s.onlyRemoteScreenShare,C.createOffer(d.bind(null,C),u,r),S.forEach((function(e){e.createOffer(d.bind(null,e),u,I)})),T&&T.createOffer(d.bind(null,T),u,I)},this.createAnswer=function(e,n,i){var r=0,o=U(),a=null;function s(i,s){if(r++,t.debug("[RTCPeerConnections]: createAnswer, count: ",r),i.createdLocalSdp=s,r>=o){if(a)n(a);else{var c=P("createdLocalSdp");e(c)}y()}}function c(e){r++,a||(a=e),r>=o&&n(a)}C.createAnswer(s.bind(null,C),c),S.forEach((function(e){e.remoteDescription?e.createAnswer(s.bind(null,e),c,i):r++})),T&&T.createAnswer(s.bind(null,T),c,i)},this.setMainMediaLines=function(e,n){n.m=e.splice(0,2),e.some((function(i,r){return"application"===i.media&&(t.info("[RTCPeerConnections]: Adding application media line to main SDP"),n.m.push(i),e.splice(r,1),!0)}))},this.setLocalDescription=function(e,n,r){var o=0,a=U(),s=null;function l(){o++,t.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",o),o>=a&&(s?r(s):n())}function d(e){o++,t.error("[RTCPeerConnections]: setLocalDescription error, count: "+o+"\n",e),s||(s=e),o>=a&&r(s)}var u=i.parse(e.sdp),E=u.m,p=L(E);(this.setMainMediaLines(E,u),"answer"===e.type)&&(i.parse(C.remoteDescription.sdp).m.some((function(e){return"video"===e.media}))||(t.info("[RTCPeerConnections]: Remote sdp offer has no video"),u.m=u.m.filter((function(e){return"video"!==e.media}))));var I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)});C.setLocalDescription(I,l,d),S.forEach((function(n){if(!E.length)return o++,void t.warning("[RTCPeerConnections]: Missing sdp mline for peer connection: ",o);u.m=E.splice(0,1),I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),n.setLocalDescription(I,l,d)})),T&&(u.m=p?[p]:E.splice(0,1),I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),T.setLocalDescription(I,l,d))},this.setRemoteDescription=function(e,n,r){var o=0,a=U(),s=null;function l(){o++,t.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",o),o>=a&&(s?r(s):n())}function d(e){o++,s||(s=e),o>=a&&r(s)}var u=i.parse(e.sdp),E=u.m,p=L(E);this.setMainMediaLines(E,u);var I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)});I=b(I),C.setRemoteDescription(I,l.bind(null,C),d),S.forEach((function(n){if(!E.length)return o++,void t.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+o);u.m=E.splice(0,1),I=b(I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)})),n.setRemoteDescription(I,l.bind(null,n),d)})),e.screen&&T?(u.m=p?[p]:[e.screen],I=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),T.setRemoteDescription(I,l,d)):(T=null,o++)},this.removeStream=function(e){C.removeStream(e),T&&T.removeStream(e)},this.addStream=function(e){return e&&e.isScreen&&T?T.addStream(e):C.addStream(e)},this.getLocalStreams=function(){var e=C.getLocalStreams();return T&&Array.prototype.push.apply(e,T.getLocalStreams()),e},this.getRemoteStreams=function(){var e=C.getRemoteStreams().slice(0);return S.forEach((function(t){e.push.apply(e,t.getRemoteStreams())})),T&&Array.prototype.push.apply(e,T.getRemoteStreams()),e},this.addIceCandidate=function(e){if(!e)return C.addIceCandidate(),T&&T.addIceCandidate(),void S.forEach((function(e){e.addIceCandidate()}));if("video_screen"===e.sdpMid&&T)return T.addIceCandidate(new c.IceCandidate(e)),void(e.sdpMLineIndex=0);if(e.sdpMLineIndex<=1)C.addIceCandidate(new c.IceCandidate(e));else{var t=e.sdpMLineIndex-2;S[t]&&(e.sdpMLineIndex=0,S[t].addIceCandidate(new c.IceCandidate(e)))}},this.close=function(){C.close(),_(C),T&&(T.close(),_(T)),S.forEach((function(e){e.close(),_(e)}))},this.createDTMFSender=function(e){return C.createDTMFSender(e)},this.sendDataMessage=function(e){return!!C.sendDataMessage&&C.sendDataMessage(e)},this.getScreenShareMediaId=function(){return"video_screen"},this.setMaxBitrate=function(){},this.getAvailableVideoReceivers=function(e){var t=[];return e===n.VIDEO?(M(C.getRemoteStreams()).forEach((function(e){t.includes(e)||t.push(e)})),S.forEach((function(e){M(e.getRemoteStreams()).forEach((function(e){t.includes(e)||t.push(e)}))}))):T&&M(T.getRemoteStreams()).forEach((function(e){t.includes(e)||t.push(e)})),t.map((function(e){return{id:e}}))},this.getAvailableVideoSenders=function(){return[]},Object.defineProperties(this,{localDescription:{get:function(){return P("localDescription")},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return P("remoteDescription")},enumerable:!0,configurable:!1},signalingState:{get:function(){return C.signalingState},enumerable:!0,configurable:!!Circuit.isUnitTestRun},iceConnectionState:{get:function(){return p>0?R:C.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return C},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return S},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return T},enumerable:!0,configurable:!1}}),d.sdpSemantics="plan-b",d.iceCandidatePoolSize=2,t.debug("[RTCPeerConnections]: Create RTCPeerConnection with config: ",d),f(C=new c.PeerConnection(d,u,E)),t.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),c.groupPeerConnectionsSupported&&function(){for(var e=0;e<p;e++)try{d.iceCandidatePoolSize=1;var n=new c.PeerConnection(d,u);S.push(n),f(n),t.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(e){t.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",e)}}(),s.createDesktopPc&&(d.iceCandidatePoolSize=1,f(T=new c.PeerConnection(d,a)),t.debug("[RTCPeerConnections]: Created screenshare peer connection"))},e}((Circuit=function(e){"use strict";var t,n=e.logger,i=e.Utils,r=e.isElectron&&require("electron").ipcRenderer,o=e.isElectron&&require("os"),a={ordered:!1,maxRetransmitTime:1e3,negotiated:!1,id:0};void 0!==window.Promise&&(t=window.Promise);var s={VIDEO_1080:"1080p",VIDEO_720:"720p",VIDEO_480:"480p"},c=Object.freeze({RTP_QUALITY_POOR:{levelName:"poor",value:0,threshold:0},RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(e){return e>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:e>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),l={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:i.isMobile()?0:5e3,DELAY_RTT_PROCESSING:3},d=function(e){if(e)try{e.oninactive=null;var t=function(e){return"function"==typeof e.getTracks?e.getTracks():e.getAudioTracks().concat(e.getVideoTracks())}(e);t.length&&t[0].stop?t.forEach((function(e){e.onended=null,e.stop(),n.debug("[WebRTCAdapter]: Media track has been stopped:",e.label)})):e.stop&&e.stop(),n.info("[WebRTCAdapter]: Media stream has been stopped. Stream ID:",e.id)}catch(e){n.error("[WebRTCAdapter]: Failed to stop media stream. ",e)}},u=function(e){if(e)try{var t=e.getVideoTracks();t?t.forEach((function(e){e.stop&&"video"===e.kind&&!e.remote&&e.stop()})):n.info("[WebRTCAdapter]: No video tracks to be changed")}catch(e){n.error("[WebRTCAdapter]: Failed to disable local video tracks. ",e)}},E=function(e){try{e.close(),n.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(e){n.error(e)}},C=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},T=[],p=null,S=null,I=function(){p&&(window.clearTimeout(p),p=null)},A=function(e,t,n){I();var i=T;T=[],i.forEach((function(i){try{i(e||[],t||[],n||null)}catch(e){}}))},R=function(t){if("function"==typeof t){var i,r,o;if(n.debug("[WebRTCAdapter]: Get audio output, microphone and camera devices"),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return i=[{kind:"audio",id:"default",label:"",facing:""}],o=[{kind:"video",id:"default",label:"",facing:""}],void window.setTimeout((function(){t(i,o,null)}),0);if(T.length>0)return n.debug("[WebRTCAdapter]: There is a pending MediaDevices.enumerateDevices() request"),void T.push(t);if(S&&S.validTimestamp>Date.now())return n.debug("[WebRTCAdapter]: Return cached devices"),i=S.audioSources,r=S.audioOutputs,o=S.videoSources,void window.setTimeout((function(){t(i,o,r)}),0);var a=A.bind(null);T.push(t),n.debug("[WebRTCAdapter]: Invoke MediaDevices.enumerateDevices()"),I(),p=window.setTimeout((function(){p=null,T.length&&(S?(n.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Return cached devices."),i=S.audioSources,r=S.audioOutputs,o=S.videoSources):n.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Device cache is empty, no devices available!"),a(i,o,r),a=null)}),3e3),navigator.mediaDevices.enumerateDevices().then((function(t){t=t||[],i=[],r=[],o=[],n.info("[WebRTCAdapter]: MediaDevices.enumerateDevices returned "+t.length+" device(s)"),t.forEach((function(t){var n={id:t.deviceId,groupId:t.groupId,kind:t.kind,label:t.label};if(n.label){var a=n.label.match(/(.*)\s\(.*:.*\)/);n.label=a&&a[1]||n.label}switch(e.isElectron&&("default"!==n.id||n.label||(n.label="res_DefaultDeviceLabel")),n.kind){case"audioinput":i.push(n);break;case"audiooutput":r.push(n);break;case"videoinput":o.push(n)}})),0!==r.length&&C()||(r=null),n.debug("[WebRTCAdapter]: Update DeviceInfos cache"),S={audioSources:i,audioOutputs:r,videoSources:o},i.length?!i.some((function(e){return e.label}))||o.length&&!o.some((function(e){return e.label}))?(n.debug("[WebRTCAdapter]: User hasn't authorized access to audio and/or video input devices yet"),S.validTimestamp=0):S.validTimestamp=Date.now()+6e4:S.validTimestamp=0,a&&a(i,o,r)})).catch((function(e){n.error("[WebRTCAdapter]: Failed to enumerate devices. ",e),a&&a()}))}},f=function(){n.debug("[WebRTCAdapter]: Cleared device info cache"),S=null},_=function(e){if(e&&e.iceServers){var t=[];e.iceServers.forEach((function(e){e.url?t.push(e):e.urls&&e.urls.forEach((function(n){t.push({url:n,credential:e.credential,username:e.username})}))})),e.iceServers=t}},v=function(e,t){var n=[{autoGainControl:!!(e=e||{}).enableAudioAGC},{echoCancellation:!0}];return t?{advanced:n}:{optional:n}},g=function(e){return{optional:[{echoCancellation:!0},{googEchoCancellation:!0},{googEchoCancellation2:!0},{autoGainControl:!!(e=e||{}).enableAudioAGC},{googAutoGainControl:!!e.enableAudioAGC},{googAutoGainControl2:!!e.enableAudioAGC},{noiseSuppression:!0},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0}]}},N=function(t){if(e.WebRTCAdapter.useNewConstraintSyntax)return function(e){var t;if(e&&e.videoResolution){switch(t={aspectRatio:{min:1.77,max:1.78},frameRate:{min:24,max:30}},e.minFrameRate&&(t.frameRate.min=Math.min(e.minFrameRate,t.frameRate.max)),e.sourceId&&(t.deviceId={exact:e.sourceId}),e.videoResolution){case s.VIDEO_1080:t.width={min:1920},t.height={min:1080};break;case s.VIDEO_720:t.width={min:1280},t.height={min:720};break;case s.VIDEO_480:t.width={min:854},t.height={min:480}}return t}return t={aspectRatio:{min:1.77,max:1.78}},e.sourceId&&(t.deviceId=e.sourceId),t}(t);var n={mandatory:{minAspectRatio:1.77,maxAspectRatio:1.78},optional:[{googNoiseReduction:!0}]};if(t)if(t.videoResolution)switch(n.mandatory.minFrameRate=24,n.mandatory.maxFrameRate=30,t.minFrameRate&&(n.mandatory.minFrameRate=Math.min(t.minFrameRate,n.mandatory.maxFrameRate)),t.sourceId&&(n.mandatory.sourceId=t.sourceId),t.videoResolution){case s.VIDEO_1080:n.mandatory.minWidth=1920,n.mandatory.maxWidth=1920,n.mandatory.minHeight=1080,n.mandatory.maxHeight=1080;break;case s.VIDEO_720:n.mandatory.minWidth=1280,n.mandatory.maxWidth=1280,n.mandatory.minHeight=720,n.mandatory.maxHeight=720;break;case s.VIDEO_480:n.mandatory.minWidth=853,n.mandatory.maxWidth=854,n.mandatory.minHeight=480,n.mandatory.maxHeight=480}else t.sourceId&&n.optional.push({sourceId:t.sourceId});return n},m=function(e,t){var n=e&&e.getAudioTracks();return!(!n||!n[0])&&(n[0].enabled=!!t,!0)},h=function(t,i,r){if(r=r||function(){},n.debug("[WebRTCAdapter]: Attach sinkId to audio element"),t)return i&&i.length?void(void 0!==t.sinkId&&e.WebRTCAdapter?(n.debug("[WebRTCAdapter]: Get media sources to find available device"),e.WebRTCAdapter.getMediaSources((function(o,a,s){var c=e.Utils.selectMediaDevice(s,i),l=c&&c.id||"";if(n.debug("[WebRTCAdapter]: Found audio output device to attach as sinkId. deviceId = ",l||"NONE"),t.sinkId===l)return n.debug("[WebRTCAdapter]: Audio output device is already attached to element"),void r();l||n.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",t.sinkId);var d=window.setTimeout((function(){d=null,n.error("[WebRTCAdapter]: Timed out attaching audio output device: ",l||"<default>"),r("timed out")}),3e3);t.setSinkId(l).then((function(){d&&(window.clearTimeout(d),n.debug("[WebRTCAdapter]: Success, audio output device attached: ",l||"<default>"),r())})).catch((function(e){if(d){window.clearTimeout(d);var t=(e=e||{}).message||"unknown error";"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device."),n.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+l+" - ",t),r(t)}})),n.debug("[WebRTCAdapter]: setSinkId has been invoked")}))):r("setSinkId not available")):(n.debug("[WebRTCAdapter]: There is no audio output device selected"),void r());r("Invalid parameters")},O=function(e){var t={offerToReceiveAudio:1,offerToReceiveVideo:1};return e&&(e.mandatory&&(e.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(t.offerToReceiveAudio=e.mandatory.OfferToReceiveAudio?1:0),e.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(t.offerToReceiveVideo=e.mandatory.OfferToReceiveVideo?1:0)),e.optional&&e.optional.some((function(e){return!!e.hasOwnProperty("VoiceActivityDetection")&&(t.voiceActivityDetection=!!e.VoiceActivityDetection,!0)}))),t},D=function(e,t,i,r,o){var a=function(a){var s=function(e,t,n,i){if(!e||!e[t])return e;var r=e[t];if(r.mandatory){var o=r.mandatory[n];if(o){var a=(e=Object.create(e))[t];a.optional=a.optional||[];var s={};s[n]=o,a.optional.push(s),delete a.mandatory}}else{var c=r[i];c&&c.exact&&((e=Object.create(e))[t][i]=c.exact)}return e}(i,"audio","sourceId","deviceId");if(s!==i){n.warn("[WebRTCAdapter]: First getUserMedia attempt with required audio sourceId/deviceId failed. Falling back to optional.");var c=function(e){r(e,a)},l=e.apply(t,[s,c,o]);l&&l.then&&l.then(c).catch(o)}else o&&o(a)},s=e.apply(t,[i,r,a]);s&&s.then&&s.then(r).catch(a)},P=function(t,i,r,o,a){var s=null,c=e.isElectron?1:3,l=0;function u(e){n.warn("[WebRTCAdapter]: Get user media failed: ",e&&e.name||e),s&&window.clearTimeout(s),s=null,a&&a(e),o=null,a=null}!function e(){n.info("[WebRTCAdapter]: Get user media attempt #:",l),s=null,l!==c?(++l,D(t,i,r,(function(e,t){!function(e,t){n.info("[WebRTCAdapter]: Get user media succeeded"),o?o(e,t):d(e),o=null,a=null}(e,t),s&&window.clearTimeout(s),s=null}),u),s=window.setTimeout(e,1e4)):u("Timeout")}()},y=function(e,t){t.some((function(t){return"ssrc"===t.type&&(t.stats.transportId&&e.some((function(e){return"ssrc"===e.type&&(e.stats.transportId=t.stats.transportId,!0)})),!0)}))},b=function(e,t){var i;if(n.info("[WebRTCAdapter]: Destroying Data Channel (error: %s)",t&&t.message||t),e){i=e.label;try{e.close()}catch(e){n.info("[WebRTCAdapter]: Could not close the existing data channel")}e.onmessage=null,e.onopen=null,e.onclose=null,e.onerror=null}e=null,r&&r.send("remove-listeners",i)},U=function(e){if(r&&this&&"open"===this.readyState){var t=JSON.parse(e.data);this.label.startsWith("SCREEN_CONTROL")?(t.dataChannelName=this.label,t.keysToOmitFromLogging=["key","keyCode"],n.debug("[WebRTCAdapter]: Sending controlling data to main process: ",t),r.send("screen-control-data",t)):n.warn("[WebRTCAdapter]: Received message for data channel "+this.label+" that cannot be handled")}else n.error("[WebRTCAdapter]: Cannot handle the received message. Data Channel has not been opened yet.")},L=function(e,t){e?(e.binaryType="arraybuffer","number"==typeof e.bufferedAmountLowThreshold&&(e.bufferedAmountLowThreshold=65536),e.onopen=function(){"open"===e.readyState?(n.info("[WebRTCAdapter]: Data channel has been successfully opened."),t&&r&&r.send("register-listeners",e.label)):n.warn("[WebRTCAdapter]: Data channel has not been opened yet.")},t&&(e.onmessage=U),e.onclose=function(){b(e)},e.onerror=function(t){b(e,t)}):b(e,new Error("Data channel event is missing `channel` property"))},M=function(e){L(e.channel,!1),this.dataChannel=e.channel,this.sendDataMessage=function(e){if(this.dataChannel&&"open"===this.dataChannel.readyState){var t;return e&&"object"==typeof e?(t=JSON.stringify(e),this.dataChannel.bufferedAmount+t.length<this.dataChannel.bufferedAmountLowThreshold?(e.keysToOmitFromLogging=["key","keyCode"],n.debug("[WebRTCAdapter]: Sending data over data channel: ",e),this.dataChannel.send(t),!0):(n.error("[WebRTCAdapter]: Cannot send data - Data channel buffer is full"),!1)):(n.error("[WebRTCAdapter]: Cannot send data - Data to send has incorrect format: ",typeof e),!1)}return n.error("[WebRTCAdapter]: Cannot send data - Data channel either not created or not ready"),!1}},w=function(e,t){if(e&&t&&t.isScreenControlled)if(n.info("[WebRTCAdapter]: Data channel will be created for supporting screen control"),t.isScreenOwner){var i=(new Date).toISOString(),r=t.screenControlChannelName+"_"+i,o=e.createDataChannel(r,a);L(o,!0),e.ondatachannel=null}else e.ondatachannel=M.bind(e)},G=function(e,t,i,r,o){if(e&&t&&i){var a=[];r&&(t.degradationPreference=r,a.push("degradationPreference="+r)),t.encodings&&t.encodings.length>0?(t.encodings[0].maxBitrate=i,a.push("maxBitrate="+i),o&&(t.encodings[0].scaleResolutionDownBy=o,a.push("scaleResolutionDownBy="+o))):n.error("[WebRTCAdapter]: Unable to set max bitrate due to read-only encoding parameters for RtpSender mid="+e.mid),a.length&&e.sender.setParameters(t).then((function(){n.debug("[WebRTCAdapter]: Applied parameters {"+a+"} to RtpSender mid="+e.mid)})).catch((function(t){n.error("[WebRTCAdapter]: Could not apply parameters {"+a+"} to RtpSender mid="+e.mid+": ",t&&t.message||t)}))}};function k(e){e.ipAddress=e.address,e.portNumber=e.port,e.protocol=e.protocol||e.transport}function H(i,r){var o="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,a=function(){var i=function(t,n,i){var r="0"===i||"1"===i;switch(this.stats=t,this.id=t.id,t.type){case"inboundrtp":case"inbound-rtp":t.isRemote||(this.type="ssrc",this.stats.mid=i,"audio"===n?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=1e3*t.jitter):this.stats.googFrameHeightReceived=!0,r&&(this.stats.googTrackId="audio"===n?"audio_main":"video_main"));break;case"outboundrtp":case"outbound-rtp":t.isRemote||(this.type="ssrc",this.stats.mid=i,"audio"===n?this.stats.audioInputLevel=!0:(this.stats.googFrameHeightSent=!0,this.stats.googFrameRateSent=Math.round(t.framerateMean),this.stats.googTransmitBitrate=Math.round(t.bitrateMean)),r&&(this.stats.googTrackId="audio"===n?"audio_main":"video_main"));break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof t.selected&&t.selected&&"succeeded"===t.state?(this.stats.googActiveConnection="true",e.WebRTCAdapter.unifiedPlanEnabled?this.stats.googChannelId=t.transportId:"audio"===n&&(this.stats.googChannelId="Channel-audio-1")):this.discard=!0;break;case"local-candidate":this.type="localcandidate",k(this.stats);break;case"remote-candidate":this.type="remotecandidate",k(this.stats);break;default:this.type=t.type}};i.prototype.names=function(){return Object.keys(this.stats)},i.prototype.stat=function(e){return this.stats[e]};var r=function(e,t,n){var r,o,a=[];return e.forEach((function(e){var s=new i(e,t,n);s.discard||("googCandidatePair"===s.type?r=s.stats.transportId:"remote-inbound-rtp"===e.type&&"video"===e.mediaType&&(o=1e3*s.stats.roundTripTime),a.push(s))})),(r||o>=0)&&a.forEach((function(e){"ssrc"===e.type&&r?e.stats.transportId=r:"googCandidatePair"===e.type&&!e.discard&&o>=0&&(e.stats.googRtt=o)})),a};return function(e){var i=[],o=e.getTransceivers(),a=[];return o.forEach((function(e){e.receiver&&e.receiver.track?a.push(new t((function(t){e.receiver.getStats().then((function(o){var a=r(o,e.receiver.track.kind,e.mid);e.sender&&e.sender.track?e.sender.getStats().then((function(n){var o=r(n,e.sender.track.kind,e.mid);y(o,a),Array.prototype.push.apply(i,a),Array.prototype.push.apply(i,o),t()})).catch((function(r){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",r),Array.prototype.push.apply(i,a),t()})):(Array.prototype.push.apply(i,a),t())})).catch((function(i){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",i),t()}))}))):e.sender&&e.sender.track&&a.push(new t((function(t){e.sender.getStats().catch((function(t){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",t)})).then((function(n){n&&Array.prototype.push.apply(i,r(n,e.sender.track.kind,e.mid)),t()}))})))})),t.all(a).then((function(){return i}))}}();return function(e,t,n){var s=new o(e);return s.origCreateOffer=s.createOffer,s.createOffer=function(e,t,n){var r;i||(r=O(n)),s.origCreateOffer(r).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},s.origCreateAnswer=s.createAnswer,s.createAnswer=function(e,t,n){i||O(n),s.origCreateAnswer(void 0).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},s.origGetStats=s.getStats,s.getStats=function(){return a(s)},s.removeStream=function(){},s.createDTMFSender=function(e){if("function"!=typeof s.getSenders)return null;var t=s.getSenders().find((function(t){return t.track===e})),n=t&&t.dtmf;return n?(n.canInsertDTMF=!0,n):null},s.addStream=function(e){var t=e.getAudioTracks()[0];t&&s.addTrack(t,e);var n=e.getVideoTracks()[0];n&&s.addTrack(n,e)},s.getRemoteStreams=function(){var e=[];return s.getReceivers().forEach((function(t){if(t.track&&t.track.mid){var n=new MediaStream([t.track]);e.push(n)}})),e},s.getLocalStreams=function(){var e=[];return s.getSenders().forEach((function(t){if(t.track){var n=new MediaStream([t.track]);e.push(n)}})),e},parseInt(r.version,10)>=46&&Object.defineProperty(s,"onaddstream",{enumerable:!0,get:function(){return s.onaddstreamCb},set:function(e){s.onaddstreamCb=e,s.ontrack=e?function(t){var n=t&&t.transceiver&&t.transceiver.mid;n&&t.track&&(t.track.mid=n),e({stream:t&&t.streams&&t.streams[0]})}:null}}),w(s,n),s}}function V(){n.info("Setting WebRTC APIs for Safari");var i=function(){var e=function(e,t,n){var i="0"===n||"1"===n;switch(this.stats=e,this.id=e.id,e.type){case"inboundrtp":case"inbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=1e3*e.jitter):this.stats.googFrameHeightReceived=!0,i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"outboundrtp":case"outbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?this.stats.audioInputLevel=!0:(this.stats.googFrameHeightSent=!0,this.stats.googFrameRateSent=e.framerateMean,this.stats.googTransmitBitrate=e.bitrateMean),i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","succeeded"===e.state?(this.stats.googActiveConnection="true",this.stats.googChannelId=e.transportId,this.stats.googRtt=1e3*e.currentRoundTripTime):this.discard=!0;break;case"local-candidate":this.type="localcandidate",e.portNumber=e.port;break;case"remote-candidate":this.type="remotecandidate",e.portNumber=e.port;break;default:this.type=e.type}};e.prototype.names=function(){return Object.keys(this.stats)},e.prototype.stat=function(e){return this.stats[e]};var i=function(t,n,i){var r,o=[];return t.forEach((function(t){var a=new e(t,n,i);a.discard||("googCandidatePair"===a.type&&(r=a.stats.transportId),o.push(a))})),r&&o.some((function(e){return"ssrc"===e.type&&(e.stats.transportId=r,!0)})),o};return function(e){var r=[],o=e.getTransceivers(),a=[];return o.forEach((function(e){e.receiver&&e.receiver.track?a.push(new t((function(t){e.receiver.getStats().then((function(o){var a=i(o,e.receiver.track.kind,e.mid);e.sender&&e.sender.track?e.sender.getStats().then((function(n){var o=i(n,e.sender.track.kind,e.mid);y(o,a),Array.prototype.push.apply(r,a),Array.prototype.push.apply(r,o),t()})).catch((function(i){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",i),Array.prototype.push.apply(r,a),t()})):(Array.prototype.push.apply(r,a),t())})).catch((function(i){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",i),t()}))}))):e.sender&&e.sender.track&&a.push(new t((function(t){e.sender.getStats().catch((function(t){n.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",t)})).then((function(n){n&&Array.prototype.push.apply(r,i(n,e.sender.track.kind,e.mid)),t()}))})))})),t.all(a).then((function(){return r}))}}();e.WebRTCAdapter={enabled:!0,browser:"safari",unifiedPlanEnabled:!0,useNewConstraintSyntax:!0,useReducedAudioConstraints:!0,MediaStream:MediaStream,PeerConnection:function(e,t,n){var r=new RTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(e,t,n){var i;n&&(i=O(n)),r.origCreateOffer(i).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(e,t,n){var i=O(n);r.origCreateAnswer(i).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},r.origSetLocalDescription=r.setLocalDescription,r.setLocalDescription=function(e,t,n){r.origSetLocalDescription(e).then((function(){t&&t()})).catch((function(e){n&&n(e)}))},r.origSetRemoteDescription=r.setRemoteDescription,r.setRemoteDescription=function(e,t,n){r.origSetRemoteDescription(e).then((function(){t&&t()})).catch((function(e){n&&n(e)}))},r.origGetStats=r.getStats,r.getStats=function(){return i(r)},w(r,n),r},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){P(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){e&&R(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=v(e,!0);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t},getVideoOptions:N,getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1080},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},setEncodingParameters:function(e,t,n){var i=e.sender.getParameters();G(e,i,t,n)},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){return{}}}}return function i(){var r=e.Utils.getBrowserInfo();try{r.chrome?function(i){n.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},e.WebRTCAdapter={enabled:!0,browser:"chrome",unifiedPlanEnabled:e.isUnitTestRun||parseInt(i.version,10)>=72,useNewConstraintSyntax:!1,useReducedAudioConstraints:!0,MediaStream:webkitMediaStream,PeerConnection:function(e,n,i){var r=new webkitRTCPeerConnection(e,n);return r.origCreateOffer=r.createOffer,r.createOffer=function(e,t,n){var i;n&&(i=O(n)),r.origCreateOffer(i).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(e,t,n){var i=O(n);r.origCreateAnswer(i).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},r.origGetStats=r.getStats,r.getStats=function(){return new t((function(e,t){r.origGetStats(e,t)}))},w(r,i),r},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){P(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){e&&R(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=Circuit.WebRTCAdapter.useReducedAudioConstraints?v(e,!1):g(e);return e&&e.sourceId&&"default"!==e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:N,getDesktopOptions:function(t,n){var i=(n=n||{}).frameRate||{};return i.min=i.min||5,i.max=i.max||10,e.isElectron?{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxWidth:1920,maxHeight:1080},optional:[{googNoiseReduction:!0},{maxFrameRate:i.max},{minFrameRate:i.min}]}:{video:{width:{max:1920},height:{max:1080},framerate:{min:i.min,max:i.max}}}},setEncodingParameters:function(e,t,n,i){var r=e.sender.getParameters();G(e,r,t,n,i)},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){var e={};if(o){var t=o.networkInterfaces();Object.keys(t).forEach((function(n){(t[n]||[]).forEach((function(t){e[t.address]=t.netmask}))}))}return e}}}(r):r.firefox?function(t){n.info("Setting WebRTC APIs for Firefox");var i=parseInt(t.version,10)>=63,r="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,o="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;e.WebRTCAdapter={enabled:!0,browser:"firefox",unifiedPlanEnabled:i,useNewConstraintSyntax:!0,MediaStream:MediaStream,PeerConnection:H(i,t),SessionDescription:r,IceCandidate:o,getUserMedia:function(e,t,n){P(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:function(e){return URL.createObjectURL(e)},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.mid||t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.mid||t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:function(e){window.setTimeout((function(){E(e)}),500)},getMediaSources:function(e){e&&R(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t.advanced=t.optional,delete t.optional,t},getVideoOptions:N,getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return n.min=n.min||5,n.max=n.max||10,navigator.mediaDevices.getDisplayMedia?{video:{width:{max:1920},height:{max:1080},framerate:{min:n.min,max:n.max}}}:{mozMediaSource:e||"screen",mediaSource:e||"screen",width:{max:1920},height:{max:1080},advanced:[{frameRate:n}]}},setEncodingParameters:function(e,t,n,i){G(e,{encodings:[{}]},t,n,i)},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:h,iceTimeoutSafetyFactor:.5,toggleAudio:m,getNetmaskMap:function(){return{}}}}(r):r.safari?V():r.ios?function(){n.info("Setting WebRTC APIs for iOS client");var i=function(e){this.id=e.id,this.type=e.type,this.timestamp=new Date(e.timestamp);var t={};Object.getOwnPropertyNames(e.values).forEach((function(n){t[n]=e.values[n]})),this.names=function(){return Object.getOwnPropertyNames(t)},this.stat=function(e){return t[e]},e=null},r=function(e){var t=e.map((function(e){return new i(e)}));this.result=function(){return t},e=null};e.WebRTCAdapter={enabled:!0,browser:"ios",unifiedPlanEnabled:!0,MediaStream:function(e){return navigator.createMediaStreamWithTracks(e)},PeerConnection:function(e,n){_(e);var i=RTCPeerConnection.createRTCPeerConnection(e,n);return i.origGetStats=i.getStats,i.getStats=function(){return new t((function(e){i.origGetStats((function(t){e(new r(t))}))}))},i.addIceCandidate=i.addIceCandidateJS,Object.defineProperties(i,{localDescription:{get:function(){return i.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return i.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return i.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return i.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return i.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),i},SessionDescription:function(e){return RTCSessionDescription.createRTCSessionDescription(e)},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.streamId+" "+t.trackId:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.streamId+" "+t.trackId:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.trackId:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.trackId:""},getStreamId:function(e){return e&&e.streamId},getTrackId:function(e){return e&&e.trackId},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){e&&e([],[{id:"1",label:"front"},{id:"2",label:"back"}])},clearMediaSourcesCache:function(){},getAudioOptions:g,getVideoOptions:N,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},setEncodingParameters:function(e,t){e&&e.sender&&t&&(e.sender.maxBitrate=t,n.debug("[WebRTCAdapter]: Applied maxBitrate {"+t+"} to RtpSender mid="+e.mid))},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){return{}}}}():r.android?function(){var i;n.info("Setting WebRTC APIs for Android client");var r=function(e){this.id=e.id,this.type=e.type,this.timestamp=new Date(e.timestamp);var t={};Object.getOwnPropertyNames(e.values).forEach((function(n){var i=e.values[n];i.name&&(t[i.name]=i.value)})),this.names=function(){return Object.getOwnPropertyNames(t)},this.stat=function(e){return t[e]},e=null},o=function(e){var t=e.map((function(e){return new r(e)}));this.result=function(){return t},e=null};e.WebRTCAdapter={enabled:!0,browser:"android",unifiedPlanEnabled:!0,MediaStream:function(e){if(!i){i=RTCPeerConnectionUnified({sdpSemantics:"unified-plan"})}var t=i.createEmptyStream();return Array.isArray(e)?t.addTracks(e):t.addTrack(e),t},PeerConnection:function(e,n){_(e);var i=RTCPeerConnectionUnified(e,n);return i.getStats=function(){return new t((function(e){i.origGetStats((function(t){e(new o(t.data))}))}))},i},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:g,getVideoOptions:N,getDesktopOptions:function(){return{mandatory:{androidMediaSource:"screen"}}},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){return{}}}}():r.cordovaios?(n.info("Setting WebRTC APIs for Cordova iOS"),cordova.plugins.iosrtc.RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},cordova.plugins.iosrtc.RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},e.WebRTCAdapter={enabled:!0,browser:"cordovaios",unifiedPlanEnabled:!1,useNewConstraintSyntax:!0,MediaStream:cordova.plugins.iosrtc.MediaStream,PeerConnection:function(e,t){var n=new cordova.plugins.iosrtc.RTCPeerConnection(e,t);return n.origCreateOffer=n.createOffer,n.createOffer=function(e,t,i){var r=O(i);n.origCreateOffer(r).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},n.origCreateAnswer=n.createAnswer,n.createAnswer=function(e,t,i){var r=O(i);n.origCreateAnswer(r).then((function(t){e&&e(t)})).catch((function(e){t&&t(e)}))},n.origSetLocalDescription=n.setLocalDescription,n.setLocalDescription=function(e,t,i){n.origSetLocalDescription(e).then((function(){t&&t()})).catch((function(e){i&&i(e)}))},n.origSetRemoteDescription=n.setRemoteDescription,n.setRemoteDescription=function(e,t,i){n.origSetRemoteDescription(e).then((function(){t&&t()})).catch((function(e){i&&i(e)}))},n},SessionDescription:cordova.plugins.iosrtc.RTCSessionDescription,IceCandidate:cordova.plugins.iosrtc.RTCIceCandidate,getUserMedia:function(e,t,n){cordova.plugins.iosrtc.getUserMedia(e).then(t).catch(n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){e&&R(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t},getVideoOptions:function(e){var t=N(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1080},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},setEncodingParameters:function(){},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){return{}}}):e.TemasysAdapter?function(){n.info("Setting WebRTC APIs for IE with Temasys plugin");var i=e.TemasysAdapter;e.WebRTCAdapter={enabled:!0,browser:"msie",unifiedPlanEnabled:!1,PeerConnection:function(e,n,r){_(e);var o=i.PeerConnection(e,n);return w(o,r),o.origGetStats=o.getStats,o.getStats=function(){return new t((function(e,t){o.origGetStats(e,t)}))},o},SessionDescription:i.SessionDescription,IceCandidate:i.IceCandidate,getUserMedia:function(e,t,n){D(i.getUserMedia,i,e,t,n)},createObjectURL:function(e,t,n){return i.createObjectURL(e,n)},attachMediaStream:i.attachMediaStream,getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.label+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.label+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:d,stopLocalVideoTrack:u,closePc:E,getMediaSources:function(e){"function"==typeof e&&i.getMediaSources((function(t){var n=[],i=[];t&&t.forEach((function(e){"audio"===e.kind?n.push(e):"video"===e.kind&&i.push(e)})),e(n,i,null)}))},clearMediaSourcesCache:function(){},getAudioOptions:function(e){return!e||!e.sourceId||{mandatory:{sourceId:e.sourceId}}},getVideoOptions:function(e){return!e||!e.sourceId||{optional:[{sourceId:e.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:i.screensharingKey()}]}},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:h,toggleAudio:m,getNetmaskMap:function(){return{}}}}():n.info("WebRTC is not supported")}catch(e){n.error("Failed to initialize WebRTCAdapter. ",e)}e.WebRTCAdapter||(e.WebRTCAdapter={enabled:!1,browser:"",unifiedPlanEnabled:!1,MediaStream:function(){},PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(e,t,n){n&&n("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},getStreamId:function(){return""},getTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(e,t,n){n&&n()},toggleAudio:function(){return!1},getNetmaskMap:function(){return{}},init:i})}(),e.WebRTCAdapter.overridePromise=function(e){void 0===t&&(t=e)},e.Enums=e.Enums||{},e.Enums.VideoResolutionLevel=s,e.Enums.RtpQualityLevel=c,e.RtpStatsConfig=l,e}((Circuit=function(e){"use strict";var t=e.Constants,n=e.Utils,i=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected",Ready:"Ready"});return e.ConnectionController=function(r){var o,a,s,c,l,d,u=e.logger;n.isMobile()?(a=0,o=0,s=0,l=0,d=0,c=0):(a=0,o=7e3,s=8e3,l=64e3,d=1350,c=1);var E=this,C=null,T=null,p=null,S=i.Disconnected,I=0,A=0,R=null,f=null,_=null,v=r||{},g=null,N=null,m=null,h=null,O=[],D=[],P=null,y=null;function b(e,t){if("function"==typeof e)try{e(t)}catch(e){u.error(e)}}function U(e,t){g=e,N=t}function L(e){return e?e.split("?")[0]:"N/A"}function M(){u.debug("[CONN]: online event received"),_&&(u.debug("[CONN]: Clear offline timeout"),window.clearTimeout(_),_=null),S===i.Reconnecting&&(I=s,E.reconnect(null,null,1e3))}function w(){u.debug("[CONN]: offline event received"),S===i.Connected&&(window.addEventListener("online",M),_||(_=window.setTimeout((function(){_=null,window.navigator.onLine||(u.debug("[CONN]: The client is offline. Change state to Reconnecting."),E.reconnect())}),4e3)))}function G(){C&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.onerror=null,C=null)}function k(e){if(e!==S){u.debug("[CONN]: Changed connection state from "+S+" to "+e),u.debug("[CONN]: Raising connectionStateChange event");var t=S;S=e,window.setTimeout((function(){!function(e,t){b(E.onStateChange,{newState:e,oldState:t})}(e,t)}),0)}}function H(e){try{T&&T(e)}catch(e){u.error("[CONN]: Exception on errorCallback. ",e)}finally{T=null,p=null}}function V(){P&&(window.clearTimeout(P),P=null),D=[],O=[]}function B(e){if(R&&(window.clearTimeout(R),R=null),f&&(window.clearTimeout(f),f=null),V(),C){u.debug("[CONN]: Disconnecting from server");var t=C;G(),t.close()}e||(window.removeEventListener&&(window.removeEventListener("online",M),window.removeEventListener("offline",w)),k(i.Disconnected))}function F(){if(n.isMobile())u.warn("[CONN]: Mobile Client - Do not attempt to reconnect from JS");else{if(d>0&&A>=d)return u.warn("[CONN]: Reached max number of attempts reconnecting to WebSocket"),void B();!1===window.navigator.onLine?(u.warn("[CONN]: Client is offline. Set retry timer to max value."),I=l):I||(y&&y()?(u.info("[CONN]: Client has an active call. Use priority reconnection timeout"),I=n.randomNumber(a,o)):I=o+n.randomNumber(0,s)),u.info("[CONN]: Retry to open socket in "+I/1e3+" seconds"),R=window.setTimeout((function(){R=null,m=N||g,Q()}),I),I<l&&(A++,I=A>c?2*I:s,I=Math.min(I,l))}}function x(){return m===N&&(B(!0),window.setTimeout((function(){u.info("[CONN]: Fallback to default target URL"),m=g,Q()}),0),!0)}function W(){switch(G(),V(),S){case i.Connected:k(i.Reconnecting),F();break;case i.Reconnecting:x()||(b(E.onReconnectFailed),F());break;case i.Connecting:x()||(B(),u.error("[CONN]: Failed to open WebSocket connection"),H("Failed to open WebSocket connection"))}}function K(e){e===C&&(u.info("[CONN]: WebSocket is opened"),I=0,A=0,S!==i.Disconnected&&(k(i.Connected),window.addEventListener&&(window.addEventListener("offline",w),window.removeEventListener("online",M)),function(){try{u.debug("[CONN]: Registered Successfully"),p&&p()}catch(e){u.error("[CONN]: Exception on successCallback. ",e)}finally{T=null,p=null}}()))}function Y(e,t){e===C&&(t=t||{},u.info("[CONN]: WebSocket is closed. Code: "+t.code+". Reason:",t.reason),W())}function q(e,t){if(e===C)try{if(!t.data||"PING"===t.data)return;var n=t.data;if(!v.doNotParseMessages)try{n=JSON.parse(n)}catch(e){return void u.error("[CONN]: Message discarded (Cannot Parse): ",t.data)}!function(e){b(E.onMessage,e)}(n)}catch(e){u.error(e)}}function j(e,t){e===C&&(u.error("[CONN]: WebSocket connection error. ",t),W())}function Q(){if(S===i.Connecting||S===i.Reconnecting){G(),h=L(m),u.info("[CONN]: Opening WebSocket to ",h);try{switch(window.navigator.platform){case"iOS":C=WebSocket.createWebSocket(m);break;case"node":C=new WebSocket(m,v.cookie);break;default:C=new WebSocket(m)}}catch(e){return u.error("[CONN]: Failed to connect WebSocket. ",e),void H(e)}C.onopen=K.bind(null,C),C.onclose=Y.bind(null,C),C.onmessage=q.bind(null,C),C.onerror=j.bind(null,C)}}function z(){var e=Date.now(),t=O.findIndex((function(t){return e-t<2e3}));-1===t?O=[]:O.splice(0,t)}function X(){if(!P){var e=200;O.length>=20&&(e+=2e3-(Date.now()-O[0])),u.info("[CONN]: Start throttle timeout with delay = ",e),P=window.setTimeout((function(){P=null,function(){u.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",D.length),z();var e=0;for(;D.length>0&&O.length<20&&e<5;)J(D.shift()),e++;D.length>0?(u.warn("[CONN]: Number of remaining queued messages = ",D.length),X()):u.info("[CONN]: Dequeued all throttled messages")}()}),e)}}function J(e){try{var t=e.request&&e.request.requestId||"N/A";C.send(JSON.stringify(e)),O.push(Date.now()),u.debug("[CONN]: Sent message with requestId:",t)}catch(e){u.error("[CONN]: Failed to send message. ",e)}}this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return S},this.isConnected=function(){return S===i.Connected},this.connect=function(e,t,n,r){u.debug("[CONN]: Connect WebSocket: ",{url:L(e),proxyUrl:L(t)}),S!==i.Disconnected&&B(!0),U(e,t),p=n||function(){},T=r||function(){},k(i.Connecting),window.setTimeout((function(){m=N||g,Q()}),0)},this.disconnect=function(){u.debug("[CONN]: Disconnect WebSocket from ",h),B()},this.reconnect=function(e,t,n){u.debug("[CONN]: Reconnect WebSocket: ",{url:L(e),proxyUrl:L(t)}),B(!0),e&&U(e,t),k(i.Reconnecting),f=window.setTimeout((function(){f=null,m=N||g,Q()}),n||50)},this.sendMessage=function(e,r){return S!==i.Connected?(u.warn("[CONN]: WebSocket is not connected. Cannot send message. ",e),!1):e?(r||u.msgSend("[CONN]: ",e),"string"==typeof e?"PING"===e&&n.isMobile()?C.ping():C.send(e):(delete e.keysToOmitFromLogging,!P&&(O.length>=20&&z(),O.length<20)?J(e):!function(e){return!(!e.request||!e.request.user||e.request.user.type!==t.UserActionType.LOGOUT)}(e)?(!function(e){u.warn("[CONN]: Throttling limit exceeded. Queue the message."),D.length>=200?u.error("[CONN]: Throttling queue is full. Drop the message."):(D.push(e),u.info("[CONN]: Queued message #",D.length))}(e),X()):(J(e),V())),!0):(u.error("[CONN]: Data is missing. Cannot send message."),!1)},this.injectHasActiveCall=function(e){y="function"==typeof e?e:null}},e.Enums=e.Enums||{},e.Enums.ConnectionState=i,e}((Circuit=function(e){"use strict";var t=e.Utils,n=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}}),i=Object.freeze({VP8:"VP8",VP9:"VP9",H264:"H264"});function r(e){if(e){var t=(e=e.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2")).split(" ");if(t.length<7)throw new Error("Invalid candidate: "+e);this.foundation=parseInt(t[0],10),this.componentId=parseInt(t[1],10),this.transport=t[2].toLowerCase(),this.priority=parseInt(t[3],10),this.address=t[4],this.port=parseInt(t[5],10),this.typ=t[7],this.optional=[];for(var n=8;n<t.length;n+=2)this.optional.push(t[n]),this[t[n]]=t[n+1]}else this.foundation=1,this.componentId=1,this.transport="udp",this.priority=1,this.address="0.0.0.0",this.port=1,this.typ="host",this.generation=0,this.optional=[]}r.prototype.equals=function(e){return e=e&&"string"!=typeof e?e:new r(e),this.foundation===e.foundation&&this.componentId===e.componentId&&this.transport===e.transport&&this.priority===e.priority&&this.address===e.address&&this.port===e.port&&this.typ===e.typ},r.prototype.isRtp=function(){return 1===this.componentId},r.prototype.isRtcp=function(){return 2===this.componentId},r.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<=n.TCP.end},r.prototype.getRelayClientTransportType=function(){var e="";if("relay"===this.typ){var t=this.priority;[n.TLS,n.TCP,n.UDP].some((function(n){return t>=n.start&&t<=n.end&&(e=n.name,!0)}))}return e},r.prototype.getValue=function(){for(var e=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,t=0;t<this.optional.length;t++){var n=this.optional[t];e+=" "+n+" "+this[n]}return e},r.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},r.prototype.toString=function(){return"candidate:"+this.getValue()};var o=function(){var e=Circuit.logger;function n(e){var t=e.split(/\s+/);return{nettype:t[0],addrtype:t[1],address:t[2]}}function i(e){var t=/^([^:]+)(?::(.*))?/.exec(e);return{field:t[1],value:t[2]}}function o(e){var t=+e;return isNaN(t)?e:t}var a=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: +(\S+(?: +\S+)*))?/;function s(e){var t=a.exec(e);return{media:t[1],port:+t[2],portnum:+(t[3]||1),proto:t[4],fmt:t[5]?t[5].split(/\s+/).map(o):[]}}function c(e,t,n){switch(t){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":e[t]=n;break;default:e[t]?e[t].push(n):e[t]=[n]}}var l={o:function(e){return[e.username||"-",e.id,e.version,e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},c:function(e){return[e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},m:function(e){var t=[e.media||"audio",e.port||"0",e.proto||"RTP/AVP"];return e.fmt&&e.fmt.length&&t.push(e.fmt.join(" ")),t.join(" ")},a:function(e){return e.value?[e.field,e.value].join(":"):e.field}};function d(e,t,n){if(void 0!==e[t]){var i=function(e){return t+"="+(l[t]&&l[t](e)||e)+"\r\n"};return Array.isArray(e[t])?e[t].map(i).join(""):i(e[t])}return n?t+"="+n+"\r\n":""}function u(e){return e.filter((function(e){switch(e.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0}))}function E(e){var t,r,o=e.split(/\r\n/),a={};for(t=0;t<o.length&&((r=/^(\w)=(.*)/.exec(o[t]))&&"m"!==r[1]);++t)"a"===r[1]&&r[2]?c(a,r[1],i(r[2])):c(a,r[1],r[2]);a.m=[];for(var l,d,u=null;t<o.length&&(r=/(\w)=(.*)/.exec(o[t]));++t)"m"===r[1]?(u=s(r[2]),a.m.push(u)):"a"===r[1]&&r[2]?c(u,r[1],i(r[2])):c(u,r[1],r[2]);return a.s&&""!==a.s.trim()||(a.s="-"),a.o&&(a.o=(l=a.o,{username:(d=l.split(/\s+/))[0],id:d[1],version:d[2],nettype:d[3],addrtype:d[4],address:d[5]})),a.c&&(a.c=n(a.c)),a.m.forEach((function(e){e.c&&(e.c=n(e.c))})),a}function C(e,t){var n="string"==typeof e?E(e):e,i="sendrecv";return void 0!==(t=t||{}).mLineIndex?(n.m[t.mLineIndex].a.forEach((function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}})),i):(t.mediaType&&"both"!==t.mediaType||(t.mediaType="audio"),n.a&&n.a.forEach((function(e){switch(e.field){case"sendonly":case"recvonly":case"inactive":i=e.field}})),n.m&&n.m.forEach((function(e){e.media===t.mediaType&&e.a.forEach((function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}}))})),i)}function T(e){return!!Array.isArray(e)&&e.some((function(e){return e.includes("AS:")}))}function p(e){return!!Array.isArray(e)&&e.some((function(e){return e.includes("TIAS:")}))}return{parse:E,stringify:function(e){var t="";return t+=d(e,"v",0),t+=d(e,"o"),t+=d(e,"s","-"),t+=d(e,"i"),t+=d(e,"u"),t+=d(e,"e"),t+=d(e,"p"),t+=d(e,"c"),t+=d(e,"b"),t+=d(e,"t","0 0"),t+=d(e,"r"),t+=d(e,"z"),t+=d(e,"k"),t+=d(e,"a"),e.m.forEach((function(e){t+=d({m:e},"m"),t+=d(e,"i"),t+=d(e,"c"),t+=d(e,"b"),t+=d(e,"k"),t+=d(e,"a")})),t},getConnectionMode:C,getVideoConnectionModes:function(e){var t="string"==typeof e?E(e):e,n=[];return t.m&&t.m.forEach((function(e){"video"===e.media&&e.a.some((function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return n.push(e.field),!0}return!1}))})),n},setConnectionMode:function(e,t,n){var i="string"==typeof e?E(e):e,r=t&&"both"!==t?[t]:["audio","video"];return"both"===t&&i.a&&(i.a=u(i.a),i.a.push({field:n})),i.m&&i.m.forEach((function(e){r.includes(e.media)&&(e.a=u(e.a),e.a.push({field:n}))})),i},isHold:function(e){var t=C(e);return"inactive"===t||"sendonly"===t},disableMultiplex:function(e){var t="string"==typeof e?E(e):e;return t.a&&(t.a=t.a.filter((function(e){return"group"!==e.field}))),t},isMultiplexEnabled:function(e){var t="string"==typeof e?E(e):e;return!!t.a&&t.a.some((function(e){return"group"===e.field&&e.value&&e.value.startsWith("BUNDLE")}))},hasVideo:function(e){var t="string"==typeof e?E(e):e;return!!t.m&&t.m.some((function(e,n){return"video"===e.media&&0!==e.port&&0!==e.fmt.length&&("inactive"!==C(t,{mLineIndex:n})&&e.a.some((function(e){return"rtpmap"===e.field&&/VP[89]/.test(e.value)})))}))},addEmptyVideoLine:function(e){var t="string"==typeof e?E(e):e;return t.m.push({media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]}),t},removeVideo:function(e){var t="string"==typeof e?E(e):e;return t.m&&t.m.forEach((function(e){"video"===e.media&&(e.port=0,e.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},e.a=e.a.filter((function(e){return"mid"===e.field})),e.a.push({field:"inactive"}))})),t},setOpusParameters:function(e,n){var i="string"==typeof e?E(e):e;return i.m&&n?(n=t.shallowCopy(n),i.m.forEach((function(e){var t;"audio"===e.media&&e.a&&(e.a.some((function(e){return!("rtpmap"!==e.field||!e.value.includes("opus"))&&(t=e.value.split(" ")[0],!0)})),t&&e.a.some((function(e){if("fmtp"===e.field&&e.value.includes(t)){e.value.substring(t.length+1).split(";").forEach((function(e){var t=e.split("="),i=t[0].trim(),r=t[1].trim();n.hasOwnProperty(i)||(n[i]=r)}));var i=Object.keys(n).map((function(e){return e+"="+n[e]}));return e.value=t+" "+i.join(";"),!0}return!1})))})),i):i},setVideoBandwidth:function(e,t,n,i){var r="string"==typeof e?E(e):e;return r.m&&r.m.forEach((function(e,r){if("video"===e.media){if(i>=0&&i!==r)return;n?t&&t.valueOf()>0?e.b=["AS:"+t,"TIAS:"+1e3*t]:(T(e.b)||p(e.b))&&delete e.b:(T(e.b)||c(e,"b","AS:"+t),p(e.b)||c(e,"b","TIAS:"+1e3*t))}})),r},setXGoogle:function(e,t,n){var i="string"==typeof e?E(e):e;return i.m&&t&&i.m.forEach((function(e,i){if("video"===e.media&&e.a&&!(n>=0&&n!==i)){var r=[];e.a=e.a.filter((function(e,t){return"rtpmap"===e.field&&/VP[89]/.test(e.value)&&r.push({idx:t+r.length,pt:e.value.split(" ")[0]}),("fmtp"!==e.field||e.value&&!e.value.includes("x-google"))&&"x-google-buffer-latency"!==e.field})),r.forEach((function(n){var i=[];t.minBitRate&&t.minBitRate.valueOf()>0&&i.push("x-google-min-bitrate="+t.minBitRate),t.maxBitRate&&t.maxBitRate.valueOf()>0&&i.push("x-google-max-bitrate="+t.maxBitRate),t.startBitRate&&t.startBitRate.valueOf()>0&&i.push("x-google-start-bitrate="+t.startBitRate),t.maxQuantization&&t.maxQuantization.valueOf()>0&&i.push("x-google-max-quantization="+t.maxQuantization),i.length>0&&(i=n.pt+" "+i.join("; "),e.a.splice(n.idx+1,0,{field:"fmtp",value:i}))}))}})),i},setPreferredVideoCodec:function(t,n){var i="string"==typeof t?E(t):t;return i.m&&n&&i.m.forEach((function(t,i){if("video"===t.media){var r=t.a.find((function(e){return"rtpmap"===e.field&&e.value.includes(n)}));if(r){var o=parseInt(r.value.split(" ")[0],10),a=t.fmt.indexOf(o);a>0&&(t.fmt.splice(a,1),t.fmt.unshift(o),e.debug("[SdpParser]: Prefer "+n+" format for video m-line #:",i))}}})),i},removeVideoBandwidth:function(e){var t="string"==typeof e?E(e):e;return t.m&&t.m.forEach((function(e){"video"===e.media&&(e.b=e.b&&e.b.filter((function(e){return!e.startsWith("AS:")&&!e.startsWith("TIAS:")})))})),t},removeAudioLevelAttr:function(e){var t="string"==typeof e?E(e):e;return t.m&&t.m.forEach((function(e){"audio"===e.media&&(e.a=e.a&&e.a.filter((function(e){return"extmap"!==e.field||!e.value||!e.value.includes("ssrc-audio-level")})))})),t},isTrickleIceOption:function(e){var t=function(e){return"ice-options"===e.field&&e.value&&e.value.includes("trickle")||"inactive"===e.field},n="string"==typeof e?E(e):e;return n.a=n.a||[],n.a.some(t)||n.m&&n.m.length>0&&n.m.every((function(e){return e.a&&e.a.some(t)}))},fixTrickleIceOption:function(t,n){var i=function(t,n,i){return"ice-options"===t.field&&(t.value=t.value||"",t.value=t.value.replace(/trickle\s*/gi,"").trim(),t.value||(e.debug("[SdpParser]: There are no other ice-options - remove the attribute."),i.splice(n,1)),!0)},r="string"==typeof t?E(t):t;r.a=r.a||[];var o=this.isTrickleIceOption(r);n&&!o?(e.debug("[SdpParser]: Adding Trickle ICE indication"),r.a.some((function(e){return"ice-options"===e.field&&(e.value=(e.value||"")+" trickle",!0)}))||r.a.push({field:"ice-options",value:"trickle"})):!n&&o&&(e.debug("[SdpParser]: Removing Trickle ICE indication"),r.a.some(i),r.m.forEach((function(e){e.a&&e.a.some(i)})));return r},addEndOfCandidatesLine:function(e){var t="string"==typeof e?E(e):e;return t.m&&t.m.forEach((function(e){e.a=e.a||[],e.a.some((function(e){return"end-of-candidates"===e.field}))||e.a.push({field:"end-of-candidates"})})),t},removeEndOfCandidatesLine:function(e){var t="string"==typeof e?E(e):e;return t.m&&t.m.forEach((function(e){e.a&&e.a.some((function(t,n){return"end-of-candidates"===t.field&&(e.a.splice(n,1),!0)}))})),t},validateIceCandidates:function(t,n,i){return!("string"==typeof t?E(t):t).m.some((function(t,o){return!function t(n,i,o,a){if(0===n.port)return!0;var s=0,c=!1,l=null,d=null,u=n.a.filter((function(t){if("candidate"!==t.field)return!0;var i=new r(t.value);if("udp"!==i.transport)return!1;if(o&&"video"===n.media){if("relay"!==i.typ)return c=!0,!1;if(!i.isTcpTlsRelay())return e.debug("[SdpParser]: Removed UDP relay candidate: ",t.value),c=!0,!1;!l&&i.isRtp()&&(l=i),!d&&i.isRtcp()&&(d=i)}return s++,!0}));return l||!c||a?!(0===s&&!a)&&(n.a=u,d&&n.a.some((function(e){return"rtcp"===e.field&&(e.value=d.port+" IN IP4 "+d.address,!0)})),l&&(n.port=l.port,n.c&&(n.c.address=l.address)),!0):(e.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),t(n,i,!1))}(t,o,n,i)}))},isNoOfferSdp:function(e){return!!e&&""===e.sdp&&"nooffer"===e.type},iceTotalCandidatesCount:function(e){var t=0;return("string"==typeof e?E(e):e).m.forEach((function(e){e.a.forEach((function(e){"candidate"===e.field&&t++}))})),t},getIceCandidates:function(e){var t=[];return("string"==typeof e?E(e):e).m.forEach((function(e){e.a.forEach((function(e){"candidate"===e.field&&t.push(new r(e.value))}))})),t},removeAudioMediaProtocols:function(e,t){var n="string"==typeof e?E(e):e;return t&&t.length?(n.m.some((function(e){if("audio"===e.media&&e.proto){var n=e.proto.split("/");return n=n.filter((function(e){return!t.includes(e)})),e.proto=n.join("/"),!0}return!1})),n):n},removeVideoCodecs:function(t,n){var i=["rtpmap","fmtp","rtcp-fb"],r="string"==typeof t?E(t):t;return r.m&&n&&n.length&&r.m.forEach((function(t,r){if("video"===t.media){var o=function(e){var n=t.a.find((function(t){return"fmtp"===t.field&&t.value.includes("apt="+e)}));return n&&parseInt(n.value.split(" ")[0],10)},a=function(n,o){t.a=t.a.filter((function(e){return function(e,t){return!(i.includes(e.field)&&e.value&&e.value.startsWith(t))}(e,n)}));var a=t.fmt.indexOf(n);-1!==a&&(t.fmt.splice(a,1),e.debug("[SdpParser]: Removed "+o+" with pt "+n+" from format for video m-line #:",r))};n.forEach((function(e){var n;do{if(n=t.a.find((function(t){return"rtpmap"===t.field&&t.value.includes(e)}))){var i=parseInt(n.value.split(" ")[0],10);a(i,e);var r=o(i);r&&a(r,"rtx")}}while(n)}))}})),r},verifyFingerprintInMLines:function(t){var n="string"==typeof t?E(t):t;return n.m&&n.m.forEach((function(t,i){t.a.some((function(e){return"fingerprint"===e.field}))||n.a.some((function(e){return"fingerprint"===e.field&&(t.a.push(e),!0)}))||e.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",i)})),n},findMediaLineIndex:function(e,t){return t?function(e,t){return e.m.findIndex((function(e){return e.a.some((function(e){return"mid"===e.field&&e.value===t}))}))}("string"==typeof e?E(e):e,t):-1},setMediaIdAttribute:function(e,t,n,i){var r=("string"==typeof e?E(e):e).m[t];r&&(r.a.some((function(e){return"mid"===e.field&&(i&&(e.value=n),!0)}))||r.a.push({field:"mid",value:n}))},getMediaIds:function(e){var t="string"==typeof e?E(e):e,n={};return t.m.forEach((function(e){var t,i;e.a&&e.a.some((function(e){return"mid"===e.field?t=e.value:"msid"===e.field&&(i=e.value),t&&i}))&&(n[i]=t)})),n},getOrigin:function(e){if("string"==typeof e){var t=/(o=[^\r]+)\r\n/i.exec(e);return t&&t[1]||""}return d(e,"o")},getSsrcList:function(e){var t="string"==typeof e?E(e):e,n=[];return t.a.forEach((function(e){"ssrc"===e.field&&n.push(e.value.split(" ")[0])})),n}}}();return e.IceCandidate=r,e.sdpParser=o,e.Enums=e.Enums||{},e.Enums.VideoCodecs=i,e}((Circuit=function(e){"use strict";var t,n,i=e.logger,r=e.Utils,o=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",SANITY_CHECK:"SANITY_CHECK",WEB_HOOK:"WEB_HOOK",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",PROVISIONING:"PROVISIONING",RTC_CONNECTION:"RTC_CONNECTION",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",MS_CONNECTOR:"MS_CONNECTOR",SPACE:"SPACE",CPAAS:"CPAAS",TEAM:"TEAM",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",CLOUD_TELEPHONY_EXCEPTION:"CLOUD_TELEPHONY_EXCEPTION",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",REQUEST_CANCELED:"REQUEST_CANCELED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE",CLOUD_TELEPHONY_ERROR:"CLOUD_TELEPHONY_ERROR",CIRCUIT_EXCEPTION:"CIRCUIT_EXCEPTION"},CircuitExceptionErrorCode:{INWEB_00000C:"INWEB-00000C",INWEB_00001C:"INWEB-00001C",INWEB_00002C:"INWEB-00002C",INWEB_00003C:"INWEB-00003C",INWEB_00004C:"INWEB-00004C",INWEB_00005C:"INWEB-00005C",SPACE_00004C:"SPACE-00004C",SPACE_00024C:"SPACE-00024C",SPACE_00032C:"SPACE-00032C",SPACE_00035C:"SPACE-00035C",SPACE_00045C:"SPACE-00045C"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",ALREADY_CONNECTED:"ALREADY_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS",INVALID_DRIVEID:"INVALID_DRIVEID",TOO_MANY_REQUESTS:"TOO_MANY_REQUESTS"},CloudTelephonyErrorType:{CMP_NEXT:"CMP_NEXT",VALIDATION:"VALIDATION",CMP_NEXT_VALIDATION:"CMP_NEXT_VALIDATION"},CloudTelephonyValidationError:{UNKNOWN:"UNKNOWN",DN_NOT_FOUND_IN_TENANT:"DN_NOT_FOUND_IN_TENANT",DUPLICATE_SITE_NAME:"DUPLICATE_SITE_NAME",OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE:"OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE",OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT:"OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT",OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE:"OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE",OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT:"OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT",EXISTING_USERS_IN_RANGE:"EXISTING_USERS_IN_RANGE",EXISTING_USERS_IN_PUBLIC_RANGE:"EXISTING_USERS_IN_PUBLIC_RANGE",EXISTING_USERS_IN_PRIVATE_RANGE:"EXISTING_USERS_IN_PRIVATE_RANGE",AREA_CODES_INCONSISTENT:"AREA_CODES_INCONSISTENT",DELETE_ITSP_ALREADY_ASSIGNED:"DELETE_ITSP_ALREADY_ASSIGNED",DN_NOT_FOUND_IN_SITE:"DN_NOT_FOUND_IN_SITE",CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS:"CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS",AA_OPERATOR_INVALID:"AA_OPERATOR_INVALID",MSN_AS_EXISTING_USER:"MSN_AS_EXISTING_USER",EA_INVALID_CREATE_UPDATE_CONFIGURATION:"EA_INVALID_CREATE_UPDATE_CONFIGURATION",INVALID_CHARACTERS_FOR_EA_GROUP_NAME:"INVALID_CHARACTERS_FOR_EA_GROUP_NAME",INVALID_LENGTH_FOR_EA_GROUP_NAME:"INVALID_LENGTH_FOR_EA_GROUP_NAME",MSN_ASSIGNED_TO_EA_GROUP:"MSN_ASSIGNED_TO_EA_GROUP",EXISTING_EA_USERS_IN_PUBLIC_RANGE:"EXISTING_EA_USERS_IN_PUBLIC_RANGE",EXISTING_EA_USERS_IN_PRIVATE_RANGE:"EXISTING_EA_USERS_IN_PRIVATE_RANGE",EXISTING_EA_USERS_IN_RANGE:"EXISTING_EA_USERS_IN_RANGE",INVALID_IP_OR_FQDN:"INVALID_IP_OR_FQDN",INVALID_PORT:"INVALID_PORT",EXISTING_AA_TRANSFER_TARGETS_IN_PUBLIC_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_PUBLIC_RANGE",EXISTING_AA_TRANSFER_TARGETS_IN_PRIVATE_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_PRIVATE_RANGE",EXISTING_AA_TRANSFER_TARGETS_IN_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_RANGE",NUMBER_USED_IN_AA_TRANSFER_TARGET:"NUMBER_USED_IN_AA_TRANSFER_TARGET",MULTIPLE_USER_INVITE_EXCEEDS_LIMIT:"MULTIPLE_USER_INVITE_EXCEEDS_LIMIT",EXISTING_AUTOMATED_ATTENDANT_IN_PRIVATE_RANGE:"EXISTING_AUTOMATED_ATTENDANT_IN_PRIVATE_RANGE",EXISTING_AUTOMATED_ATTENDANT_IN_PUBLIC_RANGE:"EXISTING_AUTOMATED_ATTENDANT_IN_PUBLIC_RANGE"},CloudTelephonyCmpNextError:{COUNTRY_DETAILS_NOT_FOUND:"COUNTRY_DETAILS_NOT_FOUND",OSV_OPERATION_FAILED:"OSV_OPERATION_FAILED",CALL_PICKUP_GROUP_DUPLICATE_NAME:"CALL_PICKUP_GROUP_DUPLICATE_NAME",OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT:"OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT",OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY:"OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY",INVALID_IP_OR_FQDN:"INVALID_IP_OR_FQDN"},ClientCapability:{GUEST_EXPERIENCE:1,SYSTEM_MESSAGES:2,TC_START_REASSIGNMENT:4,MUTABLE_APN:8,IOS13_VOIP_APN:16,DISABLE_VOIP_NOTIFICATIONS:32},SortOrder:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},TimeRange:{ONE_HOUR:36e5,ONE_DAY:864e5,ONE_WEEK:6048e5,ONE_MONTH:2592e6},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS",GET_USER_DATA_SINCE:"GET_USER_DATA_SINCE",GET_CONFERENCE_INVITATION_TEXT:"GET_CONFERENCE_INVITATION_TEXT",GET_CONFERENCE_INVITATION_EXAMPLE:"GET_CONFERENCE_INVITATION_EXAMPLE",GET_TEASER_MESSAGES:"GET_TEASER_MESSAGES",TAKE_MODERATION_RIGHT:"TAKE_MODERATION_RIGHT",GET_CONVERSATION_TOPICS:"GET_CONVERSATION_TOPICS",PIN_TOPIC:"PIN_TOPIC",UNPIN_TOPIC:"UNPIN_TOPIC",DELETE_JOURNAL_ENTRY:"DELETE_JOURNAL_ENTRY",SET_CONVERSATION_RETENTION_POLICY:"SET_CONVERSATION_RETENTION_POLICY",GET_JOURNAL_ENTRIES:"GET_JOURNAL_ENTRIES",GET_CONVERSATION_DETAILS:"GET_CONVERSATION_DETAILS",GET_UNHEARD_VOICEMAILS_COUNT:"GET_UNHEARD_VOICEMAILS_COUNT",SET_VOICEMAIL_HEARD:"SET_VOICEMAIL_HEARD",GET_CONVERSATION_IDS_REMOVED_FROM:"GET_CONVERSATION_IDS_REMOVED_FROM",SET_RECORDING_DELETION_DELAY:"SET_RECORDING_DELETION_DELAY",TAG_CONVERSATION:"TAG_CONVERSATION",UNTAG_CONVERSATION:"UNTAG_CONVERSATION",DELETE_ALL_JOURNAL_ENTRIES:"DELETE_ALL_JOURNAL_ENTRIES"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED",JOURNAL_ENTRY_DELETED:"JOURNAL_ENTRY_DELETED",ALL_JOURNAL_ENTRIES_DELETED:"ALL_JOURNAL_ENTRIES_DELETED"},UISettings:{INFO:"INFO",DETAILS:"DETAILS",SPACE_INFO:"SPACE_INFO",SPACE_DETAILS:"SPACE_DETAILS",SPACE_PINNED_TOPICS:"SPACE_PINNED_TOPICS",SPACE_ACTIVE_POLLS:"SPACE_ACTIVE_POLLS",SPACE_OPEN_QUESTIONS:"SPACE_OPEN_QUESTIONS",CONVERSATION_FAVORITES:"CONVERSATION_FAVORITES"},DefaultUISettingsValues:{INFO:!0,DETAILS:!0,SPACE_INFO:!0,SPACE_DETAILS:!0,SPACE_PINNED_TOPICS:!0,SPACE_ACTIVE_POLLS:!0,SPACE_OPEN_QUESTIONS:!0,CONVERSATION_FAVORITES:!0},UserBusyHandlingOptions:{DefaultRouting:"DefaultRouting",BusySignal:"BusySignal",SendToAlternativeNumber:"SendToAlternativeNumber",SendToVm:"SendToVm"},RetentionPolicyStatus:{ENABLED:"ENABLED",USER_DISABLED:"USER_DISABLED",LEGALHOLD_DISABLED:"LEGALHOLD_DISABLED",USER_LEGALHOLD_DISABLED:"USER_LEGALHOLD_DISABLED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationItemTypeMapping:{RTC:"phone",CALL_SUMMARY:"call-summary",TEXT:"text",SYSTEM:"notification",VOICEMAIL:"vm",MARKER:"marker",DIVIDER:"divider",GAP:"gap"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RetrieveAction:{CONVERSATIONS:"CONVERSATIONS",CONVERSATION_IDS:"CONVERSATION_IDS",CONVERSATIONS_AND_IDS:"CONVERSATIONS_AND_IDS"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED",MODERATOR_RIGHTS_GRANTED:"MODERATOR_RIGHTS_GRANTED",MODERATOR_RIGHTS_DROPPED:"MODERATOR_RIGHTS_DROPPED",GUEST_ACCESS_ENABLED:"GUEST_ACCESS_ENABLED",GUEST_ACCESS_DISABLED:"GUEST_ACCESS_DISABLED",AVATAR_CHANGED:"AVATAR_CHANGED",RETENTION_POLICY_CHANGED:"RETENTION_POLICY_CHANGED",PARTICIPANT_HARD_REMOVED:"PARTICIPANT_HARD_REMOVED",RETENTION_ITEMS_REMOVED:"RETENTION_ITEMS_REMOVED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID",SYSTEM_TAG:"SYSTEM_TAG"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED",FAVORITE:"FAVORITE",MODERATOR:"MODERATOR"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ChangedUserData:{LAST_READ_TS:"LASTREADTS",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ModerationTakenResult:{OK:"OK",ALREADY_HAS_MODERATOR:"ALREADY_HAS_MODERATOR",NO_MODERATED_CONVERTION:"NO_MODERATED_CONVERTION",NO_FULL_CONVERSATION_MEMBER:"NO_FULL_CONVERSATION_MEMBER",TAKE_MODERATION_FORBIDDEN:"TAKE_MODERATION_FORBIDDEN"},JournalFilter:{ALL:"ALL",MISSED:"MISSED",DIALED:"DIALED",RECEIVED:"RECEIVED",DIVERTED:"DIVERTED",VOICEMAILS:"VOICEMAILS",UNHEARD_VOICEMAILS:"UNHEARD_VOICEMAILS"},AddLabelsResult:{OK:"OK",LABEL_LIMIT_REACHED:"LABEL_LIMIT_REACHED",LABEL_ALREADY_EXISTS:"LABEL_ALREADY_EXISTS"},SystemTag:{IC:"IC"},ContainerType:{SPACE:"SPACE",CONVERSATION:"CONVERSATION"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS",SUBMIT_RTC_QUALITY_RATING:"SUBMIT_RTC_QUALITY_RATING",MERGE:"MERGE"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES",RTC_QUALITY_RATING_EVENT:"RTC_QUALITY_RATING_EVENT",IFRAME_STATISTICS:"IFRAME_STATISTICS"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",NOT_REACHABLE:"NOT_REACHABLE"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},TerminateCause:{COMPLETED_ELSEWHERE:"COMPLETED_ELSEWHERE",PICKED_UP:"PICKED_UP"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",GET_SESSIONID_BY_PIN:"GET_SESSIONID_BY_PIN",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD",SET_WHITEBOARD_BACKGROUND:"SET_WHITEBOARD_BACKGROUND",CLEAR_WHITEBOARD_BACKGROUND:"CLEAR_WHITEBOARD_BACKGROUND",TOGGLE_WHITEBOARD_OVERLAY:"TOGGLE_WHITEBOARD_OVERLAY",UNDO_WHITEBOARD:"UNDO_WHITEBOARD",SEND_CLIENT_INFO:"SEND_CLIENT_INFO",REQUEST_SCREEN_CONTROL:"REQUEST_SCREEN_CONTROL",REJECT_SCREEN_CONTROL_REQUEST:"REJECT_SCREEN_CONTROL_REQUEST",OFFER_SCREEN_CONTROL:"OFFER_SCREEN_CONTROL",ACCEPT_SCREEN_CONTROL:"ACCEPT_SCREEN_CONTROL",REJECT_SCREEN_CONTROL:"REJECT_SCREEN_CONTROL",STOP_SCREEN_CONTROL:"STOP_SCREEN_CONTROL",START_POLL:"START_POLL",GET_POLL:"GET_POLL",EDIT_POLL:"EDIT_POLL",VOTE_POLL:"VOTE_POLL",CLOSE_POLL:"CLOSE_POLL",RESUME_POLL:"RESUME_POLL",MAKE_POLL_RESULTS_VISIBLE:"MAKE_POLL_RESULTS_VISIBLE",STOP_POLL:"STOP_POLL",EXPORT_POLL:"EXPORT_POLL",ENABLE_POLL:"ENABLE_POLL",DISABLE_POLL:"DISABLE_POLL",SWITCH_RECORDING_LAYOUT:"SWITCH_RECORDING_LAYOUT",SET_VIDEO_RECEIVER_CONFIGURATION:"SET_VIDEO_RECEIVER_CONFIGURATION"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED",WHITEBOARD_BACKGROUND_SET:"WHITEBOARD_BACKGROUND_SET",WHITEBOARD_BACKGROUND_CLEARED:"WHITEBOARD_BACKGROUND_CLEARED",WHITEBOARD_OVERLAY_TOGGLED:"WHITEBOARD_OVERLAY_TOGGLED",WHITEBOARD_SYNC:"WHITEBOARD_SYNC",WHITEBOARD_CONVERSION_FAILED:"WHITEBOARD_CONVERSION_FAILED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_REJECTED:"SCREEN_CONTROL_REQUEST_REJECTED",SCREEN_CONTROL_OFFERED:"SCREEN_CONTROL_OFFERED",SCREEN_CONTROL_ACCEPTED:"SCREEN_CONTROL_ACCEPTED",SCREEN_CONTROL_REJECTED:"SCREEN_CONTROL_REJECTED",HANDOVER_SCREEN_CONTROL:"HANDOVER_SCREEN_CONTROL",SCREEN_CONTROL_TERMINATED:"SCREEN_CONTROL_TERMINATED",SCREEN_CONTROL_FAILED:"SCREEN_CONTROL_FAILED",POLL_STARTED:"POLL_STARTED",POLL_UPDATED:"POLL_UPDATED",POLL_CLOSED:"POLL_CLOSED",POLL_RESUMED:"POLL_RESUMED",POLL_STOPPED:"POLL_STOPPED",POLL_ENABLED:"POLL_ENABLED",POLL_DISABLED:"POLL_DISABLED",POLL_EXPORTED:"POLL_EXPORTED",LIVE_TRANSCRIPTION:"LIVE_TRANSCRIPTION"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RTCSessionParticipantFlag:{CPU_LOAD:"CPU_LOAD",CPU_LOAD_TRANSCODE:"CPU_LOAD_TRANSCODE",NO_LICENSE:"NO_LICENSE",MAX_COUNT:"MAX_COUNT"},RtcSupportedFeatures:{UPGRADE_TO_CONFERENCE:"UPGRADE_TO_CONFERENCE",SCREEN_CONTROL:"SCREEN_CONTROL",SCREEN_CONTROLLER:"SCREEN_CONTROLLER",SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO:"SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO",MID_STREAM_MAPPING:"MID_STREAM_MAPPING",CALL_PICKUP:"CALL_PICKUP"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RecordingMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",TEXT:"TEXT"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",VOICE_MAIL:"VOICE_MAIL",TEST_CALL:"TEST_CALL"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},RecordingVideoLayoutName:{SINGLE:"SINGLE",VIDEO_SCREEN_50_50:"VIDEO_SCREEN_50_50",VIDEO_SCREEN_75_25:"VIDEO_SCREEN_75_25",VIDEO_SCREEN_25_75:"VIDEO_SCREEN_25_75",SINGLE_VIDEO:"SINGLE_VIDEO"},RtcClientInfoType:{OFFLINE_JOIN_FAILURE:"OFFLINE_JOIN_FAILURE",DEVICE_DIAGNOSTICS:"DEVICE_DIAGNOSTICS",CALL_CONNECTED:"CALL_CONNECTED"},RtcClientInfoReason:{NO_NETWORK_CONNECTION:"NO_NETWORK_CONNECTION",DISCONNECTED:"DISCONNECTED",FAILED_TO_SEND:"FAILED_TO_SEND",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",JOIN_DELAY:"JOIN_DELAY",CALL_CONNECTED:"CALL_CONNECTED"},RtcActionInfoType:{REQUEST_RESPONSE:"REQUEST_RESPONSE",EVENT:"EVENT"},RtcDiagnosticsAction:{RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",PREPARE:"PREPARE",JOIN:"JOIN",ICE_CANDIDATES:"ICE_CANDIDATES",SDP_CONNECTED:"SDP_CONNECTED",SDP_ANSWER:"SDP_ANSWER",REMOTE_ICE_CANDIDATES:"REMOTE_ICE_CANDIDATES"},SessionAttributesChangedEventType:{EVENT_ATTENDEE_COUNT_CHANGED:"EVENT_ATTENDEE_COUNT_CHANGED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_CLEARED:"SCREEN_CONTROL_REQUEST_CLEARED",SCREEN_CONTROL_ESTABLISHED:"SCREEN_CONTROL_ESTABLISHED",SCREEN_CONTROL_ENDED:"SCREEN_CONTROL_ENDED"},IncomingVideoContentType:{VIDEO:"VIDEO",SCREEN:"SCREEN"},VideoQuality:{LOW:"LOW",NORMAL:"NORMAL",HIGH:"HIGH"},AudioQualityParam:{ECHO:"ECHO",JITTER:"JITTER",NO_PACKETS_RECV:"NO_PACKETS_RECV",NO_PACKETS_SENT:"NO_PACKETS_SENT",PL_RECV:"PL_RECV",PL_SEND:"PL_SEND",RTT:"RTT"},VideoQualityParam:{BW_SEND:"BW_SEND",FRAME_HEIGHT_SENT:"FRAME_HEIGHT_SENT",FRAME_RATE_SENT:"FRAME_RATE_SENT",FRAME_WIDTH_SENT:"FRAME_WIDTH_SENT",PL_RECV:"PL_RECV",PL_SEND:"PL_SEND",RTT:"RTT",TRX_BITRATE:"TRX_BITRATE"},WhiteboardErrorCause:{EXTERNAL_URL_NOT_ALLOWED:"EXTERNAL_URL_NOT_ALLOWED",IMAGE_SIZE_TOO_LARGE:"IMAGE_SIZE_TOO_LARGE",IMAGE_DOWNLOAD_FAILED:"IMAGE_DOWNLOAD_FAILED"},SearchActionType:{START_ADVANCED_USER_SEARCH:"START_ADVANCED_USER_SEARCH",START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{BROADCAST:"BROADCAST",BROADCAST_REMOVED:"BROADCAST_REMOVED",MAINTENANCE:"MAINTENANCE",MAINTENANCE_REMOVED:"MAINTENANCE_REMOVED",MAINTENANCE_ADDED:"MAINTENANCE_ADDED"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED",CLIENT_AUTOUPDATE_MAX_TIME:"CLIENT_AUTOUPDATE_MAX_TIME",ADD_TELEPHONY_CONNECTOR_DISABLED:"ADD_TELEPHONY_CONNECTOR_DISABLED",CHROME_EXTENSION_ID:"CHROME_EXTENSION_ID",EDGE_EXTENSION_ID:"EDGE_EXTENSION_ID",CONV_INCOMING_WEBHOOKS_MAX_SIZE:"CONV_INCOMING_WEBHOOKS_MAX_SIZE"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},SearchContext:{USER:"USER",MEETING_POINT:"MEETING_POINT"},UserActionType:{LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN",RESET_OPENSCAPE_DEVICE_PINS:"RESET_OPENSCAPE_DEVICE_PINS",SUBSCRIBE_TENANT_PRESENCE:"SUBSCRIBE_TENANT_PRESENCE",UNSUBSCRIBE_TENANT_PRESENCE:"UNSUBSCRIBE_TENANT_PRESENCE",GET_TENANT_ID_TO_NAME_MAP:"GET_TENANT_ID_TO_NAME_MAP",ADD_RECENT_USED_CMR:"ADD_RECENT_USED_CMR",GET_RECENT_USED_CMRS:"GET_RECENT_USED_CMRS",IS_ALLOWED_TO_ADD_CMR:"IS_ALLOWED_TO_ADD_CMR",GET_SUPPORT_DATA:"GET_SUPPORT_DATA",WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",SET_CLIENT_CAPABILITIES:"SET_CLIENT_CAPABILITIES"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE",TENANT_CONFIGURATION_UPDATED:"TENANT_CONFIGURATION_UPDATED",UCAAS_DEVICE_UPDATED:"UCAAS_DEVICE_UPDATED",TENANT_PRESENCE_CHANGE:"TENANT_PRESENCE_CHANGE",CMR_SETTINGS_UPDATED:"CMR_SETTINGS_UPDATED",CMR_COMMAND:"CMR_COMMAND",TELEPHONY_CHANGED:"TELEPHONY_CHANGED",TELEPHONY_PROVIDER_UPDATED:"TELEPHONY_PROVIDER_UPDATED",EAGROUP_STATUS_CHANGED:"EAGROUP_STATUS_CHANGED"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",RECENT_SPACE_SEARCHES:"RECENT_SPACE_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS",SYSTEM_LABELS:"SYSTEM_LABELS",PENDING_SYSTEM_NOTIFICATIONS:"PENDING_SYSTEM_NOTIFICATIONS",SUPPORT_INFO:"SUPPORT_INFO",HAS_TENANT_MEETING_POINTS:"HAS_TENANT_MEETING_POINTS",TEAMS:"TEAMS",SPACES_NCA:"SPACES_NCA"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK",UNKNOWN:"UNKNOWN",SESSION_GUEST:"SESSION_GUEST"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},AALanguageCode:{EN_US:"en_US",EN_GB:"en_GB",DE_DE:"de_DE",ES_ES:"es_ES",FR_FR:"fr_FR",IT_IT:"it_IT",RU_RU:"ru_RU",ZH_CN:"zh_CN",PT_BR:"pt_BR",NL_NL:"nl_NL"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER",UCAAS:"UCAAS"},PhoneNumberNpi:{PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI",DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:"DESKTOP_MESSAGE_NOTIFICATIONS_SETTING",MOBILE_MESSAGE_NOTIFICATIONS_SETTING:"MOBILE_MESSAGE_NOTIFICATIONS_SETTING",PLAY_SOUND_MESSAGE_NOTIFICATIONS:"PLAY_SOUND_MESSAGE_NOTIFICATIONS",PLAY_SOUND_RTC:"PLAY_SOUND_RTC",PLAY_SYSTEM_SOUNDS:"PLAY_SYSTEM_SOUNDS",ENHANCED_DESKTOP_MESSAGE_NOTIFICATION:"ENHANCED_DESKTOP_MESSAGE_NOTIFICATION",ENHANCED_MOBILE_MESSAGE_NOTIFICATION:"ENHANCED_MOBILE_MESSAGE_NOTIFICATION",HIDE_PROFILE_EXTERNAL_ENABLED:"HIDE_PROFILE_EXTERNAL_ENABLED",PLAY_PICKUP_SOUND:"PLAY_PICKUP_SOUND",KEYBOARD_SHORTCUTS_ENABLED:"KEYBOARD_SHORTCUTS_ENABLED",TM_WEB_POPOUT_CONVERSATION:"TM_WEB_POPOUT_CONVERSATION",TM_WEB_DTMF_DIAL_PAD:"TM_WEB_DTMF_DIAL_PAD",TM_WEB_PHONE_CONSULTATION:"TM_WEB_PHONE_CONSULTATION",ANONYMOUS_RTC_PARTICIPANT:"ANONYMOUS_RTC_PARTICIPANT",VOICEMAIL_NO_RECORDING:"VOICEMAIL_NO_RECORDING",TM_SELECT_DRAFT_TYPE:"TM_SELECT_DRAFT_TYPE",TM_START_CONV_OR_CALL:"TM_START_CONV_OR_CALL",TM_FIELD_MODE:"TM_FIELD_MODE",TM_EXPERT_CONVERSATION_TYPE:"TM_EXPERT_CONVERSATION_TYPE",TM_EXPERT_CONVERSATION_FILTER:"TM_EXPERT_CONVERSATION_FILTER"},OAuthScope:{ALL:"ALL",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_USER_PROFILE:"WRITE_USER_PROFILE",READ_CONVERSATIONS:"READ_CONVERSATIONS",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",READ_USER:"READ_USER",CALLS:"CALLS",CALL_RECORDING:"CALL_RECORDING",MENTION_EVENT:"MENTION_EVENT",USER_MANAGEMENT:"USER_MANAGEMENT",MANAGE_CONVERSATIONS:"MANAGE_CONVERSATIONS",CREATE_CONVERSATIONS_CONTENT:"CREATE_CONVERSATIONS_CONTENT",DELETE_CONVERSATIONS_CONTENT:"DELETE_CONVERSATIONS_CONTENT",UPDATE_CONVERSATION_CONTENT:"UPDATE_CONVERSATION_CONTENT",MANAGE_PRESENCE:"MANAGE_PRESENCE",MODERATE_CONVERSATIONS:"MODERATE_CONVERSATIONS",ORGANIZE_CONVERSATIONS:"ORGANIZE_CONVERSATIONS",SEARCH_CONVERSATIONS:"SEARCH_CONVERSATIONS",USER_TO_USER:"USER_TO_USER",READ_SPACE:"READ_SPACE",WRITE_SPACE:"WRITE_SPACE",MANAGE_SPACE:"MANAGE_SPACE",CREATE_SPACE_CONTENT:"CREATE_SPACE_CONTENT",DELETE_SPACE_CONTENT:"DELETE_SPACE_CONTENT",UPDATE_SPACE_CONTENT:"UPDATE_SPACE_CONTENT",ORGANIZE_SPACE:"ORGANIZE_SPACE",GUEST_CALLS:"GUEST_CALLS"},OAuthGrantTypes:{AUTHORIZATION_CODE:"AUTHORIZATION_CODE",IMPLICIT:"IMPLICIT",CLIENT_CREDENTIALS:"CLIENT_CREDENTIALS",RESOURCE_OWNER_CREDENTIALS:"RESOURCE_OWNER_CREDENTIALS",RESOURCE_OWNER:"RESOURCE_OWNER"},OAuthSubtype:{NONE:"NONE",INCOMING_WEBHOOK:"INCOMING_WEBHOOK"},MessageNotificationsSetting:{ALL:0,DIRECT_AND_MENTIONS:1,NONE:2},EnhancedMessageNotificationsSetting:{ALL:-1,NONE:0,DIRECT:1,MENTION:2,FAVORITE:4},TelephonyChangeType:{ADDED:"ADDED",UPDATED:"UPDATED",REMOVED:"REMOVED"},FederationFeature:{SPACE_FEDERATION:"SPACE_FEDERATION",CONVERSATION_FEDERATION:"CONVERSATION_FEDERATION",PRESENCE_FEDERATION:"PRESENCE_FEDERATION"},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",FIND_TENANT_SETTING:"FIND_TENANT_SETTING",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID:"GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID",GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID:"GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID",SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS:"SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS",UPDATE_TENANT:"UPDATE_TENANT",ENABLE_PARTNER_ADMINISTRATION:"ENABLE_PARTNER_ADMINISTRATION",DISABLE_PARTNER_ADMINISTRATION:"DISABLE_PARTNER_ADMINISTRATION",GET_RESELLER_INFO:"GET_RESELLER_INFO",SET_SUPPORT_TYPE:"SET_SUPPORT_TYPE",SET_SUPPORT_EMAIL_ADDRESS:"SET_SUPPORT_EMAIL_ADDRESS",EXPORT_DATA_USER:"EXPORT_DATA_USER",EXPORT_DATA_TENANT:"EXPORT_DATA_TENANT",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",ADD_API_TECHNICAL_USER:"ADD_API_TECHNICAL_USER",GET_CUSTOM_APPS:"GET_CUSTOM_APPS",ADD_CUSTOM_APP:"ADD_CUSTOM_APP",GET_PROVISIONED_TENANT_USERS:"GET_PROVISIONED_TENANT_USERS",CREATE_PROVISIONED_USER:"CREATE_PROVISIONED_USER",REMOVE_PROVISIONED_USER:"REMOVE_PROVISIONED_USER",UPDATE_PROVISIONED_USER:"UPDATE_PROVISIONED_USER",SET_TELEPHONY_STATUS:"SET_TELEPHONY_STATUS",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",GET_TECHNICAL_CREDENTIALS:"GET_TECHNICAL_CREDENTIALS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",GET_TELEPHONY_TRUNK_GROUPS:"GET_TELEPHONY_TRUNK_GROUPS",GET_TELEPHONY_TRUNK_GROUP:"GET_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_GROUP:"ADD_TELEPHONY_TRUNK_GROUP",REMOVE_TELEPHONY_TRUNK_GROUP:"REMOVE_TELEPHONY_TRUNK_GROUP",UPDATE_TELEPHONY_TRUNK_GROUP:"UPDATE_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_TO_GROUP:"ADD_TELEPHONY_TRUNK_TO_GROUP",REMOVE_TELEPHONY_TRUNK_FROM_GROUP:"REMOVE_TELEPHONY_TRUNK_FROM_GROUP",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",SET_TENANT_VOICEMAIL_NUMBERS:"SET_TENANT_VOICEMAIL_NUMBERS",GET_TENANT_VOICEMAIL_NUMBERS:"GET_TENANT_VOICEMAIL_NUMBERS",UPDATE_TRUNK:"UPDATE_TRUNK",START_TRUNK_SOFT_SUSPENSION:"START_TRUNK_SOFT_SUSPENSION",CANCEL_TRUNK_SOFT_SUSPENSION:"CANCEL_TRUNK_SOFT_SUSPENSION",GET_TRUNK_ACTIVE_CALLS:"GET_TRUNK_ACTIVE_CALLS",SHARE_TRUNK_GROUP:"SHARE_TRUNK_GROUP",UNSHARE_TRUNK_GROUP:"UNSHARE_TRUNK_GROUP",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE:"GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",GET_OPENSCAPE_USER_V2:"GET_OPENSCAPE_USER_V2",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT",DELETE_OPENSCAPE_SITES:"DELETE_OPENSCAPE_SITES",CREATE_OPENSCAPE_SITE:"CREATE_OPENSCAPE_SITE",UPDATE_OPENSCAPE_SITE:"UPDATE_OPENSCAPE_SITE",GET_OPENSCAPE_SITE:"GET_OPENSCAPE_SITE",DELETE_PUBLIC_NUMBER_RANGE:"DELETE_PUBLIC_NUMBER_RANGE",DELETE_OPENSCAPE_MSN_NUMBER:"DELETE_OPENSCAPE_MSN_NUMBER",DELETE_PRIVATE_NUMBER_RANGE:"DELETE_PRIVATE_NUMBER_RANGE",CREATE_HUNT_GROUP:"CREATE_HUNT_GROUP",GET_HUNT_GROUP:"GET_HUNT_GROUP",GET_TENANT_HUNT_GROUPS:"GET_TENANT_HUNT_GROUPS",GET_HUNT_GROUP_PILOT_CANDIDATES:"GET_HUNT_GROUP_PILOT_CANDIDATES",GET_HUNT_GROUP_MEMBER_CANDIDATES:"GET_HUNT_GROUP_MEMBER_CANDIDATES",UPDATE_HUNT_GROUP:"UPDATE_HUNT_GROUP",DELETE_HUNT_GROUP:"DELETE_HUNT_GROUP",UPDATE_HUNT_GROUP_LIST:"UPDATE_HUNT_GROUP_LIST",GET_OPENSCAPE_ITSP_TEMPLATES:"GET_OPENSCAPE_ITSP_TEMPLATES",CREATE_OPENSCAPE_ITSP:"CREATE_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSP:"GET_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSPS:"GET_OPENSCAPE_ITSPS",UPDATE_OPENSCAPE_ITSP:"UPDATE_OPENSCAPE_ITSP",DELETE_OPENSCAPE_ITSP:"DELETE_OPENSCAPE_ITSP",ASSIGN_OPENSCAPE_ITSP_TO_SITE:"ASSIGN_OPENSCAPE_ITSP_TO_SITE",UNASSIGN_OPENSCAPE_ITSP_TO_SITE:"UNASSIGN_OPENSCAPE_ITSP_TO_SITE",FIND_OPENSCAPE_SITES_BY_ITSP:"FIND_OPENSCAPE_SITES_BY_ITSP",GET_PICKUP_GROUP_MEMBER_CANDIDATES:"GET_PICKUP_GROUP_MEMBER_CANDIDATES",CREATE_PICKUP_GROUP:"CREATE_PICKUP_GROUP",GET_TENANT_PICKUP_GROUPS:"GET_TENANT_PICKUP_GROUPS",DELETE_PICKUP_GROUPS:"DELETE_PICKUP_GROUPS",GET_PICKUP_GROUP:"GET_PICKUP_GROUP",UPDATE_PICKUP_GROUP:"UPDATE_PICKUP_GROUP",CREATE_AUTOMATED_ATTENDANT_CONFIGURATION:"CREATE_AUTOMATED_ATTENDANT_CONFIGURATION",GET_AUTOMATED_ATTENDANT_CONFIGURATIONS:"GET_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_AUTOMATED_ATTENDANT_CONFIGURATION:"GET_AUTOMATED_ATTENDANT_CONFIGURATION",UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION:"UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION",DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS:"DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_THIRD_PARTY_DEVICE_INFO:"GET_THIRD_PARTY_DEVICE_INFO",IS_MSN_RESERVED:"IS_MSN_RESERVED",HAS_RESERVED_DNS_IN_SITE_RANGES:"HAS_RESERVED_DNS_IN_SITE_RANGES",GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS:"GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS",CREATE_EXECUTIVE_ASSISTANT_GROUP:"CREATE_EXECUTIVE_ASSISTANT_GROUP",CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC:"CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC",GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES:"GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES",GET_EXECUTIVE_ASSISTANT_GROUP:"GET_EXECUTIVE_ASSISTANT_GROUP",GET_COMPOSER_CONNECTION_DETAILS:"GET_COMPOSER_CONNECTION_DETAILS",DELETE_EXECUTIVE_ASSISTANT_GROUPS:"DELETE_EXECUTIVE_ASSISTANT_GROUPS",ADD_LDAP_CONFIGURATION_FOR_PHONE:"ADD_LDAP_CONFIGURATION_FOR_PHONE",GET_LDAP_CONFIGURATION_FOR_PHONE:"GET_LDAP_CONFIGURATION_FOR_PHONE",VALIDATE_TRANSFER_TARGET:"VALIDATE_TRANSFER_TARGET",ADD_PHONE_ONLY_USER:"ADD_PHONE_ONLY_USER",ADD_SHARED_DEVICE:"ADD_SHARED_DEVICE",CREATE_APPLICATION_FRAMEWORK_CONFIGURATION:"CREATE_APPLICATION_FRAMEWORK_CONFIGURATION",GET_APPLICATION_FRAMEWORK_CONFIGURATIONS:"GET_APPLICATION_FRAMEWORK_CONFIGURATIONS",GET_APPLICATION_FRAMEWORK_CONFIGURATION:"GET_APPLICATION_FRAMEWORK_CONFIGURATION",UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION:"UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION",DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS:"DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",INVITE_PARTNER_USER:"INVITE_PARTNER_USER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_CMR_SETTINGS:"SET_CMR_SETTINGS",GET_CMR_SETTINGS:"GET_CMR_SETTINGS",GET_CMR_INFO_BY_ID:"GET_CMR_INFO_BY_ID",GET_CMR_INFO_BY_IDS:"GET_CMR_INFO_BY_IDS",SET_ADMIN_MANAGED_CMR_SETTINGS:"SET_ADMIN_MANAGED_CMR_SETTINGS",SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS:"SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS",SHARE_CMR:"SHARE_CMR",UNSHARE_CMR:"UNSHARE_CMR",GET_CMR_SHARED_TENANT_INFO:"GET_CMR_SHARED_TENANT_INFO",SEND_CMR_COMMAND:"SEND_CMR_COMMAND",GET_CMR_FEATURES_BY_IDS:"GET_CMR_FEATURES_BY_IDS",GET_PARTNER_MANAGEABLE_TENANTS:"GET_PARTNER_MANAGEABLE_TENANTS",GET_SYSTEM_NOTIFICATIONS:"GET_SYSTEM_NOTIFICATIONS",ADD_SYSTEM_NOTIFICATION:"ADD_SYSTEM_NOTIFICATION",REMOVE_SYSTEM_NOTIFICATION:"REMOVE_SYSTEM_NOTIFICATION",UPDATE_SYSTEM_NOTIFICATION:"UPDATE_SYSTEM_NOTIFICATION"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR",INVITATION_SEND_UCAAS_DN_ALREADY_USED:"INVITATION_SEND_UCAAS_DN_ALREADY_USED",INVITATION_SEND_UCAAS_DN_NOT_FOUND:"INVITATION_SEND_UCAAS_DN_NOT_FOUND",INVITATION_SEND_UCAAS_ERROR:"INVITATION_SEND_UCAAS_ERROR",INVITATION_NOT_SEND_UCAAS_DN_ALREADY_USED:"INVITATION_NOT_SEND_UCAAS_DN_ALREADY_USED",INVITATION_NOT_SEND_UCAAS_DN_NOT_FOUND:"INVITATION_NOT_SEND_UCAAS_DN_NOT_FOUND",INVITATION_NOT_SEND_UCAAS_ERROR:"INVITATION_NOT_SEND_UCAAS_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},SupportType:{CONVERSATION:"CONVERSATION",NO_SUPPORT:"NO_SUPPORT",EMAIL:"EMAIL",PARTNER_ADMIN_EMAIL:"PARTNER_ADMIN_EMAIL"},SystemNotificationType:{MAINTENANCE:"MAINTENANCE",BROADCAST:"BROADCAST"},HuntType:{INIT:"INIT",LINEAR:"LINEAR",CIRCULAR_WITH_HUNT:"CIRCULAR_WITH_HUNT",UCD:"UCD",MANUAL:"MANUAL",PARALLEL:"PARALLEL",PARALLEL_SA:"PARALLEL_SA"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",TELEPHONY_CONFIG_CONVERSATION:"TELEPHONY_CONFIG_CONVERSATION",CLIENT_AUTO_UPDATE:"CLIENT_AUTO_UPDATE",HELP_URL:"HELP_URL",SDK_USAGE_ENABLED:"SDK_USAGE_ENABLED",OAUTH_ACCESS_ENABLED:"OAUTH_ACCESS_ENABLED",LOGIN_METHODS_AVAILABLE:"LOGIN_METHODS_AVAILABLE",DATA_RETENTION_PERIOD:"DATA_RETENTION_PERIOD",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",PLUGIN_DESKTOP_APP_ENABLED:"PLUGIN_DESKTOP_APP_ENABLED",PLUGIN_IE_PLUGIN_ENABLED:"PLUGIN_IE_PLUGIN_ENABLED",PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED:"PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED",PLUGIN_CHROME_EXTENSION_ENABLED:"PLUGIN_CHROME_EXTENSION_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_OPEN_XCHANGE_ENABLED:"EXTENSION_OPEN_XCHANGE_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",LOOKUP_API_BLACKLISTED_DOMAINS:"LOOKUP_API_BLACKLISTED_DOMAINS",ROOT_DEVICES_ALLOWED:"ROOT_DEVICES_ALLOWED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED",SKYPE4B_CLIENT_ID:"SKYPE4B_CLIENT_ID",SKYPE4B_ROOT_URL:"SKYPE4B_ROOT_URL",C4O_AUTO_UPDATE:"C4O_AUTO_UPDATE",DA_AUTO_UPDATE:"DA_AUTO_UPDATE",EXTENSION_SENNHEISER_ENABLED:"EXTENSION_SENNHEISER_ENABLED",MUTE_ON_ENTRY:"MUTE_ON_ENTRY",MUTE_ON_ENTRY_CMR:"MUTE_ON_ENTRY_CMR",MUTE_ON_ENTRY_OUTCALL:"MUTE_ON_ENTRY_OUTCALL",C4O_PRESENCE_SETTINGS:"C4O_PRESENCE_SETTINGS",EXTENSION_ZAPIER_ENABLED:"EXTENSION_ZAPIER_ENABLED",CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED:"CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED",REMOTE_CONTROL_ENABLED:"REMOTE_CONTROL_ENABLED",REMOTE_CONTROL_EXTERNAL_ENABLED:"REMOTE_CONTROL_EXTERNAL_ENABLED",EXTENSION_EMBRAVA_ENABLED:"EXTENSION_EMBRAVA_ENABLED",EXTENSION_CONCEPTBOARD_ENABLED:"EXTENSION_CONCEPTBOARD_ENABLED",DATA_RETENTION_STRATEGY:"DATA_RETENTION_STRATEGY",PLANTRONICS_HUB_DOWNLOAD_URL:"PLANTRONICS_HUB_DOWNLOAD_URL",INCOMING_WEBHOOKS_ENABLED:"INCOMING_WEBHOOKS_ENABLED",CONVERSATION_RETENTION_POLICY_CHANGEABLE:"CONVERSATION_RETENTION_POLICY_CHANGEABLE",EXTENSION_GOOGLE_CONTACTS_ENABLED:"EXTENSION_GOOGLE_CONTACTS_ENABLED",EXTENSION_JPL_ENABLED:"EXTENSION_JPL_ENABLED",SCREENSHARE_DISABLED:"SCREENSHARE_DISABLED",FILESHARE_DISABLED:"FILESHARE_DISABLED",TRANSCRIPTION_ENABLED:"TRANSCRIPTION_ENABLED",TRANSCRIPTION_GOOGLE_API_KEY:"TRANSCRIPTION_GOOGLE_API_KEY",SUPPRESS_JOIN_INDICATION_THRESHOLD:"SUPPRESS_JOIN_INDICATION_THRESHOLD",USER_CONTROLLED_WEBRTC_POLICY_ENABLED:"USER_CONTROLLED_WEBRTC_POLICY_ENABLED",DATA_RETENTION_RECORDING_PERIOD:"DATA_RETENTION_RECORDING_PERIOD",DATA_RETENTION_EXTENDED_RECORDING_PERIOD:"DATA_RETENTION_EXTENDED_RECORDING_PERIOD",GLOBAL_SPACE_CREATION_ENABLED:"GLOBAL_SPACE_CREATION_ENABLED",ALLOW_EXTERNAL_SPACES:"ALLOW_EXTERNAL_SPACES",TRANSCRIPTION_LOCALES:"TRANSCRIPTION_LOCALES",EXTENSION_MEISTERTASK_ENABLED:"EXTENSION_MEISTERTASK_ENABLED",MASS_OPENSCAPE_USER_MANAGEMENT:"MASS_OPENSCAPE_USER_MANAGEMENT",FAQ_URL:"FAQ_URL",SPACE_DEFAULT_TYPE:"SPACE_DEFAULT_TYPE",ANONYMOUS_PARTICIPANTS_ENABLED:"ANONYMOUS_PARTICIPANTS_ENABLED",EXTENSION_KUANDO_ENABLED:"EXTENSION_KUANDO_ENABLED",EXTENSION_C4G_ENABLED:"EXTENSION_C4G_ENABLED",PASSWORD_POLICY_CONFIG_JSON:"PASSWORD_POLICY_CONFIG_JSON",IC_SUPPORT_PHONE_NUMBER:"IC_SUPPORT_PHONE_NUMBER",IC_SUPPORT_EMAIL_ADDRESS:"IC_SUPPORT_EMAIL_ADDRESS",IC_SUPPORT_OPERATING_HOURS_FROM:"IC_SUPPORT_OPERATING_HOURS_FROM",IC_SUPPORT_OPERATING_HOURS_TO:"IC_SUPPORT_OPERATING_HOURS_TO",IC_SUPPORT_OPERATING_HOURS_TIMEZONE:"IC_SUPPORT_OPERATING_HOURS_TIMEZONE",IC_USER_MANUAL_URL:"IC_USER_MANUAL_URL",IC_SAFETY_NOTICE_URL:"IC_SAFETY_NOTICE_URL",IC_ADDITIONAL_TERMS_OF_SERVICE_URL:"IC_ADDITIONAL_TERMS_OF_SERVICE_URL",EXTENSION_C4C_ENABLED:"EXTENSION_C4C_ENABLED",EXTENSION_C4O365_ENABLED:"EXTENSION_C4O365_ENABLED",SPACE_FEDERATION:"SPACE_FEDERATION",CONVERSATION_FEDERATION:"CONVERSATION_FEDERATION",PRESENCE_FEDERATION:"PRESENCE_FEDERATION",EXTERNAL_COMMUNICATION_BLOCKED:"EXTERNAL_COMMUNICATION_BLOCKED",EVENT_ORGANIZER_CONFIG:"EVENT_ORGANIZER_CONFIG",CALL_QUALITY_RATING_PERCENTAGE:"CALL_QUALITY_RATING_PERCENTAGE",EXTENSION_PLANTRONICS_STATUS_ENABLED:"EXTENSION_PLANTRONICS_STATUS_ENABLED",USER_BY_EMAIL_FEDERATION:"USER_BY_EMAIL_FEDERATION",EXTENSION_C4TEAMS_ENABLED:"EXTENSION_C4TEAMS_ENABLED",CO_BRANDING_CONFIG_JSON:"CO_BRANDING_CONFIG_JSON",EXTENSION_MICROSOFT_SHAREPOINT_ENABLED:"EXTENSION_MICROSOFT_SHAREPOINT_ENABLED",USER_PROFILE_TAGS_ENABLED:"USER_PROFILE_TAGS_ENABLED",UCAAS_ALLOW_RESTRICTED_ITSPS:"UCAAS_ALLOW_RESTRICTED_ITSPS",EXTENSION_LOGITECH_ENABLED:"EXTENSION_LOGITECH_ENABLED",ALLOW_VDI_USER_DOWNLOAD:"ALLOW_VDI_USER_DOWNLOAD",ALLOW_VDI_PACKAGE_CITRIX:"ALLOW_VDI_PACKAGE_CITRIX",ALLOW_VDI_PACKAGE_VMWARE:"ALLOW_VDI_PACKAGE_VMWARE"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED",SUSPENDING:"SUSPENDING"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE",SUB_TRUNK_TYPE:"SUB_TRUNK_TYPE"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},RemoveTrunkGroupResult:{SUCCESS:"SUCCESS",REFERENCES_EXIST:"REFERENCES_EXIST",UNKNOWN_ERROR:"UNKNOWN_ERROR"},CMRSettingKey:{CMR_ADDRESS:"CMR_ADDRESS",CMR_PLATFORM_VERSION:"CMR_PLATFORM_VERSION",CMR_OS_VERSION:"CMR_OS_VERSION",CMR_APP_VERSION:"CMR_APP_VERSION",CMR_MAC_ADDRESS:"CMR_MAC_ADDRESS",VIDEO_DEVICE:"VIDEO_DEVICE",AUDIO_DEVICE:"AUDIO_DEVICE",PRIMARY_DISPLAY:"PRIMARY_DISPLAY",SECONDARY_DISPLAY:"SECONDARY_DISPLAY",UPDATE_SERVER_STATUS:"UPDATE_SERVER_STATUS",PLAYBACK_DEVICE:"PLAYBACK_DEVICE",RECORDING_DEVICE:"RECORDING_DEVICE",CONTROL_PANEL_ENABLED:"CONTROL_PANEL_ENABLED",CONTROL_PANEL_MODEL:"CONTROL_PANEL_MODEL",CONTROL_PANEL_VERSION:"CONTROL_PANEL_VERSION",TOUCHSCREEN_DISPLAY:"TOUCHSCREEN_DISPLAY"},AdminManagedCMRSettingKey:{CMR_UDP_QOS:"CMR_UDP_QOS",CMR_UDP_AUDIO_DSCP:"CMR_UDP_AUDIO_DSCP",CMR_UDP_VIDEO_DSCP:"CMR_UDP_VIDEO_DSCP",CMR_TCP_QOS:"CMR_TCP_QOS",CMR_TCP_AUDIO_DSCP:"CMR_TCP_AUDIO_DSCP",CMR_TCP_VIDEO_DSCP:"CMR_TCP_VIDEO_DSCP",MANUAL_TIME:"MANUAL_TIME",TIMEZONE:"TIMEZONE",DATE:"DATE",TIME:"TIME",NTP_SERVER:"NTP_SERVER",REMOTE_ACCESS:"REMOTE_ACCESS",ENERGY_SAVING:"ENERGY_SAVING",SUSPEND_AFTER:"SUSPEND_AFTER",DASHBOARD_PASSWORD:"DASHBOARD_PASSWORD",SW_UPDATE_INFO:"SW_UPDATE_INFO",CMR_MANUAL_QOS_PORTS:"CMR_MANUAL_QOS_PORTS",CMR_UDP_AUDIO_START_PORT:"CMR_UDP_AUDIO_START_PORT",CMR_UDP_AUDIO_END_PORT:"CMR_UDP_AUDIO_END_PORT",CMR_UDP_VIDEO_START_PORT:"CMR_UDP_VIDEO_START_PORT",CMR_UDP_VIDEO_END_PORT:"CMR_UDP_VIDEO_END_PORT",CMR_TCP_AUDIO_START_PORT:"CMR_TCP_AUDIO_START_PORT",CMR_TCP_AUDIO_END_PORT:"CMR_TCP_AUDIO_END_PORT",CMR_TCP_VIDEO_START_PORT:"CMR_TCP_VIDEO_START_PORT",CMR_TCP_VIDEO_END_PORT:"CMR_TCP_VIDEO_END_PORT",SW_UPDATE_PENDING:"SW_UPDATE_PENDING",RESTART_PENDING:"RESTART_PENDING",TRAPS_ENABLED:"TRAPS_ENABLED",SNMP_USERNAME:"SNMP_USERNAME",AUTHENTICATION_PASSWORD:"AUTHENTICATION_PASSWORD",ENCRYPTION_PASSWORD:"ENCRYPTION_PASSWORD",TRAP_DESTINATION_1:"TRAP_DESTINATION_1",TRAP_DESTINATION_2:"TRAP_DESTINATION_2",NO_AUDIO_CONNECTED_ENABLED:"NO_AUDIO_CONNECTED_ENABLED",NO_VIDEO_CONNECTED_ENABLED:"NO_VIDEO_CONNECTED_ENABLED",PERIODIC_REBOOT_ENABLED:"PERIODIC_REBOOT_ENABLED",PERIODIC_REBOOT_TOD:"PERIODIC_REBOOT_TOD",SWAP_AUXILIARY_CONTENT:"SWAP_AUXILIARY_CONTENT",DHCP:"DHCP",PROXY:"PROXY",PROXY_ADDRESS:"PROXY_ADDRESS",CIRCUIT_NO_PROXY:"CIRCUIT_NO_PROXY",PROXY_USERNAME:"PROXY_USERNAME",PROXY_PASSWORD:"PROXY_PASSWORD",ALTERNATE_IDLE_SCREEN:"ALTERNATE_IDLE_SCREEN"},CMRCommand:{DOWNLOAD_SYSTEM_LOGS:"DOWNLOAD_SYSTEM_LOGS",UPDATE_SOFTWARE:"UPDATE_SOFTWARE",RESTART:"RESTART"},UcaasDeviceStatus:{NO_DEVICE:"NO_DEVICE",NOT_CONFIGURED:"NOT_CONFIGURED",CONFIGURED:"CONFIGURED"},DeviceTypeAssigned:{NONE:"NONE",UNIFY:"UNIFY",THIRD_PARTY:"THIRD_PARTY"},OpenscapeDirectoryNumberUsage:{MLHG_MEMBER:"MLHG_MEMBER",MLHG_PILOT:"MLHG_PILOT",PICKUP_MEMBER:"PICKUP_MEMBER",EXECUTIVE_ASSISTANT_MEMBER:"EXECUTIVE_ASSISTANT_MEMBER",MLHG_OVERFLOW_DESTINATION:"MLHG_OVERFLOW_DESTINATION",AA_TRANSFER_TARGET:"AA_TRANSFER_TARGET"},StatisticsTypes:{ACCOUNT_FLUX:"account-flux",ACCOUNT_STATUS:"account-status",CDR_STATS:"cdr-stats",DAILY_LOGINS_BY_DEVICE_SUB_TYPE:"daily-logins-by-device-sub-type",DAILY_LOGINS_BY_DEVICE_TYPE_VERSION:"daily-logins-by-device-type-version",DISCONNECT_CAUSE_BY_DEV_TYPE:"disconnect-cause-by-dev-type",DOCUMENTATION:"documentation",ITEM_ACTIVITY:"item-activity",USER_ADOPTION:"user-adoption",MINUTES_BY_MEDIA_STACKED:"minutes-by-media-stacked",QOS_METRIC_HISTOGRAM:"qos-metric-histogram",RATINGS_INTERVAL_STATS:"ratings-interval-stats",RATINGS_PIE_STATS:"ratings-pie-stats",RATINGS_PIE_COMBINED:"ratings-combined"},StatisticsTimePeriod:{TODAY:"TODAY",ONE_WEEK:"ONE_WEEK",TWO_WEEKS:"TWO_WEEKS",THREE_WEEKS:"THREE_WEEKS",FOUR_WEEKS:"FOUR_WEEKS"},StatisticsQosMetric:{JI:"JI",LA:"LA",MOS:"MOS",PLL:"PLL",PLR:"PLR"},StatisticsDeviceTypes:{ANDROID:"android",C4O:"c4o",CMR:"cmr",DA:"da",GTC:"gtc",GUEST:"guest",IOS:"ios",VRS:"vrs",WEB:"web"},ITSPRegistrationStates:{REGISTERED:"REGISTERED",NOT_REGISTERED:"NOT_REGISTERED",DA_FAILURE:"DA_FAILURE"},ITSPConnectionStates:{CONNECTED:"CONNECTED",NOT_CONNECTED:"NOT_CONNECTED"},ITSPConfigurationStates:{IN_PROGRESS:"IN_PROGRESS",FAILED:"FAILED",CREATED:"CREATED",DELETED:"DELETED",DELETE_FAILED:"DELETE_FAILED"},ExecutiveAssistantGroupStatus:{CREATED:"CREATED",CREATION_FAILED:"CREATION_FAILED",IN_PROGRESS:"IN_PROGRESS",DELETE_IN_PROGRESS:"DELETE_IN_PROGRESS",DELETED:"DELETED",DELETION_FAILED:"DELETION_FAILED"},AuthenticationType:{ANONYMOUS:"ANONYMOUS",SIMPLE:"SIMPLE"},TenantType:{DEFAULT:"DEFAULT",CAPEX:"CAPEX"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION",GET_OAUTH_DATA:"GET_OAUTH_DATA",GET_OAUTH_DATA_SESSION:"GET_OAUTH_DATA_SESSION"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_CONTACTS:"GOOGLE_CONTACTS",GOOGLE_DRIVE:"GOOGLE_DRIVE",ONE_DRIVE:"ONE_DRIVE",CLIENT_THIRDPARTY:"CLIENT_THIRDPARTY",ZAPIER:"ZAPIER",CONCEPTBOARD:"CONCEPTBOARD",MEISTERTASK:"MEISTERTASK",MS_SHAREPOINT:"MS_SHAREPOINT"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},MsGraphDataTypes:{FILE:"file",FOLDER:"folder",DRIVE:"drive",SITE:"site",CONTENT:"content",SUBSITES:"subsites"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST",GET_REGIONS:"GET_REGIONS",GET_JOINING_INSTRUCTIONS:"GET_JOINING_INSTRUCTIONS",VALIDATE_SESSION_PIN:"VALIDATE_SESSION_PIN"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK",STC:"STC",TEAM_PICKUP:"TEAM_PICKUP"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID",RENEW_ASSOCIATED_TELEPHONY_USER:"RENEW_ASSOCIATED_TELEPHONY_USER",ADD_ACCOUNT_PERMISSION:"ADD_ACCOUNT_PERMISSION",REMOVE_ACCOUNT_PERMISSION:"REMOVE_ACCOUNT_PERMISSION"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED",TC_BALANCING_NEEDED:"TC_BALANCING_NEEDED",TC_START_REASSIGNMENT:"TC_START_REASSIGNMENT"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_NAME:"BY_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG",TELEPHONY_USER_ID:"TELEPHONY_USER_ID",TELEPHONY_TRUNK_GROUP_ID:"TELEPHONY_TRUNK_GROUP_ID"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",ROLE_SYSTEM_USER:"ROLE_SYSTEM_USER",ROLE_SYSTEM:"ROLE_SYSTEM",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",SDK_ACCESS:"SDK_ACCESS",OAUTH_ACCESS_ENABLED:"OAUTH_ACCESS_ENABLED",SDK_USAGE_ENABLED:"SDK_USAGE_ENABLED",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",BASIC_AUTHENTICATION:"BASIC_AUTHENTICATION",ENTITY_ACCESS_DENIED:"ENTITY_ACCESS_DENIED",ROLE_BOT:"ROLE_BOT",NO_SECURITY_CONTEXT:"NO_SECURITY_CONTEXT",NO_OAUTH_SCOPE_ACCESS:"NO_OAUTH_SCOPE_ACCESS",MS_CONNECTOR:"MS_CONNECTOR",RTC_WHITE_BOARD:"RTC_WHITE_BOARD",SYSTEM_ANALYTICS:"SYSTEM_ANALYTICS",VENDOR_ANALYTICS:"VENDOR_ANALYTICS",TENANT_ANALYTICS:"TENANT_ANALYTICS",USER_ANALYTICS:"USER_ANALYTICS",UCAAS:"UCAAS",PARTNER_ADMIN:"PARTNER_ADMIN",DEVELOPER_CONSOLE_ACCESS:"DEVELOPER_CONSOLE_ACCESS",DEVELOPER_CONSOLE_VIEW:"DEVELOPER_CONSOLE_VIEW",DEVELOPER_CONSOLE_MANAGE_USER:"DEVELOPER_CONSOLE_MANAGE_USER",S4B_INTEGRATION:"S4B_INTEGRATION",TENANT_PRESENCE_SUBSCRIPTION:"TENANT_PRESENCE_SUBSCRIPTION",SCREEN_CONTROL:"SCREEN_CONTROL",CONCURRENT_VIDEO_CHANNELS:"CONCURRENT_VIDEO_CHANNELS",WORKFLOW_INTEGRATIONS:"WORKFLOW_INTEGRATIONS",CLV_SUPERADMIN:"CLV_SUPERADMIN",UCAAS_MLHG_QUEUING:"UCAAS_MLHG_QUEUING",DISTRIBUTOR_ANALYTICS:"DISTRIBUTOR_ANALYTICS",RESELLER_ANALYTICS:"RESELLER_ANALYTICS",CLV_ACCESS:"CLV_ACCESS",MAX_OAUTH_APPS:"MAX_OAUTH_APPS",MAX_OAUTH_BOTS:"MAX_OAUTH_BOTS",CREATE_TENANT:"CREATE_TENANT",MAX_INCOMING_WEBHOOKS:"MAX_INCOMING_WEBHOOKS",HD_VIDEO:"HD_VIDEO",HD_SCREENSHARE:"HD_SCREENSHARE",MAX_PRESENCE_SUBSCRIPTIONS:"MAX_PRESENCE_SUBSCRIPTIONS",SPACES:"SPACES",SPACE_CREATION:"SPACE_CREATION",SPACE_MASTER:"SPACE_MASTER",UCAAS_EA:"UCAAS_EA",IC_ONLY_USER:"IC_ONLY_USER",IC_MIXED_USER:"IC_MIXED_USER",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",EVENT_ORGANIZER_BASIC:"EVENT_ORGANIZER_BASIC",TEAM:"TEAM",ORGANIZE_EVENTS:"ORGANIZE_EVENTS",EVENT_ORGANIZER_XS:"EVENT_ORGANIZER_XS",EVENT_ORGANIZER_S:"EVENT_ORGANIZER_S",EVENT_ORGANIZER_M:"EVENT_ORGANIZER_M",EVENT_ORGANIZER_L:"EVENT_ORGANIZER_L",REST_ADMIN_API:"REST_ADMIN_API",VOICEMAIL:"VOICEMAIL",TRANSCRIPTION:"TRANSCRIPTION"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK",OK_NO_CHANGES:"OK_NO_CHANGES"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ActivityStreamItemType:{NAVIGABLE:"NAVIGABLE",SYSTEM:"SYSTEM"},NavigableStreamItemType:{MENTION:"MENTION",SPACES_MENTION:"SPACES_MENTION",SPACES_ADD:"SPACES_ADD",SPACES_REQUEST_ACCEPT:"SPACES_REQUEST_ACCEPT",SPACES_REQUEST_TO_JOIN:"SPACES_REQUEST_TO_JOIN",SPACES_USER_MASS_IMPORT:"SPACES_USER_MASS_IMPORT",SPACES_TAG_ADD:"SPACES_TAG_ADD",SPACES_TAG_REMOVE:"SPACES_TAG_REMOVE",TEAM_USER_INVITED_TO_JOIN:"TEAM_USER_INVITED_TO_JOIN",TEAM_USER_INVITATION_DECLINED:"TEAM_USER_INVITATION_DECLINED",TEAM_USER_INVITATION_ACCEPTED:"TEAM_USER_INVITATION_ACCEPTED",TEAM_USER_DELETED_FROM_TEAM:"TEAM_USER_DELETED_FROM_TEAM",TEAM_I_BELONG_TO_HAS_BEEN_DELETED:"TEAM_I_BELONG_TO_HAS_BEEN_DELETED",TEAM_USER_LEFT_TEAM:"TEAM_USER_LEFT_TEAM",MISSED_OUTCALL:"MISSED_OUTCALL",MISSED_OUTCALL_GUESTINVITE:"MISSED_OUTCALL_GUESTINVITE",SPACES_BEST_ANSWER_HAS_BEEN_EDITED:"SPACES_BEST_ANSWER_HAS_BEEN_EDITED",SPACES_BEST_ANSWER_HAS_BEEN_MARKED:"SPACES_BEST_ANSWER_HAS_BEEN_MARKED",SPACES_BEST_ANSWER_HAS_BEEN_UNMARKED:"SPACES_BEST_ANSWER_HAS_BEEN_UNMARKED",SPACES_BEST_ANSWER_HAS_BEEN_DELETED:"SPACES_BEST_ANSWER_HAS_BEEN_DELETED"},SystemStreamItemType:{REMOVED_FROM:"REMOVED_FROM",SPACES_REMOVE:"SPACES_REMOVE",SPACES_REQUEST_DECLINE:"SPACES_REQUEST_DECLINE"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},SpaceActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",CLEAR_NCA:"CLEAR_NCA",GET_NCA_DATA:"GET_NCA_DATA",EXISTS_SPACE_NAME:"EXISTS_SPACE_NAME",SET_GLOBAL_CONFIGURATION:"SET_GLOBAL_CONFIGURATION",GET_GLOBAL_CONFIGURATION:"GET_GLOBAL_CONFIGURATION",SET_FAVORITE_SPACE:"SET_FAVORITE_SPACE",REMOVE_FAVORITE_SPACE_MARKER:"REMOVE_FAVORITE_SPACE_MARKER",GET_FAVORITE_SPACES:"GET_FAVORITE_SPACES",GET_SPACES:"GET_SPACES",GET_SPACES_BY_IDS:"GET_SPACES_BY_IDS",SEARCH_TAGS:"SEARCH_TAGS",GET_DIRECTORY:"GET_DIRECTORY",GET_ADMIN_DIRECTORY:"GET_ADMIN_DIRECTORY",SELECT_SPACE:"SELECT_SPACE",GET_PARTICIPANTS_IMPORT_DATA:"GET_PARTICIPANTS_IMPORT_DATA",GET_SPACE_PREVIEW_DATA:"GET_SPACE_PREVIEW_DATA",ADD_PARTICIPANTS:"ADD_PARTICIPANTS",ADD_PARTICIPANTS_SEARCH:"ADD_PARTICIPANTS_SEARCH",UPDATE_PARTICIPANT:"UPDATE_PARTICIPANT",REMOVE_PARTICIPANTS:"REMOVE_PARTICIPANTS",IMPORT_PARTICIPANTS:"IMPORT_PARTICIPANTS",GET_PARTICIPANTS:"GET_PARTICIPANTS",GET_PENDING_PARTICIPANTS:"GET_PENDING_PARTICIPANTS",SEARCH_SPACE_PARTICIPANTS:"SEARCH_SPACE_PARTICIPANTS",JOIN:"JOIN",LEAVE:"LEAVE",REQUEST_ACCESS:"REQUEST_ACCESS",GRANT_ACCESS:"GRANT_ACCESS",DENY_ACCESS:"DENY_ACCESS",IS_EXTERNAL_PARTICIPANT_IN_SPACE:"IS_EXTERNAL_PARTICIPANT_IN_SPACE",UPDATE_READ_TIMESTAMP:"UPDATE_READ_TIMESTAMP",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_TOPICS:"GET_TOPICS",GET_TOPIC_WITH_REPLIES:"GET_TOPIC_WITH_REPLIES",GET_POLL_WITH_REPLIES:"GET_POLL_WITH_REPLIES",GET_OPEN_POLLS:"GET_OPEN_POLLS",GET_OPEN_QUESTIONS:"GET_OPEN_QUESTIONS",GET_REPLIES:"GET_REPLIES",GET_MATCHING_REPLIES:"GET_MATCHING_REPLIES",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",CREATE_TOPIC:"CREATE_TOPIC",CREATE_POLL:"CREATE_POLL",CREATE_QUESTION:"CREATE_QUESTION",VOTE_POLL_OPTIONS:"VOTE_POLL_OPTIONS",GET_POLL_OPTION_VOTERS:"GET_POLL_OPTION_VOTERS",MARK_BEST_ANSWER:"MARK_BEST_ANSWER",UNMARK_BEST_ANSWER:"UNMARK_BEST_ANSWER",CREATE_REPLY:"CREATE_REPLY",UPDATE_TOPIC:"UPDATE_TOPIC",UPDATE_POLL:"UPDATE_POLL",UPDATE_QUESTION:"UPDATE_QUESTION",UPDATE_REPLY:"UPDATE_REPLY",DELETE_ITEM:"DELETE_ITEM",GET_LIKES:"GET_LIKES",LIKE:"LIKE",UNLIKE:"UNLIKE",FLAG:"FLAG",UNFLAG:"UNFLAG",GET_FLAGGED_ITEMS_COUNT:"GET_FLAGGED_ITEMS_COUNT",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID:"GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID",PIN_TOPIC:"PIN_TOPIC",UNPIN_TOPIC:"UNPIN_TOPIC",GET_PINNED_TOPICS:"GET_PINNED_TOPICS",SET_WELCOME_BOX:"SET_WELCOME_BOX",GET_WELCOME_BOX:"GET_WELCOME_BOX",DELETE_WELCOME_BOX:"DELETE_WELCOME_BOX",GET_SPACE_FILES:"GET_SPACE_FILES",UPDATE_TOPIC_TAGS:"UPDATE_TOPIC_TAGS",CLOSE_POLL:"CLOSE_POLL",START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAILED_SEARCH:"START_DETAILED_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",CREATE_WIKI:"CREATE_WIKI",GET_WIKI_PAGE:"GET_WIKI_PAGE",GET_WIKI_PAGE_WITH_CONTENT:"GET_WIKI_PAGE_WITH_CONTENT",CREATE_WIKI_PAGE:"CREATE_WIKI_PAGE",LOCK_WIKI_PAGE_CONTENT:"LOCK_WIKI_PAGE_CONTENT",UNLOCK_WIKI_PAGE_CONTENT:"UNLOCK_WIKI_PAGE_CONTENT",UPDATE_WIKI_PAGE_CONTENT:"UPDATE_WIKI_PAGE_CONTENT",DELETE_WIKI_PAGE:"DELETE_WIKI_PAGE",MOVE_WIKI_PAGE:"MOVE_WIKI_PAGE",GET_WIKI_PAGE_STRUCTURE:"GET_WIKI_PAGE_STRUCTURE"},SpaceEventType:{IMPORT_PARTICIPANTS:"IMPORT_PARTICIPANTS",NCA:"NCA",SPACE_UPDATED:"SPACE_UPDATED",SPACE_DELETED:"SPACE_DELETED",ITEM_CREATED:"ITEM_CREATED",ITEM_UPDATED:"ITEM_UPDATED",ITEM_DELETED:"ITEM_DELETED",FLAGGED:"FLAGGED",UNFLAGGED:"UNFLAGGED",LIKED:"LIKED",UNLIKED:"UNLIKED",BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED",SEARCH_STATUS:"SEARCH_STATUS",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",LOCKED_WIKI_PAGE_CONTENT:"LOCKED_WIKI_PAGE_CONTENT",UNLOCKED_WIKI_PAGE_CONTENT:"UNLOCKED_WIKI_PAGE_CONTENT"},SpaceParticipantRole:{MODERATOR:"MODERATOR",AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",READER:"READER"},SpaceParticipantDefaultRole:{AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",READER:"READER"},SpaceParticipantState:{ACTIVE:"ACTIVE",PENDING:"PENDING"},SpaceParticipantAccessType:{INTERNAL:"INTERNAL",EXTERNAL:"EXTERNAL"},SpaceType:{OPEN:"OPEN",CLOSED:"CLOSED",SECRET:"SECRET"},SpaceAccessModeType:{INTERNAL_ONLY:"INTERNAL_ONLY",INTERNAL_EXTERNAL:"INTERNAL_EXTERNAL"},SpaceStatus:{ENABLED:"ENABLED",DISABLED:"DISABLED"},SpaceWikiStatus:{ENABLED:"ENABLED",DISABLED:"DISABLED"},SpaceItemStatus:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED"},SpacePollStatus:{OPEN:"OPEN",CLOSED:"CLOSED"},SpaceItemType:{TOPIC:"TOPIC",REPLY:"REPLY",WELCOME_BOX:"WELCOME_BOX",POLL:"POLL",QUESTION:"QUESTION",WIKI_PAGE_CONTENT:"WIKI_PAGE_CONTENT"},SpacesAdminDirectorySortBy:{LAST_CONTENT:"LAST_CONTENT",SPACE_NAME:"SPACE_NAME",NUMBER_OF_USERS:"NUMBER_OF_USERS",CREATION_DATE:"CREATION_DATE"},SpaceOwnerType:{OWNED:"OWNED",NOT_OWNED:"NOT_OWNED"},SpacesAdminDirectoryFilterCriteria:{OWNER:"OWNER",ACCESS_MODE_TYPE:"ACCESS_MODE_TYPE",SPACE_TYPE:"SPACE_TYPE",SPACE_STATUS:"SPACE_STATUS"},SpacesDirectorySortBy:{LAST_CONTENT:"LAST_CONTENT",NAME:"NAME",NUMBER_OF_USERS:"NUMBER_OF_USERS"},SpacesDirectoryFilter:{JOINED:"JOINED",REQUESTED:"REQUESTED",OPEN:"OPEN",CLOSED:"CLOSED",NOT_JOINED_REQUESTED:"NOT_JOINED_REQUESTED"},SpaceFilterCriterion:{ALL:"ALL",MY_MODERATED:"MY_MODERATED"},SpaceFilesSortBy:{FILE_NAME:"FILE_NAME",CREATION_TIME:"CREATION_TIME",FILE_SIZE:"FILE_SIZE",MIME_TYPE:"MIME_TYPE",FILE_EXTENSION:"FILE_EXTENSION"},SpaceAddParticipantsResult:{PARTICIPANT_ADDED:"PARTICIPANT_ADDED",ALREADY_MEMBER:"ALREADY_MEMBER",USER_DOES_NOT_EXIST:"USER_DOES_NOT_EXIST",INTERNAL_ONLY:"INTERNAL_ONLY",BLOCKED:"BLOCKED",ERROR:"ERROR"},SpaceSearchScope:{ALL:"ALL",SPACES:"SPACES",TOPICBY:"TOPICBY",FILES:"FILES",TAGS:"TAGS",LABEL:"LABEL",DATE:"DATE"},SpacesParticipantsFilter:{ALL:"ALL",MODERATOR:"MODERATOR",READER:"READER",AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",INTERNAL:"INTERNAL",EXTERNAL:"EXTERNAL"},SpaceParticipantsFilterCriteria:{ACCESS_TYPE:"ACCESS_TYPE",ROLE:"ROLE",STATE:"STATE"},SpaceParticipantsSortBy:{DISPLAY_NAME:"DISPLAY_NAME",NAME:"NAME",FIRST_NAME:"FIRST_NAME"},SpacePermissionAddParticipant:{MODERATORS_ONLY:"MODERATORS_ONLY",INTERNAL_MEMBERS:"INTERNAL_MEMBERS"},SpaceMassImportStatus:{NO_IMPORT:"NO_IMPORT",IMPORT_SCHEDULED:"IMPORT_SCHEDULED",IMPORT_RUNNING:"IMPORT_RUNNING",IMPORT_FINISHED_SUCCESS:"IMPORT_FINISHED_SUCCESS",IMPORT_INVALID_FILE_FORMAT:"IMPORT_INVALID_FILE_FORMAT",IMPORT_FINISHED_FAILURE_SYSTEM_RESTART:"IMPORT_FINISHED_FAILURE_SYSTEM_RESTART",IMPORT_FINISHED_FAILURE:"IMPORT_FINISHED_FAILURE"},SpaceMassImportErrors:{IMPORT_ILLEGAL_ARGUMENTS:"SPACE-00048C",IMPORT_FILE_DOES_NOT_EXIST:"SPACE-00049C",IMPORT_FILEHUB_DOWNLOAD_ERROR:"SPACE-00050C",IMPORT_UNZIP_ERROR:"SPACE-00051C",IMPORT_INVALID_CONTENT:"SPACE-00052C",IMPORT_INVALID_DATA:"SPACE-00053C",IMPORT_INTERNAL_ERROR:"SPACE-00054C",IMPORT_RUNNING:"SPACE-00055C"},SpacePermissionAddWiki:{MODERATORS_ONLY:"MODERATORS_ONLY",MODERATORS_AUTHORS:"MODERATORS_AUTHORS"},CPaaSActionType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA",GET_OAUTH_APPLICATIONS:"GET_OAUTH_APPLICATIONS",CREATE_OAUTH_APPLICATION:"CREATE_OAUTH_APPLICATION",GET_OAUTH_APPLICATION:"GET_OAUTH_APPLICATION",DELETE_OAUTH_APPLICATION:"DELETE_OAUTH_APPLICATION",SUSPEND_OAUTH_APPLICATION:"SUSPEND_OAUTH_APPLICATION",UNSUSPEND_OAUTH_APPLICATION:"UNSUSPEND_OAUTH_APPLICATION",UPDATE_OAUTH_APPLICATION:"UPDATE_OAUTH_APPLICATION",RECREATE_CLIENT_SECRET:"RECREATE_CLIENT_SECRET",DELETE_USER_FROM_OAUTH_APPLICATION:"DELETE_USER_FROM_OAUTH_APPLICATION",ADD_USER_TO_OAUTH_APPLICATION:"ADD_USER_TO_OAUTH_APPLICATION",GET_TENANT_BOTS:"GET_TENANT_BOTS",CREATE_INCOMING_WEBHOOK:"CREATE_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOK:"GET_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOKS:"GET_INCOMING_WEBHOOKS",UPDATE_INCOMING_WEBHOOK:"UPDATE_INCOMING_WEBHOOK",DELETE_INCOMING_WEBHOOK:"DELETE_INCOMING_WEBHOOK",SUSPEND_INCOMING_WEBHOOK:"SUSPEND_INCOMING_WEBHOOK",UNSUSPEND_INCOMING_WEBHOOK:"UNSUSPEND_INCOMING_WEBHOOK",GET_OAUTHSCOPE_LIST:"GET_OAUTHSCOPE_LIST",GET_TENANT_INTEGRATIONS:"GET_TENANT_INTEGRATIONS",ENABLE_TENANT_INTEGRATION:"ENABLE_TENANT_INTEGRATION",DISABLE_TENANT_INTEGRATION:"DISABLE_TENANT_INTEGRATION",GET_CONVERSATION_INTEGRATIONS:"GET_CONVERSATION_INTEGRATIONS",ENABLE_CONVERSATION_INTEGRATION:"ENABLE_CONVERSATION_INTEGRATION",UPDATE_CONVERSATION_INTEGRATION:"UPDATE_CONVERSATION_INTEGRATION",DISABLE_CONVERSATION_INTEGRATION:"DISABLE_CONVERSATION_INTEGRATION",GET_INTEGRATION_DATA:"GET_INTEGRATION_DATA"},CPaaSEventType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA",INTEGRATION_STATE_CHANGED:"INTEGRATION_STATE_CHANGED"},CPaaSFormMetaDataControlType:{LABEL:"LABEL",BUTTON:"BUTTON",RADIO:"RADIO",CHECKBOX:"CHECKBOX",DROPDOWN:"DROPDOWN",INPUT:"INPUT",SPACER:"SPACER"},CPasSIntegrationStateChangedReason:{ENABLED:"ENABLED",DISABLED:"DISABLED",STARTUP:"STARTUP",SHUTDOWN:"SHUTDOWN",ENABLE_FAILED:"ENABLE_FAILED",DISABLE_FAILED:"DISABLE_FAILED"},CPasSIncomingWebhookFilter:{TENANT:"TENANT",USER:"USER",CONVERSATION:"CONVERSATION"},TenantIntegrationState:{ACTIVE:"ACTIVE",DISABLED:"DISABLED",SHUTDOWN:"SHUTDOWN",STARTUP:"STARTUP"},IntegrationKeys:{MEISTERTASK:"MEISTERTASK",INCOMING_WEBHOOKS:"INCOMING-WEBHOOKS"},MeistertaskIntegrationType:{GET_USER_PROJECTS:"GET_USER_PROJECTS"},TeamActionType:{CREATE_TEAM:"CREATE_TEAM",UPDATE_TEAM:"UPDATE_TEAM",DELETE_TEAM:"DELETE_TEAM",GET_TEAMS:"GET_TEAMS",GET_TEAMS_BY_IDS:"GET_TEAMS_BY_IDS",INVITE_MEMBER:"INVITE_MEMBER",REMOVE_MEMBER:"REMOVE_MEMBER",ACCEPT_INVITATION:"ACCEPT_INVITATION",DECLINE_INVITATION:"DECLINE_INVITATION",LEAVE_TEAM:"LEAVE_TEAM",CHANGE_MEMBER_ROLE:"CHANGE_MEMBER_ROLE"},TeamEventType:{NOTIFY:"NOTIFY",NOTIFY_CANCEL:"NOTIFY_CANCEL",TEAM_CREATED:"TEAM_CREATED",TEAM_UPDATED:"TEAM_UPDATED",TEAM_DELETED:"TEAM_DELETED",TEAM_MEMBERSHIP_CHANGED:"TEAM_MEMBERSHIP_CHANGED"},MemberResultCode:{SUCCESS:"SUCCESS",ERROR:"ERROR",USER_ID_DOES_NOT_EXIST:"USER_ID_DOES_NOT_EXIST",USER_IS_SUSPENDED:"USER_IS_SUSPENDED",USER_IS_ALREADY_A_MEMBER:"USER_IS_ALREADY_A_MEMBER",TEAMS_PER_USER_LIMIT_REACHED:"TEAMS_PER_USER_LIMIT_REACHED",USER_IS_NOT_A_MEMBER:"USER_IS_NOT_A_MEMBER"},MemberStatus:{INVITED:"INVITED",ACCEPTED:"ACCEPTED",DECLINED:"DECLINED",PENDING:"PENDING",FAILED:"FAILED"},MemberRole:{MEMBER:"MEMBER",OWNER:"OWNER"},LabFeatureName:{ACTIVE_WHITEBOARD:"ACTIVE_WHITEBOARD",ADD_CMR_NEW_FLOW:"ADD_CMR_NEW_FLOW",ADD_CMR_VIA_QR_CODE:"ADD_CMR_VIA_QR_CODE",ANDROID_STRICT_MODE:"ANDROID_STRICT_MODE",ANR_WATCHDOG:"ANR_WATCHDOG",ANSWER_CALL_SCREEN:"ANSWER_CALL_SCREEN",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",CALL_FORWARD_NO_REPLY:"CALL_FORWARD_NO_REPLY",CMR_CONTROL_PANEL:"CMR_CONTROL_PANEL",CONFERENCE_POLL:"CONFERENCE_POLL",DARK_MODE:"DARK_MODE",DISABLE_CALL_KIT:"DISABLE_CALL_KIT",ENHANCED_AUTOMATED_ATTENDANT:"ENHANCED_AUTOMATED_ATTENDANT",FAVORITE_A_SPACE:"FAVORITE_A_SPACE",FCM_FOREGROUND_SERVICE:"FCM_FOREGROUND_SERVICE",FLOATING_ONGOING_CALL_CONTROL:"FLOATING_ONGOING_CALL_CONTROL",INTERNAL_DOWNLOAD_AREA:"INTERNAL_DOWNLOAD_AREA",IN_MEETING_STATUS:"IN_MEETING_STATUS",IOS13_PUSH_NOTIFICATIONS:"IOS13_PUSH_NOTIFICATIONS",JABRA_NODE_MODULE_SDK:"JABRA_NODE_MODULE_SDK",LANDSCAPE_MODE:"LANDSCAPE_MODE",LEAK_CANARY:"LEAK_CANARY",LOCK_SCREEN_CALL_CONTROL:"LOCK_SCREEN_CALL_CONTROL",MEISTER_TASK_INTEGRATION:"MEISTER_TASK_INTEGRATION",MS_TEAMS:"MS_TEAMS",ORGANISE_CONTENT:"ORGANISE_CONTENT",OUTLOOK_365:"OUTLOOK_365",PHONE_ONLY_AND_SHARED_DEVICES:"PHONE_ONLY_AND_SHARED_DEVICES",PROFILE_TAGS:"PROFILE_TAGS",SCOPE_SEARCHES:"SCOPE_SEARCHES",SECOND_LOCAL_CALL:"SECOND_LOCAL_CALL",SHAREPOINT_ONLINE:"SHAREPOINT_ONLINE",SIMULCAST:"SIMULCAST",SPACES_FILTER_AND_LABELS:"SPACES_FILTER_AND_LABELS",SPACES_FLAGGING:"SPACES_FLAGGING",SPACES_HASHTAGS:"SPACES_HASHTAGS",SPACES_PAGES:"SPACES_PAGES",SPACES_POLLING:"SPACES_POLLING",SPACES_QUESTIONS:"SPACES_QUESTIONS",STARTED_MEETING_SUMMARY:"STARTED_MEETING_SUMMARY",TENANT_ADMIN_USER_TABLE_ENHANCEMENT:"TENANT_ADMIN_USER_TABLE_ENHANCEMENT",TRANSCRIPTION_AND_TRANSLATION:"TRANSCRIPTION_AND_TRANSLATION",UCAAS_PHONES_LDAP_SETTINGS:"UCAAS_PHONES_LDAP_SETTINGS",UCAAS_SHARED_TRUNKS:"UCAAS_SHARED_TRUNKS",UNIFIED_CONVERSATION_CREATION:"UNIFIED_CONVERSATION_CREATION",WEBRTC_DEBUG_LOGGING:"WEBRTC_DEBUG_LOGGING",WEBRTC_ICE_OPTIMIZATION:"WEBRTC_ICE_OPTIMIZATION"},MeetingRoomFeatureName:{DISPLAY_MULTIPLE_VIDEO_STREAMS:"DISPLAY_MULTIPLE_VIDEO_STREAMS",CONFERENCE_POLL:"CONFERENCE_POLL"},DraftType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE",PRIVATE:"PRIVATE",BRIDGE:"BRIDGE",EXPERT:"EXPERT"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",EXPERT:"EXPERT"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",AUDIO_DEVICE:"AUDIO_DEVICE",VIDEO_INPUT:"VIDEO_INPUT"},RecordingState:{IDLE:"IDLE",LISTENING:"LISTENING",PROCESSING:"PROCESSING"},TranscriptionError:{RECORDING_NOT_SUPPORTED:"RECORDING_NOT_SUPPORTED",RECORDING_NOT_STARTED:"RECORDING_NOT_STARTED",RECORDING_IN_PROGRESS:"RECORDING_IN_PROGRESS",RECORDING_ABORTED:"RECORDING_ABORTED",INVALID_CALL:"INVALID_CALL",INVALID_PROVIDER:"INVALID_PROVIDER"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY",PBX_CALL_LOG:"PBX_CALL_LOG"},StcCapabilities:{STC_TRANSFER:"STC_TRANSFER",STC_MERGE:"STC_MERGE"},TcAvailableFeatures:{HOLD:"HOLD",CONSULTATION:"CONSULTATION",MERGE:"MERGE",TRANSFER:"TRANSFER"}}),a=(n=/^\|\|::\$\$privateData=({.*})::\|\|/,{SUPPORTED_PRIVATE_DATA_FIELDS:t=["conceptboards","rtcInstanceId"],convertPrivateDataToContent:function(e,n){if(!e)return"";n=n||[];var i={};if(t.forEach((function(t){void 0===e[t]||null===e[t]||n.includes(t)||(i[t]=e[t])})),r.isEmptyObject(i))return"";var o=JSON.stringify(i);return o=r.textToHtmlEscaped(o),"||::$$privateData=%%1::||".replace("%%1",o)},retrievePrivateDataFromContent:function(e){if(e&&e.text)try{if(t.forEach((function(t){void 0===e[t]&&(e[t]=null)})),!e.text.content)return;var o=n.exec(e.text.content);if(o&&o[0]){e.text.content=e.text.content.slice(o[0].length);var a=o[1];if(a){a=r.escapedHtmlToText(a);var s=JSON.parse(a);t.forEach((function(t){void 0!==s[t]&&(e[t]=s[t])}))}}}catch(e){i.error("[Proto]: Failed to retrieve private data. ",e)}}}),s={requestNr:0,normalizeWhiteboard:function(t){e.isSDK&&t&&("boolean"==typeof t.backround?t.background=t.backround:"boolean"==typeof t.background?t.backround=t.background:(t.background=!1,t.backround=!1))},Request:function(e,t,n){s.requestNr++;var i={msgType:o.WSMessageType.REQUEST,request:{requestId:s.requestNr,type:e}};switch(n&&(i.request.tenantContext=n),e){case o.ContentType.CONVERSATION:i.request.conversation=t;break;case o.ContentType.USER:i.request.user=t;break;case o.ContentType.RTC_CALL:i.request.rtcCall=t;break;case o.ContentType.RTC_SESSION:i.request.rtcSession=t;break;case o.ContentType.SEARCH:i.request.search=t;break;case o.ContentType.INSTRUMENTATION:i.request.instrumentation=t;break;case o.ContentType.ADMINISTRATION:i.request.administration=t;break;case o.ContentType.SYSTEM:i.request.system=t;break;case o.ContentType.THIRDPARTYCONNECTORS:i.request.thirdpartyconnectors=t;break;case o.ContentType.GUEST:i.request.guest=t;break;case o.ContentType.USER_TO_USER:i.request.userToUser=t;break;case o.ContentType.VERSION:i.request.version=t;break;case o.ContentType.ACCOUNT:i.request.account=t;break;case o.ContentType.ACTIVITYSTREAM:i.request.activityStream=t;break;case o.ContentType.SPACE:i.request.space=t;break;case o.ContentType.CPAAS:i.request.cpaas=t;break;case o.ContentType.USER_DATA:i.request.userData=t;break;case o.ContentType.TEAM:i.request.team=t}return i},ParseEvent:function(e,t){var n,i={};switch(e.type){case o.ContentType.CONVERSATION:switch(n="Conversation."+e.conversation.type,e.conversation.type){case o.ConversationEventType.CREATE:i=e.conversation.create;break;case o.ConversationEventType.UPDATE:i=e.conversation.update;break;case o.ConversationEventType.ADD_ITEM:i=e.conversation.addItem;break;case o.ConversationEventType.ADD_PARTICIPANT:i=e.conversation.addParticipant;break;case o.ConversationEventType.UPDATE_ITEM:i=e.conversation.updateItem;break;case o.ConversationEventType.READ_ITEMS:i=e.conversation.readItems;break;case o.ConversationEventType.TYPING:i=e.conversation.typing;break;case o.ConversationEventType.DRAFT_MESSAGE_SAVED:case o.ConversationEventType.DRAFT_MESSAGE_DISCARDED:case o.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:i=e.conversation.draftMessage;break;case o.ConversationEventType.FLAG_ITEM:i=e.conversation.setFlagItem;break;case o.ConversationEventType.CLEAR_FLAGGED_ITEM:i=e.conversation.clearFlaggedItem;break;case o.ConversationEventType.CONVERSATION_MARKED:i=e.conversation.conversationMarked;break;case o.ConversationEventType.CONVERSATION_UNMARKED:i=e.conversation.conversationUnmarked;break;case o.ConversationEventType.FAVORITE_POSITION_CHANGED:i=e.conversation.favoritePositionChangedEvent;break;case o.ConversationEventType.USER_DATA_CHANGED:i=e.conversation.userDataChangedEvent;break;case o.ConversationEventType.JOURNAL_ENTRY_DELETED:i=e.conversation.journalEntryDeletedEvent;break;case o.ConversationEventType.ALL_JOURNAL_ENTRIES_DELETED:i=e.conversation.allJournalEntriesDeleted}i.convId=e.conversation.convId;break;case o.ContentType.USER:switch(n="User."+e.user.type,e.user.type){case o.UserEventType.USER_PRESENCE_CHANGE:i=e.user.presenceChanged;break;case o.UserEventType.USER_UPDATED:i=e.user.userUpdated;break;case o.UserEventType.SESSION_CLOSED:i=e.user.sessionClosed;break;case o.UserEventType.PASSWORD_CHANGED:i=e.user.passwordChanged;break;case o.UserEventType.USER_SETTING_UPDATED:i=e.user.userSettingUpdated;break;case o.UserEventType.TELEPHONY_DATA:i=e.user.telephonyData;break;case o.UserEventType.DEVICE_LIST_CHANGED:i=e.user.deviceListChangedEvent;break;case o.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:i=e.user.notificationSubscriptionChange;break;case o.UserEventType.TENANT_CONFIGURATION_UPDATED:i=e.user.tenantConfigurationUpdatedEvent;break;case o.UserEventType.TENANT_PRESENCE_CHANGE:i=e.user.tenantPresenceChanged;break;case o.UserEventType.CMR_SETTINGS_UPDATED:i=e.user.cmrSettingsUpdatedEvent;break;case o.UserEventType.CMR_COMMAND:i=e.user.cmrCommandEvent;break;case o.UserEventType.TELEPHONY_CHANGED:i=e.user.telephonyChangedEvent;break;case o.UserEventType.TELEPHONY_PROVIDER_UPDATED:i=e.user.telephonyProviderEvent;break;case o.UserEventType.EAGROUP_STATUS_CHANGED:i=e.user.executiveAssistantGroupEvent}i.userId=e.user.userId;break;case o.ContentType.RTC_CALL:switch(n="RTCCall."+e.rtcCall.type,e.rtcCall.type){case o.RTCCallEventType.SDP_ANSWER:i=e.rtcCall.sdpAnswer;break;case o.RTCCallEventType.SDP_FAILED:i=e.rtcCall.sdpFailed;break;case o.RTCCallEventType.INVITE:i=e.rtcCall.invite;break;case o.RTCCallEventType.INVITE_CANCEL:i=e.rtcCall.inviteCancel;break;case o.RTCCallEventType.INVITE_FAILED:i=e.rtcCall.inviteFailed;break;case o.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:i=e.rtcCall.changeMediaRequested;break;case o.RTCCallEventType.PROGRESS:i=e.rtcCall.participantProgress;break;case o.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:i=e.rtcCall.changeMediaTypeForcedEvent;break;case o.RTCCallEventType.ICE_CANDIDATES:i=e.rtcCall.iceCandidates;break;case o.RTCCallEventType.RTC_QUALITY_RATING_EVENT:i=e.rtcCall.ratingEvent;break;case o.RTCCallEventType.IFRAME_STATISTICS:i=e.rtcCall.iFrameStatisticsEvent}i.sessionId=e.rtcCall.sessionId,i.instanceId=e.rtcCall.instanceId;break;case o.ContentType.RTC_SESSION:switch(n="RTCSession."+e.rtcSession.type,e.rtcSession.type){case o.RTCSessionEventType.SESSION_STARTED:i=e.rtcSession.sessionStarted;break;case o.RTCSessionEventType.SESSION_TERMINATED:i=e.rtcSession.sessionTerminated;break;case o.RTCSessionEventType.SESSION_UPDATED:i=e.rtcSession.sessionUpdated;break;case o.RTCSessionEventType.SESSION_MOVED:i=e.rtcSession.sessionMoved;break;case o.RTCSessionEventType.PARTICIPANT_JOINED:i=e.rtcSession.participantJoined;break;case o.RTCSessionEventType.PARTICIPANT_LEFT:i=e.rtcSession.participantLeft;break;case o.RTCSessionEventType.PARTICIPANT_UPDATED:i=e.rtcSession.participantUpdated;break;case o.RTCSessionEventType.ACTIVE_SPEAKER:i=e.rtcSession.speaker;break;case o.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:i=e.rtcSession.videoSpeaker;break;case o.RTCSessionEventType.SESSION_RECORDING_INFO:i=e.rtcSession.sessionRecordingInfo;break;case o.RTCSessionEventType.SESSION_RECORDING_STARTED:i=e.rtcSession.sessionRecordingStarted;break;case o.RTCSessionEventType.SESSION_RECORDING_STOPPED:i=e.rtcSession.sessionRecordingStopped;break;case o.RTCSessionEventType.SESSION_RECORDING_FAILED:i=e.rtcSession.sessionRecordingFailed;break;case o.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:i=e.rtcSession.sessionTerminationTimerStarted;break;case o.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:i=e.rtcSession.sessionTerminationTimerCancelled;break;case o.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:i=e.rtcSession.sessionAttributesChangedEvent;break;case o.RTCSessionEventType.QUESTION_EVENT:i=e.rtcSession.questionEvent;break;case o.RTCSessionEventType.INVITE_TO_STAGE_EVENT:i=e.rtcSession.inviteToStageEvent;break;case o.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:i=e.rtcSession.inviteToStageCancelEvent;break;case o.RTCSessionEventType.CURTAIN_EVENT:i=e.rtcSession.curtainEvent;break;case o.RTCSessionEventType.WHITEBOARD_ENABLED:i=e.rtcSession.whiteboardEnabled,s.normalizeWhiteboard(i.whiteboard,t);break;case o.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:i=e.rtcSession.whiteboardElementAdded;break;case o.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:i=e.rtcSession.whiteboardElementRemoved;break;case o.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:i=e.rtcSession.whiteboardElementUpdated;break;case o.RTCSessionEventType.WHITEBOARD_CLEARED:i=e.rtcSession.whiteboardCleared;break;case o.RTCSessionEventType.WHITEBOARD_BACKGROUND_SET:i=e.rtcSession.whiteboardBackgroundSet;break;case o.RTCSessionEventType.WHITEBOARD_SYNC:i=e.rtcSession.whiteboardSync,s.normalizeWhiteboard(i.whiteboard,t);break;case o.RTCSessionEventType.WHITEBOARD_CONVERSION_FAILED:i=e.rtcSession.whiteboardConversionFailed;break;case o.RTCSessionEventType.SCREEN_CONTROL_REQUESTED:i=e.rtcSession.screenControlRequested;break;case o.RTCSessionEventType.SCREEN_CONTROL_OFFERED:i=e.rtcSession.screenControlOffered;break;case o.RTCSessionEventType.SCREEN_CONTROL_ACCEPTED:i=e.rtcSession.screenControlAccepted;break;case o.RTCSessionEventType.HANDOVER_SCREEN_CONTROL:i=e.rtcSession.handoverScreenControl;break;case o.RTCSessionEventType.POLL_ENABLED:i=e.rtcSession.pollEnabledEvent;break;case o.RTCSessionEventType.POLL_STARTED:i=e.rtcSession.pollStartedEvent;break;case o.RTCSessionEventType.POLL_STOPPED:i=e.rtcSession.pollStoppedEvent;break;case o.RTCSessionEventType.POLL_UPDATED:i=e.rtcSession.pollUpdatedEvent;break;case o.RTCSessionEventType.POLL_EXPORTED:i=e.rtcSession.pollExportedEvent;break;case o.RTCSessionEventType.LIVE_TRANSCRIPTION:i=e.rtcSession.liveTranscriptionEvent}i.sessionId=e.rtcSession.sessionId;break;case o.ContentType.SEARCH:switch(n="Search."+e.search.type,e.search.type){case o.SearchEventType.BASIC_SEARCH_RESULT:i=e.search.basicSearchResult;break;case o.SearchEventType.DETAILED_SEARCH_RESULT:i=e.search.detailSearchResult;break;case o.SearchEventType.SEARCH_STATUS:i=e.search.searchStatus;break;case o.SearchEventType.RECENT_SEARCH_ADDED:i=e.search.recentSearchAdded}i.searchId=e.search.searchId;break;case o.ContentType.SYSTEM:switch(n="System."+e.system.type,e.system.type){case o.SystemEventType.BROADCAST:(i=e.system.systemNotificationEvent).eventId=e.system.eventId;break;case o.SystemEventType.MAINTENANCE:case o.SystemEventType.MAINTENANCE_ADDED:(i=e.system.maintenance).eventId=e.system.eventId;break;case o.SystemEventType.BROADCAST_REMOVED:case o.SystemEventType.MAINTENANCE_REMOVED:i=e.system.eventId}break;case o.ContentType.ADMINISTRATION:switch(n="Administration."+e.administration.type,e.administration.type){case o.AdministrationEventType.INVITE_MULTIPLE_USERS:i=e.administration.inviteMultipleUsers;break;case o.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:i=e.administration.inviteMultiplePartnerUsers}break;case o.ContentType.THIRDPARTYCONNECTORS:switch(n="ThirdParty."+e.thirdParty.type,e.thirdParty.type){case o.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:i=e.thirdParty;break;case o.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:i=e.thirdParty.provider}break;case o.ContentType.USER_TO_USER:n="UserToUser."+e.userToUser.userToUser.type,(i=e.userToUser.userToUser).routing=e.userToUser.routing;break;case o.ContentType.ACTIVITYSTREAM:switch(n="ActivityStream."+e.activity.type,e.activity.type){case o.ActivityStreamEventType.ACTIVITY_CREATED:i=e.activity.create.item;break;case o.ActivityStreamEventType.ACTIVITY_DELETED:i=e.activity.delete.item;break;case o.ActivityStreamEventType.ACTIVITY_MARKED_READ:i=e.activity.markRead.itemId;break;case o.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:i=e.activity.markUnread.itemId;break;case o.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:i=e.activity.markAllRead.status}break;case o.ContentType.ACCOUNT:switch(n="Account."+e.account.type,e.account.type){case o.AccountEventType.MIGRATE_MULTIPLE_USERS:i=e.account.migrateMultipleUsers;break;case o.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:i=e.account.telephonyConfigurationUpdated;break;case o.AccountEventType.TC_START_REASSIGNMENT:i=e.account.tcStartReassignment}break;case o.ContentType.CONVERSATION_USER_DATA:switch(n="ConversationUserData."+e.conversationUserData.type,e.conversationUserData.type){case o.ConversationUserDataEventType.LABELS_ADDED:i=e.conversationUserData.labelsAdded;break;case o.ConversationUserDataEventType.LABELS_REMOVED:i=e.conversationUserData.labelsRemoved;break;case o.ConversationUserDataEventType.LABEL_EDITED:i=e.conversationUserData.labelEdited;break;case o.ConversationUserDataEventType.FILTERS_REMOVED:i=e.conversationUserData.filtersRemoved;break;case o.ConversationUserDataEventType.FILTER_ADDED:i=e.conversationUserData.filterAdded;break;case o.ConversationUserDataEventType.FILTER_EDITED:i=e.conversationUserData.filterEdited}break;case o.ContentType.SPACE:switch(n="Space."+e.space.type,e.space.type){case o.SpaceEventType.IMPORT_PARTICIPANTS:i=e.space.importParticipant;break;case o.SpaceEventType.NCA:i=e.space.nca;break;case o.SpaceEventType.SPACE_UPDATED:i=e.space.spaceUpated;break;case o.SpaceEventType.SPACE_DELETED:i=e.space.spaceDeleted;break;case o.SpaceEventType.ITEM_CREATED:i=e.space.itemCreated;break;case o.SpaceEventType.ITEM_UPDATED:i=e.space.itemUpdated;break;case o.SpaceEventType.ITEM_DELETED:i=e.space.itemDeleted;break;case o.SpaceEventType.FLAGGED:i=e.space.flagged;break;case o.SpaceEventType.UNFLAGGED:i=e.space.unflagged;break;case o.SpaceEventType.LIKED:i=e.space.liked;break;case o.SpaceEventType.UNLIKED:i=e.space.unliked;break;case o.SpaceEventType.BASIC_SEARCH_RESULT:i=e.space.basicSearchResult;break;case o.SpaceEventType.DETAILED_SEARCH_RESULT:i=e.space.detailedSearchResult;break;case o.SpaceEventType.RECENT_SEARCH_ADDED:i=e.space.recentSearchAdded;break;case o.SpaceEventType.SEARCH_STATUS:i=e.space.searchStatus;break;case o.SpaceEventType.PARTICIPANT_UPDATED:i=e.space.participantUpdated;break;case o.SpaceEventType.LOCKED_WIKI_PAGE_CONTENT:i=e.space.lockedWikiPageContentEvent;break;case o.SpaceEventType.UNLOCKED_WIKI_PAGE_CONTENT:i=e.space.unlockedWikiPageContentEvent}break;case o.ContentType.CPAAS:switch(n="CPAAS."+e.cpaas.type,e.cpaas.type){case o.CPaaSEventType.SUBMIT_FORM_DATA:i=e.cpaas.submitFormData;break;case o.CPaaSEventType.INTEGRATION_STATE_CHANGED:i=e.cpaas.integrationStateChanged}break;case o.ContentType.TEAM:switch(n="Team."+e.team.type,e.team.type){case o.TeamEventType.NOTIFY:i=e.team.notifyEvent;break;case o.TeamEventType.NOTIFY_CANCEL:i=e.team.notifyCancelEvent;break;case o.TeamEventType.TEAM_CREATED:i=e.team.teamCreatedEvent.team;break;case o.TeamEventType.TEAM_UPDATED:i=e.team.teamUpdatedEvent.team;break;case o.TeamEventType.TEAM_DELETED:i=e.team.teamDeletedEvent.teamId;break;case o.TeamEventType.TEAM_MEMBERSHIP_CHANGED:i=e.team.teamMembershipChangedEvent}break;default:return null}return{name:n,data:i}},getMediaType:function(e){if(!e)return{audio:!1,video:!1,desktop:!1};var t={audio:!1,video:!1,desktop:!1};return e.forEach((function(e){switch(e){case o.RealtimeMediaType.AUDIO:t.audio=!0;break;case o.RealtimeMediaType.VIDEO:t.video=!0;break;case o.RealtimeMediaType.DESKTOP_SHARING:t.desktop=!0}})),t},isOfflineFailure:function(e){return e===o.ReturnCode.DISCONNECTED||e===o.ReturnCode.FAILED_TO_SEND||e===o.ReturnCode.REQUEST_TIMEOUT}};return e.Constants=o,e.PrivateData=a,e.Proto=s,e}((Circuit=function(e){"use strict";var t=e.Utils||{};t.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var n=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^/?>]*\/?)>/gi;function i(e,n,i){var r=t.EMOTICON_MAPPING[i];return r?String.fromCodePoint(r):""}return t.standardizeEmoticon=function(e){return e?e.replace(n,i):""},t.removeMentionHtml=function(e){var t=0;return e.replace(/(<span.*?>)|(<\/span>)/gi,(function(e,n,i){return n?n.match(/class="mention"/i)?"":(t++,n):i&&t?(t--,i):""}))},t.getDeviceSubtype=function(){switch(window.navigator.platform){case"node":return"NODE_SDK";case"iOS":return"IOS_SDK";case"Android":return"ANDROID_SDK";default:return"JS_SDK"}},e}((Circuit=function(e){"use strict";e.__server="",e.__domain="",e.isElectron=!(e.isSDK||"undefined"==typeof process||!process.versions||!process.versions.electron);var t,n=e.logger,i=e.Emoticons,r=e.Emoji;if(e.isElectron){var o=(t=require("electron").remote).getCurrentWindow();e.__server=o._domain||"",e.__sotelUser=!!o._sotelUser,e.productName=o._productName||"Circuit",e.productBrand=o._productBrand||""}else e.productName="string"==typeof __productName?__productName:"Circuit",e.productBrand="string"==typeof __productBrand?__productBrand:"";var a="https://",s=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^/?>]*\/?)>/gi,c=e.Utils||{};var l="(?:[\\w@'^=$%&amp;\\/~+\\{\\}\\-\\|.,?!:\\[\\]\\(\\)#]*[\\w@'^=$%&amp;\\/~+\\{\\}\\-\\|#])?",d=["items","parents","peerUsers","previousMembers"];c.trimCallForMobile=function(e){var t;return e&&(t=c.flattenObj(e)),t},c.trimConvForMobile=function(e){var t;return e&&(t=c.flattenObj(e),d.forEach((function(e){delete t[e]})),t.call=c.trimCallForMobile(e.call)),t},c.isPromise=function(e){return!(!e||"function"!=typeof e.then)},c.convertVersionToNumber=function(e){if("string"!=typeof e)return 0;var t=e.split("."),n=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0;i=Math.min(i,99);var r=parseInt(t[2],10)||0;return(r=Math.min(r,9999))+1e4*i+1e6*n},c.trimTextWithEmoticonsBeforeMatch=function(e,t,n){for(var i=e.indexOf(t),r=e.slice(i),o=e.slice(0,i),a=String.fromCharCode(17),c=String.fromCharCode(18),l=o.replace(s,(function(e,t){return a+t+c})),d=!0,u=l.length-1,E=l.length-1,C=E;o.length-1-u<=n&&E>=0;)18===l.charCodeAt(E)?(l=l.replaceAt(E,">"),d=!1):17===l.charCodeAt(E)&&(l=l.replaceAt(E,"<"),d=!0),C=E,E--,d&&u--;return(o=C>0?"..."+l.slice(C):l)+r},c.enhanceEncodeURI=function(e){var t={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(e).replace(/[!()#{}]/gi,(function(e){return t[e]}))},c.normalizeDn=function(e){return e?e.replace("+",""):""},c.cleanPhoneNumber=function(e){return e?e.replace(/[^*#\d+]/g,""):""},c.cleanPhoneNumberDigitsWithPin=function(e){return e?e.replace(/[^*#\d+,]/g,""):""},c.isMSDoc=function(e){return e.search(/<\S*?WordDocument>/i)>=0||e.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)>=0||e.search(/<meta[^>]*?Microsoft/i)>=0},c.isXCodeDoc=function(e){return e.search(/<meta[^>]*?Cocoa[^<]+?>/)>=0};var u=["eu.yourcircuit.com","na.yourcircuit.com"];c.isYourCircuitDomain=function(){var t=e.isElectron?e.__server:window.location.host;return-1!==u.indexOf(t)};var E=["eu.yourcircuit.com","na.yourcircuit.com","beta.circuit.com","circuit.siemens.com","partner.circuit.siemens.com","teams.univergeblue.com","bluebeta.circuit.com"];c.isProductionDomain=function(){var t=e.isElectron?e.__server:window.location.host;return-1!==E.indexOf(t)};var C=["tandi.circuitsandbox.net","adfs01.circuitsandbox.net","circuitsandbox.net","beta.circuit.com","eu.yourcircuit.com","na.yourcircuit.com","circuitdev.unify.com"];c.isIntegrationsSupported=function(){var t=e.isElectron?e.__server.split(":")[0]:window.location.hostname;return C.includes(t)},c.sanitizer=null,c.sanitize=function(e){if(!e||!c.sanitizer)return e||"";try{e=(e=(e=(e=e.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"')).replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,(function(e){return e.includes("class=")?e.replace(/class=".*?"/gi,(function(e){return e.includes("rich-text-highlight")?e:e.replace(/[^=]\s*(.*)/gi,(function(e){return e.slice(0,-1)+" rich-text-highlight"}))})):e.replace(">",(function(e){return' class="rich-text-highlight" '+e}))}))).replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,"")).replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),e=(e=(e=(e=(e=i?i.normalizeEmoticonHtml(e):e).replace(/<font[^>]*>|<\/font>/gi,"")).replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>")).replace(/(\r|\n)+(?=[^<]*?>)/gi," ")).replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof c.sanitizer&&(e=c.sanitizer(e));var t=e.split(/<\/?div.*?>|<\/?p.*?>/g).filter((function(e){return!!e})),r=t.length,o="";if(r>1)for(var a,s,l=/<br>(?![\s\S]*<br>)(?=(<[^/][^>]*><\/[^>]*>)*$|(<\/[^>]*>)*$|$)/i,d=0;d<r;d++)a=t[d].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!s||s.endsWith("</ul>")||s.endsWith("</ol>")||l.test(s)||(o+="<br>"),o+=a,s=a;else o=t[0];e=o}catch(t){return n.error("[Utils]: Error sanitizing content. ",t),n.error("[Utils]: Unexpected content: ",e),""}return e||""},c.sanitizeSymbols=function(e){return c.isMobile()&&"undefined"!=typeof he?e&&he.encode(e,{allowUnsafeSymbols:!0,decimal:!0}):e},c.convertSymbolCodes=function(e){return c.isMobile()?e&&e.replace(r.HTML_ENTITY_REGEX,(function(e){return function(e){var t=e.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(t)||t>=55296&&t<=57343||t>1114111)return e;var n="";return t>65535&&(t-=65536,n+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),n+=String.fromCharCode(t)}(e)})):e},c.retrieveTextOnly=function(e,t){if(!e||"PLAIN"===t)return e;e=(e=(e=(e=(e=e.replace(Circuit.Emoticons.HTML_REGEX,"")).replace(/&#\d+;/g,"")).replace(/<span.*?class=["']mention["'].*?>.*?>/g,"")).replace(c.URL_PATTERN,"")).replace(c.PSEUDO_URL_PATTERN,"");var n=document.createElement("div");return n.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi,"&nbsp;"),n.textContent.trim()},c.toPlainText=function(e,t){if(e&&(!t||"RICH"===t)){i&&(e=e.replace(i.HTML_REGEX,(function(e,t){return i.isEmoticonContent(e)?t:e})));var n=document.createElement("div");return n.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi,"&nbsp;"),n.textContent}return e},c.toPlainTextWithEmoticonHtml=function(e,t){if(e&&(!t||"RICH"===t)){var n=String.fromCharCode(17),o=String.fromCharCode(18);e=e.replace(i.HTML_REGEX,(function(e,t){return i.isEmoticonContent(e)?n+t+o:e})),e=r.convertEmojis(e);var a=String.fromCharCode(19),s=String.fromCharCode(20);e=e.replace(r.HTML_REGEX,(function(e,t){return r.isEmojiContent(e)?a+t+s:e}));var l=document.createElement("div");l.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi," ");var d=c.textToHtmlEscaped(l.textContent,!0);return(d=d.replace(/\x11([^\x11\x12]*)\x12/gim,(function(e,t){return i.getHtmlFromShortcut(t,!1,!0,!0)}))).replace(/\x13([^\x13\x14]*)\x14/gim,(function(e,t){return r.convertEmojis(t.replace(/&amp;/g,"&"))}))}return e},c.truncateFileName=function(e){return!e||e.length<=22?e:e.substring(0,10)+" ..."+e.substring(e.length-8,e.length)},c.convertItemText=function(e,t,n){return e?n?c.toPlainTextWithEmoticonHtml(e,t):c.toPlainText(e,t):""},c.createMentionedUsersArray=function(e,t){for(var n=[],i=/<span.*?class=["']mention["'].*?>/g,r=i.exec(e);null!==r;){var o=c.ABBR_PATTERN.exec(r[0]);o=o&&o[1],-1===n.indexOf(o)&&n.push(o),r=i.exec(e)}return t&&(n=n.filter((function(e){return t.some((function(t){return t.userId===e}))}))),n},c.createHashtagsArray=function(e){if(!e)return[];var t=e.match(/<span[^>]*class=["']hashtag["'][^>]*>/gim);return t?t.map((function(e){var t=c.ABBR_PATTERN.exec(e);return t&&t[1]})):[]},c.DEFAULT_HELP_URL="https://www.circuit.com/support",c.DEFAULT_FAQ_URL="https://www.circuit.com/unifyportalfaqdetail",c.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",c.NUMERIC_PATTERN="^[0-9]*$",c.NUMERIC_SIGN_PATTERN="^[*+]?[0-9]*$",c.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",c.URL_SEPARATORS_PATTERN=/(?=[.,;!]?\s+|[.,;!]$)/,c.URL_PATTERN=new RegExp("(http|ftp|https|circuit):\\/\\/[\\w-]+?((\\.|:)[\\w-]+?)*?"+l,"gim"),c.EXACT_URL_PATTERN=new RegExp("^"+c.URL_PATTERN.source+"$","i"),c.PSEUDO_URL_PATTERN=new RegExp("www\\.+[\\w-]+?(\\.[\\w-]+?)+?"+l,"gim"),c.PROTOCOL_PATTERN=/^(?:http|https|ftp):\/\//,c.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",c.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",c.ABBR_PATTERN=/abbr=["'](.*?)["']/,c.SPACE_HASHTAG_PATTERN=/#([_a-zA-Z0-9\u0080-\u009f\u00c0-\uffff]+)/g,c.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w*+\-$?^{!#%&'/=`|}~]+?(?:\.[\w*+\-$?^{!#%&'/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,c.EMAIL_ADDRESS_PATTERN=new RegExp("^"+c.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),e.isElectron&&t&&(c.SSO_EMAIL_DOMAINS_MAPPING=t.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING||[],c.SSO_PATTERN="[_a-z0-9-]+?@(("+c.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",c.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(c.SSO_PATTERN,"i")),c.CIRCUIT_CONVERSATION_HASH_PATTERN=/#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(&user=(\d)+?)?)))?$/gim,c.CIRCUIT_SPACE_HASH_PATTERN=/#\/space\/[0-9\-a-z]+?(\?page=[0-9\-a-z]+?)?(\?topic=[0-9\-a-z]+?(&reply=[0-9\-a-z]+?)?)?$/gim,c.CIRCUIT_LINKS_HASH_PATTERN=/#\/(profile|phone|user|search)\/[0-9\-a-z]+?$/gim,c.CIRCUIT_HASH_TAG_SEARCH_PATTERN=/#\/search\/[a-zA-Z\u0080-\u009f\u00a1-\uffff0-9_]+/gim,c.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#\\/email\\/"+c.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),c.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,c.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,c.PHONE_PAC=/^([#*]+[#*()\-\s+\d]*)$/,c.PHONE_DIAL_PATTERN=/^([#*()\\/\-.\s+\d,]*)$/,c.PHONE_DIAL_WITH_PIN_PATTERN=/^([#*()\\/\-.\s+\d]*)(,+[,\d#*]+)$/,c.PHONE_WITH_EXTENSION_PATTERN=/^([#*()\\/\-.\s+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,c.TIME_PATTERN=/^((([0-1]?[0-9]|2[0-3]):[0-5][0-9]\s*)|((0?[1-9]|1[0-2]):[0-5][0-9]\s*(PM|AM)))$/,c.IPV4_ADDRESS_PATTERN=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,c.TCP_PORT_NUMBERS_PATTERN=/^(0|([1-9]\d{0,3}|[1-5]\d{4}|[6][0-5][0-5]([0-2]\d|[3][0-5])))$/,c.FQDN_PATTERN=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/,c.matchPhonePattern=function(e){return e&&"string"==typeof e?e.match(c.PHONE_PATTERN):null},c.matchUrlPattern=function(e){return e&&"string"==typeof e?e.match(c.URL_PATTERN)||e.match(c.PSEUDO_URL_PATTERN):null},c.matchEmailPattern=function(e){return e&&"string"==typeof e?e.match(c.EMAIL_ADDRESS_INCLUDED_PATTERN):null},c.getEmails=function(e){var t=e&&e.split(/[;,]\s*|\s+/i);return(t=t&&t.map((function(e){var t=e.match(c.EMAIL_ADDRESS_INCLUDED_PATTERN);return t&&t[0]})).filter((function(e){return!!e})))||[]},c.getBadge=function(e){return e.isPoll?"poll":e.isQuestion?e.hasBestAnswer?"best-answer":"question":""},c.getTags=function(e){return e&&e.split(/[;,]\s*/i).reduce((function(e,t){var n=t.trim();return n.length&&e.push(n),e}),[])},c.matchNames=function(e,t,n){if(!e||"string"!=typeof e||!t)return!1;var i=new RegExp("^"+RegExp.escape(t),n||"i");return i.test(e)||e.split(" ").some((function(e){return i.test(e)}))},c.matchIpOrFqdnPattern=function(e){return e&&"string"==typeof e?e.match(c.IPV4_ADDRESS_PATTERN)||e.match(c.FQDN_PATTERN):null},c.compareStrings=function(e,t){return"string"==typeof e&&"string"==typeof t&&new RegExp("^"+RegExp.escape(e)+"$","i").test(t)},c.rstring=function(){return Math.floor(1e9*Math.random()).toString()},c.randomNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},c.randomBoolean=function(){return Math.random()<.5},c.createTransactionId=function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(e[19]?3:8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},c.getLegalRegion=function(e){switch(e){case"europe":var t=(navigator.language||navigator.browserLanguage).split("-");return"de"===c.lastArrayElement(t).toLowerCase()?"de":"uk";case"americas":case"apac":default:return"us"}},c.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome",version:process.versions.chrome};if(window.cordova&&"ios"===window.cordova.platformId)return{cordovaios:!0,type:"cordovaios"};var e,t={},n=navigator.userAgent.toLowerCase(),i=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(n)||/(opera|opr)\/(?:.*version\/|)([\d.]+)/.exec(n)||/(firefox)\/([\d.]+)/.exec(n)||/(edge)\/([\d.]+)/.exec(n)||/(edg)\/([\d.]+)/.exec(n)||/(chrome)\/([\d.]+)/.exec(n)||/version\/([\d.]+).*(safari)/.exec(n)||/(phantomjs)\/([\d.]+)/.exec(n)||[],r=i[1]||"",o=i[2]||0;if("safari"===o)r=i[2],o=i[1];else switch(r){case"trident":r="msie";break;case"opr":r="opera";break;case"edg":r="chrome",e="edge"}return t[r]=!0,t.type=r,t.version=o,e&&(t.subType=e),t};var T=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];function p(e){if(!e)return"";var t=document.createElement("div"),n=document.createElement("div");e=e.replace(/\$/gm,"$$$$");var i=0;return e=e.replace(/(<span.*?>)|(<\/span>)/gi,(function(e,t,n){return t?t.match(/class="mention"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):t.match(/class="hashtag"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="hashtag" abbr="$1"><a href="#/search/$1">'):(i++,t):n?i?(i--,n):"</a></span>":""})),c.isMobile()||(e=r.convertEmojis(e)),t.innerHTML=e,function e(t,n){if(!t||!t.childNodes||!t.childNodes.length)return t;for(var i,r=0,o=t.childNodes.length;r<o;r++)switch((i=t.childNodes[r]).nodeType){case 1:if("A"===i.nodeName){var a=S(),s=c.getCircuitRelativeLink(a,i.href);s?(i.removeAttribute("target"),i.href=s):(i.target="_blank",i.rel="noopener noreferrer")}if(i.classList.contains("link-preview")||i.classList.contains("fr-link"))break;e(i,n);break;case 3:for(n.innerHTML=c.linkifyText(i.textContent,"PRE"===i.parentNode.tagName),r+=n.childNodes.length-1;n.childNodes.length;)t.insertBefore(n.childNodes[0],i);t.removeChild(i),o=t.childNodes.length}return t}(t,n).innerHTML.replace(/&nbsp;/gi," ")}function S(){return e.isElectron?a+e.__server:window.location&&window.location.origin}c.getOSInfo=function(e){var t=e=e||window.navigator.userAgent,i="",r="";if(T.some((function(n){return!!n.r.test(e)&&(t=n.s,!0)}))&&/Windows/.test(t))r=/Windows (.*)/.exec(t)[1],i="Windows";else{i=t;try{switch(t){case"Mac OS X":r=/Mac OS X (10[._\d]+)/.exec(e)[1];break;case"Android":r=/Android ([._\d]+)/.exec(e)[1]}}catch(t){n.debug("[Utils]: osVersion does not contain version on it. ",e)}}return{type:i,version:r,info:t}},c.checkUserDomain=function(t,n){var i=e.isElectron?e.__server.split(":")[0]:window.location.hostname;return n?i.startsWith(t):i.endsWith(t)},c.parseIpWithPort=function(e){if(!e||"string"!=typeof e)return null;if("["===e[0]){var t=/\[(.*)\]:(\d*)/.exec(e);if(t&&3===t.length)return{ipAddress:t[1],port:t[2]}}else if(e.includes(":")){var n=e.split(":");if(2===n.length)return{ipAddress:n[0],port:n[1]}}return null},c.isEmptyObject=function(e){return 0===Object.keys(e).length},c.getBaseObject=function(e,t){if(!e||"object"!=typeof e)return null;if(Array.isArray(e))return e;var n=Object.getPrototypeOf(e);return c.isEmptyObject(n)?e:(!1!==t&&Object.getOwnPropertyNames(n).forEach((function(t){"function"!=typeof n[t]&&e.hasOwnProperty(t)&&(n[t]=e[t])})),n)},c.syncBaseObject=function(e){var t=c.getBaseObject(e,!0);t&&t!==e&&Object.getOwnPropertyNames(t).forEach((function(t){e.hasOwnProperty(t)&&delete e[t]}))},c.flattenObj=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return e;var t=Object.getPrototypeOf(e);if(c.isEmptyObject(t))return e;var n={};for(var i in e)"function"!=typeof e[i]&&(n[i]=e[i]);return n},c.getNormalizedFileExtension=function(e){var t=e&&(e.fileName||e.name);if(!t)return null;if(/audio/i.test(e.mimeType))return"audio";if(/video/i.test(e.mimeType))return"video";var n=t.split(".").pop();if(n)switch(n.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio";case"vtt":return"vtt"}return"def"},c.getImageFileExtension=function(e){if(e.type)switch(e.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},c.getMimeTypes=function(e){if(!e)return null;var t=e.split(".").pop();if(t)switch(t.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},c.textToHtmlEscaped=function(e,t){if(!e)return"";var n=t?"&nbsp;":"<br>";return e.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,n)},c.escapedHtmlToText=function(e){return e?e.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},c.stripParenthesis=function(e){for(var t=(e=e.trim()).match(/\(/g)||[],n=e.match(/\)/g)||[],i=0;"("===e[i];)i++;return e.slice(i,e.length-Math.abs(t.length-i-n.length))},c.linkifyText=function(e,t){t||(e=e.replace(/\xA0|&#160;|\x0A|\x0D/gim," "));for(var n=String.fromCharCode(17),i=String.fromCharCode(18),r=String.fromCharCode(19),o=function(e){var t="",o="",s=S(),l=c.getCircuitRelativeLink(s,e);if(!l){var d=!0;if(l=e,e.startsWith("circuit://"))new RegExp(s.replace(a,"")+"\\/guest\\?token=","i").exec(e)?l=e.replace("circuit://",a):d=!1;else c.PROTOCOL_PATTERN.exec(e)||(l="http://"+l);t=d?" target="+r+"_blank"+r:"",o=" rel="+r+"noopener noreferrer"+r}return n+"a href="+r+l+r+t+o+i+e+n+"/a"+i},s=e.split(c.URL_SEPARATORS_PATTERN),l=0;l<s.length;l++){var d=s[l],u=c.stripParenthesis(d),E=u;E.search(/http|ftp|https|circuit/gim)>=0&&E.search(c.URL_PATTERN)>=0?E=E.replace(c.URL_PATTERN,o):E.search(/www\./gim)>=0&&E.search(c.PSEUDO_URL_PATTERN)>=0?E=E.replace(c.PSEUDO_URL_PATTERN,o):E.search(/\S@\S/gim)>=0&&E.search(c.EMAIL_ADDRESS_INCLUDED_PATTERN)>=0&&(E=E.replace(c.EMAIL_ADDRESS_INCLUDED_PATTERN,n+"a href="+r+"mailto:$&"+r+" target="+r+"_blank"+r+" rel="+r+"noopener noreferrer"+r+i+"$&"+n+"/a"+i)),d=d.replace(u,E),s[l]=d}return e=s.join(""),c.textToHtmlEscaped(e).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")},c.linkifyContent=function(e,t){if(!e)return"";return e.length>5e4?e:(e=i.addEmoticonsAltAttr(e),"PLAIN"===t?c.linkifyText(e):p(e))},c.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],c.hasScrollbar=function(e){if(e&&e.length>0){var t=e[0];return!!t&&t.scrollHeight>t.clientHeight}return!1},c.isDescendantOrEqual=function(e,t){if(e===t)return!0;for(var n=e;n;)if((n=n.parentElement)===t)return!0;return!1},c.isSupportedImage=function(e){return/^image\/(jpeg|gif|bmp|png)$/i.test(e)},c.isVideoSupportedByBrowser=function(e){return/^video\/(quicktime|mp4|webm)$/i.test(e)},c.shallowCopy=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.slice();var t=c.flattenObj(e),n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},c.normalizeLocaleProto=function(e){var t;return e&&e.length>=5&&(t=e.replace(/-/g,"_").toUpperCase()),t},c.normalizeLocale=function(e){var t;return e&&e.length>=5&&(t=e.substr(0,2).toLowerCase()+e.substr(2,e.length-2).replace(/_/g,"-")),t},c.getTimezoneName=function(e){return(e=e||new Date).toLocaleDateString("en-US",{timeZoneName:"long"}).split(", ").pop()},c.getTimezone=function(e){return"number"!=typeof e&&(e=(new Date).getTimezoneOffset()),(e>0?"-":"+")+Math.floor(Math.abs(e)/60)+(Math.floor(Math.abs(e)%60)+"").padStart(2,"0")},c.delayOrTimestamp=function(e,t){return e>0?Date.now()+e:t},c.buildAttachmentMetaData=function(e){var t=function(e){var t={fileId:e.fileId,fileName:e.fileName,itemId:e.itemId,mimeType:e.mimeType,size:e.size};return e.thumbnail&&e.thumbnail.fileId&&(t.thumbnailId=e.thumbnail.fileId),e.inlineUsage&&(t.inlineUsage=e.inlineUsage),t},n=[],i=[];return e&&e.forEach((function(e){if(e.isThirdParty){var r=t(e);i.push({type:e.provider,attachment:r,downloadLocation:e.url,previewLocation:e.url,shareLinkToken:e.shareLinkToken})}else n.push(t(e)),e.thumbnail&&n.push(t(e.thumbnail))})),{attachments:n,externalAttachments:i}},c.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.parent=t.prototype},c.bytesToSize=function(e,t){if(!(e=parseInt(e,10)))return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return Number((e/Math.pow(1024,n)).toPrecision(t||3))+" "+["Bytes","KB","MB","GB","TB","PB"][n]},c.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(-1!==window.navigator.userAgent.indexOf("Mac")||-1!==window.navigator.userAgent.indexOf("Darwin")),c.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),c.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},c.isIOS=function(){return"iOS"===window.navigator.platform},c.formatPIN=function(e,t,n){if(!t)return"";if(n)return(e||"")+t+"#";for(var i,r=[],o=e?3:4,a=0;a<t.length;a+=o)a>0&&(o=3),(i=t.substr(a,o)).length>=2||0===r.length?r.push(i):r[r.length-1]+=i;return e&&r.unshift(e),r.push("#"),r.join(" ")},c.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],c.CountryCodeToCountryNameResourceMap={},c.CountriesArray.forEach((function(e){c.CountryCodeToCountryNameResourceMap[e.code]=e.name})),c.getCircuitRelativeLink=function(t,n){if(!n)return"";if(t=t||S(),e.isElectron&&0===n.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return"#"+n.split("#")[1];if(n.startsWith("#/"))return n;if(c.PROTOCOL_PATTERN.exec(t)||(t=a+t),t.endsWith("/")||(t+="/"),c.PROTOCOL_PATTERN.exec(n)||(n=n.startsWith("circuit://")?n.replace("circuit://",a):a+n),!n.startsWith(t)){var i=t.startsWith("https://partner.")?t.replace("https://partner.",a):t.replace(a,"https://partner.");n.startsWith(i)&&(n=n.replace(i,t))}if(n.length>t.length&&n.startsWith(t)){var r=n.slice(t.length),o=r.match(c.CIRCUIT_CONVERSATION_HASH_PATTERN);if(o)return o[0].replace(/\/(muted|open)/gim,"/conversation");if(o=r.match(c.CIRCUIT_SPACE_HASH_PATTERN))return o[0];var s=r;try{s=decodeURI(s)}catch(e){}return(o=r.match(c.CIRCUIT_LINKS_HASH_PATTERN)||r.match(c.CIRCUIT_EMAIL_HASH_PATTERN)||s.match(c.CIRCUIT_HASH_TAG_SEARCH_PATTERN))&&o[0]}return""},c.isCircuitLink=function(e,t){return!!c.getCircuitRelativeLink(e,t)},c.throttle=function(e,t,n){var i,r,o,a=null,s=0;n=n||{};var c=function(){s=!1===n.leading?0:Date.now(),a=null,o=e.apply(i,r),i=r=null};return function(){var l=Date.now();s||!1!==n.leading||(s=l);var d=t-(l-s);return i=this,r=arguments,d<=0?(a&&(window.clearTimeout(a),a=null),s=l,o=e.apply(i,r),i=r=null):a||!1===n.trailing||(a=window.setTimeout(c,d)),o}},c.hasEmptyPrototype=function(e){return!(!e||"object"!=typeof e)&&c.isEmptyObject(Object.getPrototypeOf(e))},c.compareElements=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;var n=t.slice();return e.every((function(e){return n.some((function(t,i){return!!c.compareElements(e,t)&&(n.splice(i,1),!0)}))}))}if(!c.hasEmptyPrototype(e)||!c.hasEmptyPrototype(t))return!1;for(var i in e)if(e.hasOwnProperty(i)&&0!==i.indexOf("$$")&&!c.compareElements(e[i],t[i]))return!1;return!0},c.copyToClipboard=function(e,t,i){var r,o,a,s,c;if(e)try{o=document.createRange(),r=window.getSelection(),s=document.body.style.overflow,c=this.getBrowserInfo().msie,a=i?document.createElement("textarea"):document.createElement("div"),i||(e=e.replace(/\r\n/gi,"<br>")),a.style.backgroundColor="#fff",a.style.font="normal normal 15px Calibri, sans-serif",a.style["white-space"]="pre-wrap",i?(a.value=e,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),r.removeAllRanges(),a.select(),a.setSelectionRange(0,e.length)):(a.innerHTML=e,document.body.appendChild(a),o.selectNode(a),r.removeAllRanges(),r.addRange(o)),c&&(document.body.style.overflow="hidden"),document.execCommand("copy")?t&&t():t&&t("Failed to copy")}catch(e){n.error("[Utils]: Copy to clipboard failed"),t&&t("Internal error")}finally{r&&("function"!=typeof r.removeRange||i?r.removeAllRanges():r.removeRange(o)),c&&(document.body.style.overflow=s),a&&document.body.removeChild(a)}},c.toCamelCase=function(e){if(!e||"string"!=typeof e)return"";for(var t=e.toLowerCase().split(/[_-]/),n=1;n<t.length;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1);return t.join("")},c.sslProxify=function(e,t){return e&&!c.PROTOCOL_PATTERN.exec(e)&&(e=e.startsWith("//")?e.replace("//",t):t+e),e&&e.startsWith("http://")?"https://embed-proxy.circuitsandbox.net/?target="+encodeURIComponent(e):e},c.parsePreviewObject=function(e,t){var n=c.PROTOCOL_PATTERN.test(e)?e:"http://"+e,i={preview:{type:t.type,title:t.title||"",description:t.description||"",provider:t.provider_name||"",srcURL:e,previewURL:n,imageURI:t.thumbnail_url}};switch(i.previewImageURISecure=c.sslProxify(i.preview.imageURI,c.getUrlProtocol(n)),t.type){case"photo":i.previewImageURISecure=c.sslProxify(e,c.getUrlProtocol(e));break;case"video":i.preview.html=t.html;break;case"rich":i.preview.type="link"}return i},c.appIsFocused=function(){if(e.isElectron){var n=t.getCurrentWindow();return n.isFocused()&&n.isVisible()&&!n.isMinimized()}return!0!==document.hidden},c.validatePreviewProtocol=function(e){return e?e.match(/https:/)?e:e.replace('src="//','src="https://'):""},c.getUrlProtocol=function(e){return e&&c.PROTOCOL_PATTERN.exec(e)?e.split("/")[0]+"//":"http://"},c.TabSelector=function(e){if(Array.isArray(e)&&0!==e.length){var t=this,n={},i="";e.forEach((function(e,r){0===r?(n[e]=!0,i=e):n[e]=!1,Object.defineProperty(t,e,{get:function(){return n[e]},set:function(t){t&&(Object.keys(n).forEach((function(e){n[e]=!1})),n[e]=!0,i=e)},enumerable:!0,configurable:!1})})),Object.defineProperty(this,"selected",{get:function(){return i},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return e.indexOf(i)},enumerable:!0,configurable:!1})}},c.getOrigin=S,c.parseQS=function(e){var t={};e=e.substring(1);for(var n=/([^&=]+)=([^&]*)/g,i=n.exec(e);i;)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),i=n.exec(e);return t},c.toQS=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)&&void 0!==e[n]){var i=e[n];Array.isArray(i)?i.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}return t.join("&")},c.extractConfigurableText=function(e,t,n){var i=e&&e.find((function(e){return e.type===t}));if(!i||!i.texts)return"";var r,o=function(e){return i.texts.find((function(t){return t.language===e}))};return n&&((r=o(n))||(r=o(n=n.split("-",1)[0]))),r||(r=o("default")),r&&r.translation},c.selectMediaDevice=function(e,t,n){return e&&t?(t.some((function(t){return!!(i=void 0===t.id?t:e.find((function(e){return t.id===e.id})))})),!i&&n&&t.some((function(t){return!!(i=e.find((function(e){return t.label===e.label})))})),i):null;var i},c.addDeviceToPreferredList=function(e,t){if(!t)return e||[];if(!e)return[t];var n=e.findIndex((function(e){return e.id===t.id}));return-1!==n&&e.splice(n,1),e.unshift(t),e=e.slice(0,5)},c.removeArrayElement=function(e,t){if(Array.isArray(e)&&void 0!==t&&t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},c.binaryInsert=function(e,t,n,i){return function e(t,n,i,r,o,a){if(!n||!Array.isArray(t))return-1;if(0===t.length)return t.push(n),0;if(o=o||0,(a=a||t.length-1)-o<=1)return i(n,t[o])<0?(t.splice(o,0,n),o):i(n,t[a])>0?(t.splice(a+1,0,n),a+1):n[r]===t[o][r]?(t[o]=n,o):n[r]===t[a][r]?(t[a]=n,a):(t.splice(a,0,n),a);var s=Math.floor((a-o)/2)+o;return i(n,t[s])<0?e(t,n,i,r,o,s):e(t,n,i,r,s,a)}(e,t,n,i||"id")},c.isEmptyArray=function(e){return 0===e.length},c.lastArrayElement=function(e){if(e.length>0)return e[e.length-1]},c.shuffleArray=function(e){if(e.length)for(var t=e.length,n=0;n<t;n++){var i=Math.floor(Math.random()*t),r=e[i];e[i]=e[n],e[n]=r}return e},c.randomArrayCopy=function(e,t){if(Array.isArray(e)){var n=e.slice(0);return c.shuffleArray(n),n.splice(0,t)}return null},c.moveArrayElement=function(e,t,n){if(!("number"!=typeof t||"number"!=typeof n||t<0||t>=e.length||n<0||t===n)){for(var i=e.length;i<=n;i++)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}},c.emptyArray=function(e){if(e.length)for(;e.length>0;)e.pop()},c.getAvatarImageFormat=function(e){return/[\w]+:[\w]+\/png/.exec(e)?"png":"jpeg"},c.displayNameToInitials=function(e){if(!e)return"";var t=e.indexOf("@"),n=t>=0?e.slice(0,t).split("."):e.split(/[ ]+/);return((n[0][0]||"")+(n[1]&&n[1][0]||"")).toUpperCase()};var I,A,R,f,_=["pdf","doc","xls","ppt","html","csv","jpg","png","zip","log","video","audio"];c.getIconFile=function(e){return _.includes(e)?"icon-file-"+e:"icon-file-generic"},"function"!=typeof Object.values&&(Object.values=function(e){return Object.keys(e).map((function(t){return e[t]}))}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return null!=e&&(e=e.toString(),t=Math.floor(t)||0,this.substr(t,e.length)===e)}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){return null!=e&&(t=void 0===t?this.length:Math.min(Math.floor(t)||0,this.length),!((t-=(e=e.toString()).length)<0)&&this.substr(t,e.length)===e)}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),String.prototype.repeat||Object.defineProperty(String.prototype,"repeat",{value:function(e){if(null===this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0===t.length||0===e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="",i=0;i<e;i++)n+=t;return n}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{value:function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{value:function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}}),Object.defineProperty(String.prototype,"format",{value:function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,n){return void 0!==e[n]&&null!==e[n]?e[n]:t}))}}),Object.defineProperty(String.prototype,"replaceAt",{value:function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)}}),Object.defineProperty(String.prototype,"randomCharacter",{value:function(){return this[Math.floor(this.length*Math.random())]}}),Array.from||(Array.from=(I=Object.prototype.toString,A=function(e){return"function"==typeof e||"[object Function]"===I.call(e)},R=Math.pow(2,53)-1,f=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),R)},function(e){var t=this,n=Object(e);if(null===e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!A(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var o,a=f(n.length),s=A(t)?Object(new t(a)):new Array(a),c=0;c<a;)o=n[c],s[c]=r?void 0===i?r(o,c):r.call(i,o,c):o,c+=1;return s.length=a,s})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return o;return-1}}),Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),RegExp.escape=function(e){return e?e.replace(/[.*+?|()[\]{}\\$^]/g,"\\$&"):""},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var v={format:function(e,t){if("undefined"!=typeof PhoneNumberUtil&&e&&"+"===e.charAt(0))try{var n=e.match(c.PHONE_DIAL_WITH_PIN_PATTERN),i="";n&&(e=n[1],i=t?"":n[2]);var r=PhoneNumberUtil.parseAndKeepRawInput(e,null);e=PhoneNumberUtil.formatInternational(r)+i}catch(e){}return e}};return e.Utils=c,e.PhoneNumberFormatter=v,e}((Circuit=function(e){"use strict";var t={SIGNATURE:"ansibleChromeExtensionSignature"};return t.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),t.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),t.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager",PRIVACY_SETTINGS:"privacySettings"}),t.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),t.BgLogMsgType=Object.freeze({LOG:"log"}),t.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront",GET_FILE:"getFile"}),t.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),t.BgPrivacySettingsMsgType=Object.freeze({SET_IP_HANDLING_POLICY:"setWebRTCIPHandlingPolicy",GET_IP_HANDLING_POLICY:"getWebRTCIPHandlingPolicy",IP_HANDLING_POLICY_CHANGED:"webRTCIPHandlingPolicyChanged"}),t.BgPrivacySettingsError=Object.freeze({NOT_AUTHORIZED:"notAuthorized",NOT_CONTROLLABLE:"notControllable",CONTROLLED_BY_OTHER_EXTENSIONS:"controlledByOtherExtensions"}),t.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",AUTODISCOVER_GET_SERVER:"autodiscoverGetServer",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken",GET_OOO_MSG:"getOooMsg",GET_USER_AVAILABILITY:"getUserAvailability"}),t.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled",RESTART_HEADSET_APP:"restartHeadsetApp"}),t.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut",MAILBOX_NOT_FOUND:"mailboxNotFound",NTLM_NOT_SUPPORTED:"ntlmNotSupported"}),t.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),t.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),t.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),e.ChromeExtension=t,"undefined"!=typeof module&&module.exports&&(module.exports=t),e}((Circuit=function(e){"use strict";var t=null;try{t=window.localStorage||t}catch(e){t=window.sessionStorage||t}function n(e,n){try{return t?t[e].apply(t,n):null}catch(e){return null}}var i={getItem:function(e){return n("getItem",[e])},setItem:function(e,t){return n("setItem",[e,t])},removeItem:function(e){return n("removeItem",[e])}};return e.storeManager=i,e}((Circuit=function(e){"use strict";return e.Error=function(e,t){this.code=e||"UNEXPECTED_ERROR","string"==typeof t?this.message=t:"object"==typeof t&&(this.errObj=t,t.info&&!t.message&&(t.message=t.info)),this.stack=Error().stack},e.Error.prototype=Object.create(Error.prototype),e.Error.prototype.name="Error",e}((Circuit=function(e){"use strict";var t=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),n=t.Warning,i="undefined"!=typeof _circuitLogger?_circuitLogger:{setLevel:function(e){n=e},getLevel:function(){return n},debug:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){n<=t.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){n<=t.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){n<=t.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(e,i){n<=t.Error&&(e=e&&e.stack||e,(i=i&&i.stack||i)?console.error(e,i):console.error(e))},msgSend:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(e,t,n){switch(e.name){case"DEBUG":this.debug(t,n);break;case"INFO":this.info(t,n);break;case"WARN":case"WARNING":case"ERROR":this.info(t,n);break;default:this.debug(t,n)}},setExtensionVersion:function(e){console.log("ExtensionVersion = "+e)}};return e.logger=i,e.Enums=e.Enums||{},e.Enums.LogLevel=t,e}((Circuit=function(e){"use strict";e.isSDK=!0;var t={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?t={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(t={name:process.argv[0]}):t={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:t.hostname}),navigator.platform||(navigator.platform=t.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(e){return new Buffer(e).toString("base64")}),e._runtime=t,e.DefaultAvatars={},e}(Circuit||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{});
return Circuit;

}));
